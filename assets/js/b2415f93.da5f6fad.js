"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[69824],{58709:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var n=t(85893),a=t(11151);const s={displayed_sidebar:"English"},r="List partitioning",o={id:"table_design/list_partitioning",title:"List partitioning",description:"Since v3.1, StarRocks supports list partitioning. Data is partitioned based on a predefined value list for each partition, which can accelerate queries and facilitate management according to enumerated values.",source:"@site/versioned_docs/version-3.1/table_design/list_partitioning.md",sourceDirName:"table_design",slug:"/table_design/list_partitioning",permalink:"/doc/docs/table_design/list_partitioning",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/edit/main/docs/table_design/list_partitioning.md",tags:[],version:"3.1",frontMatter:{displayed_sidebar:"English"},sidebar:"English",previous:{title:"Expression partitioning (recommended)",permalink:"/doc/docs/table_design/expression_partitioning"},next:{title:"Dynamic partitioning",permalink:"/doc/docs/table_design/dynamic_partitioning"}},d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Usage",id:"usage",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Examples",id:"examples",level:3},{value:"Limits",id:"limits",level:2}];function l(e){const i=Object.assign({h1:"h1",p:"p",h2:"h2",img:"img",strong:"strong",code:"code",a:"a",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",h3:"h3",pre:"pre",ul:"ul",li:"li"},(0,a.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"list-partitioning",children:"List partitioning"}),"\n",(0,n.jsx)(i.p,{children:"Since v3.1, StarRocks supports list partitioning. Data is partitioned based on a predefined value list for each partition, which can accelerate queries and facilitate management according to enumerated values."}),"\n",(0,n.jsx)(i.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsx)(i.p,{children:"You need to explicitly specify the column values list in each partition. These values do not need to be continuous, unlike the continuous time or numeric range required in Range Partitioning. During data loading, StarRocks will store the data in the corresponding partition based on the mapping between the data's partitioning column values and the predefined column values for each partition."}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"list_partitioning",src:t(98997).Z+"",width:"463",height:"440"})}),"\n",(0,n.jsx)(i.p,{children:"List partitioning is suitable for storing data whose columns contain a small number of enum values, and you often query and manage data based on these enum values. For example, columns represent geographical locations, states, and categories. Each value in a column represents an independent category. By partitioning data based on enum values, you can improve query performance and facilitate data management."}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"List partitioning is particularly useful for scenarios where a partition needs to include multiple values for each partitioning column"}),". For example, if a table includes the ",(0,n.jsx)(i.code,{children:"City"})," column representing the city where an individual is from, and you often query and manage data by states and cities. At table creation, you can use the ",(0,n.jsx)(i.code,{children:"City"})," column as the partitioning column for List Partitioning and specify that data of various cities within the same state are placed in one partition, for example ",(0,n.jsx)(i.code,{children:'PARTITION pCalifornia VALUES IN ("Los Angeles", "San Francisco", "San Diego")'}),". This method can accelerate queries based on states and cities while facilitating data management."]}),"\n",(0,n.jsxs)(i.p,{children:["If a partition only needs to contain data with the same value of each partitioning column, it is recommended to use ",(0,n.jsx)(i.a,{href:"/doc/docs/table_design/expression_partitioning",children:"expression partitioning"}),"."]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsxs)(i.strong,{children:["Comparison between list partitioning and ",(0,n.jsx)(i.a,{href:"/doc/docs/table_design/expression_partitioning",children:"expression partitioning"})]})}),"\n",(0,n.jsx)(i.p,{children:"The main difference between list partitioning and expression partitioning (recommended) is that list partitioning requires you to manually create partitions one by one. On the other hand, expression partitioning can automatically create partitions during loading to simplify partitioning. And in most cases, expression partitioning can replace list partitioning. The specific comparison between the two is shown in the following table:"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Partitioning method"}),(0,n.jsx)(i.th,{children:(0,n.jsx)(i.strong,{children:"List partitioning"})}),(0,n.jsx)(i.th,{children:(0,n.jsx)(i.strong,{children:"Expression partitioning"})})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"Syntax"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"PARTITION BY LIST (partition_columns)\uff08    PARTITION <partition_name> VALUES IN (value_list)    [, ...] )"})}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"PARTITION BY <partition_columns>"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"Multiple values for each partitioning column in a partition"}),(0,n.jsxs)(i.td,{children:["Supported. A partition can store data with different values in each partitioning column. In the following example, when the loaded data contains values ",(0,n.jsx)(i.code,{children:"Los Angeles"}),", ",(0,n.jsx)(i.code,{children:"San Francisco"}),", and ",(0,n.jsx)(i.code,{children:"San Diego"})," in the ",(0,n.jsx)(i.code,{children:"city"})," column, all the data is stored in one partition. ",(0,n.jsx)(i.code,{children:"pCalifornia"}),".",(0,n.jsx)(i.code,{children:'PARTITION BY LIST (city) (    PARTITION pCalifornia VALUES IN ("Los Angeles","San Francisco","San Diego")    [, ...] )'})]}),(0,n.jsxs)(i.td,{children:["Not supported. A partition stores data with the same value in  the partitioning column For example, the expression ",(0,n.jsx)(i.code,{children:"PARTITION BY (city)"})," is used in expression partitioning. When the loaded data contains values ",(0,n.jsx)(i.code,{children:"Los Angeles"}),", ",(0,n.jsx)(i.code,{children:"San Francisco"}),", and ",(0,n.jsx)(i.code,{children:"San Diego"})," in the ",(0,n.jsx)(i.code,{children:"city"})," column, StarRocks will automatically create three partitions ",(0,n.jsx)(i.code,{children:"pLosAngeles"}),", ",(0,n.jsx)(i.code,{children:"pSanFrancisco"}),", and ",(0,n.jsx)(i.code,{children:"pSanDiego"}),". The three partitions respectively store data with values ",(0,n.jsx)(i.code,{children:"Los Angeles,"})," ",(0,n.jsx)(i.code,{children:"San Francisco"}),", and ",(0,n.jsx)(i.code,{children:"San Diego"})," in the ",(0,n.jsx)(i.code,{children:"city"})," column."]})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"Create partitions before data loading"}),(0,n.jsx)(i.td,{children:"Supported. Partitions need to be created at table creation."}),(0,n.jsx)(i.td,{children:"No need to do so. Partitions can be automatically created during data loading."})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"Automatically create List partitions during data loading"}),(0,n.jsx)(i.td,{children:"Not supported. If a partition corresponding to the data does not exist during data loading, an error is returned."}),(0,n.jsx)(i.td,{children:"Supported. If a partition corresponding to the data does not exist during data loading, StarRocks automatically creates the partition to store the data. Each partition can only contain data with the same value for the partitioning column."})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"SHOW CREATE TABLE"}),(0,n.jsx)(i.td,{children:"Returned the partitions definition in the CREATE TABLE statement."}),(0,n.jsxs)(i.td,{children:["After data is loaded, the statement returns the result with the partition clause used in the CREATE TABLE statement, that is, ",(0,n.jsx)(i.code,{children:"PARTITION BY (partition_columns)"}),". However, the returned result does not show any automatically created partitions. If you need to view the automatically created partitions, execute ",(0,n.jsx)(i.code,{children:"SHOW PARTITIONS FROM <table_name>"}),"."]})]})]})]}),"\n",(0,n.jsx)(i.h2,{id:"usage",children:"Usage"}),"\n",(0,n.jsx)(i.h3,{id:"syntax",children:"Syntax"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-sql",children:"PARTITION BY LIST (partition_columns)\uff08\n    PARTITION <partition_name> VALUES IN (value_list)\n    [, ...]\n)\n\npartition_columns::= \n    <column> [,<column> [, ...] ]\n\nvalue_list ::=\n    value_item [, value_item [, ...] ]\n\nvalue_item ::=\n    { <value> | ( <value> [, <value>, [, ...] ] ) }    \n"})}),"\n",(0,n.jsx)(i.h3,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:(0,n.jsx)(i.strong,{children:"Parameters"})}),(0,n.jsx)(i.th,{children:(0,n.jsx)(i.strong,{children:"Parameters"})}),(0,n.jsx)(i.th,{children:(0,n.jsx)(i.strong,{children:"Description"})})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"partition_columns"})}),(0,n.jsx)(i.td,{children:"YES"}),(0,n.jsxs)(i.td,{children:["the ames of the partitioning columns. The partitioning column values can be string (BINARY not supported), date or datetime, integer, and boolean values. The partitioning column allows ",(0,n.jsx)(i.code,{children:"NULL"})," values."]})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"partition_name"})}),(0,n.jsx)(i.td,{children:"YES"}),(0,n.jsx)(i.td,{children:"Partition name. It is recommended to set appropriate partition names based on the business scenario to differentiate the data in different partitions."})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"value_list"})}),(0,n.jsx)(i.td,{children:"YES"}),(0,n.jsx)(i.td,{children:"A list of partitioning column values in a partition."})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"examples",children:"Examples"}),"\n",(0,n.jsxs)(i.p,{children:["Example 1: Suppose you frequently query details of data center billing based on states or cities. At table creation, you can specify the partitioning column as ",(0,n.jsx)(i.code,{children:"city"})," and specify that each partition stores data of cities within the same state. This method can accelerate queries for specific states or cities and facilitate data management."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-SQL",children:'CREATE TABLE t_recharge_detail1 (\n    id bigint,\n    user_id bigint,\n    recharge_money decimal(32,2), \n    city varchar(20) not null,\n    dt varchar(20) not null\n)\nDUPLICATE KEY(id)\nPARTITION BY LIST (city) (\n   PARTITION pLos_Angeles VALUES IN ("Los Angeles"),\n   PARTITION pSan_Francisco VALUES IN ("San Francisco")\n)\nDISTRIBUTED BY HASH(`id`);\n'})}),"\n",(0,n.jsxs)(i.p,{children:["Example 2: Suppose you frequently query details of data center billing based on time ranges and specific states or cities. During table creation, you can specify the partitioning columns as ",(0,n.jsx)(i.code,{children:"dt"}),"  and ",(0,n.jsx)(i.code,{children:"city"}),". This way, data of specific dates and specific states or cities is stored into the same partition, improving query speed and facilitating data management."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-SQL",children:'CREATE TABLE t_recharge_detail4 (\n    id bigint,\n    user_id bigint,\n    recharge_money decimal(32,2), \n    city varchar(20) not null,\n    dt varchar(20) not null\n) ENGINE=OLAP\nDUPLICATE KEY(id)\nPARTITION BY LIST (dt,city) (\n   PARTITION p202204_California VALUES IN (\n       ("2022-04-01", "Los Angeles"),\n       ("2022-04-01", "San Francisco"),\n       ("2022-04-02", "Los Angeles"),\n       ("2022-04-02", "San Francisco")\n    ),\n   PARTITION p202204_Texas VALUES IN (\n       ("2022-04-01", "Houston"),\n       ("2022-04-01", "Dallas"),\n       ("2022-04-02", "Houston"),\n       ("2022-04-02", "Dallas")\n   )\n)\nDISTRIBUTED BY HASH(`id`);\n'})}),"\n",(0,n.jsx)(i.h2,{id:"limits",children:"Limits"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"List partitioning does support dynamic partitoning and creating multiple partitions at a time."}),"\n",(0,n.jsxs)(i.li,{children:["Currently, StarRocks's ",(0,n.jsx)(i.a,{href:"/doc/docs/deployment/shared_data/s3",children:"shared-data mode"})," does not support this feature."]}),"\n",(0,n.jsxs)(i.li,{children:["When the ",(0,n.jsx)(i.code,{children:"ALTER TABLE <table_name> DROP PARTITION <partition_name>;"})," statement is used to delete a partition created by using list partitioning, data in the partition is directly removed and cannot be recovered."]}),"\n",(0,n.jsxs)(i.li,{children:["Currently you cannot ",(0,n.jsx)(i.a,{href:"/doc/docs/administration/Backup_and_restore",children:"backup and restore"})," partitions created by the list partitioning."]}),"\n",(0,n.jsxs)(i.li,{children:["Currently, StarRocks does not support creating ",(0,n.jsx)(i.a,{href:"/doc/docs/using_starrocks/Materialized_view",children:"asynchronous materialized views"})," with base tables created with the list partitioning strategy."]}),"\n"]})]})}const h=function(e={}){const{wrapper:i}=Object.assign({},(0,a.ah)(),e.components);return i?(0,n.jsx)(i,Object.assign({},e,{children:(0,n.jsx)(l,e)})):l(e)}},98997:(e,i,t)=>{t.d(i,{Z:()=>n});const n=t.p+"assets/images/list_partitioning-dcc2197297db3ceafda8685498d963be.png"},11151:(e,i,t)=>{t.d(i,{Zo:()=>o,ah:()=>s});var n=t(67294);const a=n.createContext({});function s(e){const i=n.useContext(a);return n.useMemo((()=>"function"==typeof e?e(i):{...i,...e}),[i,e])}const r={};function o({components:e,children:i,disableParentContext:t}){let o;return o=t?"function"==typeof e?e({}):e||r:s(e),n.createElement(a.Provider,{value:o},i)}}}]);