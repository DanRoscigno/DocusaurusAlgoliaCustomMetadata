"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[59299],{4073:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var s=t(85893),n=t(11151);const r={displayed_sidebar:"documentation"},l="Delta Lake catalog",i={id:"data_source/catalog/deltalake_catalog",title:"Delta Lake catalog",description:"A Delta Lake catalog is a kind of external catalog that enables you to query data from Apache Delta Lake without ingestion.",source:"@site/versioned_docs/version-2.5/data_source/catalog/deltalake_catalog.md",sourceDirName:"data_source/catalog",slug:"/data_source/catalog/deltalake_catalog",permalink:"/doc/docs/2.5/data_source/catalog/deltalake_catalog",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/edit/main/docs/data_source/catalog/deltalake_catalog.md",tags:[],version:"2.5",frontMatter:{displayed_sidebar:"documentation"},sidebar:"documentation",previous:{title:"Hudi catalog",permalink:"/doc/docs/2.5/data_source/catalog/hudi_catalog"},next:{title:"Query external data",permalink:"/doc/docs/2.5/data_source/catalog/query_external_data"}},o={},c=[{value:"Usage notes",id:"usage-notes",level:2},{value:"Integration preparations",id:"integration-preparations",level:2},{value:"AWS IAM",id:"aws-iam",level:3},{value:"HDFS",id:"hdfs",level:3},{value:"Kerberos authentication",id:"kerberos-authentication",level:3},{value:"Create a Delta Lake catalog",id:"create-a-delta-lake-catalog",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Parameters",id:"parameters",level:3},{value:"catalog_name",id:"catalog_name",level:4},{value:"comment",id:"comment",level:4},{value:"type",id:"type",level:4},{value:"MetastoreParams",id:"metastoreparams",level:4},{value:"Hive metastore",id:"hive-metastore",level:5},{value:"AWS Glue",id:"aws-glue",level:5},{value:"StorageCredentialParams",id:"storagecredentialparams",level:4},{value:"AWS S3",id:"aws-s3",level:5},{value:"S3-compatible storage system",id:"s3-compatible-storage-system",level:5},{value:"MetadataUpdateParams",id:"metadataupdateparams",level:4},{value:"Examples",id:"examples",level:3},{value:"HDFS",id:"hdfs-1",level:4},{value:"AWS S3",id:"aws-s3-1",level:4},{value:"If you choose instance profile-based credential",id:"if-you-choose-instance-profile-based-credential",level:5},{value:"If you choose assumed role-based credential",id:"if-you-choose-assumed-role-based-credential",level:5},{value:"If you choose IAM user-based credential",id:"if-you-choose-iam-user-based-credential",level:5},{value:"S3-compatible storage system",id:"s3-compatible-storage-system-1",level:4},{value:"View the schema of a Delta Lake table",id:"view-the-schema-of-a-delta-lake-table",level:2},{value:"Query a Delta Lake table",id:"query-a-delta-lake-table",level:2},{value:"Load data from Delta Lake",id:"load-data-from-delta-lake",level:2},{value:"Manually or automatically update metadata cache",id:"manually-or-automatically-update-metadata-cache",level:2},{value:"Manual update",id:"manual-update",level:3},{value:"Automatic incremental update",id:"automatic-incremental-update",level:3},{value:"Step 1: Configure event listener for your Hive metastore",id:"step-1-configure-event-listener-for-your-hive-metastore",level:4},{value:"Step 2: Enable automatic incremental update on StarRocks",id:"step-2-enable-automatic-incremental-update-on-starrocks",level:4},{value:"Appendix: Understand metadata automatic asynchronous update",id:"appendix-understand-metadata-automatic-asynchronous-update",level:2}];function d(e){const a=Object.assign({h1:"h1",p:"p",a:"a",ul:"ul",li:"li",h2:"h2",h3:"h3",code:"code",strong:"strong",blockquote:"blockquote",pre:"pre",h4:"h4",h5:"h5",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",ol:"ol",img:"img"},(0,n.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.h1,{id:"delta-lake-catalog",children:"Delta Lake catalog"}),"\n",(0,s.jsx)(a.p,{children:"A Delta Lake catalog is a kind of external catalog that enables you to query data from Apache Delta Lake without ingestion."}),"\n",(0,s.jsxs)(a.p,{children:["Also, you can directly transform and load data from Delta Lake by using ",(0,s.jsx)(a.a,{href:"/doc/docs/2.5/sql-reference/sql-statements/data-manipulation/insert",children:"INSERT INTO"})," based on Delta Lake catalogs. StarRocks supports Delta Lake catalogs from v2.5 onwards."]}),"\n",(0,s.jsx)(a.p,{children:"To ensure successful SQL workloads on your Delta Lake cluster, your StarRocks cluster needs to integrate with two important components:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Object storage or distributed file system like AWS S3 or HDFS"}),"\n",(0,s.jsx)(a.li,{children:"Metastore like Hive metastore or AWS Glue"}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"usage-notes",children:"Usage notes"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"The file format of Delta Lake that StarRocks supports is Parquet. Parquet files support the following compression formats: SNAPPY, LZ4, ZSTD, GZIP, and NO_COMPRESSION."}),"\n",(0,s.jsx)(a.li,{children:"The data types of Delta Lake that StarRocks does not support are MAP and STRUCT."}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"integration-preparations",children:"Integration preparations"}),"\n",(0,s.jsx)(a.p,{children:"Before you create a Delta Lake catalog, make sure your StarRocks cluster can integrate with the storage system and metastore of your Delta Lake cluster."}),"\n",(0,s.jsx)(a.h3,{id:"aws-iam",children:"AWS IAM"}),"\n",(0,s.jsx)(a.p,{children:"If your Delta Lake cluster uses AWS S3 as storage or AWS Glue as metastore, choose your suitable authentication method and make the required preparations to ensure that your StarRocks cluster can access the related AWS cloud resources."}),"\n",(0,s.jsx)(a.p,{children:"The following authentication methods are recommended:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Instance profile"}),"\n",(0,s.jsx)(a.li,{children:"Assumed role"}),"\n",(0,s.jsx)(a.li,{children:"IAM user"}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"Of the above-mentioned three authentication methods, instance profile is the most widely used."}),"\n",(0,s.jsxs)(a.p,{children:["For more information, see ",(0,s.jsx)(a.a,{href:"/doc/docs/2.5/integrations/authenticate_to_aws_resources#preparation-for-authentication-in-aws-iam",children:"Preparation for authentication in AWS IAM"}),"."]}),"\n",(0,s.jsx)(a.h3,{id:"hdfs",children:"HDFS"}),"\n",(0,s.jsx)(a.p,{children:"If you choose HDFS as storage, configure your StarRocks cluster as follows:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["(Optional) Set the username that is used to access your HDFS cluster and Hive metastore. By default, StarRocks uses the username of the FE and BE processes to access your HDFS cluster and Hive metastore. You can also set the username by adding ",(0,s.jsx)(a.code,{children:'export HADOOP_USER_NAME="<user_name>"'})," at the beginning of the ",(0,s.jsx)(a.strong,{children:"fe/conf/hadoop_env.sh"})," file of each FE and at the beginning of the ",(0,s.jsx)(a.strong,{children:"be/conf/hadoop_env.sh"})," file of each BE. After you set the username in these files, restart each FE and each BE to make the parameter settings take effect. You can set only one username for each StarRocks cluster."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"When you query Delta Lake data, the FEs and BEs of your StarRocks cluster use the HDFS client to access your HDFS cluster. In most cases, you do not need to configure your StarRocks cluster to achieve that purpose, and StarRocks starts the HDFS client using the default configurations. You need to configure your StarRocks cluster only in the following situations:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["High availability (HA) is enabled for your HDFS cluster: Add the ",(0,s.jsx)(a.strong,{children:"hdfs-site.xml"})," file of your HDFS cluster to the ",(0,s.jsx)(a.strong,{children:"$FE_HOME/conf"})," path of each FE and to the ",(0,s.jsx)(a.strong,{children:"$BE_HOME/conf"})," path of each BE."]}),"\n",(0,s.jsxs)(a.li,{children:["View File System (ViewFs) is enabled for your HDFS cluster: Add the ",(0,s.jsx)(a.strong,{children:"core-site.xml"})," file of your HDFS cluster to the ",(0,s.jsx)(a.strong,{children:"$FE_HOME/conf"})," path of each FE and to the ",(0,s.jsx)(a.strong,{children:"$BE_HOME/conf"})," path of each BE."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"NOTE"})}),"\n",(0,s.jsxs)(a.p,{children:["If an error indicating an unknown host is returned when you send a query, you must add the mapping between the host names and IP addresses of your HDFS cluster nodes to the ",(0,s.jsx)(a.strong,{children:"/etc/hosts"})," path."]}),"\n"]}),"\n",(0,s.jsx)(a.h3,{id:"kerberos-authentication",children:"Kerberos authentication"}),"\n",(0,s.jsx)(a.p,{children:"If Kerberos authentication is enabled for your HDFS cluster or Hive metastore, configure your StarRocks cluster as follows:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["Run the ",(0,s.jsx)(a.code,{children:"kinit -kt keytab_path principal"})," command on each FE and each BE to obtain Ticket Granting Ticket (TGT) from Key Distribution Center (KDC). To run this command, you must have the permissions to access your HDFS cluster and Hive metastore. Note that accessing KDC with this command is time-sensitive. Therefore, you need to use cron to run this command periodically."]}),"\n",(0,s.jsxs)(a.li,{children:["Add ",(0,s.jsx)(a.code,{children:'JAVA_OPTS="-Djava.security.krb5.conf=/etc/krb5.conf"'})," to the ",(0,s.jsx)(a.strong,{children:"$FE_HOME/conf/fe.conf"})," file of each FE and to the ",(0,s.jsx)(a.strong,{children:"$BE_HOME/conf/be.conf"})," file of each BE. In this example, ",(0,s.jsx)(a.code,{children:"/etc/krb5.conf"})," is the save path of the ",(0,s.jsx)(a.strong,{children:"krb5.conf"})," file. You can modify the path based on your needs."]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"create-a-delta-lake-catalog",children:"Create a Delta Lake catalog"}),"\n",(0,s.jsx)(a.h3,{id:"syntax",children:"Syntax"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG <catalog_name>\n[COMMENT <comment>]\nPROPERTIES\n(\n    "type" = "deltalake",\n    MetastoreParams,\n    StorageCredentialParams,\n    MetadataUpdateParams\n)\n'})}),"\n",(0,s.jsx)(a.h3,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsx)(a.h4,{id:"catalog_name",children:"catalog_name"}),"\n",(0,s.jsx)(a.p,{children:"The name of the Delta Lake catalog. The naming conventions are as follows:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"The name can contain letters, digits (0-9), and underscores (_). It must start with a letter."}),"\n",(0,s.jsx)(a.li,{children:"The name is case-sensitive and cannot exceed 1023 characters in length."}),"\n"]}),"\n",(0,s.jsx)(a.h4,{id:"comment",children:"comment"}),"\n",(0,s.jsx)(a.p,{children:"The description of the Delta Lake catalog. This parameter is optional."}),"\n",(0,s.jsx)(a.h4,{id:"type",children:"type"}),"\n",(0,s.jsxs)(a.p,{children:["The type of your data source. Set the value to ",(0,s.jsx)(a.code,{children:"deltalake"}),"."]}),"\n",(0,s.jsx)(a.h4,{id:"metastoreparams",children:"MetastoreParams"}),"\n",(0,s.jsx)(a.p,{children:"A set of parameters about how StarRocks integrates with the metastore of your data source."}),"\n",(0,s.jsx)(a.h5,{id:"hive-metastore",children:"Hive metastore"}),"\n",(0,s.jsxs)(a.p,{children:["If you choose Hive metastore as the metastore of your data source, configure ",(0,s.jsx)(a.code,{children:"MetastoreParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"hive.metastore.type" = "hive",\n"hive.metastore.uris" = "<hive_metastore_uri>"\n'})}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"NOTE"})}),"\n",(0,s.jsxs)(a.p,{children:["Before querying Delta Lake data, you must add the mapping between the host names and IP addresses of your Hive metastore nodes to the ",(0,s.jsx)(a.code,{children:"/etc/hosts"})," path. Otherwise, StarRocks may fail to access your Hive metastore when you start a query."]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["The following table describes the parameter you need to configure in ",(0,s.jsx)(a.code,{children:"MetastoreParams"}),"."]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Parameter"}),(0,s.jsx)(a.th,{children:"Required"}),(0,s.jsx)(a.th,{children:"Description"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"hive.metastore.type"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["The type of metastore that you use for your Delta Lake cluster. Set the value to ",(0,s.jsx)(a.code,{children:"hive"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"hive.metastore.uris"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["The URI of your Hive metastore. Format: ",(0,s.jsx)(a.code,{children:"thrift://<metastore_IP_address>:<metastore_port>"}),".",(0,s.jsx)("br",{}),"If high availability (HA) is enabled for your Hive metastore, you can specify multiple metastore URIs and separate them with commas (",(0,s.jsx)(a.code,{children:","}),"), for example, ",(0,s.jsx)(a.code,{children:'"thrift://<metastore_IP_address_1>:<metastore_port_1>,thrift://<metastore_IP_address_2>:<metastore_port_2>,thrift://<metastore_IP_address_3>:<metastore_port_3>"'}),"."]})]})]})]}),"\n",(0,s.jsx)(a.h5,{id:"aws-glue",children:"AWS Glue"}),"\n",(0,s.jsx)(a.p,{children:"If you choose AWS Glue as the metastore of your data source, take one of the following actions:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To choose the instance profile-based authentication method, configure ",(0,s.jsx)(a.code,{children:"MetastoreParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"hive.metastore.type" = "glue",\n"aws.glue.use_instance_profile" = "true",\n"aws.glue.region" = "<aws_glue_region>"\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To choose the assumed role-based authentication method, configure ",(0,s.jsx)(a.code,{children:"MetastoreParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"hive.metastore.type" = "glue",\n"aws.glue.use_instance_profile" = "true",\n"aws.glue.iam_role_arn" = "<iam_role_arn>",\n"aws.glue.region" = "<aws_glue_region>"\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To choose the IAM user-based authentication method, configure ",(0,s.jsx)(a.code,{children:"MetastoreParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"hive.metastore.type" = "glue",\n"aws.glue.use_instance_profile" = "false",\n"aws.glue.access_key" = "<iam_user_access_key>",\n"aws.glue.secret_key" = "<iam_user_secret_key>",\n"aws.glue.region" = "<aws_s3_region>"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["The following table describes the parameters you need to configure in ",(0,s.jsx)(a.code,{children:"MetastoreParams"}),"."]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Parameter"}),(0,s.jsx)(a.th,{children:"Required"}),(0,s.jsx)(a.th,{children:"Description"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"hive.metastore.type"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["The type of metastore that you use for your Delta Lake cluster. Set the value to ",(0,s.jsx)(a.code,{children:"glue"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.glue.use_instance_profile"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["Specifies whether to enable the instance profile-based authentication method and the assumed role-based authentication method. Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"false"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.glue.iam_role_arn"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsx)(a.td,{children:"The ARN of the IAM role that has privileges on your AWS Glue Data Catalog. If you use the assumed role-based authentication method to access AWS Glue, you must specify this parameter."})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.glue.region"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["The region in which your AWS Glue Data Catalog resides. Example: ",(0,s.jsx)(a.code,{children:"us-west-1"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.glue.access_key"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsx)(a.td,{children:"The access key of your AWS IAM user. If you use the IAM user-based authentication method to access AWS Glue, you must specify this parameter."})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.glue.secret_key"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsx)(a.td,{children:"The secret key of your AWS IAM user. If you use the IAM user-based authentication method to access AWS Glue, you must specify this parameter."})]})]})]}),"\n",(0,s.jsxs)(a.p,{children:["For information about how to choose an authentication method for accessing AWS Glue and how to configure an access control policy in the AWS IAM Console, see ",(0,s.jsx)(a.a,{href:"/doc/docs/2.5/integrations/authenticate_to_aws_resources#authentication-parameters-for-accessing-aws-glue",children:"Authentication parameters for accessing AWS Glue"}),"."]}),"\n",(0,s.jsx)(a.h4,{id:"storagecredentialparams",children:"StorageCredentialParams"}),"\n",(0,s.jsx)(a.p,{children:"A set of parameters about how StarRocks integrates with your storage system. This parameter set is optional."}),"\n",(0,s.jsxs)(a.p,{children:["You need to configure ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"})," only when your Delta Lake cluster uses AWS S3 as storage."]}),"\n",(0,s.jsxs)(a.p,{children:["If your Delta Lake cluster uses any other storage system, you can ignore ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"}),"."]}),"\n",(0,s.jsx)(a.h5,{id:"aws-s3",children:"AWS S3"}),"\n",(0,s.jsx)(a.p,{children:"If you choose AWS S3 as storage for your Delta Lake cluster, take one of the following actions:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To choose the instance profile-based authentication method, configure ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"aws.s3.use_instance_profile" = "true",\n"aws.s3.region" = "<aws_s3_region>"\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To choose the assumed role-based authentication method, configure ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"aws.s3.use_instance_profile" = "true",\n"aws.s3.iam_role_arn" = "<iam_role_arn>",\n"aws.s3.region" = "<aws_s3_region>"\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To choose the IAM user-based authentication method, configure ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"})," as follows:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"aws.s3.use_instance_profile" = "false",\n"aws.s3.access_key" = "<iam_user_access_key>",\n"aws.s3.secret_key" = "<iam_user_secret_key>",\n"aws.s3.region" = "<aws_s3_region>"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["The following table describes the parameters you need to configure in ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"}),"."]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Parameter"}),(0,s.jsx)(a.th,{children:"Required"}),(0,s.jsx)(a.th,{children:"Description"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.use_instance_profile"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["Specifies whether to enable the instance profile-based authentication method and the assumed role-based authentication method. Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"false"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.iam_role_arn"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsx)(a.td,{children:"The ARN of the IAM role that has privileges on your AWS S3 bucket. If you use the assumed role-based authentication method to access AWS S3, you must specify this parameter."})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.region"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["The region in which your AWS S3 bucket resides. Example: ",(0,s.jsx)(a.code,{children:"us-west-1"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.access_key"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsx)(a.td,{children:"The access key of your IAM user. If you use the IAM user-based authentication method to access AWS S3, you must specify this parameter."})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.secret_key"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsx)(a.td,{children:"The secret key of your IAM user. If you use the IAM user-based authentication method to access AWS S3, you must specify this parameter."})]})]})]}),"\n",(0,s.jsxs)(a.p,{children:["For information about how to choose an authentication method for accessing AWS S3 and how to configure an access control policy in AWS IAM Console, see ",(0,s.jsx)(a.a,{href:"/doc/docs/2.5/integrations/authenticate_to_aws_resources#authentication-parameters-for-accessing-aws-s3",children:"Authentication parameters for accessing AWS S3"}),"."]}),"\n",(0,s.jsx)(a.h5,{id:"s3-compatible-storage-system",children:"S3-compatible storage system"}),"\n",(0,s.jsx)(a.p,{children:"Delta Lake catalogs support S3-compatible storage systems from v2.5 onwards."}),"\n",(0,s.jsxs)(a.p,{children:["If you choose an S3-compatible storage system, such as MinIO, as storage for your Delta Lake cluster, configure ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"})," as follows to ensure a successful integration:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'"aws.s3.enable_ssl" = "{true | false}",\n"aws.s3.enable_path_style_access" = "{true | false}",\n"aws.s3.endpoint" = "<s3_endpoint>",\n"aws.s3.access_key" = "<iam_user_access_key>",\n"aws.s3.secret_key" = "<iam_user_secret_key>"\n'})}),"\n",(0,s.jsxs)(a.p,{children:["The following table describes the parameters you need to configure in ",(0,s.jsx)(a.code,{children:"StorageCredentialParams"}),"."]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Parameter"}),(0,s.jsx)(a.th,{children:"Required"}),(0,s.jsx)(a.th,{children:"Description"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.enable_ssl"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["Specifies whether to enable SSL connection.",(0,s.jsx)("br",{}),"Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"true"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.enable_path_style_access"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsxs)(a.td,{children:["Specifies whether to enable path-style access.",(0,s.jsx)("br",{}),"Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"false"}),". For MinIO, you must set the value to ",(0,s.jsx)(a.code,{children:"true"}),".",(0,s.jsx)("br",{}),"Path-style URLs use the following format: ",(0,s.jsx)(a.code,{children:"https://s3.<region_code>.amazonaws.com/<bucket_name>/<key_name>"}),". For example, if you create a bucket named ",(0,s.jsx)(a.code,{children:"DOC-EXAMPLE-BUCKET1"})," in the US West (Oregon) Region, and you want to access the ",(0,s.jsx)(a.code,{children:"alice.jpg"})," object in that bucket, you can use the following path-style URL: ",(0,s.jsx)(a.code,{children:"https://s3.us-west-2.amazonaws.com/DOC-EXAMPLE-BUCKET1/alice.jpg"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.endpoint"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsx)(a.td,{children:"The endpoint that is used to connect to your S3-compatible storage system instead of AWS S3."})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.access_key"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsx)(a.td,{children:"The access key of your IAM user."})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"aws.s3.secret_key"}),(0,s.jsx)(a.td,{children:"Yes"}),(0,s.jsx)(a.td,{children:"The secret key of your IAM user."})]})]})]}),"\n",(0,s.jsx)(a.h4,{id:"metadataupdateparams",children:"MetadataUpdateParams"}),"\n",(0,s.jsx)(a.p,{children:"A set of parameters about how StarRocks updates the cached metadata of Delta Lake. This parameter set is optional."}),"\n",(0,s.jsxs)(a.p,{children:["StarRocks implements the ",(0,s.jsx)(a.a,{href:"#appendix-understand-metadata-automatic-asynchronous-update",children:"automatic asynchronous update policy"})," by default."]}),"\n",(0,s.jsxs)(a.p,{children:["In most cases, you can ignore ",(0,s.jsx)(a.code,{children:"MetadataUpdateParams"})," and do not need to tune the policy parameters in it, because the default values of these parameters already provide you with an out-of-the-box performance."]}),"\n",(0,s.jsx)(a.p,{children:"However, if the frequency of data updates in Delta Lake is high, you can tune these parameters to further optimize the performance of automatic asynchronous updates."}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.strong,{children:"NOTE"})}),"\n",(0,s.jsx)(a.p,{children:"In most cases, if your Delta Lake data is updated at a granularity of 1 hour or less, the data update frequency is considered high."}),"\n"]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Parameter"}),(0,s.jsx)(a.th,{children:"Required"}),(0,s.jsx)(a.th,{children:"Description"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"enable_metastore_cache"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsxs)(a.td,{children:["Specifies whether StarRocks caches the metadata of Delta Lake tables. Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"true"}),". The value ",(0,s.jsx)(a.code,{children:"true"})," enables the cache, and the value ",(0,s.jsx)(a.code,{children:"false"})," disables the cache."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"enable_remote_file_cache"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsxs)(a.td,{children:["Specifies whether StarRocks caches the metadata of the underlying data files of Delta Lake tables or partitions. Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"true"}),". The value ",(0,s.jsx)(a.code,{children:"true"})," enables the cache, and the value ",(0,s.jsx)(a.code,{children:"false"})," disables the cache."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"metastore_cache_refresh_interval_sec"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsxs)(a.td,{children:["The time interval at which StarRocks asynchronously updates the metadata of Delta Lake tables or partitions cached in itself. Unit: seconds. Default value: ",(0,s.jsx)(a.code,{children:"7200"}),", which is 2 hours."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"remote_file_cache_refresh_interval_sec"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsxs)(a.td,{children:["The time interval at which StarRocks asynchronously updates the metadata of the underlying data files of Delta Lake tables or partitions cached in itself. Unit: seconds. Default value: ",(0,s.jsx)(a.code,{children:"60"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"metastore_cache_ttl_sec"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsxs)(a.td,{children:["The time interval at which StarRocks automatically discards the metadata of Delta Lake tables or partitions cached in itself. Unit: seconds. Default value: ",(0,s.jsx)(a.code,{children:"86400"}),", which is 24 hours."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"remote_file_cache_ttl_sec"}),(0,s.jsx)(a.td,{children:"No"}),(0,s.jsxs)(a.td,{children:["The time interval at which StarRocks automatically discards the metadata of the underlying data files of Delta Lake tables or partitions cached in itself. Unit: seconds. Default value: ",(0,s.jsx)(a.code,{children:"129600"}),", which is 36 hours."]})]})]})]}),"\n",(0,s.jsx)(a.h3,{id:"examples",children:"Examples"}),"\n",(0,s.jsxs)(a.p,{children:["The following examples create a Delta Lake catalog named ",(0,s.jsx)(a.code,{children:"deltalake_catalog_hms"})," or ",(0,s.jsx)(a.code,{children:"deltalake_catalog_glue"}),", depending on the type of metastore you use, to query data from your Delta Lake cluster."]}),"\n",(0,s.jsx)(a.h4,{id:"hdfs-1",children:"HDFS"}),"\n",(0,s.jsx)(a.p,{children:"If you use HDFS as storage, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_hms\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "hive",\n    "hive.metastore.uris" = "thrift://xx.xx.xx:9083"\n);\n'})}),"\n",(0,s.jsx)(a.h4,{id:"aws-s3-1",children:"AWS S3"}),"\n",(0,s.jsx)(a.h5,{id:"if-you-choose-instance-profile-based-credential",children:"If you choose instance profile-based credential"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If you use Hive metastore in your Delta Lake cluster, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_hms\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "hive",\n    "hive.metastore.uris" = "thrift://xx.xx.xx:9083",\n    "aws.s3.use_instance_profile" = "true",\n    "aws.s3.region" = "us-west-2"\n);\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If you use AWS Glue in your Amazon EMR Delta Lake cluster, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_glue\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "glue",\n    "aws.glue.use_instance_profile" = "true",\n    "aws.glue.region" = "us-west-2",\n    "aws.s3.use_instance_profile" = "true",\n    "aws.s3.region" = "us-west-2"\n);\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h5,{id:"if-you-choose-assumed-role-based-credential",children:"If you choose assumed role-based credential"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If you use Hive metastore in your Delta Lake cluster, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_hms\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "hive",\n    "hive.metastore.uris" = "thrift://xx.xx.xx:9083",\n    "aws.s3.use_instance_profile" = "true",\n    "aws.s3.iam_role_arn" = "arn:aws:iam::081976408565:role/test_s3_role",\n    "aws.s3.region" = "us-west-2"\n);\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If you use AWS Glue in your Amazon EMR Delta Lake cluster, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_glue\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "glue",\n    "aws.glue.use_instance_profile" = "true",\n    "aws.glue.iam_role_arn" = "arn:aws:iam::081976408565:role/test_glue_role",\n    "aws.glue.region" = "us-west-2",\n    "aws.s3.use_instance_profile" = "true",\n    "aws.s3.iam_role_arn" = "arn:aws:iam::081976408565:role/test_s3_role",\n    "aws.s3.region" = "us-west-2"\n);\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h5,{id:"if-you-choose-iam-user-based-credential",children:"If you choose IAM user-based credential"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If you use Hive metastore in your Delta Lake cluster, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_hms\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "hive",\n    "hive.metastore.uris" = "thrift://xx.xx.xx:9083",\n    "aws.s3.use_instance_profile" = "false",\n    "aws.s3.access_key" = "<iam_user_access_key>",\n    "aws.s3.secret_key" = "<iam_user_access_key>",\n    "aws.s3.region" = "us-west-2"\n);\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"If you use AWS Glue in your Amazon EMR Delta Lake cluster, run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_glue\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "glue",\n    "aws.glue.use_instance_profile" = "false",\n    "aws.glue.access_key" = "<iam_user_access_key>",\n    "aws.glue.secret_key" = "<iam_user_secret_key>",\n    "aws.glue.region" = "us-west-2",\n    "aws.s3.use_instance_profile" = "false",\n    "aws.s3.access_key" = "<iam_user_access_key>",\n    "aws.s3.secret_key" = "<iam_user_secret_key>",\n    "aws.s3.region" = "us-west-2"\n);\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h4,{id:"s3-compatible-storage-system-1",children:"S3-compatible storage system"}),"\n",(0,s.jsx)(a.p,{children:"Use MinIO as an example. Run a command like below:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG deltalake_catalog_hms\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.type" = "hive",\n    "hive.metastore.uris" = "thrift://34.132.15.127:9083",\n    "aws.s3.enable_ssl" = "true",\n    "aws.s3.enable_path_style_access" = "true",\n    "aws.s3.endpoint" = "<s3_endpoint>",\n    "aws.s3.access_key" = "<iam_user_access_key>",\n    "aws.s3.secret_key" = "<iam_user_secret_key>"\n);\n'})}),"\n",(0,s.jsx)(a.h2,{id:"view-the-schema-of-a-delta-lake-table",children:"View the schema of a Delta Lake table"}),"\n",(0,s.jsx)(a.p,{children:"You can use one of the following syntaxes to view the schema of a Delta Lake table:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"View schema"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"DESC[RIBE] <catalog_name>.<database_name>.<table_name>\n"})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"View schema and location from the CREATE statement"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"SHOW CREATE TABLE <catalog_name>.<database_name>.<table_name>\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"query-a-delta-lake-table",children:"Query a Delta Lake table"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Use the following syntax to view the databases in your Delta Lake cluster:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"SHOW DATABASES FROM <catalog_name>\n"})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Use the following syntax to connect to your target Delta Lake database:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"USE <catalog_name>.<database_name>\n"})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Use the following syntax to query the Delta Lake table:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"SELECT count(*) FROM <table_name> LIMIT 10\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"load-data-from-delta-lake",children:"Load data from Delta Lake"}),"\n",(0,s.jsxs)(a.p,{children:["Suppose you have an OLAP table named ",(0,s.jsx)(a.code,{children:"olap_tbl"}),", you can transform and load data like below:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"INSERT INTO default_catalog.olap_db.olap_tbl SELECT * FROM deltalake_table\n"})}),"\n",(0,s.jsx)(a.h2,{id:"manually-or-automatically-update-metadata-cache",children:"Manually or automatically update metadata cache"}),"\n",(0,s.jsx)(a.h3,{id:"manual-update",children:"Manual update"}),"\n",(0,s.jsxs)(a.p,{children:["By default, StarRocks caches the metadata of Delta Lake and automatically updates the metadata in asynchronous mode to deliver better performance. Additionally, after some schema changes or table updates are made on a Delta Lake table, you can also use ",(0,s.jsx)(a.a,{href:"/doc/docs/2.5/sql-reference/sql-statements/data-definition/REFRESH_EXTERNAL_TABLE",children:"REFRESH EXTERNAL TABLE"})," to manually update its metadata, thereby ensuring that StarRocks can obtain up-to-date metadata at its earliest opportunity and generate appropriate execution plans:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:"REFRESH EXTERNAL TABLE <table_name>\n"})}),"\n",(0,s.jsx)(a.h3,{id:"automatic-incremental-update",children:"Automatic incremental update"}),"\n",(0,s.jsx)(a.p,{children:"Unlike the automatic asynchronous update policy, the automatic incremental update policy enables the FEs in your StarRocks cluster to read events, such as adding columns, removing partitions, and updating data, from your Hive metastore. StarRocks can automatically update the metadata cached in the FEs based on these events. This means you do not need to manually update the metadata of your Delta Lake tables."}),"\n",(0,s.jsx)(a.p,{children:"To enable automatic incremental update, follow these steps:"}),"\n",(0,s.jsx)(a.h4,{id:"step-1-configure-event-listener-for-your-hive-metastore",children:"Step 1: Configure event listener for your Hive metastore"}),"\n",(0,s.jsxs)(a.p,{children:["Both Hive metastore v2.x and v3.x support configuring an event listener. This step uses the event listener configuration used for Hive metastore v3.1.2 as an example. Add the following configuration items to the ",(0,s.jsx)(a.strong,{children:"$HiveMetastore/conf/hive-site.xml"})," file, and then restart your Hive metastore:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-XML",children:"<property>\n    <name>hive.metastore.event.db.notification.api.auth</name>\n    <value>false</value>\n</property>\n<property>\n    <name>hive.metastore.notifications.add.thrift.objects</name>\n    <value>true</value>\n</property>\n<property>\n    <name>hive.metastore.alter.notifications.basic</name>\n    <value>false</value>\n</property>\n<property>\n    <name>hive.metastore.dml.events</name>\n    <value>true</value>\n</property>\n<property>\n    <name>hive.metastore.transactional.event.listeners</name>\n    <value>org.apache.hive.hcatalog.listener.DbNotificationListener</value>\n</property>\n<property>\n    <name>hive.metastore.event.db.listener.timetolive</name>\n    <value>172800s</value>\n</property>\n<property>\n    <name>hive.metastore.server.max.message.size</name>\n    <value>858993459</value>\n</property>\n"})}),"\n",(0,s.jsxs)(a.p,{children:["You can search for ",(0,s.jsx)(a.code,{children:"event id"})," in the FE log file to check whether the event listener is successfully configured. If the configuration fails, ",(0,s.jsx)(a.code,{children:"event id"})," values are ",(0,s.jsx)(a.code,{children:"0"}),"."]}),"\n",(0,s.jsx)(a.h4,{id:"step-2-enable-automatic-incremental-update-on-starrocks",children:"Step 2: Enable automatic incremental update on StarRocks"}),"\n",(0,s.jsx)(a.p,{children:"You can enable automatic incremental update for a single Delta Lake catalog or for all Delta Lake catalogs in your StarRocks cluster."}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To enable automatic incremental update for a single Delta Lake catalog, set the ",(0,s.jsx)(a.code,{children:"enable_hms_events_incremental_sync"})," parameter to ",(0,s.jsx)(a.code,{children:"true"})," in ",(0,s.jsx)(a.code,{children:"PROPERTIES"})," like below when you create the Delta Lake catalog:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-SQL",children:'CREATE EXTERNAL CATALOG <catalog_name>\n[COMMENT <comment>]\nPROPERTIES\n(\n    "type" = "deltalake",\n    "hive.metastore.uris" = "thrift://102.168.xx.xx:9083",\n     ....\n    "enable_hms_events_incremental_sync" = "true"\n);\n'})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["To enable automatic incremental update for all Delta Lake catalogs, add ",(0,s.jsx)(a.code,{children:'"enable_hms_events_incremental_sync" = "true"'})," to the ",(0,s.jsx)(a.code,{children:"$FE_HOME/conf/fe.conf"})," file of each FE, and then restart each FE to make the parameter setting take effect."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["You can also tune the following parameters in the ",(0,s.jsx)(a.code,{children:"$FE_HOME/conf/fe.conf"})," file of each FE based on your business requirements, and then restart each FE to make the parameter settings take effect."]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Parameter"}),(0,s.jsx)(a.th,{children:"Description"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"hms_events_polling_interval_ms"}),(0,s.jsxs)(a.td,{children:["The time interval at which StarRocks reads events from your Hive metastore. Default value: ",(0,s.jsx)(a.code,{children:"5000"}),". Unit: milliseconds."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"hms_events_batch_size_per_rpc"}),(0,s.jsxs)(a.td,{children:["The maximum number of events that StarRocks can read at a time. Default value: ",(0,s.jsx)(a.code,{children:"500"}),"."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"enable_hms_parallel_process_evens"}),(0,s.jsxs)(a.td,{children:["Specifies whether StarRocks processes events in parallel as it reads the events. Valid values: ",(0,s.jsx)(a.code,{children:"true"})," and ",(0,s.jsx)(a.code,{children:"false"}),". Default value: ",(0,s.jsx)(a.code,{children:"true"}),". The value ",(0,s.jsx)(a.code,{children:"true"})," enables parallelism, and the value ",(0,s.jsx)(a.code,{children:"false"})," disables parallelism."]})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"hms_process_events_parallel_num"}),(0,s.jsxs)(a.td,{children:["The maximum number of events that StarRocks can process in parallel. Default value: ",(0,s.jsx)(a.code,{children:"4"}),"."]})]})]})]}),"\n",(0,s.jsx)(a.h2,{id:"appendix-understand-metadata-automatic-asynchronous-update",children:"Appendix: Understand metadata automatic asynchronous update"}),"\n",(0,s.jsx)(a.p,{children:"Automatic asynchronous update is the default policy that StarRocks uses to update the metadata in Delta Lake catalogs."}),"\n",(0,s.jsxs)(a.p,{children:["By default (namely, when the ",(0,s.jsx)(a.code,{children:"enable_metastore_cache"})," and ",(0,s.jsx)(a.code,{children:"enable_remote_file_cache"})," parameters are both set to ",(0,s.jsx)(a.code,{children:"true"}),"), if a query hits a partition of a Delta Lake table, StarRocks automatically caches the metadata of the partition and the metadata of the underlying data files of the partition. The cached metadata is updated by using the lazy update policy."]}),"\n",(0,s.jsxs)(a.p,{children:["For example, there is a Delta Lake table named ",(0,s.jsx)(a.code,{children:"table2"}),", which has four partitions: ",(0,s.jsx)(a.code,{children:"p1"}),", ",(0,s.jsx)(a.code,{children:"p2"}),", ",(0,s.jsx)(a.code,{children:"p3"}),", and ",(0,s.jsx)(a.code,{children:"p4"}),". A query hits ",(0,s.jsx)(a.code,{children:"p1"}),", and StarRocks caches the metadata of ",(0,s.jsx)(a.code,{children:"p1"})," and the metadata of the underlying data files of ",(0,s.jsx)(a.code,{children:"p1"}),". Assume that the default time intervals to update and discard the cached metadata are as follows:"]}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["The time interval (specified by the ",(0,s.jsx)(a.code,{children:"metastore_cache_refresh_interval_sec"})," parameter) to asynchronously update the cached metadata of ",(0,s.jsx)(a.code,{children:"p1"})," is 2 hours."]}),"\n",(0,s.jsxs)(a.li,{children:["The time interval (specified by the ",(0,s.jsx)(a.code,{children:"remote_file_cache_refresh_interval_sec"})," parameter) to asynchronously update the cached metadata of the underlying data files of ",(0,s.jsx)(a.code,{children:"p1"})," is 60 seconds."]}),"\n",(0,s.jsxs)(a.li,{children:["The time interval (specified by the ",(0,s.jsx)(a.code,{children:"metastore_cache_ttl_sec"})," parameter) to automatically discard the cached metadata of ",(0,s.jsx)(a.code,{children:"p1"})," is 24 hours."]}),"\n",(0,s.jsxs)(a.li,{children:["The time interval (specified by the ",(0,s.jsx)(a.code,{children:"remote_file_cache_ttl_sec"})," parameter) to automatically discard the cached metadata of the underlying data files of ",(0,s.jsx)(a.code,{children:"p1"})," is 36 hours."]}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"The following figure shows the time intervals on a timeline for easier understanding."}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.img,{alt:"Timeline for updating and discarding cached metadata",src:t(61914).Z+"",width:"2160",height:"856"})}),"\n",(0,s.jsx)(a.p,{children:"Then StarRocks updates or discards the metadata in compliance with the following rules:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["If another query hits ",(0,s.jsx)(a.code,{children:"p1"})," again and the current time from the last update is less than 60 seconds, StarRocks does not update the cached metadata of ",(0,s.jsx)(a.code,{children:"p1"})," or the cached metadata of the underlying data files of ",(0,s.jsx)(a.code,{children:"p1"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["If another query hits ",(0,s.jsx)(a.code,{children:"p1"})," again and the current time from the last update is more than 60 seconds, StarRocks updates the cached metadata of the underlying data files of ",(0,s.jsx)(a.code,{children:"p1"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["If another query hits ",(0,s.jsx)(a.code,{children:"p1"})," again and the current time from the last update is more than 2 hours, StarRocks updates the cached metadata of ",(0,s.jsx)(a.code,{children:"p1"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["If ",(0,s.jsx)(a.code,{children:"p1"})," has not been accessed within 24 hours from the last update, StarRocks discards the cached metadata of ",(0,s.jsx)(a.code,{children:"p1"}),". The metadata will be cached at the next query."]}),"\n",(0,s.jsxs)(a.li,{children:["If ",(0,s.jsx)(a.code,{children:"p1"})," has not been accessed within 36 hours from the last update, StarRocks discards the cached metadata of the underlying data files of ",(0,s.jsx)(a.code,{children:"p1"}),". The metadata will be cached at the next query."]}),"\n"]})]})}const h=function(e={}){const{wrapper:a}=Object.assign({},(0,n.ah)(),e.components);return a?(0,s.jsx)(a,Object.assign({},e,{children:(0,s.jsx)(d,e)})):d(e)}},61914:(e,a,t)=>{t.d(a,{Z:()=>s});const s=t.p+"assets/images/catalog_timeline-205b8d3929bc11904bb2ea52e871eb98.png"},11151:(e,a,t)=>{t.d(a,{Zo:()=>i,ah:()=>r});var s=t(67294);const n=s.createContext({});function r(e){const a=s.useContext(n);return s.useMemo((()=>"function"==typeof e?e(a):{...a,...e}),[a,e])}const l={};function i({components:e,children:a,disableParentContext:t}){let i;return i=t?"function"==typeof e?e({}):e||l:r(e),s.createElement(n.Provider,{value:i},a)}}}]);