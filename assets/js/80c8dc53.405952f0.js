"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[99160],{15679:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var i=t(85893),a=t(11151);const s={displayed_sidebar:"English"},r="Load data using INSERT",o={id:"loading/InsertInto",title:"Load data using INSERT",description:"This topic describes how to load data into StarRocks by using a DML statement - INSERT.",source:"@site/versioned_docs/version-2.3/loading/InsertInto.md",sourceDirName:"loading",slug:"/loading/InsertInto",permalink:"/docs/2.3/loading/InsertInto",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/edit/main/docs/loading/InsertInto.md",tags:[],version:"2.3",frontMatter:{displayed_sidebar:"English"},sidebar:"English",previous:{title:"Synchronize data from MySQL in real time",permalink:"/docs/2.3/loading/Flink_cdc_load"},next:{title:"Introduction",permalink:"/docs/2.3/loading/Json_loading"}},l={},d=[{value:"Precautions",id:"precautions",level:2},{value:"Preparation",id:"preparation",level:2},{value:"Insert data via INSERT INTO VALUES",id:"insert-data-via-insert-into-values",level:2},{value:"Insert data via INSERT INTO SELECT",id:"insert-data-via-insert-into-select",level:2},{value:"Check the INSERT transaction status",id:"check-the-insert-transaction-status",level:2},{value:"Check via the result",id:"check-via-the-result",level:3},{value:"Check via SHOW LOAD",id:"check-via-show-load",level:3},{value:"Check via curl command",id:"check-via-curl-command",level:3},{value:"Configuration",id:"configuration",level:2},{value:"FE configuration",id:"fe-configuration",level:3},{value:"insert_load_default_timeout_second",id:"insert_load_default_timeout_second",level:4},{value:"Session variables",id:"session-variables",level:3},{value:"enable_insert_strict",id:"enable_insert_strict",level:4},{value:"query_timeout",id:"query_timeout",level:4}];function c(e){const n=Object.assign({h1:"h1",p:"p",a:"a",h2:"h2",ul:"ul",li:"li",strong:"strong",code:"code",blockquote:"blockquote",pre:"pre",h3:"h3",h4:"h4"},(0,a.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"load-data-using-insert",children:"Load data using INSERT"}),"\n",(0,i.jsx)(n.p,{children:"This topic describes how to load data into StarRocks by using a DML statement - INSERT."}),"\n",(0,i.jsxs)(n.p,{children:["Similar to MySQL and many other database management systems, StarRocks supports loading data to an internal table with INSERT command. You can insert one or more rows with the VALUES syntax to test a function or a DEMO. You can also insert data defined by the results of a query on an internal or an ",(0,i.jsx)(n.a,{href:"/docs/2.3/data_source/External_table",children:"external table"})," to build mathematical models for small-scale datasets or back up your data in HDFS."]}),"\n",(0,i.jsx)(n.h2,{id:"precautions",children:"Precautions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Because INSERT transaction is synchronous, you can cancel it only by pressing the ",(0,i.jsx)(n.strong,{children:"Ctrl"})," and ",(0,i.jsx)(n.strong,{children:"C"})," keys from your MySQL client."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["As for the current version of StarRocks, the INSERT transaction fails by default if the data of any rows does not comply with the schema of the table. For example, the INSERT transaction fails if the length of a field in any row exceeds the length limit for the mapping field in the table. You can set the session variable ",(0,i.jsx)(n.code,{children:"enable_insert_strict"})," to ",(0,i.jsx)(n.code,{children:"false"})," to allow the transaction to continue by filtering out the rows that mismatch the table."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If you execute the INSERT statement frequently to load small batches of data into StarRocks, excessive data versions are generated. It severely affects query performance. We recommend that, in production, you should not load data with the INSERT command too often or use it as a routine for data loading on a daily basis. Should your application or analytic scenario demand solutions to loading streaming data or small data batches separately, we recommend you use Apache Kafka\xae as your data source and load the data via ",(0,i.jsx)(n.a,{href:"/docs/2.3/loading/RoutineLoad",children:"Routine Load"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"preparation",children:"Preparation"}),"\n",(0,i.jsxs)(n.p,{children:["Create a database named ",(0,i.jsx)(n.code,{children:"load_test"}),", and create an AGGREGATE KEY table ",(0,i.jsx)(n.code,{children:"insert_wiki_edit"})," and a data source table ",(0,i.jsx)(n.code,{children:"source_wiki_edit"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,i.jsxs)(n.p,{children:["Examples demonstrated in this topic are based on the table ",(0,i.jsx)(n.code,{children:"insert_wiki_edit"})," and the table ",(0,i.jsx)(n.code,{children:"source_wiki_edit"}),". Should you prefer working with your own tables and data, you can skip the preparation and move on to the next step."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE DATABASE IF NOT EXISTS load_test;\nUSE load_test;\nCREATE TABLE insert_wiki_edit\n(\n    event_time DATETIME,\n    channel VARCHAR(32) DEFAULT '',\n    user VARCHAR(128) DEFAULT '',\n    is_anonymous TINYINT DEFAULT '0',\n    is_minor TINYINT DEFAULT '0',\n    is_new TINYINT DEFAULT '0',\n    is_robot TINYINT DEFAULT '0',\n    is_unpatrolled TINYINT DEFAULT '0',\n    delta INT DEFAULT '0',\n    added INT DEFAULT '0',\n    deleted INT DEFAULT '0'\n)\nDUPLICATE KEY(event_time, channel, user, is_anonymous, is_minor, is_new, is_robot, is_unpatrolled)\nPARTITION BY RANGE(event_time)\n(\n    PARTITION p06 VALUES LESS THAN ('2015-09-12 06:00:00'),\n    PARTITION p12 VALUES LESS THAN ('2015-09-12 12:00:00'),\n    PARTITION p18 VALUES LESS THAN ('2015-09-12 18:00:00'),\n    PARTITION p24 VALUES LESS THAN ('2015-09-13 00:00:00')\n)\nDISTRIBUTED BY HASH(user) BUCKETS 3;\n\nCREATE TABLE source_wiki_edit\n(\n    event_time DATETIME,\n    channel VARCHAR(32) DEFAULT '',\n    user VARCHAR(128) DEFAULT '',\n    is_anonymous TINYINT DEFAULT '0',\n    is_minor TINYINT DEFAULT '0',\n    is_new TINYINT DEFAULT '0',\n    is_robot TINYINT DEFAULT '0',\n    is_unpatrolled TINYINT DEFAULT '0',\n    delta INT DEFAULT '0',\n    added INT DEFAULT '0',\n    deleted INT DEFAULT '0'\n)\nDUPLICATE KEY(event_time, channel, user, is_anonymous, is_minor, is_new, is_robot, is_unpatrolled)\nPARTITION BY RANGE(event_time)\n(\n    PARTITION p06 VALUES LESS THAN ('2015-09-12 06:00:00'),\n    PARTITION p12 VALUES LESS THAN ('2015-09-12 12:00:00'),\n    PARTITION p18 VALUES LESS THAN ('2015-09-12 18:00:00'),\n    PARTITION p24 VALUES LESS THAN ('2015-09-13 00:00:00')\n)\nDISTRIBUTED BY HASH(user) BUCKETS 3;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"insert-data-via-insert-into-values",children:"Insert data via INSERT INTO VALUES"}),"\n",(0,i.jsxs)(n.p,{children:["You can append one or more rows to a specific table by using INSERT INTO VALUES command. Multiple rows are separated by comma (,). For detailed instructions and parameter references, see ",(0,i.jsx)(n.a,{href:"/docs/2.3/sql-reference/sql-statements/data-manipulation/insert",children:"SQL Reference - INSERT"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CAUTION"})}),"\n",(0,i.jsxs)(n.p,{children:["Inserting data via INSERT INTO VALUES merely applies to the situation when you need to verify a DEMO with a small dataset. It is not recommended for a massive testing or production environment. To load mass data into StarRocks, see ",(0,i.jsx)(n.a,{href:"/docs/2.3/loading/Loading_intro",children:"Ingestion Overview"})," for other options that suit your scenarios."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The following example insert two rows into the data source table ",(0,i.jsx)(n.code,{children:"source_wiki_edit"})," with the label ",(0,i.jsx)(n.code,{children:"insert_load_wikipedia"}),". Label is the unique identification label for each data load transaction within the database."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:'INSERT INTO source_wiki_edit\nWITH LABEL insert_load_wikipedia\nVALUES\n    ("2015-09-12 00:00:00","#en.wikipedia","AustinFF",0,0,0,0,0,21,5,0),\n    ("2015-09-12 00:00:00","#ca.wikipedia","helloSR",0,1,0,1,0,3,23,0);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"insert-data-via-insert-into-select",children:"Insert data via INSERT INTO SELECT"}),"\n",(0,i.jsxs)(n.p,{children:["You can load the result of a query on a data source table into the target table via INSERT INTO SELECT command. INSERT INTO SELECT command performs ETL operations on the data from the data source table, and loads the data into an internal table in StarRocks. The data source can be one or more internal or external tables. The target table MUST be an internal table in StarRocks. For detailed instructions and parameter references, see ",(0,i.jsx)(n.a,{href:"/docs/2.3/sql-reference/sql-statements/data-manipulation/insert",children:"SQL Reference - INSERT"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,i.jsx)(n.p,{children:"Inserting data from an external table is identical to inserting data from an internal table. For simplicity, we only demonstrate how to insert data from an internal table in the following examples."}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The following example inserts the data from the source table to the target table ",(0,i.jsx)(n.code,{children:"insert_wiki_edit"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"INSERT INTO insert_wiki_edit\nWITH LABEL insert_load_wikipedia_1\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The following example inserts the data from the source table to the ",(0,i.jsx)(n.code,{children:"p06"})," and ",(0,i.jsx)(n.code,{children:"p12"})," partitions of the target table ",(0,i.jsx)(n.code,{children:"insert_wiki_edit"}),". If no partition is specified, the data will be inserted into all partitions. Otherwise, the data will be inserted only into the specified partition(s)."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"INSERT INTO insert_wiki_edit PARTITION(p06, p12)\nWITH LABEL insert_load_wikipedia_2\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Query the target table to make sure there is data in them."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",metastring:"text",children:"MySQL > select * from insert_wiki_edit;\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user     | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #en.wikipedia | AustinFF |            0 |        0 |      0 |        0 |              0 |    21 |     5 |       0 |\n| 2015-09-12 00:00:00 | #ca.wikipedia | helloSR  |            0 |        1 |      0 |        1 |              0 |     3 |    23 |       0 |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.00 sec)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you ",(0,i.jsx)(n.a,{href:"/docs/2.3/sql-reference/sql-functions/math-functions/truncate",children:"truncate"})," the ",(0,i.jsx)(n.code,{children:"p06"})," and ",(0,i.jsx)(n.code,{children:"p12"})," partitions, the data will not be returned in a query."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",children:"MySQL > TRUNCATE TABLE insert_wiki_edit PARTITION(p06, p12);\nQuery OK, 0 rows affected (0.01 sec)\n\nMySQL > select * from insert_wiki_edit;\nEmpty set (0.00 sec)\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The following example inserts the ",(0,i.jsx)(n.code,{children:"event_time"})," and ",(0,i.jsx)(n.code,{children:"channel"})," columns from the source table to the target table ",(0,i.jsx)(n.code,{children:"insert_wiki_edit"}),". Default values are used in the columns that are not specified here."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"INSERT INTO insert_wiki_edit\nWITH LABEL insert_load_wikipedia_3 \n(\n    event_time, \n    channel\n)\nSELECT event_time, channel FROM source_wiki_edit;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"check-the-insert-transaction-status",children:"Check the INSERT transaction status"}),"\n",(0,i.jsx)(n.h3,{id:"check-via-the-result",children:"Check via the result"}),"\n",(0,i.jsx)(n.p,{children:"The INSERT transaction returns different status in accordance with the result of the transaction."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Transaction succeeds"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"StarRocks returns the following if the transaction succeeds:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",children:"Query OK, 2 rows affected (0.05 sec)\n{'label':'insert_load_wikipedia', 'status':'VISIBLE', 'txnId':'1006'}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Transaction fails"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If all rows of data fail to be loaded into the target table, the INSERT transaction fails. StarRocks returns the following if the transaction fails:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",children:"ERROR 1064 (HY000): Insert has filtered data in strict mode, tracking_url=http://x.x.x.x:yyyy/api/_load_error_log?file=error_log_9f0a4fd0b64e11ec_906bbede076e9d08\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can locate the problem by checking the log with ",(0,i.jsx)(n.code,{children:"tracking_url"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"check-via-show-load",children:"Check via SHOW LOAD"}),"\n",(0,i.jsx)(n.p,{children:"You can check the INSERT transaction status by using SHOW LOAD command."}),"\n",(0,i.jsxs)(n.p,{children:["The following example checks the status of the transaction with label ",(0,i.jsx)(n.code,{children:"insert_load_wikipedia"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:'SHOW LOAD WHERE label="insert_load_wikipedia"\\G\n'})}),"\n",(0,i.jsx)(n.p,{children:"The return is as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",children:'*************************** 1. row ***************************\n         JobId: 13525\n         Label: insert_load_wikipedia\n         State: FINISHED\n      Progress: ETL:100%; LOAD:100%\n          Type: INSERT\n       EtlInfo: NULL\n      TaskInfo: cluster:N/A; timeout(s):3600; max_filter_ratio:0.0\n      ErrorMsg: NULL\n    CreateTime: 2022-08-02 11:41:26\n  EtlStartTime: 2022-08-02 11:41:26\n EtlFinishTime: 2022-08-02 11:41:26\n LoadStartTime: 2022-08-02 11:41:26\nLoadFinishTime: 2022-08-02 11:41:26\n           URL: \n    JobDetails: {"Unfinished backends":{},"ScannedRows":0,"TaskNumber":0,"All backends":{},"FileNumber":0,"FileSize":0}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"check-via-curl-command",children:"Check via curl command"}),"\n",(0,i.jsx)(n.p,{children:"You can check the INSERT transaction status by using curl command."}),"\n",(0,i.jsxs)(n.p,{children:["The following example checks the status of the transaction with label ",(0,i.jsx)(n.code,{children:"insert_load_wikipedia"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Bash",children:"curl --location-trusted -u <username>:<password> \\\n  http://x.x.x.x:8030/api/load_test/_load_info?label=insert_load_wikipedia\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,i.jsxs)(n.p,{children:["If you use an account for which no password is set, you need to input only ",(0,i.jsx)(n.code,{children:"<username>:"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The return is as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",children:'{\n  "jobInfo": {\n    "dbName": "default_cluster:load_test",\n    "tblNames": [\n      "source_wiki_edit"\n    ],\n    "label": "insert_load_wikipedia",\n    "clusterName": "default_cluster",\n    "state": "FINISHED",\n    "failMsg": "",\n    "trackingUrl": ""\n  },\n  "status": "OK",\n  "msg": "Success"\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"You can set the following configuration items for INSERT transaction:"}),"\n",(0,i.jsx)(n.h3,{id:"fe-configuration",children:"FE configuration"}),"\n",(0,i.jsx)(n.h4,{id:"insert_load_default_timeout_second",children:"insert_load_default_timeout_second"}),"\n",(0,i.jsx)(n.p,{children:"Default timeout for INSERT transaction. Unit: second. If the current INSERT transaction is not completed within the time set by this parameter, it will be canceled by the system and the status will be CANCELLED. As for current version of StarRocks, you can only specify a uniform timeout for all INSERT transactions using this parameter, and you cannot set a different timeout for a specific INSERT transaction. The default is 3600 seconds (1 hour). If the INSERT transaction cannot be completed within the specified time, you can extend the timeout by adjusting this parameter."}),"\n",(0,i.jsx)(n.h3,{id:"session-variables",children:"Session variables"}),"\n",(0,i.jsx)(n.h4,{id:"enable_insert_strict",children:"enable_insert_strict"}),"\n",(0,i.jsxs)(n.p,{children:["Switch value to control if the INSERT transaction is tolerant of invalid data rows. When it is set to ",(0,i.jsx)(n.code,{children:"true"}),", the transaction fails if any of the data rows is invalid. When it is set to ",(0,i.jsx)(n.code,{children:"false"}),", the transaction succeeds when at least one row of data has been loaded correctly, and the label will be returned. The default is ",(0,i.jsx)(n.code,{children:"true"}),". You can set this variable with ",(0,i.jsx)(n.code,{children:"SET enable_insert_strict = {true | false};"})," command."]}),"\n",(0,i.jsx)(n.h4,{id:"query_timeout",children:"query_timeout"}),"\n",(0,i.jsxs)(n.p,{children:["Timeout for SQL commands. Unit: second. INSERT, as a SQL command, is also restricted by this session variable. You can set this variable with the ",(0,i.jsx)(n.code,{children:"SET query_timeout = xxx;"})," command."]})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,i.jsx)(n,Object.assign({},e,{children:(0,i.jsx)(c,e)})):c(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>o,ah:()=>s});var i=t(67294);const a=i.createContext({});function s(e){const n=i.useContext(a);return i.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const r={};function o({components:e,children:n,disableParentContext:t}){let o;return o=t?"function"==typeof e?e({}):e||r:s(e),i.createElement(a.Provider,{value:o},n)}}}]);