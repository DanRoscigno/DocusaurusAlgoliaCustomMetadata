"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[59357],{89532:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>l,toc:()=>i});var s=t(85893),a=t(11151);const c={},r="STRUCT",l={id:"sql-reference/sql-statements/data-types/STRUCT",title:"STRUCT",description:"Description",source:"@site/versioned_docs/version-3.1/sql-reference/sql-statements/data-types/STRUCT.md",sourceDirName:"sql-reference/sql-statements/data-types",slug:"/sql-reference/sql-statements/data-types/STRUCT",permalink:"/docs/sql-reference/sql-statements/data-types/STRUCT",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/sql-reference/sql-statements/data-types/STRUCT.md",tags:[],version:"3.1",frontMatter:{},sidebar:"documentation",previous:{title:"MAP",permalink:"/docs/sql-reference/sql-statements/data-types/Map"},next:{title:"Other",permalink:"/docs/category/other"}},o={},i=[{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Define a STRUCT column in StarRocks",id:"define-a-struct-column-in-starrocks",level:2},{value:"Construct structs in SQL",id:"construct-structs-in-sql",level:2},{value:"Load STRUCT data",id:"load-struct-data",level:2},{value:"INSERT INTO",id:"insert-into",level:3},{value:"Load STRUCT data from ORC/Parquet files",id:"load-struct-data-from-orcparquet-files",level:3},{value:"Access STRUCT fields",id:"access-struct-fields",level:2}];function d(e){const n=Object.assign({h1:"h1",h2:"h2",p:"p",code:"code",a:"a",pre:"pre",ul:"ul",li:"li",h3:"h3"},(0,a.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"struct",children:"STRUCT"}),"\n",(0,s.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,s.jsxs)(n.p,{children:["STRUCT is widely used to express complex data types. It represents a collection of elements (also called fields) with different data types, for example, ",(0,s.jsx)(n.code,{children:"<a INT, b STRING>"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Field names in a struct must be unique. Fields can be of primitive data types (such as numeric, string, or date) or complex data types (such as ARRAY or MAP)."}),"\n",(0,s.jsxs)(n.p,{children:["A field within a struct can also be another STRUCT, ARRAY, or MAP, which allows you to create nested data structures, for example, ",(0,s.jsx)(n.code,{children:"STRUCT<a INT, b STRUCT<c INT, d INT>, c MAP<INT, INT>, d ARRAY<INT>>"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The STRUCT data type is supported from v3.1 onwards. In v3.1, you can define STRUCT columns when you create a StarRocks table, load STRUCT data into that table, and query MAP data."}),"\n",(0,s.jsxs)(n.p,{children:["From v2.5 onwards, StarRocks supports querying complex data types MAP and STRUCT from data lakes. You can use external catalogs provided by StarRocks to query MAP and STRUCT data from Apache Hive\u2122, Apache Hudi, and Apache Iceberg. You can only query data from ORC and Parquet files. For more information about how to use external catalogs to query external data sources, see ",(0,s.jsx)(n.a,{href:"/docs/data_source/catalog/catalog_overview",children:"Overview of catalogs"})," and topics related to the required catalog type."]}),"\n",(0,s.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Haskell",children:"STRUCT<name, type>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": the field name, same as the column name defined in the CREATE TABLE statement."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"type"}),": the field type. It can be of any supported type."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"define-a-struct-column-in-starrocks",children:"Define a STRUCT column in StarRocks"}),"\n",(0,s.jsx)(n.p,{children:"You can define a STRUCT column when you create a table and load STRUCT data into this column."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"-- Define a one-dimensional struct.\nCREATE TABLE t0(\n  c0 INT,\n  c1 STRUCT<a INT, b INT>\n)\nDUPLICATE KEY(c0);\n\n-- Define a complex struct.\nCREATE TABLE t1(\n  c0 INT,\n  c1 STRUCT<a INT, b STRUCT<c INT, d INT>, c MAP<INT, INT>, d ARRAY<INT>>\n)\nDUPLICATE KEY(c0);\n\n-- Define a NOT NULL struct.\nCREATE TABLE t2(\n  c0 INT,\n  c1 STRUCT<a INT, b INT> NOT NULL\n)\nDUPLICATE KEY(c0);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Columns with the STRUCT type have the following restrictions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cannot be used as key columns in a table. They can only be used as value columns."}),"\n",(0,s.jsx)(n.li,{children:"Cannot be used as partition key columns (following PARTITION BY) in a table."}),"\n",(0,s.jsx)(n.li,{children:"Cannot be used as bucketing columns (following DISTRIBUTED BY) in a table."}),"\n",(0,s.jsxs)(n.li,{children:["Only supports the replace() function when used as a value column in an ",(0,s.jsx)(n.a,{href:"/docs/table_design/table_types/aggregate_table",children:"Aggregate table"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"construct-structs-in-sql",children:"Construct structs in SQL"}),"\n",(0,s.jsxs)(n.p,{children:["STRUCT can be constructed in SQL using the following functions: ",(0,s.jsx)(n.a,{href:"/docs/sql-reference/sql-functions/struct-functions/row",children:"row, struct"}),", and ",(0,s.jsx)(n.a,{href:"/docs/sql-reference/sql-functions/struct-functions/named_struct",children:"named_struct"}),". struct() is the alias of row()."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"row"})," and ",(0,s.jsx)(n.code,{children:"struct"})," support unnamed struct. You do not need to specify the field names. StarRocks automatically generates column names, like ",(0,s.jsx)(n.code,{children:"col1"}),", ",(0,s.jsx)(n.code,{children:"col2"}),"..."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"named_struct"})," supports named struct. The expressions of names and values must be in pairs."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"StarRocks automatically determines the type of the struct based on the input values."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'select row(1, 2, 3, 4) as numbers; -- Return {"col1":1,"col2":2,"col3":3,"col4":4}.\nselect row(1, 2, null, 4) as numbers; -- Return {"col1":1,"col2":2,"col3":null,"col4":4}.\nselect row(null) as nulls; -- Return {"col1":null}.\nselect struct(1, 2, 3, 4) as numbers; -- Return {"col1":1,"col2":2,"col3":3,"col4":4}.\nselect named_struct(\'a\', 1, \'b\', 2, \'c\', 3, \'d\', 4) as numbers; -- Return {"a":1,"b":2,"c":3,"d":4}.\n'})}),"\n",(0,s.jsx)(n.h2,{id:"load-struct-data",children:"Load STRUCT data"}),"\n",(0,s.jsxs)(n.p,{children:["You can load STRUCT data into StarRocks using two methods: ",(0,s.jsx)(n.a,{href:"/docs/loading/InsertInto",children:"INSERT INTO"}),", and ",(0,s.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/BROKER%20LOAD",children:"ORC/Parquet loading"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Note that StarRocks automatically casts the data type into the corresponding STRUCT type."}),"\n",(0,s.jsx)(n.h3,{id:"insert-into",children:"INSERT INTO"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'CREATE TABLE t0(\n  c0 INT,\n  c1 STRUCT<a INT, b INT>\n)\nDUPLICATE KEY(c0);\n\nINSERT INTO t0 VALUES(1, row(1, 1));\n\nSELECT * FROM t0;\n+------+---------------+\n| c0   | c1            |\n+------+---------------+\n|    1 | {"a":1,"b":1} |\n+------+---------------+\n'})}),"\n",(0,s.jsx)(n.h3,{id:"load-struct-data-from-orcparquet-files",children:"Load STRUCT data from ORC/Parquet files"}),"\n",(0,s.jsxs)(n.p,{children:["The STRUCT data type in StarRocks corresponds to the nested columns structure in ORC or Parquet format. No additional specification is needed. You can load STRUCT data from ORC or Parquet files by following the instructions in ",(0,s.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/BROKER%20LOAD",children:"ORC/Parquet loading"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"access-struct-fields",children:"Access STRUCT fields"}),"\n",(0,s.jsxs)(n.p,{children:["To query a subfield of a struct, you can use the dot (",(0,s.jsx)(n.code,{children:"."}),") operator to query a value by its field name, or use ",(0,s.jsx)(n.code,{children:"[]"})," to call a value by its index."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> select named_struct('a', 1, 'b', 2, 'c', 3, 'd', 4).a;\n+------------------------------------------------+\n| named_struct('a', 1, 'b', 2, 'c', 3, 'd', 4).a |\n+------------------------------------------------+\n| 1                                              |\n+------------------------------------------------+\n\nmysql> select row(1, 2, 3, 4).col1;\n+-----------------------+\n| row(1, 2, 3, 4).col1  |\n+-----------------------+\n| 1                     |\n+-----------------------+\n\nmysql> select row(2, 4, 6, 8)[2];\n+--------------------+\n| row(2, 4, 6, 8)[2] |\n+--------------------+\n|                  4 |\n+--------------------+\n\nmysql> select row(map{'a':1}, 2, 3, 4)[1];\n+-----------------------------+\n| row(map{'a':1}, 2, 3, 4)[1] |\n+-----------------------------+\n| {\"a\":1}                     |\n+-----------------------------+\n"})})]})}const u=function(e={}){const{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(d,e)})):d(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>l,ah:()=>c});var s=t(67294);const a=s.createContext({});function c(e){const n=s.useContext(a);return s.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const r={};function l({components:e,children:n,disableParentContext:t}){let l;return l=t?"function"==typeof e?e({}):e||r:c(e),s.createElement(a.Provider,{value:l},n)}}}]);