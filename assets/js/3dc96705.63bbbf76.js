"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[86375],{76089:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var a=t(85893),i=t(11151);const s={},r="Load data using INSERT",o={id:"loading/InsertInto",title:"Load data using INSERT",description:"This topic describes how to load data into StarRocks by using a SQL statement - INSERT.",source:"@site/versioned_docs/version-3.1/loading/InsertInto.md",sourceDirName:"loading",slug:"/loading/InsertInto",permalink:"/docs/loading/InsertInto",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/loading/InsertInto.md",tags:[],version:"3.1",frontMatter:{},sidebar:"documentation",previous:{title:"Load data in bulk using Spark Load",permalink:"/docs/loading/SparkLoad"},next:{title:"Load data using Stream Load transaction interface",permalink:"/docs/loading/Stream_Load_transaction_interface"}},l={},d=[{value:"Precautions",id:"precautions",level:2},{value:"Preparation",id:"preparation",level:2},{value:"Insert data via INSERT INTO VALUES",id:"insert-data-via-insert-into-values",level:2},{value:"Insert data via INSERT INTO SELECT",id:"insert-data-via-insert-into-select",level:2},{value:"Insert data from an internal or external table into an internal table",id:"insert-data-from-an-internal-or-external-table-into-an-internal-table",level:3},{value:"Insert data directly from files in an external source using FILES()",id:"insert-data-directly-from-files-in-an-external-source-using-files",level:3},{value:"Overwrite data via INSERT OVERWRITE VALUES",id:"overwrite-data-via-insert-overwrite-values",level:2},{value:"Overwrite data via INSERT OVERWRITE SELECT",id:"overwrite-data-via-insert-overwrite-select",level:2},{value:"Insert data into a table with generated columns",id:"insert-data-into-a-table-with-generated-columns",level:2},{value:"Load data asynchronously using INSERT",id:"load-data-asynchronously-using-insert",level:2},{value:"Check the INSERT job status",id:"check-the-insert-job-status",level:2},{value:"Check via the result",id:"check-via-the-result",level:3},{value:"Check via Information Schema",id:"check-via-information-schema",level:3},{value:"Check via curl command",id:"check-via-curl-command",level:3},{value:"Configuration",id:"configuration",level:2}];function c(e){const n=Object.assign({h1:"h1",p:"p",a:"a",ol:"ol",li:"li",blockquote:"blockquote",strong:"strong",h2:"h2",ul:"ul",code:"code",pre:"pre",h3:"h3",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,i.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"load-data-using-insert",children:"Load data using INSERT"}),"\n",(0,a.jsx)(n.p,{children:"This topic describes how to load data into StarRocks by using a SQL statement - INSERT."}),"\n",(0,a.jsxs)(n.p,{children:["Similar to MySQL and many other database management systems, StarRocks supports loading data to an internal table with INSERT. You can insert one or more rows directly with the VALUES clause to test a function or a DEMO. You can also insert data defined by the results of a query into an internal table from an ",(0,a.jsx)(n.a,{href:"/docs/data_source/External_table",children:"external table"}),". From StarRocks v3.1 onwards, you can directly load data from files on cloud storage using the INSERT command and the table function ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-functions/table-functions/files",children:"FILES()"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"StarRocks v2.4 further supports overwriting data into a table by using INSERT OVERWRITE. The INSERT OVERWRITE statement integrates the following operations to implement the overwriting function:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Creates temporary partitions according to the partitions that store the original data."}),"\n",(0,a.jsx)(n.li,{children:"Inserts data into the temporary partitions."}),"\n",(0,a.jsx)(n.li,{children:"Swaps the original partitions with the temporary partitions."}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,a.jsx)(n.p,{children:"If you need to verify the data before overwriting it, instead of using INSERT OVERWRITE, you can follow the above procedures to overwrite your data and verify it before swapping the partitions."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"precautions",children:"Precautions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["You can cancel a synchronous INSERT transaction only by pressing the ",(0,a.jsx)(n.strong,{children:"Ctrl"})," and ",(0,a.jsx)(n.strong,{children:"C"})," keys from your MySQL client."]}),"\n",(0,a.jsxs)(n.li,{children:["You can submit an asynchronous INSERT task using ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SUBMIT%20TASK",children:"SUBMIT TASK"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["As for the current version of StarRocks, the INSERT transaction fails by default if the data of any rows does not comply with the schema of the table. For example, the INSERT transaction fails if the length of a field in any row exceeds the length limit for the mapping field in the table. You can set the session variable ",(0,a.jsx)(n.code,{children:"enable_insert_strict"})," to ",(0,a.jsx)(n.code,{children:"false"})," to allow the transaction to continue by filtering out the rows that mismatch the table."]}),"\n",(0,a.jsxs)(n.li,{children:["If you execute the INSERT statement frequently to load small batches of data into StarRocks, excessive data versions are generated. It severely affects query performance. We recommend that, in production, you should not load data with the INSERT command too often or use it as a routine for data loading on a daily basis. If your application or analytic scenario demand solutions to loading streaming data or small data batches separately, we recommend you use Apache Kafka\xae as your data source and load the data via ",(0,a.jsx)(n.a,{href:"/docs/loading/RoutineLoad",children:"Routine Load"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["If you execute the INSERT OVERWRITE statement, StarRocks creates temporary partitions for the partitions which store the original data, inserts new data into the temporary partitions, and ",(0,a.jsx)(n.a,{href:"../sql-statements/data-definition/ALTER%20TABLE.md#use-a-temporary-partition-to-replace-current-partition",children:"swaps the original partitions with the temporary partitions"}),". All these operations are executed in the FE Leader node. Hence, if the FE Leader node crashes while executing INSERT OVERWRITE command, the whole load transaction will fail, and the temporary partitions will be truncated."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"preparation",children:"Preparation"}),"\n",(0,a.jsxs)(n.p,{children:["Create a database named ",(0,a.jsx)(n.code,{children:"load_test"}),", and create a table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," as the destination table and a table ",(0,a.jsx)(n.code,{children:"source_wiki_edit"})," as the source table."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,a.jsxs)(n.p,{children:["Examples demonstrated in this topic are based on the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," and the table ",(0,a.jsx)(n.code,{children:"source_wiki_edit"}),". If you prefer working with your own tables and data, you can skip the preparation and move on to the next step."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"CREATE DATABASE IF NOT EXISTS load_test;\nUSE load_test;\nCREATE TABLE insert_wiki_edit\n(\n    event_time      DATETIME,\n    channel         VARCHAR(32)      DEFAULT '',\n    user            VARCHAR(128)     DEFAULT '',\n    is_anonymous    TINYINT          DEFAULT '0',\n    is_minor        TINYINT          DEFAULT '0',\n    is_new          TINYINT          DEFAULT '0',\n    is_robot        TINYINT          DEFAULT '0',\n    is_unpatrolled  TINYINT          DEFAULT '0',\n    delta           INT              DEFAULT '0',\n    added           INT              DEFAULT '0',\n    deleted         INT              DEFAULT '0'\n)\nDUPLICATE KEY(\n    event_time,\n    channel,\n    user,\n    is_anonymous,\n    is_minor,\n    is_new,\n    is_robot,\n    is_unpatrolled\n)\nPARTITION BY RANGE(event_time)(\n    PARTITION p06 VALUES LESS THAN ('2015-09-12 06:00:00'),\n    PARTITION p12 VALUES LESS THAN ('2015-09-12 12:00:00'),\n    PARTITION p18 VALUES LESS THAN ('2015-09-12 18:00:00'),\n    PARTITION p24 VALUES LESS THAN ('2015-09-13 00:00:00')\n)\nDISTRIBUTED BY HASH(user);\n\nCREATE TABLE source_wiki_edit\n(\n    event_time      DATETIME,\n    channel         VARCHAR(32)      DEFAULT '',\n    user            VARCHAR(128)     DEFAULT '',\n    is_anonymous    TINYINT          DEFAULT '0',\n    is_minor        TINYINT          DEFAULT '0',\n    is_new          TINYINT          DEFAULT '0',\n    is_robot        TINYINT          DEFAULT '0',\n    is_unpatrolled  TINYINT          DEFAULT '0',\n    delta           INT              DEFAULT '0',\n    added           INT              DEFAULT '0',\n    deleted         INT              DEFAULT '0'\n)\nDUPLICATE KEY(\n    event_time,\n    channel,user,\n    is_anonymous,\n    is_minor,\n    is_new,\n    is_robot,\n    is_unpatrolled\n)\nPARTITION BY RANGE(event_time)(\n    PARTITION p06 VALUES LESS THAN ('2015-09-12 06:00:00'),\n    PARTITION p12 VALUES LESS THAN ('2015-09-12 12:00:00'),\n    PARTITION p18 VALUES LESS THAN ('2015-09-12 18:00:00'),\n    PARTITION p24 VALUES LESS THAN ('2015-09-13 00:00:00')\n)\nDISTRIBUTED BY HASH(user);\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTICE"})}),"\n",(0,a.jsxs)(n.p,{children:["Since v2.5.7, StarRocks can automatically set the number of buckets (BUCKETS) when you create a table or add a partition. You no longer need to manually set the number of buckets. For detailed information, see ",(0,a.jsx)(n.a,{href:"/docs/table_design/Data_distribution#determine-the-number-of-buckets",children:"determine the number of buckets"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"insert-data-via-insert-into-values",children:"Insert data via INSERT INTO VALUES"}),"\n",(0,a.jsxs)(n.p,{children:["You can append one or more rows to a specific table by using INSERT INTO VALUES command. Multiple rows are separated by comma (,). For detailed instructions and parameter references, see ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/insert",children:"SQL Reference - INSERT"}),"."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"CAUTION"})}),"\n",(0,a.jsxs)(n.p,{children:["Inserting data via INSERT INTO VALUES merely applies to the situation when you need to verify a DEMO with a small dataset. It is not recommended for a massive testing or production environment. To load mass data into StarRocks, see ",(0,a.jsx)(n.a,{href:"/docs/loading/Loading_intro",children:"Ingestion Overview"})," for other options that suit your scenarios."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The following example inserts two rows into the data source table ",(0,a.jsx)(n.code,{children:"source_wiki_edit"})," with the label ",(0,a.jsx)(n.code,{children:"insert_load_wikipedia"}),". Label is the unique identification label for each data load transaction within the database."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:'INSERT INTO source_wiki_edit\nWITH LABEL insert_load_wikipedia\nVALUES\n    ("2015-09-12 00:00:00","#en.wikipedia","AustinFF",0,0,0,0,0,21,5,0),\n    ("2015-09-12 00:00:00","#ca.wikipedia","helloSR",0,1,0,1,0,3,23,0);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"insert-data-via-insert-into-select",children:"Insert data via INSERT INTO SELECT"}),"\n",(0,a.jsxs)(n.p,{children:["You can load the result of a query on a data source table into the target table via INSERT INTO SELECT command. INSERT INTO SELECT command performs ETL operations on the data from the data source table, and loads the data into an internal table in StarRocks. The data source can be one or more internal or external tables, or even data files on cloud storage. The target table MUST be an internal table in StarRocks. For detailed instructions and parameter references, see ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/insert",children:"SQL Reference - INSERT"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"insert-data-from-an-internal-or-external-table-into-an-internal-table",children:"Insert data from an internal or external table into an internal table"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,a.jsx)(n.p,{children:"Inserting data from an external table is identical to inserting data from an internal table. For simplicity, we only demonstrate how to insert data from an internal table in the following examples."}),"\n"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example inserts the data from the source table to the target table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"INSERT INTO insert_wiki_edit\nWITH LABEL insert_load_wikipedia_1\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example inserts the data from the source table to the ",(0,a.jsx)(n.code,{children:"p06"})," and ",(0,a.jsx)(n.code,{children:"p12"})," partitions of the target table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"}),". If no partition is specified, the data will be inserted into all partitions. Otherwise, the data will be inserted only into the specified partition(s)."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"INSERT INTO insert_wiki_edit PARTITION(p06, p12)\nWITH LABEL insert_load_wikipedia_2\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Query the target table to make sure there is data in them."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",metastring:"text",children:"MySQL > select * from insert_wiki_edit;\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user     | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #en.wikipedia | AustinFF |            0 |        0 |      0 |        0 |              0 |    21 |     5 |       0 |\n| 2015-09-12 00:00:00 | #ca.wikipedia | helloSR  |            0 |        1 |      0 |        1 |              0 |     3 |    23 |       0 |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.00 sec)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["If you truncate the ",(0,a.jsx)(n.code,{children:"p06"})," and ",(0,a.jsx)(n.code,{children:"p12"})," partitions, the data will not be returned in a query."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:"MySQL > TRUNCATE TABLE insert_wiki_edit PARTITION(p06, p12);\nQuery OK, 0 rows affected (0.01 sec)\n\nMySQL > select * from insert_wiki_edit;\nEmpty set (0.00 sec)\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example inserts the ",(0,a.jsx)(n.code,{children:"event_time"})," and ",(0,a.jsx)(n.code,{children:"channel"})," columns from the source table to the target table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"}),". Default values are used in the columns that are not specified here."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"INSERT INTO insert_wiki_edit\nWITH LABEL insert_load_wikipedia_3 \n(\n    event_time, \n    channel\n)\nSELECT event_time, channel FROM source_wiki_edit;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"insert-data-directly-from-files-in-an-external-source-using-files",children:"Insert data directly from files in an external source using FILES()"}),"\n",(0,a.jsxs)(n.p,{children:["From v3.1 onwards, StarRocks supports directly loading data from files on cloud storage using the INSERT command and the ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-functions/table-functions/files",children:"FILES()"})," function, thereby you do not need to create an external catalog or file external table first. Besides, FILES() can automatically infer the table schema of the files, greatly simplifying the process of data loading."]}),"\n",(0,a.jsxs)(n.p,{children:["The following example inserts data rows from the Parquet file ",(0,a.jsx)(n.strong,{children:"parquet/insert_wiki_edit_append.parquet"})," within the AWS S3 bucket ",(0,a.jsx)(n.code,{children:"inserttest"})," into the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:'INSERT INTO insert_wiki_edit\n    SELECT * FROM FILES(\n        "path" = "s3://inserttest/parquet/insert_wiki_edit_append.parquet",\n        "format" = "parquet",\n        "aws.s3.access_key" = "XXXXXXXXXX",\n        "aws.s3.secret_key" = "YYYYYYYYYY",\n        "aws.s3.region" = "us-west-2"\n);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"overwrite-data-via-insert-overwrite-values",children:"Overwrite data via INSERT OVERWRITE VALUES"}),"\n",(0,a.jsxs)(n.p,{children:["You can overwrite a specific table with one or more rows by using INSERT OVERWRITE VALUES command. Multiple rows are separated by comma (,). For detailed instructions and parameter references, see ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/insert",children:"SQL Reference - INSERT"}),"."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"CAUTION"})}),"\n",(0,a.jsxs)(n.p,{children:["Overwriting data via INSERT OVERWRITE VALUES merely applies to the situation when you need to verify a DEMO with a small dataset. It is not recommended for a massive testing or production environment. To load mass data into StarRocks, see ",(0,a.jsx)(n.a,{href:"/docs/loading/Loading_intro",children:"Ingestion Overview"})," for other options that suit your scenarios."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Query the source table and the target table to make sure there is data in them."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:"MySQL > SELECT * FROM source_wiki_edit;\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user     | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #ca.wikipedia | helloSR  |            0 |        1 |      0 |        1 |              0 |     3 |    23 |       0 |\n| 2015-09-12 00:00:00 | #en.wikipedia | AustinFF |            0 |        0 |      0 |        0 |              0 |    21 |     5 |       0 |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.02 sec)\n \nMySQL > SELECT * FROM insert_wiki_edit;\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user     | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #ca.wikipedia | helloSR  |            0 |        1 |      0 |        1 |              0 |     3 |    23 |       0 |\n| 2015-09-12 00:00:00 | #en.wikipedia | AustinFF |            0 |        0 |      0 |        0 |              0 |    21 |     5 |       0 |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.01 sec)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The following example overwrites the source table ",(0,a.jsx)(n.code,{children:"source_wiki_edit"})," with two new rows."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:'INSERT OVERWRITE source_wiki_edit\nWITH LABEL insert_load_wikipedia_ow\nVALUES\n    ("2015-09-12 00:00:00","#cn.wikipedia","GELongstreet",0,0,0,0,0,36,36,0),\n    ("2015-09-12 00:00:00","#fr.wikipedia","PereBot",0,1,0,1,0,17,17,0);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"overwrite-data-via-insert-overwrite-select",children:"Overwrite data via INSERT OVERWRITE SELECT"}),"\n",(0,a.jsxs)(n.p,{children:["You can overwrite a table with the result of a query on a data source table via INSERT OVERWRITE SELECT command. INSERT OVERWRITE SELECT statement performs ETL operations on the data from one or more internal or external tables, and overwrites an internal table with the data For detailed instructions and parameter references, see ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/insert",children:"SQL Reference - INSERT"}),"."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,a.jsx)(n.p,{children:"Loading data from an external table is identical to loading data from an internal table. For simplicity, we only demonstrate how to overwrite the target table with the data from an internal table in the following examples."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Query the source table and the target table to make sure that they hold different rows of data."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:"MySQL > SELECT * FROM source_wiki_edit;\n+---------------------+---------------+--------------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user         | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+--------------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #cn.wikipedia | GELongstreet |            0 |        0 |      0 |        0 |              0 |    36 |    36 |       0 |\n| 2015-09-12 00:00:00 | #fr.wikipedia | PereBot      |            0 |        1 |      0 |        1 |              0 |    17 |    17 |       0 |\n+---------------------+---------------+--------------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.02 sec)\n \nMySQL > SELECT * FROM insert_wiki_edit;\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user     | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #en.wikipedia | AustinFF |            0 |        0 |      0 |        0 |              0 |    21 |     5 |       0 |\n| 2015-09-12 00:00:00 | #ca.wikipedia | helloSR  |            0 |        1 |      0 |        1 |              0 |     3 |    23 |       0 |\n+---------------------+---------------+----------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.01 sec)\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example overwrites the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," with the data from the source table."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"INSERT OVERWRITE insert_wiki_edit\nWITH LABEL insert_load_wikipedia_ow_1\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example overwrites the ",(0,a.jsx)(n.code,{children:"p06"})," and ",(0,a.jsx)(n.code,{children:"p12"})," partitions of the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," with the data from the source table."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"INSERT OVERWRITE insert_wiki_edit PARTITION(p06, p12)\nWITH LABEL insert_load_wikipedia_ow_2\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Query the target table to make sure there is data in them."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",metastring:"text",children:"MySQL > select * from insert_wiki_edit;\n+---------------------+---------------+--------------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| event_time          | channel       | user         | is_anonymous | is_minor | is_new | is_robot | is_unpatrolled | delta | added | deleted |\n+---------------------+---------------+--------------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n| 2015-09-12 00:00:00 | #fr.wikipedia | PereBot      |            0 |        1 |      0 |        1 |              0 |    17 |    17 |       0 |\n| 2015-09-12 00:00:00 | #cn.wikipedia | GELongstreet |            0 |        0 |      0 |        0 |              0 |    36 |    36 |       0 |\n+---------------------+---------------+--------------+--------------+----------+--------+----------+----------------+-------+-------+---------+\n2 rows in set (0.01 sec)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["If you truncate the ",(0,a.jsx)(n.code,{children:"p06"})," and ",(0,a.jsx)(n.code,{children:"p12"})," partitions, the data will not be returned in a query."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:"MySQL > TRUNCATE TABLE insert_wiki_edit PARTITION(p06, p12);\nQuery OK, 0 rows affected (0.01 sec)\n\nMySQL > select * from insert_wiki_edit;\nEmpty set (0.00 sec)\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example overwrites the target table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," with the ",(0,a.jsx)(n.code,{children:"event_time"})," and ",(0,a.jsx)(n.code,{children:"channel"})," columns from the source table. The default value is assigned to the columns into which no data is overwritten."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"INSERT OVERWRITE insert_wiki_edit\nWITH LABEL insert_load_wikipedia_ow_3 \n(\n    event_time, \n    channel\n)\nSELECT event_time, channel FROM source_wiki_edit;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"insert-data-into-a-table-with-generated-columns",children:"Insert data into a table with generated columns"}),"\n",(0,a.jsx)(n.p,{children:"A generated column is a special column whose value is derived from a pre-defined expression or evaluation based on other columns. Generated columns are especially useful when your query requests involve evaluations of expensive expressions, for example, querying a certain field from a JSON value, or calculating ARRAY data. StarRocks evaluates the expression and stores the results in the generated columns while data is being loaded into the table, thereby avoiding the expression evaluation during queries and improving the query performance."}),"\n",(0,a.jsx)(n.p,{children:"You can load data into a table with generated columns using INSERT."}),"\n",(0,a.jsxs)(n.p,{children:["The following example creates a table ",(0,a.jsx)(n.code,{children:"insert_generated_columns"})," and inserts a row into it. The table contains two generated columns: ",(0,a.jsx)(n.code,{children:"avg_array"})," and ",(0,a.jsx)(n.code,{children:"get_string"}),". ",(0,a.jsx)(n.code,{children:"avg_array"})," calculates the average value of ARRAY data in ",(0,a.jsx)(n.code,{children:"data_array"}),", and ",(0,a.jsx)(n.code,{children:"get_string"})," extracts the strings from the JSON path ",(0,a.jsx)(n.code,{children:"a"})," in ",(0,a.jsx)(n.code,{children:"data_json"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:'CREATE TABLE insert_generated_columns (\n  id           INT(11)           NOT NULL    COMMENT "ID",\n  data_array   ARRAY<INT(11)>    NOT NULL    COMMENT "ARRAY",\n  data_json    JSON              NOT NULL    COMMENT "JSON",\n  avg_array    DOUBLE            NULL \n      AS array_avg(data_array)               COMMENT "Get the average of ARRAY",\n  get_string   VARCHAR(65533)    NULL \n      AS get_json_string(json_string(data_json), \'$.a\') COMMENT "Extract JSON string"\n) ENGINE=OLAP \nPRIMARY KEY(id)\nDISTRIBUTED BY HASH(id);\n\nINSERT INTO insert_generated_columns \nVALUES (1, [1,2], parse_json(\'{"a" : 1, "b" : 2}\'));\n'})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,a.jsx)(n.p,{children:"Directly loading data into generated columns is not supported."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"You can query the table to check the data within it."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:'mysql> SELECT * FROM insert_generated_columns;\n+------+------------+------------------+-----------+------------+\n| id   | data_array | data_json        | avg_array | get_string |\n+------+------------+------------------+-----------+------------+\n|    1 | [1,2]      | {"a": 1, "b": 2} |       1.5 | 1          |\n+------+------------+------------------+-----------+------------+\n1 row in set (0.02 sec)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"load-data-asynchronously-using-insert",children:"Load data asynchronously using INSERT"}),"\n",(0,a.jsxs)(n.p,{children:["Loading data with INSERT submits a synchronous transaction, which may fail because of session interruption or timeout. You can submit an asynchronous INSERT transaction using ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SUBMIT%20TASK",children:"SUBMIT TASK"}),". This feature is supported since StarRocks v2.5."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example asynchronously inserts the data from the source table to the target table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SUBMIT TASK AS INSERT INTO insert_wiki_edit\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example asynchronously overwrites the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," with the data from the source table."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SUBMIT TASK AS INSERT OVERWRITE insert_wiki_edit\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example asynchronously overwrites the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," with the data from the source table, and extends the query timeout to ",(0,a.jsx)(n.code,{children:"100000"})," seconds using hint."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SUBMIT /*+set_var(query_timeout=100000)*/ TASK AS\nINSERT OVERWRITE insert_wiki_edit\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The following example asynchronously overwrites the table ",(0,a.jsx)(n.code,{children:"insert_wiki_edit"})," with the data from the source table, and specifies the task name as ",(0,a.jsx)(n.code,{children:"async"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SUBMIT TASK async\nAS INSERT OVERWRITE insert_wiki_edit\nSELECT * FROM source_wiki_edit;\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can check the status of an asynchronous INSERT task by querying the metadata table ",(0,a.jsx)(n.code,{children:"task_runs"})," in Information Schema."]}),"\n",(0,a.jsxs)(n.p,{children:["The following example checks the status of the INSERT task ",(0,a.jsx)(n.code,{children:"async"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM information_schema.task_runs WHERE task_name = 'async';\n"})}),"\n",(0,a.jsx)(n.h2,{id:"check-the-insert-job-status",children:"Check the INSERT job status"}),"\n",(0,a.jsx)(n.h3,{id:"check-via-the-result",children:"Check via the result"}),"\n",(0,a.jsx)(n.p,{children:"A synchronous INSERT transaction returns different status in accordance with the result of the transaction."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Transaction succeeds"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"StarRocks returns the following if the transaction succeeds:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:"Query OK, 2 rows affected (0.05 sec)\n{'label':'insert_load_wikipedia', 'status':'VISIBLE', 'txnId':'1006'}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Transaction fails"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"If all rows of data fail to be loaded into the target table, the INSERT transaction fails. StarRocks returns the following if the transaction fails:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:"ERROR 1064 (HY000): Insert has filtered data in strict mode, tracking_url=http://x.x.x.x:yyyy/api/_load_error_log?file=error_log_9f0a4fd0b64e11ec_906bbede076e9d08\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can locate the problem by checking the log with ",(0,a.jsx)(n.code,{children:"tracking_url"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"check-via-information-schema",children:"Check via Information Schema"}),"\n",(0,a.jsxs)(n.p,{children:["You can use the ",(0,a.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SELECT",children:"SELECT"})," statement to query the results of one or more load jobs from the ",(0,a.jsx)(n.code,{children:"loads"})," table in the ",(0,a.jsx)(n.code,{children:"information_schema"})," database. This feature is supported from v3.1 onwards."]}),"\n",(0,a.jsxs)(n.p,{children:["Example 1: Query the results of load jobs executed on the ",(0,a.jsx)(n.code,{children:"load_test"})," database, sort the results by creation time (",(0,a.jsx)(n.code,{children:"CREATE_TIME"}),") in descending order, and only return the top result."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM information_schema.loads\nWHERE database_name = 'load_test'\nORDER BY create_time DESC\nLIMIT 1\\G\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Example 2: Query the result of the load job (whose label is ",(0,a.jsx)(n.code,{children:"insert_load_wikipedia"}),") executed on the ",(0,a.jsx)(n.code,{children:"load_test"})," database:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM information_schema.loads\nWHERE database_name = 'load_test' and label = 'insert_load_wikipedia'\\G\n"})}),"\n",(0,a.jsx)(n.p,{children:"The return is as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:'*************************** 1. row ***************************\n              JOB_ID: 21319\n               LABEL: insert_load_wikipedia\n       DATABASE_NAME: load_test\n               STATE: FINISHED\n            PROGRESS: ETL:100%; LOAD:100%\n                TYPE: INSERT\n            PRIORITY: NORMAL\n           SCAN_ROWS: 0\n       FILTERED_ROWS: 0\n     UNSELECTED_ROWS: 0\n           SINK_ROWS: 2\n            ETL_INFO: \n           TASK_INFO: resource:N/A; timeout(s):300; max_filter_ratio:0.0\n         CREATE_TIME: 2023-08-09 10:42:23\n      ETL_START_TIME: 2023-08-09 10:42:23\n     ETL_FINISH_TIME: 2023-08-09 10:42:23\n     LOAD_START_TIME: 2023-08-09 10:42:23\n    LOAD_FINISH_TIME: 2023-08-09 10:42:24\n         JOB_DETAILS: {"All backends":{"5ebf11b5-365e-11ee-9e4a-7a563fb695da":[10006]},"FileNumber":0,"FileSize":0,"InternalTableLoadBytes":175,"InternalTableLoadRows":2,"ScanBytes":0,"ScanRows":0,"TaskNumber":1,"Unfinished backends":{"5ebf11b5-365e-11ee-9e4a-7a563fb695da":[]}}\n           ERROR_MSG: NULL\n        TRACKING_URL: NULL\n        TRACKING_SQL: NULL\nREJECTED_RECORD_PATH: NULL\n1 row in set (0.01 sec)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["For information about the fields in the return results, see ",(0,a.jsx)(n.a,{href:"/docs/administration/information_schema#loads",children:"Information Schema > loads"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"check-via-curl-command",children:"Check via curl command"}),"\n",(0,a.jsx)(n.p,{children:"You can check the INSERT transaction status by using curl command."}),"\n",(0,a.jsx)(n.p,{children:"Launch a terminal, and execute the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Bash",children:"curl --location-trusted -u <username>:<password> \\\n  http://<fe_address>:<fe_http_port>/api/<db_name>/_load_info?label=<label_name>\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The following example checks the status of the transaction with label ",(0,a.jsx)(n.code,{children:"insert_load_wikipedia"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Bash",children:"curl --location-trusted -u <username>:<password> \\\n  http://x.x.x.x:8030/api/load_test/_load_info?label=insert_load_wikipedia\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,a.jsxs)(n.p,{children:["If you use an account for which no password is set, you need to input only ",(0,a.jsx)(n.code,{children:"<username>:"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"The return is as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Plain",children:'{\n   "jobInfo":{\n      "dbName":"load_test",\n      "tblNames":[\n         "source_wiki_edit"\n      ],\n      "label":"insert_load_wikipedia",\n      "state":"FINISHED",\n      "failMsg":"",\n      "trackingUrl":""\n   },\n   "status":"OK",\n   "msg":"Success"\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(n.p,{children:"You can set the following configuration items for INSERT transaction:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"FE configuration"})}),"\n"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"FE configuration"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"insert_load_default_timeout_second"}),(0,a.jsx)(n.td,{children:"Default timeout for INSERT transaction. Unit: second. If the current INSERT transaction is not completed within the time set by this parameter, it will be canceled by the system and the status will be CANCELLED. As for current version of StarRocks, you can only specify a uniform timeout for all INSERT transactions using this parameter, and you cannot set a different timeout for a specific INSERT transaction. The default is 3600 seconds (1 hour). If the INSERT transaction cannot be completed within the specified time, you can extend the timeout by adjusting this parameter."})]})})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Session variables"})}),"\n"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Session variable"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"enable_insert_strict"}),(0,a.jsxs)(n.td,{children:["Switch value to control if the INSERT transaction is tolerant of invalid data rows. When it is set to ",(0,a.jsx)(n.code,{children:"true"}),", the transaction fails if any of the data rows is invalid. When it is set to ",(0,a.jsx)(n.code,{children:"false"}),", the transaction succeeds when at least one row of data has been loaded correctly, and the label will be returned. The default is ",(0,a.jsx)(n.code,{children:"true"}),". You can set this variable with ",(0,a.jsx)(n.code,{children:"SET enable_insert_strict = {true or false};"})," command."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"query_timeout"}),(0,a.jsxs)(n.td,{children:["Timeout for SQL commands. Unit: second. INSERT, as a SQL command, is also restricted by this session variable. You can set this variable with the ",(0,a.jsx)(n.code,{children:"SET query_timeout = xxx;"})," command."]})]})]})]})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,a.jsx)(n,Object.assign({},e,{children:(0,a.jsx)(c,e)})):c(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>o,ah:()=>s});var a=t(67294);const i=a.createContext({});function s(e){const n=a.useContext(i);return a.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const r={};function o({components:e,children:n,disableParentContext:t}){let o;return o=t?"function"==typeof e?e({}):e||r:s(e),a.createElement(i.Provider,{value:o},n)}}}]);