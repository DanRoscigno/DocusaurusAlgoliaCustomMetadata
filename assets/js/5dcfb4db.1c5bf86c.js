"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[41613],{49172:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var o=t(85893),s=t(11151);const i={displayed_sidebar:"English"},r="Deploy a Compute Node [Preview]",a={id:"administration/deploy_cn",title:"Deploy a Compute Node [Preview]",description:"A compute node (CN) is a stateless computing service that does not maintain data itself. It only provides extra computing resources for queries. This topic describes how to configure and deploy a CN node. You can add multiple CN nodes by repeating the following steps.",source:"@site/versioned_docs/version-2.3/administration/deploy_cn.md",sourceDirName:"administration",slug:"/administration/deploy_cn",permalink:"/docs/2.3/administration/deploy_cn",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/edit/main/docs/administration/deploy_cn.md",tags:[],version:"2.3",frontMatter:{displayed_sidebar:"English"},sidebar:"English",previous:{title:"Deploy Broker",permalink:"/docs/2.3/administration/deploy_broker"},next:{title:"Deploy StarRocks in Docker",permalink:"/docs/2.3/administration/deploy_with_docker"}},d={},c=[{value:"Principle",id:"principle",level:2},{value:"Download and decompress the installer",id:"download-and-decompress-the-installer",level:2},{value:"Configure a CN node",id:"configure-a-cn-node",level:2},{value:"Add a CN node",id:"add-a-cn-node",level:2},{value:"Start the CN node",id:"start-the-cn-node",level:2},{value:"Check whether the CN node starts",id:"check-whether-the-cn-node-starts",level:2},{value:"Stop the CN node",id:"stop-the-cn-node",level:2}];function l(e){const n=Object.assign({h1:"h1",p:"p",h2:"h2",a:"a",pre:"pre",code:"code",blockquote:"blockquote",strong:"strong"},(0,s.ah)(),e.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"deploy-a-compute-node-preview",children:"Deploy a Compute Node [Preview]"}),"\n",(0,o.jsx)(n.p,{children:"A compute node (CN) is a stateless computing service that does not maintain data itself. It only provides extra computing resources for queries. This topic describes how to configure and deploy a CN node. You can add multiple CN nodes by repeating the following steps."}),"\n",(0,o.jsx)(n.h2,{id:"principle",children:"Principle"}),"\n",(0,o.jsx)(n.p,{children:"The lifecycle of an SQL statement in StarRocks can be divided into three phases: query parsing, planning, and execution. CN takes some or all of the computation tasks in the execution phase. It works as follows: First, the FE splits the parsed SQL statements into logical execution units, splits the logical execution units into physical execution units according to data distribution and operator types, and then assigns them to BEs and CNs."}),"\n",(0,o.jsx)(n.p,{children:"During query execution, BEs run computation tasks that are prior to data shuffling, and perform data reading and writing. CNs receive the shuffled data from BEs, run part of the computation tasks such as JOIN, and return the results to FEs."}),"\n",(0,o.jsx)(n.h2,{id:"download-and-decompress-the-installer",children:"Download and decompress the installer"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://www.starrocks.io/download/community",children:"Download"})," and decompress StarRocks installer."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"tar -xzvf StarRocks-x.x.x.tar.gz\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Caution"}),"\n",(0,o.jsx)(n.p,{children:"Replace the file name in the command with the actual name of the file you downloaded."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"configure-a-cn-node",children:"Configure a CN node"}),"\n",(0,o.jsxs)(n.p,{children:["Navigate to the ",(0,o.jsx)(n.strong,{children:"StarRocks-x.x.x/be"})," path."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd StarRocks-x.x.x/be\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Caution"}),"\n",(0,o.jsx)(n.p,{children:"Replace the file name in the command with the actual name of the file you downloaded."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Modify the CN configuration file ",(0,o.jsx)(n.strong,{children:"conf/cn.conf"}),". Because the default configuration can be used directly to start the cluster, the following example does not change any configuration item. If you need to change a configuration item in the production environment, see ",(0,o.jsx)(n.a,{href:"/docs/2.3/administration/Configuration#be-configuration-items",children:"BE configuration items"})," for instructions, because most of CN's parameters are inherited from BEs."]}),"\n",(0,o.jsx)(n.h2,{id:"add-a-cn-node",children:"Add a CN node"}),"\n",(0,o.jsx)(n.p,{children:"Add a CN node to the StarRocks cluster via your MySQL client."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'mysql> ALTER SYSTEM ADD COMPUTE NODE "host:port";\n'})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Caution"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"host"})," must match the pre-specified ",(0,o.jsx)(n.code,{children:"priority_networks"}),", and ",(0,o.jsx)(n.code,{children:"port"})," must match ",(0,o.jsx)(n.code,{children:"heartbeat_service_port"})," specified in ",(0,o.jsx)(n.strong,{children:"cn.conf"})," (defaults to ",(0,o.jsx)(n.code,{children:"9050"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"If any issue occurs when you add the CN node, you can drop the node by using the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:'mysql> ALTER SYSTEM DROP COMPUTE NODE "host:port";\n'})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Caution"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"host"})," and ",(0,o.jsx)(n.code,{children:"port"})," must be the same as those of the CN node you added."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"start-the-cn-node",children:"Start the CN node"}),"\n",(0,o.jsx)(n.p,{children:"Run the following command to start the CN node:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"./bin/start_cn.sh --daemon\n"})}),"\n",(0,o.jsx)(n.h2,{id:"check-whether-the-cn-node-starts",children:"Check whether the CN node starts"}),"\n",(0,o.jsx)(n.p,{children:"You can check whether the CN node starts properly by via your MySQL client."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SHOW PROC '/compute_nodes'\\G\n"})}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"MySQL [(none)]> SHOW PROC '/compute_nodes'\\G\n**************************** 1. row ******************** ******\n        ComputeNodeId: 78825\n              Cluster: default_cluster\n                   IP: 172.26.xxx.xx\n        HeartbeatPort: 9050\n               BePort: 9060\n             HttpPort: 8040\n             BrpcPort: 8060\n        LastStartTime: NULL\n        LastHeartbeat: NULL\n                Alive: true\n SystemDecommissioned: false\nClusterDecommissioned: false\n               ErrMsg:\n              Version: 2.4.0-76-36ea96e\n1 row in set (0.01 sec)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"Alive"})," is ",(0,o.jsx)(n.code,{children:"true"}),", the CN node is properly started and added to the cluster."]}),"\n",(0,o.jsxs)(n.p,{children:["If the CN node is not properly added to the cluster, you can check the ",(0,o.jsx)(n.strong,{children:"log/cn.WARNING"})," log file for troubleshooting."]}),"\n",(0,o.jsxs)(n.p,{children:["After CNs are properly started, you need to set the system variables ",(0,o.jsx)(n.code,{children:"prefer_compute_node"})," and ",(0,o.jsx)(n.code,{children:"use_compute_nodes"})," to scale computing resources during queries. For more information, see ",(0,o.jsx)(n.a,{href:"/docs/2.3/reference/System_variable",children:"System variables"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"stop-the-cn-node",children:"Stop the CN node"}),"\n",(0,o.jsx)(n.p,{children:"Run the following command to stop the CN node:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"./bin/stop_cn.sh\n"})})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,o.jsx)(n,Object.assign({},e,{children:(0,o.jsx)(l,e)})):l(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>a,ah:()=>i});var o=t(67294);const s=o.createContext({});function i(e){const n=o.useContext(s);return o.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const r={};function a({components:e,children:n,disableParentContext:t}){let a;return a=t?"function"==typeof e?e({}):e||r:i(e),o.createElement(s.Provider,{value:a},n)}}}]);