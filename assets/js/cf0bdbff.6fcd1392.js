"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[9144],{76708:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var i=n(85893),a=n(11151);const s={displayed_sidebar:"English"},r="Expression partitioning (recommended)",o={id:"table_design/expression_partitioning",title:"Expression partitioning (recommended)",description:"Since v3.0, StarRocks supports expression partitioning (previously known as automatic partitioning), which is more flexible and user-friendly. This partitioning method is suitable for most scenarios such as querying and managing data based on continuous time ranges or enum values.",source:"@site/versioned_docs/version-3.1/table_design/expression_partitioning.md",sourceDirName:"table_design",slug:"/table_design/expression_partitioning",permalink:"/doc/docs/table_design/expression_partitioning",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/table_design/expression_partitioning.md",tags:[],version:"3.1",frontMatter:{displayed_sidebar:"English"},sidebar:"English",previous:{title:"Data distribution",permalink:"/doc/docs/table_design/Data_distribution"},next:{title:"List partitioning",permalink:"/doc/docs/table_design/list_partitioning"}},d={},c=[{value:"Partitioning based on a time function expression",id:"partitioning-based-on-a-time-function-expression",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Usage notes",id:"usage-notes",level:3},{value:"<strong>Examples</strong>",id:"examples",level:3},{value:"Partitioning based on the column expression (since v3.1)",id:"partitioning-based-on-the-column-expression-since-v31",level:2},{value:"Syntax",id:"syntax-1",level:3},{value:"Parameters",id:"parameters-1",level:3},{value:"Usage notes",id:"usage-notes-1",level:3},{value:"Examples",id:"examples-1",level:3},{value:"Manage partitions",id:"manage-partitions",level:2},{value:"Load data into partitions",id:"load-data-into-partitions",level:3},{value:"View partitions",id:"view-partitions",level:3},{value:"Limits",id:"limits",level:2}];function l(e){const t=Object.assign({h1:"h1",p:"p",h2:"h2",a:"a",h3:"h3",pre:"pre",code:"code",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",strong:"strong",ul:"ul",li:"li",blockquote:"blockquote"},(0,a.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"expression-partitioning-recommended",children:"Expression partitioning (recommended)"}),"\n",(0,i.jsx)(t.p,{children:"Since v3.0, StarRocks supports expression partitioning (previously known as automatic partitioning), which is more flexible and user-friendly. This partitioning method is suitable for most scenarios such as querying and managing data based on continuous time ranges or enum values."}),"\n",(0,i.jsx)(t.p,{children:"You only need to specify a simple partition expression (either a time function expression or a column expression) at table creation. During data loading, StarRocks will automatically create partitions based on the data and the rule defined in the partition expression. You no longer need to manually create numerous partitions at table creation, nor configure dynamic partition properties."}),"\n",(0,i.jsx)(t.h2,{id:"partitioning-based-on-a-time-function-expression",children:"Partitioning based on a time function expression"}),"\n",(0,i.jsx)(t.p,{children:"If you frequently query and manage data based on continuous time ranges, you only need to specify a date type (DATE or DATETIME) column as the partition column and specify year, month, day, or hour as the partition granularity in the time function expression. StarRocks will automatically create partitions and set the partitions' start and end dates or datetimes based on the loaded data and partition expression."}),"\n",(0,i.jsxs)(t.p,{children:["However, in some special scenarios, such as partitioning historical data into partitions by month and recent data into partitions by day, you must use ",(0,i.jsx)(t.a,{href:"/doc/docs/table_design/Data_distribution#range-partitioning",children:"range partitioning"})," to create partitions."]}),"\n",(0,i.jsx)(t.h3,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"PARTITION BY expression\n...\n[ PROPERTIES( 'partition_live_number' = 'xxx' ) ]\n\nexpression ::=\n    { date_trunc ( <time_unit> , <partition_column> ) |\n      time_slice ( <partition_column> , INTERVAL <N> <time_unit> [ , boundary ] ) }\n"})}),"\n",(0,i.jsx)(t.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Parameters"}),(0,i.jsx)(t.th,{children:"Required"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"expression"})}),(0,i.jsx)(t.td,{children:"YES"}),(0,i.jsxs)(t.td,{children:["Currently, only the ",(0,i.jsx)(t.a,{href:"../sql-reference/sql-functions/date-time-functions/date_trunc",children:"date_trunc"})," and ",(0,i.jsx)(t.a,{href:"../sql-reference/sql-functions/date-time-functions/time_slice",children:"time_slice"})," functions are supported. If you use the function ",(0,i.jsx)(t.code,{children:"time_slice"}),", you do not need to pass the ",(0,i.jsx)(t.code,{children:"boundary"})," parameter. It is because in this scenario, the default and valid value for this parameter is ",(0,i.jsx)(t.code,{children:"floor"}),", and the value cannot be ",(0,i.jsx)(t.code,{children:"ceil"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"time_unit"})}),(0,i.jsx)(t.td,{children:"YES"}),(0,i.jsxs)(t.td,{children:["The partition granularity, which can be ",(0,i.jsx)(t.code,{children:"hour"}),", ",(0,i.jsx)(t.code,{children:"day"}),", ",(0,i.jsx)(t.code,{children:"month"})," or ",(0,i.jsx)(t.code,{children:"year"}),". The ",(0,i.jsx)(t.code,{children:"week"})," partition granularity is not supported. If the partition granularity is ",(0,i.jsx)(t.code,{children:"hour"}),", the partition column must be of the DATETIME data type and cannot be of the DATE data type."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"partition_column"})}),(0,i.jsx)(t.td,{children:"YES"}),(0,i.jsxs)(t.td,{children:["The name of the partition column.",(0,i.jsx)("br",{}),(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{children:["The partition column can only be of the DATE or DATETIME data type. The partition column allows ",(0,i.jsx)(t.code,{children:"NULL"})," values."]}),(0,i.jsxs)("li",{children:["The partition column can be of the DATE or DATETIME data type if the ",(0,i.jsx)(t.code,{children:"date_trunc"})," function is used. The partition column must be of the DATETIME data type  if the ",(0,i.jsx)(t.code,{children:"time_slice"})," function is used. "]}),(0,i.jsx)("li",{children:"If the partition column is of the DATE data type, the supported range is [0000-01-01 ~ 9999-12-31]. If the partition column is of the DATETIME data type, the supported range is [0000-01-01 01:01:01 ~ 9999-12-31 23:59:59]."}),(0,i.jsx)("li",{children:"Currently, you can specify only one partition column and multiple partition columns are not supported."})]})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"partition_live_number"})}),(0,i.jsx)(t.td,{children:"NO"}),(0,i.jsxs)(t.td,{children:['The number of the most recent partitions to be retained. "Recent" refers to that the partitions are sorted in chronological order, ',(0,i.jsx)(t.strong,{children:"with the current date as a benchmark"}),", the number of partitions that counted backwards are retained, and the rest of the partitions (partitions created much earlier) are deleted. StarRocks schedules tasks to manage the number of partitions, and the scheduling interval can be configured through the FE dynamic parameter ",(0,i.jsx)(t.code,{children:"dynamic_partition_check_interval_seconds"}),", which defaults to 600 seconds (10 minutes). Suppose that the current date is April 4, 2023, ",(0,i.jsx)(t.code,{children:"partition_live_number"})," is set to ",(0,i.jsx)(t.code,{children:"2"}),", and the partitions include ",(0,i.jsx)(t.code,{children:"p20230401"}),", ",(0,i.jsx)(t.code,{children:"p20230402"}),", ",(0,i.jsx)(t.code,{children:"p20230403"}),", ",(0,i.jsx)(t.code,{children:"p20230404"}),". The partitions ",(0,i.jsx)(t.code,{children:"p20230403"})," and ",(0,i.jsx)(t.code,{children:"p20230404"})," are retained and other partitions are deleted. If dirty data is loaded, such as data from the future dates April 5 and April 6, partitions include ",(0,i.jsx)(t.code,{children:"p20230401"}),", ",(0,i.jsx)(t.code,{children:"p20230402"}),", ",(0,i.jsx)(t.code,{children:"p20230403"}),", ",(0,i.jsx)(t.code,{children:"p20230404"}),", and ",(0,i.jsx)(t.code,{children:"p20230405"}),", and ",(0,i.jsx)(t.code,{children:"p20230406"}),". Then partitions ",(0,i.jsx)(t.code,{children:"p20230403"}),", ",(0,i.jsx)(t.code,{children:"p20230404"}),", ",(0,i.jsx)(t.code,{children:"p20230405"}),", and ",(0,i.jsx)(t.code,{children:"p20230406"})," are retained and the other partitions are deleted."]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"usage-notes",children:"Usage notes"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"During data loading, StarRocks automatically creates some partitions based on the loaded data, but if the load job fails for some reason, the partitions that are automatically created by StarRocks cannot be automatically deleted."}),"\n",(0,i.jsxs)(t.li,{children:["StarRocks sets the default maximum number of automatically created partitions to 4096, which can be configured by the FE parameter ",(0,i.jsx)(t.code,{children:"max_automatic_partition_number"}),". This parameter can prevent you from accidentally creating too many partitions."]}),"\n",(0,i.jsx)(t.li,{children:"The naming rule for partitions is consistent with the naming rule for dynamic partitioning."}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"examples",children:(0,i.jsx)(t.strong,{children:"Examples"})}),"\n",(0,i.jsxs)(t.p,{children:["Example 1: Suppose you frequently query data by day. You can use the partition expression ",(0,i.jsx)(t.code,{children:"date_trunc()"})," and set the partition column as ",(0,i.jsx)(t.code,{children:"event_day"})," and the partition granularity as ",(0,i.jsx)(t.code,{children:"day"})," at table creation. Data is automatically partitioned based on dates during loading. Data of the same day is stored in one partition and partition pruning can be used to significantly improve query efficiency."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"CREATE TABLE site_access1 (\n    event_day DATETIME NOT NULL,\n    site_id INT DEFAULT '10',\n    city_code VARCHAR(100),\n    user_name VARCHAR(32) DEFAULT '',\n    pv BIGINT DEFAULT '0'\n)\nDUPLICATE KEY(event_day, site_id, city_code, user_name)\nPARTITION BY date_trunc('day', event_day)\nDISTRIBUTED BY HASH(event_day, site_id);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["For example, when the following two data rows are loaded, StarRocks will automatically create two partitions, ",(0,i.jsx)(t.code,{children:"p20230226"}),"  and ",(0,i.jsx)(t.code,{children:"p20230227"}),", with ranges [2023-02-26 00:00:00, 2023-02-27 00:00:00) and [2023-02-27 00:00:00, 2023-02-28 00:00:00) respectively. If subsequent loaded data falls within these ranges, they are automatically routed to the corresponding partitions."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:'-- insert two data rows\nINSERT INTO site_access1  \n    VALUES ("2023-02-26 20:12:04",002,"New York","Sam Smith",1),\n           ("2023-02-27 21:06:54",001,"Los Angeles","Taylor Swift",1);\n\n-- view partitions\nmysql > SHOW PARTITIONS FROM site_access1;\n+-------------+---------------+----------------+---------------------+--------------------+--------+--------------+------------------------------------------------------------------------------------------------------+--------------------+---------+----------------+---------------+---------------------+--------------------------+----------+------------+----------+\n| PartitionId | PartitionName | VisibleVersion | VisibleVersionTime  | VisibleVersionHash | State  | PartitionKey | Range                                                                                                | DistributionKey    | Buckets | ReplicationNum | StorageMedium | CooldownTime        | LastConsistencyCheckTime | DataSize | IsInMemory | RowCount |\n+-------------+---------------+----------------+---------------------+--------------------+--------+--------------+------------------------------------------------------------------------------------------------------+--------------------+---------+----------------+---------------+---------------------+--------------------------+----------+------------+----------+\n| 17138       | p20230226     | 2              | 2023-07-19 17:53:59 | 0                  | NORMAL | event_day    | [types: [DATETIME]; keys: [2023-02-26 00:00:00]; ..types: [DATETIME]; keys: [2023-02-27 00:00:00]; ) | event_day, site_id | 6       | 3              | HDD           | 9999-12-31 23:59:59 | NULL                     | 0B       | false      | 0        |\n| 17113       | p20230227     | 2              | 2023-07-19 17:53:59 | 0                  | NORMAL | event_day    | [types: [DATETIME]; keys: [2023-02-27 00:00:00]; ..types: [DATETIME]; keys: [2023-02-28 00:00:00]; ) | event_day, site_id | 6       | 3              | HDD           | 9999-12-31 23:59:59 | NULL                     | 0B       | false      | 0        |\n+-------------+---------------+----------------+---------------------+--------------------+--------+--------------+------------------------------------------------------------------------------------------------------+--------------------+---------+----------------+---------------+---------------------+--------------------------+----------+------------+----------+\n2 rows in set (0.00 sec)\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Example 2: If you want to implement partition lifecycle management, which is to retain only a certain number of recent partitions and delete historical partitions, you can use the ",(0,i.jsx)(t.code,{children:"partition_live_number"})," property to specify the number of partitions to retain."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"CREATE TABLE site_access2 (\n    event_day DATETIME NOT NULL,\n    site_id INT DEFAULT '10',\n    city_code VARCHAR(100),\n    user_name VARCHAR(32) DEFAULT '',\n    pv BIGINT DEFAULT '0'\n) \nDUPLICATE KEY(event_day, site_id, city_code, user_name)\nPARTITION BY date_trunc('month', event_day)\nDISTRIBUTED BY HASH(event_day, site_id)\nPROPERTIES(\n    \"partition_live_number\" = \"3\" -- only retains the most recent three partitions\n);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Example 3: Suppose you frequently query data by week. You can use the partition expression ",(0,i.jsx)(t.code,{children:"time_slice()"})," and set the partition column as ",(0,i.jsx)(t.code,{children:"event_day"})," and the partition granularity to seven days at table creation. Data of one week is stored in one partition and partition pruning can be used to significantly improve query efficiency."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"CREATE TABLE site_access(\n    event_day DATETIME NOT NULL,\n    site_id INT DEFAULT '10',\n    city_code VARCHAR(100),\n    user_name VARCHAR(32) DEFAULT '',\n    pv BIGINT DEFAULT '0'\n)\nDUPLICATE KEY(event_day, site_id, city_code, user_name)\nPARTITION BY time_slice(event_day, INTERVAL 7 day)\nDISTRIBUTED BY HASH(event_day, site_id)\n"})}),"\n",(0,i.jsx)(t.h2,{id:"partitioning-based-on-the-column-expression-since-v31",children:"Partitioning based on the column expression (since v3.1)"}),"\n",(0,i.jsx)(t.p,{children:"If you frequently query and manage data of specific type, you only need to specify the column representing the type as the partition column. StarRocks will automatically create partitions based on the partition column values of the loaded data."}),"\n",(0,i.jsxs)(t.p,{children:["However, in some special scenarios, such as when the table contains a column ",(0,i.jsx)(t.code,{children:"city"}),", and you frequently query and manage data based on countries and cities. You must use ",(0,i.jsx)(t.a,{href:"/doc/docs/table_design/list_partitioning",children:"list partitioning"})," to store data of multiple cities within the same country in one partition."]}),"\n",(0,i.jsx)(t.h3,{id:"syntax-1",children:"Syntax"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:'PARTITION BY expression\n...\n[ PROPERTIES("partition_live_number" = "xxx") ]\n\nexpression ::=\n    ( partition_columns )\n    \npartition_columns ::=\n    <column>, [ <column> [,...] ]\n'})}),"\n",(0,i.jsx)(t.h3,{id:"parameters-1",children:"Parameters"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:(0,i.jsx)(t.strong,{children:"Parameters"})}),(0,i.jsx)(t.th,{children:(0,i.jsx)(t.strong,{children:"Required"})}),(0,i.jsx)(t.th,{children:(0,i.jsx)(t.strong,{children:"Description"})})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"partition_columns"})}),(0,i.jsx)(t.td,{children:"YES"}),(0,i.jsxs)(t.td,{children:["The names of partition columns.",(0,i.jsx)("br",{})," ",(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{children:["The partition column values can be string (BINARY not supported), date or datetime, integer, and boolean values. The partition column allows ",(0,i.jsx)(t.code,{children:"NULL"})," values."]}),(0,i.jsxs)("li",{children:[" Each partition can only contain data with the same value for a partition column. To include data with different values in a partition column in a partition, see ",(0,i.jsx)(t.a,{href:"/doc/docs/table_design/list_partitioning",children:"List partitioning"}),"."]})]})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"partition_live_number"})}),(0,i.jsx)(t.td,{children:"No"}),(0,i.jsxs)(t.td,{children:["The number of partitions to be retained. Compare the values of partition columns among partitions, and periodically delete partitions with smaller values while retaining those with larger values.",(0,i.jsx)("br",{}),"StarRocks schedules tasks to manage the number of partitions, and the scheduling interval can be configured through the FE dynamic parameter ",(0,i.jsx)(t.code,{children:"dynamic_partition_check_interval_seconds"}),", which defaults to 600 seconds (10 minutes).",(0,i.jsx)("br",{}),(0,i.jsx)(t.strong,{children:"NOTE"}),(0,i.jsx)("br",{}),"If the values in the partition column are strings, StarRocks compare the lexicographical order of the partition names, and periodically retains the partitions that come earlier while deleting the partitions that come later."]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"usage-notes-1",children:"Usage notes"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"During data loading, StarRocks automatically creates some partitions based on the loaded data, but if the load job fails for some reason, the partitions that are automatically created by StarRocks cannot be automatically deleted."}),"\n",(0,i.jsxs)(t.li,{children:["StarRocks sets the default maximum number of automatically created partitions to 4096, which can be configured by the FE parameter ",(0,i.jsx)(t.code,{children:"max_automatic_partition_number"}),". This parameter can prevent you from accidentally creating too many partitions."]}),"\n",(0,i.jsxs)(t.li,{children:["The naming rule for partitions: if multiple partition columns are specified, the values of different partition columns are connected with an underscore ",(0,i.jsx)(t.code,{children:"_"})," in the partition name, and the format is ",(0,i.jsx)(t.code,{children:"p<value in partition column 1>_<value in partition column 2>_..."}),".  For example, if two columns ",(0,i.jsx)(t.code,{children:"dt"})," and ",(0,i.jsx)(t.code,{children:"province"})," are specified as partition columns, both of which are string types, and a data row with values ",(0,i.jsx)(t.code,{children:"2022-04-01"})," and ",(0,i.jsx)(t.code,{children:"beijing"})," is loaded, the corresponding partition automatically created is named ",(0,i.jsx)(t.code,{children:"p20220401_beijing"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"examples-1",children:"Examples"}),"\n",(0,i.jsxs)(t.p,{children:["Example 1: Suppose you frequently query details of the data center billing based on time ranges and specific cities. At table creation, you can use a partition expression to specify the first partition columns as ",(0,i.jsx)(t.code,{children:"dt"}),"  and ",(0,i.jsx)(t.code,{children:"city"})," . This way, data belonging to the same date and city are routed into the same partition, and partition pruning can be used to significantly improve query efficiency."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"CREATE TABLE t_recharge_detail1 (\n    id bigint,\n    user_id bigint,\n    recharge_money decimal(32,2), \n    city varchar(20) not null,\n    dt varchar(20) not null\n)\nDUPLICATE KEY(id)\nPARTITION BY (dt,city)\nDISTRIBUTED BY HASH(`id`);\n"})}),"\n",(0,i.jsx)(t.p,{children:"Insert a single data row into the table."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"INSERT INTO t_recharge_detail1 \n    VALUES (1, 1, 1, 'Houston', '2022-04-01');\n"})}),"\n",(0,i.jsxs)(t.p,{children:["View the partitions. The result shows that StarRocks automatically creates a partition ",(0,i.jsx)(t.code,{children:"p20220401_Houston1"})," based on the loaded data. During subsequent loading, data with the values ",(0,i.jsx)(t.code,{children:"2022-04-01"})," and ",(0,i.jsx)(t.code,{children:"Houston"})," in the partition columns ",(0,i.jsx)(t.code,{children:"dt"})," and ",(0,i.jsx)(t.code,{children:"city"})," are stored in this partition."]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"NOTE"})}),"\n",(0,i.jsxs)(t.p,{children:["Each partition can only contain data with the specified one value for the partition column. To specify multiple values for a partition column in a partition, see ",(0,i.jsx)(t.a,{href:"/doc/docs/table_design/list_partitioning",children:"List partitions"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"MySQL > SHOW PARTITIONS from t_recharge_detail1\\G\n*************************** 1. row ***************************\n             PartitionId: 16890\n           PartitionName: p20220401_Houston\n          VisibleVersion: 2\n      VisibleVersionTime: 2023-07-19 17:24:53\n      VisibleVersionHash: 0\n                   State: NORMAL\n            PartitionKey: dt, city\n                    List: (('2022-04-01', 'Houston'))\n         DistributionKey: id\n                 Buckets: 6\n          ReplicationNum: 3\n           StorageMedium: HDD\n            CooldownTime: 9999-12-31 23:59:59\nLastConsistencyCheckTime: NULL\n                DataSize: 2.5KB\n              IsInMemory: false\n                RowCount: 1\n1 row in set (0.00 sec)\n"})}),"\n",(0,i.jsxs)(t.p,{children:['Example 2: You can also configure the "',(0,i.jsx)(t.code,{children:"partition_live_number"})," property at table creation for partition lifecycle management, for example, specifying that the table should only retain 3 partitions."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:'CREATE TABLE t_recharge_detail2 (\n    id bigint,\n    user_id bigint,\n    recharge_money decimal(32,2), \n    city varchar(20) not null,\n    dt varchar(20) not null\n)\nDUPLICATE KEY(id)\nPARTITION BY (dt,city)\nDISTRIBUTED BY HASH(`id`) \nPROPERTIES(\n    "partition_live_number" = "3" -- only retains the most recent three partitions\n);\n'})}),"\n",(0,i.jsx)(t.h2,{id:"manage-partitions",children:"Manage partitions"}),"\n",(0,i.jsx)(t.h3,{id:"load-data-into-partitions",children:"Load data into partitions"}),"\n",(0,i.jsx)(t.p,{children:"During data loading, StarRocks will automatically create partitions based on the loaded data and partition rule defined bythe partition expression."}),"\n",(0,i.jsxs)(t.p,{children:["Note that if you use expression partitioning at table creation and need to use ",(0,i.jsx)(t.a,{href:"/doc/docs/loading/InsertInto#overwrite-data-via-insert-overwrite-select",children:"INSERT OVERWRITE"})," to overwrite data in a specific partition, whether the partition has been created or not, you currently need to explicitly provide an partition range in ",(0,i.jsx)(t.code,{children:"PARTITION()"}),". This is different from ",(0,i.jsx)(t.a,{href:"/doc/docs/table_design/Data_distribution#range-partitioning",children:"Range Partitioning"})," or ",(0,i.jsx)(t.a,{href:"/doc/docs/table_design/list_partitioning",children:"List Partitioning"}),", which allow you only to provide the partition name in ",(0,i.jsx)(t.code,{children:"PARTITION (<partition_name>)"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"If you use a time function expression at table creation and want to overwrite data in a specific partition, you need to provide the starting date or datetime of that partition (the partition granularity configured at table creation). If the partition does not exist, it can be automatically created during data loading."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"INSERT OVERWRITE site_access1 PARTITION(event_day='2022-06-08 20:12:04')\n    SELECT * FROM site_access2 PARTITION(p20220608);\n"})}),"\n",(0,i.jsx)(t.p,{children:"If you use column expression at table creation and want to overwrite data in a specific partition, you need to provide the partition column values that the partition contains. If the partition does not exist, it can be automatically created during data loading."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"INSERT OVERWRITE t_recharge_detail1 PARTITION(dt='2022-04-02',city='texas')\n    SELECT * FROM t_recharge_detail2 PARTITION(p20220402_texas);\n"})}),"\n",(0,i.jsx)(t.h3,{id:"view-partitions",children:"View partitions"}),"\n",(0,i.jsxs)(t.p,{children:["When you want to view specific information about automatically created partitions, you need to use the ",(0,i.jsx)(t.code,{children:"SHOW PARTITIONS FROM <table_name>"})," statement. The ",(0,i.jsx)(t.code,{children:"SHOW CREATE TABLE <table_name>"})," statement only returns the syntax for expression partitioning that is configured at table creation."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-SQL",children:"MySQL > SHOW PARTITIONS FROM t_recharge_detail1;\n+-------------+-------------------+----------------+---------------------+--------------------+--------+--------------+-----------------------------+-----------------+---------+----------------+---------------+---------------------+--------------------------+----------+------------+----------+\n| PartitionId | PartitionName     | VisibleVersion | VisibleVersionTime  | VisibleVersionHash | State  | PartitionKey | List                        | DistributionKey | Buckets | ReplicationNum | StorageMedium | CooldownTime        | LastConsistencyCheckTime | DataSize | IsInMemory | RowCount |\n+-------------+-------------------+----------------+---------------------+--------------------+--------+--------------+-----------------------------+-----------------+---------+----------------+---------------+---------------------+--------------------------+----------+------------+----------+\n| 16890       | p20220401_Houston | 2              | 2023-07-19 17:24:53 | 0                  | NORMAL | dt, city     | (('2022-04-01', 'Houston')) | id              | 6       | 3              | HDD           | 9999-12-31 23:59:59 | NULL                     | 2.5KB    | false      | 1        |\n| 17056       | p20220402_texas   | 2              | 2023-07-19 17:27:42 | 0                  | NORMAL | dt, city     | (('2022-04-02', 'texas'))   | id              | 6       | 3              | HDD           | 9999-12-31 23:59:59 | NULL                     | 2.5KB    | false      | 1        |\n+-------------+-------------------+----------------+---------------------+--------------------+--------+--------------+-----------------------------+-----------------+---------+----------------+---------------+---------------------+--------------------------+----------+------------+----------+\n2 rows in set (0.00 sec)\n"})}),"\n",(0,i.jsx)(t.h2,{id:"limits",children:"Limits"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Since v3.1, StarRocks's ",(0,i.jsx)(t.a,{href:"/doc/docs/deployment/shared_data/s3",children:"shared-data mode"})," supports the time function expression and does not support the column expression."]}),"\n",(0,i.jsx)(t.li,{children:"Currently, using CTAS to create tables configured expression partitioning is not supported."}),"\n",(0,i.jsx)(t.li,{children:"Currently, using Spark Load to load data to tables that use expression partitioning is not supported."}),"\n",(0,i.jsxs)(t.li,{children:["When the ",(0,i.jsx)(t.code,{children:"ALTER TABLE <table_name> DROP PARTITION <partition_name>"})," statement is used to delete a partition created by using the column expression, data in the partition is directly removed and cannot be recovered."]}),"\n",(0,i.jsxs)(t.li,{children:["Currently you cannot ",(0,i.jsx)(t.a,{href:"/doc/docs/administration/Backup_and_restore",children:"backup and restore"})," partitions created by the expression partitioning."]}),"\n"]})]})}const h=function(e={}){const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?(0,i.jsx)(t,Object.assign({},e,{children:(0,i.jsx)(l,e)})):l(e)}},11151:(e,t,n)=>{n.d(t,{Zo:()=>o,ah:()=>s});var i=n(67294);const a=i.createContext({});function s(e){const t=i.useContext(a);return i.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const r={};function o({components:e,children:t,disableParentContext:n}){let o;return o=n?"function"==typeof e?e({}):e||r:s(e),i.createElement(a.Provider,{value:o},t)}}}]);