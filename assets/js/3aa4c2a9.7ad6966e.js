"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[72286,75525],{5251:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=a(85893),s=a(11151);const o={},r=void 0,i={id:"assets/commonMarkdown/insertPrivNote",title:"insertPrivNote",description:"NOTICE",source:"@site/versioned_docs/version-3.1/assets/commonMarkdown/insertPrivNote.md",sourceDirName:"assets/commonMarkdown",slug:"/assets/commonMarkdown/insertPrivNote",permalink:"/docs/assets/commonMarkdown/insertPrivNote",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/assets/commonMarkdown/insertPrivNote.md",tags:[],version:"3.1",frontMatter:{}},d={},l=[];function c(e){const t=Object.assign({blockquote:"blockquote",p:"p",strong:"strong",a:"a"},(0,s.ah)(),e.components);return(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTICE"})}),"\n",(0,n.jsxs)(t.p,{children:["You can load data into StarRocks tables only as a user who has the INSERT privilege on those StarRocks tables. If you do not have the INSERT privilege, follow the instructions provided in ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/account-management/GRANT",children:"GRANT"})," to grant the INSERT privilege to the user that you use to connect to your StarRocks cluster."]}),"\n"]})}const h=function(e={}){const{wrapper:t}=Object.assign({},(0,s.ah)(),e.components);return t?(0,n.jsx)(t,Object.assign({},e,{children:(0,n.jsx)(c,e)})):c(e)}},97873:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>d,toc:()=>c});var n=a(85893),s=a(11151),o=a(5251);const r={},i="Continuously load data from Apache Kafka\xae",d={id:"loading/RoutineLoad",title:"Continuously load data from Apache Kafka\xae",description:"This topic introduces how to create a Routine Load job to stream Kafka messages (events) into StarRocks, and familiarizes you with some basic concepts about Routine Load.",source:"@site/versioned_docs/version-3.1/loading/RoutineLoad.md",sourceDirName:"loading",slug:"/loading/RoutineLoad",permalink:"/docs/loading/RoutineLoad",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/loading/RoutineLoad.md",tags:[],version:"3.1",frontMatter:{},sidebar:"documentation",previous:{title:"Load data using Kafka connector",permalink:"/docs/loading/Kafka-connector-starrocks"},next:{title:"Load data from Apache Spark",permalink:"/docs/category/load-data-from-apache-spark"}},l={},c=[{value:"Supported data formats",id:"supported-data-formats",level:2},{value:"Basic concepts",id:"basic-concepts",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Workflow",id:"workflow",level:3},{value:"Create a Routine Load job",id:"create-a-routine-load-job",level:2},{value:"Load CSV-format data",id:"load-csv-format-data",level:3},{value:"Prepare a dataset",id:"prepare-a-dataset",level:4},{value:"Create a table",id:"create-a-table",level:4},{value:"Submit a Routine Load job",id:"submit-a-routine-load-job",level:4},{value:"Load JSON-format data",id:"load-json-format-data",level:3},{value:"Prepare a dataset",id:"prepare-a-dataset-1",level:4},{value:"Create a table",id:"create-a-table-1",level:4},{value:"Submit a Routine Load job",id:"submit-a-routine-load-job-1",level:4},{value:"Load Avro-format data",id:"load-avro-format-data",level:3},{value:"Prepare a dataset",id:"prepare-a-dataset-2",level:4},{value:"Create a table",id:"create-a-table-2",level:4},{value:"Submit a Routine Load job",id:"submit-a-routine-load-job-2",level:4},{value:"Data types mapping",id:"data-types-mapping",level:4},{value:"Limits",id:"limits",level:4},{value:"Check a load job and task",id:"check-a-load-job-and-task",level:2},{value:"Check a load job",id:"check-a-load-job",level:3},{value:"Check a load task",id:"check-a-load-task",level:3},{value:"Pause a load job",id:"pause-a-load-job",level:2},{value:"Resume a load job",id:"resume-a-load-job",level:2},{value:"Alter a load job",id:"alter-a-load-job",level:2},{value:"Stop a load job",id:"stop-a-load-job",level:2},{value:"FAQ",id:"faq",level:2}];function h(e){const t=Object.assign({h1:"h1",p:"p",a:"a",h2:"h2",blockquote:"blockquote",strong:"strong",ul:"ul",li:"li",code:"code",img:"img",h3:"h3",ol:"ol",h4:"h4",pre:"pre",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,s.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"continuously-load-data-from-apache-kafka",children:"Continuously load data from Apache Kafka\xae"}),"\n","\n","\n",(0,n.jsx)(t.p,{children:"This topic introduces how to create a Routine Load job to stream Kafka messages (events) into StarRocks, and familiarizes you with some basic concepts about Routine Load."}),"\n",(0,n.jsx)(t.p,{children:"To continuously load messages of a stream into StarRocks, you can store the message stream in a Kafka topic, and create a Routine Load job to consume the messages. The Routine Load job persists in StarRocks, generates a series of load tasks to consume the messages in all or part of the partitions in the topic, and loads the messages into StarRocks."}),"\n",(0,n.jsx)(t.p,{children:"A Routine Load job supports exactly-once delivery semantics to guarantee the data loaded into StarRocks is neither lost nor duplicated."}),"\n",(0,n.jsxs)(t.p,{children:["Routine Load supports data transformation at data loading and supports data changes made by UPSERT and DELETE operations during data loading. For more information, see ",(0,n.jsx)(t.a,{href:"/docs/loading/Etl_in_loading",children:"Transform data at loading"})," and ",(0,n.jsx)(t.a,{href:"/docs/loading/Load_to_Primary_Key_tables",children:"Change data through loading"}),"."]}),"\n",(0,n.jsx)(o.default,{}),"\n",(0,n.jsx)(t.h2,{id:"supported-data-formats",children:"Supported data formats"}),"\n",(0,n.jsx)(t.p,{children:"Routine Load now supports consuming CSV, JSON, and Avro (supported since v3.0.1) formatted data from a Kafka cluster."}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTE"})}),"\n",(0,n.jsx)(t.p,{children:"For CSV data, take note of the following points:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"You can use a UTF-8 string, such as a comma (,), tab, or pipe (|), whose length does not exceed 50 bytes as a text delimiter."}),"\n",(0,n.jsxs)(t.li,{children:["Null values are denoted by using ",(0,n.jsx)(t.code,{children:"\\N"}),". For example, a data file consists of three columns, and a record from that data file holds data in the first and third columns but no data in the second column. In this situation, you need to use ",(0,n.jsx)(t.code,{children:"\\N"})," in the second column to denote a null value. This means the record must be compiled as ",(0,n.jsx)(t.code,{children:"a,\\N,b"})," instead of ",(0,n.jsx)(t.code,{children:"a,,b"}),". ",(0,n.jsx)(t.code,{children:"a,,b"})," denotes that the second column of the record holds an empty string."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"basic-concepts",children:"Basic concepts"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"routine load",src:a(39264).Z+"",width:"1319",height:"1286"})}),"\n",(0,n.jsx)(t.h3,{id:"terminology",children:"Terminology"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Load job"})}),"\n",(0,n.jsx)(t.p,{children:"A Routine Load job is a long-running job. As long as its status is RUNNING, a load job continuously generates one or multiple concurrent load tasks which consume the messages in a topic of a Kafka cluster and load the data into StarRocks."}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Load task"})}),"\n",(0,n.jsxs)(t.p,{children:["A load job is split into multiple load tasks by certain rules. A load task is the basic unit of data loading. As an individual event, a load task implements the load mechanism based on ",(0,n.jsx)(t.a,{href:"/docs/loading/StreamLoad",children:"Stream Load"}),". Multiple load tasks concurrently consume the messages from different partitions of a topic, and load the data into StarRocks."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"workflow",children:"Workflow"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Create a Routine Load job."}),"\nTo load data from Kafka, you need to create a Routine Load job by running the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD",children:"CREATE ROUTINE LOAD"})," statement. The FE parses the statement, and creates the job according to the properties you have specified."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"The FE splits the job into multiple load tasks."})}),"\n",(0,n.jsx)(t.p,{children:"The FE split the job into multiple load tasks based on certain rules. Each load task is an individual transaction.\nThe splitting rules are as follows:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The FE calculates the actual concurrent number of the load tasks according to the desired concurrent number ",(0,n.jsx)(t.code,{children:"desired_concurrent_number"}),", the partition number in the Kafka topic, and the number of the BE nodes that are alive."]}),"\n",(0,n.jsx)(t.li,{children:"The FE splits the job into load tasks based on the actual concurrent number calculated, and arranges the tasks in the task queue."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Each Kafka topic consists of multiple partitions. The relation between the topic partition and the load task is as follows:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"A partition is uniquely assigned to a load task, and all messages from the partition are consumed by the load task."}),"\n",(0,n.jsx)(t.li,{children:"A load task can consume messages from one or more partitions."}),"\n",(0,n.jsx)(t.li,{children:"All partitions are distributed evenly among load tasks."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Multiple load tasks run concurrently to consume the messages from multiple Kafka topic partitions, and load the data into StarRocks"})}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"The FE schedules and submits load tasks"}),": the FE schedules the load tasks in the queue on a timely basis, and assigns them to selected Coordinator BE nodes. The interval between load tasks is defined by the configuration item ",(0,n.jsx)(t.code,{children:"max_batch_interval"}),". The FE distributes the load tasks evenly to all BE nodes. See ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD#example",children:"CREATE ROUTINE LOAD"})," for more information about ",(0,n.jsx)(t.code,{children:"max_batch_interval"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["The Coordinator BE starts the load task, consumes messages in partitions, parses and filters the data. A load task lasts until the pre-defined amount of messages are consumed or the pre-defined time limit is reached. The message batch size and time limit are defined in the FE configurations ",(0,n.jsx)(t.code,{children:"max_routine_load_batch_size"})," and ",(0,n.jsx)(t.code,{children:"routine_load_task_consume_second"}),". For detailed information, see ",(0,n.jsx)(t.a,{href:"/docs/administration/Configuration",children:"Configuration"}),". The Coordinator BE then distributes the messages to the Executor BEs. The Executor BEs write the messages to disks."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTE"})}),"\n",(0,n.jsxs)(t.p,{children:["StarRocks supports access to Kafka via a security authentication mechanism SASL_SSL, SASL or SSL, or without authentication. This topic takes connection to Kafka without authentication as an example. If you need to connect to Kafka via a security authentication mechanism, see ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD",children:"CREATE ROUTINE LOAD"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"The FE generates new load tasks to load data continuously."}),"\nAfter the Executor BEs has written the data to disks, the Coordinator BE reports the result of the load task to the FE. Based on the result, the FE then generates new load tasks to load the data continuously. Or the FE retries the failed tasks to make sure the data loaded into StarRocks is neither lost nor duplicated."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"create-a-routine-load-job",children:"Create a Routine Load job"}),"\n",(0,n.jsxs)(t.p,{children:["The following three examples describe how to consume CSV-format, JSON-format and Avro-format data in Kafka, and load the data into StarRocks by creating a Routine Load job. For detailed syntax and parameter descriptions, see ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD",children:"CREATE ROUTINE LOAD"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"load-csv-format-data",children:"Load CSV-format data"}),"\n",(0,n.jsx)(t.p,{children:"This section describes how to create a Routine Load job to consume CSV-format data in a Kafka cluster, and load the data into StarRocks."}),"\n",(0,n.jsx)(t.h4,{id:"prepare-a-dataset",children:"Prepare a dataset"}),"\n",(0,n.jsxs)(t.p,{children:["Suppose there is a CSV-format dataset in the topic ",(0,n.jsx)(t.code,{children:"ordertest1"})," in a Kafka cluster. Every message in the dataset includes six fields: order ID, payment date, customer name, nationality, gender, and price."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-Plain",children:'2020050802,2020-05-08,Johann Georg Faust,Deutschland,male,895\n2020050802,2020-05-08,Julien Sorel,France,male,893\n2020050803,2020-05-08,Dorian Grey,UK,male,1262\n2020050901,2020-05-09,Anna Karenina",Russia,female,175\n2020051001,2020-05-10,Tess Durbeyfield,US,female,986\n2020051101,2020-05-11,Edogawa Conan,japan,male,8924\n'})}),"\n",(0,n.jsx)(t.h4,{id:"create-a-table",children:"Create a table"}),"\n",(0,n.jsxs)(t.p,{children:["According to the fields of CSV-format data, create the table ",(0,n.jsx)(t.code,{children:"example_tbl1"})," in the database ",(0,n.jsx)(t.code,{children:"example_db"}),". The following example creates a table with 5 fields excluding the field of customer gender in the CSV-format data."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'CREATE TABLE example_db.example_tbl1 ( \n    `order_id` bigint NOT NULL COMMENT "Order ID",\n    `pay_dt` date NOT NULL COMMENT "Payment date", \n    `customer_name` varchar(26) NULL COMMENT "Customer name", \n    `nationality` varchar(26) NULL COMMENT "Nationality", \n    `price`double NULL COMMENT "Price"\n) \nENGINE=OLAP \nDUPLICATE KEY (order_id,pay_dt) \nDISTRIBUTED BY HASH(`order_id`); \n'})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTICE"})}),"\n",(0,n.jsxs)(t.p,{children:["Since v2.5.7, StarRocks can automatically set the number of buckets (BUCKETS) when you create a table or add a partition. You no longer need to manually set the number of buckets. For detailed information, see ",(0,n.jsx)(t.a,{href:"/docs/table_design/Data_distribution#determine-the-number-of-buckets",children:"determine the number of buckets"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"submit-a-routine-load-job",children:"Submit a Routine Load job"}),"\n",(0,n.jsxs)(t.p,{children:["Execute the following statement to submit a Routine Load job named ",(0,n.jsx)(t.code,{children:"example_tbl1_ordertest1"})," to consume the messages in the topic ",(0,n.jsx)(t.code,{children:"ordertest1"})," and load the data into the table ",(0,n.jsx)(t.code,{children:"example_tbl1"}),". The load task consumes the messages from the initial offset in the specified partitions of the topic."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'CREATE ROUTINE LOAD example_db.example_tbl1_ordertest1 ON example_tbl1\nCOLUMNS TERMINATED BY ",",\nCOLUMNS (order_id, pay_dt, customer_name, nationality, temp_gender, price)\nPROPERTIES\n(\n    "desired_concurrent_number" = "5"\n)\nFROM KAFKA\n(\n    "kafka_broker_list" = "<kafka_broker1_ip>:<kafka_broker1_port>,<kafka_broker2_ip>:<kafka_broker2_port>",\n    "kafka_topic" = "ordertest1",\n    "kafka_partitions" = "0,1,2,3,4",\n    "property.kafka_default_offsets" = "OFFSET_BEGINNING"\n);\n'})}),"\n",(0,n.jsxs)(t.p,{children:["After submitting the load job, you can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement to check the status of the load job."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"load job name"})}),"\n",(0,n.jsx)(t.p,{children:"There could be multiple load job on a table. Therefore, we recommend you name a load job with the corresponding Kafka topic and the time when the load job is submitted. It helps you distinguish the load job on each table."}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Column separator"})}),"\n",(0,n.jsxs)(t.p,{children:["The property ",(0,n.jsx)(t.code,{children:"COLUMN TERMINATED BY"})," defines the column separator of the CSV-format data. The default is ",(0,n.jsx)(t.code,{children:"\\t"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Kafka topic partition and offset"})}),"\n",(0,n.jsxs)(t.p,{children:["You can specify the properties ",(0,n.jsx)(t.code,{children:"kafka_partitions"})," and ",(0,n.jsx)(t.code,{children:"kafka_offsets"})," to specify the partitions and offsets to consume the messages. For example, if you want the load job to consume messages from the Kafka partitions ",(0,n.jsx)(t.code,{children:'"0,1,2,3,4"'})," of the topic ",(0,n.jsx)(t.code,{children:"ordertest1"})," all with the initial offsets, you can specify the properties as follows: If you want the load job to consume messages from the Kafka partitions ",(0,n.jsx)(t.code,{children:'"0,1,2,3,4"'}),"and you need to specify a separate starting offset for each partition, you can configure as follows:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'"kafka_partitions" ="0,1,2,3,4",\n"kafka_offsets" = "OFFSET_BEGINNING, OFFSET_END, 1000, 2000, 3000"\n'})}),"\n",(0,n.jsxs)(t.p,{children:["You can also set the default offsets of all partitions with the property ",(0,n.jsx)(t.code,{children:"property.kafka_default_offsets"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'"kafka_partitions" ="0,1,2,3,4",\n"property.kafka_default_offsets" = "OFFSET_BEGINNING"\n'})}),"\n",(0,n.jsxs)(t.p,{children:["For detailed information, see ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD",children:"CREATE ROUTINE LOAD"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Data mapping and transformation"})}),"\n",(0,n.jsxs)(t.p,{children:["To specify the mapping and transformation relationship between the CSV-format data, and the StarRocks table, you need to use the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Data mapping:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["StarRocks extracts the columns in the CSV-format data and maps them ",(0,n.jsx)(t.strong,{children:"in sequence"})," onto the fields declared in the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["StarRocks extracts the fields declared in the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter and maps them ",(0,n.jsx)(t.strong,{children:"by name"})," onto the columns of StarRocks table."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Data transformation:"})}),"\n",(0,n.jsxs)(t.p,{children:["And because the example excludes the column of customer gender from the CSV-format data, the field ",(0,n.jsx)(t.code,{children:"temp_gender"})," in ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter is used as a placeholder for this field. The other fields are mapped to columns of the StarRocks table ",(0,n.jsx)(t.code,{children:"example_tbl1"})," directly."]}),"\n",(0,n.jsxs)(t.p,{children:["For more information about data transformation, see ",(0,n.jsx)(t.a,{href:"/docs/loading/Etl_in_loading",children:"Transform data at loading"}),"."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTE"})}),"\n",(0,n.jsxs)(t.p,{children:["You do not need to specify the  ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter if the names, number, and order of the columns in the CSV-format data completely correspond to those of the StarRocks table."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Task concurrency"})}),"\n",(0,n.jsx)(t.p,{children:"When there are many Kafka topic partitions and enough BE nodes, you can accelerate the loading by increasing the task concurrency."}),"\n",(0,n.jsxs)(t.p,{children:["To increase the actual load task concurrency, you can increase the desired load task concurrency ",(0,n.jsx)(t.code,{children:"desired_concurrent_number"})," when you [create a routine load job](./RoutineLoad#Create a Routine%20Load%20job). You can also set the dynamic configuration item of FE ",(0,n.jsx)(t.code,{children:"max_routine_load_task_concurrent_num"})," ( default maximum load task currency ) to a larger value. For more information about ",(0,n.jsx)(t.code,{children:"max_routine_load_task_concurrent_num"}),", please see ",(0,n.jsx)(t.a,{href:"../administration/Configuration#fe-configuration-items",children:"FE configuration items"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["The actual task concurrency is defined by the minimum value among the number of BE nodes that are alive, the number of the pre-specified Kafka topic partitions, and the values of ",(0,n.jsx)(t.code,{children:"desired_concurrent_number"})," and ",(0,n.jsx)(t.code,{children:"max_routine_load_task_concurrent_num"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["In the example, the number of BE nodes that are alive is ",(0,n.jsx)(t.code,{children:"5"}),", the number of the pre-specified Kafka topic partitions is ",(0,n.jsx)(t.code,{children:"5"}),", and the value of ",(0,n.jsx)(t.code,{children:"max_routine_load_task_concurrent_num"})," is ",(0,n.jsx)(t.code,{children:"5"}),". To increase the actual load task concurrency, you can increase the ",(0,n.jsx)(t.code,{children:"desired_concurrent_number"})," from the default value ",(0,n.jsx)(t.code,{children:"3"})," to ",(0,n.jsx)(t.code,{children:"5"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["For more about the properties, see ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD",children:"CREATE ROUTINE LOAD"}),". For detailed instructions on accelerating the loading, see ",(0,n.jsx)(t.a,{href:"../faq/loading/Routine_load_faq",children:"Routine Load FAQ"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"load-json-format-data",children:"Load JSON-format data"}),"\n",(0,n.jsx)(t.p,{children:"This section describes how to create a Routine Load job to consume JSON-format data in a Kafka cluster, and load the data into StarRocks."}),"\n",(0,n.jsx)(t.h4,{id:"prepare-a-dataset-1",children:"Prepare a dataset"}),"\n",(0,n.jsxs)(t.p,{children:["Suppose there is a JSON-format dataset in the topic ",(0,n.jsx)(t.code,{children:"ordertest2"})," in a Kafka cluster. The dataset includes six keys: commodity ID, customer name, nationality, payment time, and price. Besides, you want to transform the payment time column into the DATE type, and load it into the ",(0,n.jsx)(t.code,{children:"pay_dt"})," column in the StarRocks table."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-JSON",children:'{"commodity_id": "1", "customer_name": "Mark Twain", "country": "US","pay_time": 1589191487,"price": 875}\n{"commodity_id": "2", "customer_name": "Oscar Wilde", "country": "UK","pay_time": 1589191487,"price": 895}\n{"commodity_id": "3", "customer_name": "Antoine de Saint-Exup\xe9ry","country": "France","pay_time": 1589191487,"price": 895}\n'})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"CAUTION"})," Each JSON object in a row must be in one Kafka message, otherwise a JSON parsing error is returned."]}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"create-a-table-1",children:"Create a table"}),"\n",(0,n.jsxs)(t.p,{children:["According to the keys of the JSON-format data, create the table ",(0,n.jsx)(t.code,{children:"example_tbl2"})," in the database ",(0,n.jsx)(t.code,{children:"example_db"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'CREATE TABLE `example_tbl2` ( \n    `commodity_id` varchar(26) NULL COMMENT "Commodity ID", \n    `customer_name` varchar(26) NULL COMMENT "Customer name", \n    `country` varchar(26) NULL COMMENT "Country", \n    `pay_time` bigint(20) NULL COMMENT "Payment time", \n    `pay_dt` date NULL COMMENT "Payment date", \n    `price`double SUM NULL COMMENT "Price"\n) \nENGINE=OLAP\nAGGREGATE KEY(`commodity_id`,`customer_name`,`country`,`pay_time`,`pay_dt`) \nDISTRIBUTED BY HASH(`commodity_id`); \n'})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTICE"})}),"\n",(0,n.jsxs)(t.p,{children:["Since v2.5.7, StarRocks can automatically set the number of buckets (BUCKETS) when you create a table or add a partition. You no longer need to manually set the number of buckets. For detailed information, see ",(0,n.jsx)(t.a,{href:"/docs/table_design/Data_distribution#determine-the-number-of-buckets",children:"determine the number of buckets"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"submit-a-routine-load-job-1",children:"Submit a Routine Load job"}),"\n",(0,n.jsxs)(t.p,{children:["Execute the following statement to submit a Routine Load job named ",(0,n.jsx)(t.code,{children:"example_tbl2_ordertest2"})," to consume the messages in the topic ",(0,n.jsx)(t.code,{children:"ordertest2"})," and load the data into the table ",(0,n.jsx)(t.code,{children:"example_tbl2"}),". The load task consumes the messages from the initial offset in the specified partitions of the topic."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'CREATE ROUTINE LOAD example_db.example_tbl2_ordertest2 ON example_tbl2\nCOLUMNS(commodity_id, customer_name, country, pay_time, price, pay_dt=from_unixtime(pay_time, \'%Y%m%d\'))\nPROPERTIES\n(\n    "desired_concurrent_number" = "5",\n    "format" = "json",\n    "jsonpaths" = "[\\"$.commodity_id\\",\\"$.customer_name\\",\\"$.country\\",\\"$.pay_time\\",\\"$.price\\"]"\n )\nFROM KAFKA\n(\n    "kafka_broker_list" ="<kafka_broker1_ip>:<kafka_broker1_port>,<kafka_broker2_ip>:<kafka_broker2_port>",\n    "kafka_topic" = "ordertest2",\n    "kafka_partitions" ="0,1,2,3,4",\n    "property.kafka_default_offsets" = "OFFSET_BEGINNING"\n);\n'})}),"\n",(0,n.jsxs)(t.p,{children:["After submitting the load job, you can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement to check the status of the load job."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Data format"})}),"\n",(0,n.jsxs)(t.p,{children:["You need to specify ",(0,n.jsx)(t.code,{children:'"format" = "json"'})," in the clause ",(0,n.jsx)(t.code,{children:"PROPERTIES"})," to define that the data format is JSON."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Data mapping and transformation"})}),"\n",(0,n.jsxs)(t.p,{children:["To specify the mapping and transformation relationship between the JSON-format data, and the StarRocks table, you need to specify the paramter ",(0,n.jsx)(t.code,{children:"COLUMNS"})," and property",(0,n.jsx)(t.code,{children:"jsonpaths"}),". The order of fields specified in the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter must match that of the JSON-format data, and the name of fields must match that of the StarRocks table. The property ",(0,n.jsx)(t.code,{children:"jsonpaths"})," is used to extract the required fields from the JSON data. These fields are then named by the property ",(0,n.jsx)(t.code,{children:"COLUMNS"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Because the example needs to transform the payment time field to the DATE data type, and load the data into the ",(0,n.jsx)(t.code,{children:"pay_dt"})," column in the StarRocks table, you need to use the from_unixtime function. The other fields are mapped to fields of the table ",(0,n.jsx)(t.code,{children:"example_tbl2"})," directly."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Data mapping:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["StarRocks extracts the ",(0,n.jsx)(t.code,{children:"name"})," and ",(0,n.jsx)(t.code,{children:"code"})," keys of JSON-format data and maps them onto the keys declared in the ",(0,n.jsx)(t.code,{children:"jsonpaths"})," property."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["StarRocks extracts the keys declared in the ",(0,n.jsx)(t.code,{children:"jsonpaths"})," property and maps them ",(0,n.jsx)(t.strong,{children:"in sequence"})," onto the fields declared in the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["StarRocks extracts the fields declared in the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter and maps them ",(0,n.jsx)(t.strong,{children:"by name"})," onto the columns of StarRocks table."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Data transformation"}),":"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Because the example needs to transform the  key ",(0,n.jsx)(t.code,{children:"pay_time"})," to the DATE data type, and load the data into the ",(0,n.jsx)(t.code,{children:"pay_dt"})," column in the StarRocks table, you need to use the from_unixtime function in ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter. The other fields are mapped to fields of the table ",(0,n.jsx)(t.code,{children:"example_tbl2"})," directly."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["And because the example excludes the column of customer gender from the JSON-format data, the field ",(0,n.jsx)(t.code,{children:"temp_gender"})," in ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter  is used as a placeholder for this field. The other fields are mapped to columns of the StarRocks table ",(0,n.jsx)(t.code,{children:"example_tbl1"})," directly."]}),"\n",(0,n.jsxs)(t.p,{children:["For more information about data transformation, see ",(0,n.jsx)(t.a,{href:"/docs/loading/Etl_in_loading",children:"Transform data at loading"}),"."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTE"})}),"\n",(0,n.jsxs)(t.p,{children:["You do not need to specify the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter if the names and number of the keys in the JSON object completely match those of fields in the StarRocks table."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"load-avro-format-data",children:"Load Avro-format data"}),"\n",(0,n.jsx)(t.p,{children:"Since v3.0.1, StarRocks supports loading Avro data by using Routine Load."}),"\n",(0,n.jsx)(t.h4,{id:"prepare-a-dataset-2",children:"Prepare a dataset"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Avro schema"})}),"\n"]}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Create the following  Avro schema file ",(0,n.jsx)(t.code,{children:"avro_schema.avsc"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-JSON",children:'{\n    "type": "record",\n    "name": "sensor_log",\n    "fields" : [\n        {"name": "id", "type": "long"},\n        {"name": "name", "type": "string"},\n        {"name": "checked", "type" : "boolean"},\n        {"name": "data", "type": "double"},\n        {"name": "sensor_type", "type": {"type": "enum", "name": "sensor_type_enum", "symbols" : ["TEMPERATURE", "HUMIDITY", "AIR-PRESSURE"]}}  \n    ]\n}\n'})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Register the Avro schema in the ",(0,n.jsx)(t.a,{href:"https://docs.confluent.io/cloud/current/get-started/schema-registry.html#create-a-schema",children:"Schema Registry"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Avro data"})}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Prepare the Avro data and send it to the Kafka topic ",(0,n.jsx)(t.code,{children:"topic_0"}),"."]}),"\n",(0,n.jsx)(t.h4,{id:"create-a-table-2",children:"Create a table"}),"\n",(0,n.jsxs)(t.p,{children:["According to the fields of Avro data, create a table ",(0,n.jsx)(t.code,{children:"sensor_log"})," in the target database ",(0,n.jsx)(t.code,{children:"example_db"})," in the StarRocks cluster. The column names of the table must match the field names in the Avro data. For the data type mapping between the table columns and the Avro data fields, see [Data types mapping](#Data types mapping)."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'CREATE TABLE example_db.sensor_log ( \n    `id` bigint NOT NULL COMMENT "sensor id",\n    `name` varchar(26) NOT NULL COMMENT "sensor name", \n    `checked` boolean NOT NULL COMMENT "checked", \n    `data` double NULL COMMENT "sensor data", \n    `sensor_type` varchar(26) NOT NULL COMMENT "sensor type"\n) \nENGINE=OLAP \nDUPLICATE KEY (id) \nDISTRIBUTED BY HASH(`id`); \n'})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTICE"})}),"\n",(0,n.jsxs)(t.p,{children:["Since v2.5.7, StarRocks can automatically set the number of buckets (BUCKETS) when you create a table or add a partition. You no longer need to manually set the number of buckets. For detailed information, see ",(0,n.jsx)(t.a,{href:"/docs/table_design/Data_distribution#determine-the-number-of-buckets",children:"determine the number of buckets"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h4,{id:"submit-a-routine-load-job-2",children:"Submit a Routine Load job"}),"\n",(0,n.jsxs)(t.p,{children:["Execute the following statement to submit a Routine Load job named ",(0,n.jsx)(t.code,{children:"sensor_log_load_job"})," to consume the Avro messages in the Kafka topic ",(0,n.jsx)(t.code,{children:"topic_0"})," and load the data into the table ",(0,n.jsx)(t.code,{children:"sensor_log"})," in the database ",(0,n.jsx)(t.code,{children:"sensor"}),". The load job consumes the messages from the initial offset in the specified partitions of the topic."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'CREATE ROUTINE LOAD example_db.sensor_log_load_job ON sensor_log  \nPROPERTIES  \n(  \n    "format" = "avro"  \n)  \nFROM KAFKA  \n(  \n    "kafka_broker_list" = "<kafka_broker1_ip>:<kafka_broker1_port>,<kafka_broker2_ip>:<kafka_broker2_port>,...",\n    "confluent.schema.registry.url" = "http://172.xx.xxx.xxx:8081",  \n    "kafka_topic" = "topic_0",  \n    "kafka_partitions" = "0,1,2,3,4,5",  \n    "property.kafka_default_offsets" = "OFFSET_BEGINNING"  \n);\n'})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Data Format"}),"\n",(0,n.jsxs)(t.p,{children:["You need to specify ",(0,n.jsx)(t.code,{children:'"format = "avro"'})," in the clause ",(0,n.jsx)(t.code,{children:"PROPERTIES"})," to define that the data format is Avro."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Schema Registry"}),"\n",(0,n.jsxs)(t.p,{children:["You need to configure ",(0,n.jsx)(t.code,{children:"confluent.schema.registry.url"})," to specify the URL of the Schema Registry where the Avro schema is registered. StarRocks retrieves the Avro schema by using this URL. The format is as follows:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-Plaintext",children:"confluent.schema.registry.url = http[s]://[<schema-registry-api-key>:<schema-registry-api-secret>@]<hostname|ip address>[:<port>]\n"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Data mapping and transformation"}),"\n",(0,n.jsxs)(t.p,{children:["To specify the mapping and transformation relationship between the Avro-format data and the StarRocks table, you need to specify the paramter ",(0,n.jsx)(t.code,{children:"COLUMNS"})," and property ",(0,n.jsx)(t.code,{children:"jsonpaths"}),". The order of fields specified in the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter must match that of the fields in the property ",(0,n.jsx)(t.code,{children:"jsonpaths"}),", and the names of fields must match these of the StarRocks table. The property ",(0,n.jsx)(t.code,{children:"jsonpaths"})," is used to extract the required fields from the Avro data. These fields are then named by the property ",(0,n.jsx)(t.code,{children:"COLUMNS"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["For more information about data transformation, see ",(0,n.jsx)(t.a,{href:"https://docs.starrocks.io/en-us/latest/loading/Etl_in_loading",children:"Transform data at loading"}),"."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"NOTE"}),"\n",(0,n.jsxs)(t.p,{children:["You do not need to specify the ",(0,n.jsx)(t.code,{children:"COLUMNS"})," parameter if the names and number of the fields in the Avro record completely match those of columns in the StarRocks table."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["After submitting the load job, you can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement to check the status of the load job."]}),"\n",(0,n.jsx)(t.h4,{id:"data-types-mapping",children:"Data types mapping"}),"\n",(0,n.jsx)(t.p,{children:"The data type mapping between the Avro data fields you want to load and the StarRocks table columns is as follows:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Primitive types"})}),"\n"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Avro"}),(0,n.jsx)(t.th,{children:"StarRocks"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"nul"}),(0,n.jsx)(t.td,{children:"NULL"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"boolean"}),(0,n.jsx)(t.td,{children:"BOOLEAN"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"int"}),(0,n.jsx)(t.td,{children:"INT"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"long"}),(0,n.jsx)(t.td,{children:"BIGINT"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"float"}),(0,n.jsx)(t.td,{children:"FLOAT"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"double"}),(0,n.jsx)(t.td,{children:"DOUBLE"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"bytes"}),(0,n.jsx)(t.td,{children:"STRING"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"string"}),(0,n.jsx)(t.td,{children:"STRING"})]})]})]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Complex types"})}),"\n"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Avro"}),(0,n.jsx)(t.th,{children:"StarRocks"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"record"}),(0,n.jsx)(t.td,{children:"Load the entire RECORD or its subfields into StarRocks as JSON."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"enums"}),(0,n.jsx)(t.td,{children:"STRING"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"arrays"}),(0,n.jsx)(t.td,{children:"ARRAY"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"maps"}),(0,n.jsx)(t.td,{children:"JSON"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"union(T, null)"}),(0,n.jsx)(t.td,{children:"NULLABLE(T)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"fixed"}),(0,n.jsx)(t.td,{children:"STRING"})]})]})]}),"\n",(0,n.jsx)(t.h4,{id:"limits",children:"Limits"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Currently, StarRocks does not support schema evolution."}),"\n",(0,n.jsx)(t.li,{children:"Each Kafka message must only contain a single Avro data record."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"check-a-load-job-and-task",children:"Check a load job and task"}),"\n",(0,n.jsx)(t.h3,{id:"check-a-load-job",children:"Check a load job"}),"\n",(0,n.jsxs)(t.p,{children:["Execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement to check the status of the load job ",(0,n.jsx)(t.code,{children:"example_tbl2_ordertest2"}),". StarRocks returns the execution state ",(0,n.jsx)(t.code,{children:"State"}),", the statistical information (including the total rows consumed and the total rows loaded) ",(0,n.jsx)(t.code,{children:"Statistics"}),",  and the progress of the load job ",(0,n.jsx)(t.code,{children:"progress"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["If the state of the load job is automatically changed to ",(0,n.jsx)(t.strong,{children:"PAUSED"}),", it is possibly because the number of error rows has exceeded the threshold. For detailed instructions on setting this threshold, see ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/CREATE%20ROUTINE%20LOAD",children:"CREATE ROUTINE LOAD"}),". You can check the files ",(0,n.jsx)(t.code,{children:"ReasonOfStateChanged"})," and ",(0,n.jsx)(t.code,{children:"ErrorLogUrls"})," to identify and troubleshoot the problem. Having fixed the problem, you can then execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/RESUME%20ROUTINE%20LOAD",children:"RESUME ROUTINE LOAD"})," statement to resume the ",(0,n.jsx)(t.strong,{children:"PAUSED"})," load job."]}),"\n",(0,n.jsxs)(t.p,{children:["If the state of the load job is ",(0,n.jsx)(t.strong,{children:"CANCELLED"}),", it is possibly because the load job encounters an exception (such as the table has been dropped). You can check the files ",(0,n.jsx)(t.code,{children:"ReasonOfStateChanged"})," and ",(0,n.jsx)(t.code,{children:"ErrorLogUrls"})," to identify and troubleshoot the problem. However, you cannot resume a ",(0,n.jsx)(t.strong,{children:"CANCELLED"})," load job."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'MySQL [example_db]> SHOW ROUTINE LOAD FOR example_tbl2_ordertest2 \\G\n*************************** 1. row ***************************\n                  Id: 63013\n                Name: example_tbl2_ordertest2\n          CreateTime: 2022-08-10 17:09:00\n           PauseTime: NULL\n             EndTime: NULL\n              DbName: default_cluster:example_db\n           TableName: example_tbl2\n               State: RUNNING\n      DataSourceType: KAFKA\n      CurrentTaskNum: 3\n       JobProperties: {"partitions":"*","partial_update":"false","columnToColumnExpr":"commodity_id,customer_name,country,pay_time,pay_dt=from_unixtime(`pay_time`, \'%Y%m%d\'),price","maxBatchIntervalS":"20","whereExpr":"*","dataFormat":"json","timezone":"Asia/Shanghai","format":"json","json_root":"","strict_mode":"false","jsonpaths":"[\\"$.commodity_id\\",\\"$.customer_name\\",\\"$.country\\",\\"$.pay_time\\",\\"$.price\\"]","desireTaskConcurrentNum":"3","maxErrorNum":"0","strip_outer_array":"false","currentTaskConcurrentNum":"3","maxBatchRows":"200000"}\nDataSourceProperties: {"topic":"ordertest2","currentKafkaPartitions":"0,1,2,3,4","brokerList":"<kafka_broker1_ip>:<kafka_broker1_port>,<kafka_broker2_ip>:<kafka_broker2_port>"}\n    CustomProperties: {"kafka_default_offsets":"OFFSET_BEGINNING"}\n           Statistic: {"receivedBytes":230,"errorRows":0,"committedTaskNum":1,"loadedRows":2,"loadRowsRate":0,"abortedTaskNum":0,"totalRows":2,"unselectedRows":0,"receivedBytesRate":0,"taskExecuteTimeMs":522}\n            Progress: {"0":"1","1":"OFFSET_ZERO","2":"OFFSET_ZERO","3":"OFFSET_ZERO","4":"OFFSET_ZERO"}\nReasonOfStateChanged: \n        ErrorLogUrls: \n            OtherMsg: \n'})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"CAUTION"})}),"\n",(0,n.jsx)(t.p,{children:"You cannot check a load job that has stopped or has not yet started."}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"check-a-load-task",children:"Check a load task"}),"\n",(0,n.jsxs)(t.p,{children:["Execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD%20TASK",children:"SHOW ROUTINE LOAD TASK"})," statement to check the load tasks of the load job ",(0,n.jsx)(t.code,{children:"example_tbl2_ordertest2"}),", such as how many tasks are currently running, the Kafka topic partitions that are consumed and the consumption progress ",(0,n.jsx)(t.code,{children:"DataSourceProperties"}),", and the corresponding Coordinator BE node ",(0,n.jsx)(t.code,{children:"BeId"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'MySQL [example_db]> SHOW ROUTINE LOAD TASK WHERE JobName = "example_tbl2_ordertest2" \\G\n*************************** 1. row ***************************\n              TaskId: 18c3a823-d73e-4a64-b9cb-b9eced026753\n               TxnId: -1\n           TxnStatus: UNKNOWN\n               JobId: 63013\n          CreateTime: 2022-08-10 17:09:05\n   LastScheduledTime: 2022-08-10 17:47:27\n    ExecuteStartTime: NULL\n             Timeout: 60\n                BeId: -1\nDataSourceProperties: {"1":0,"4":0}\n             Message: there is no new data in kafka, wait for 20 seconds to schedule again\n*************************** 2. row ***************************\n              TaskId: f76c97ac-26aa-4b41-8194-a8ba2063eb00\n               TxnId: -1\n           TxnStatus: UNKNOWN\n               JobId: 63013\n          CreateTime: 2022-08-10 17:09:05\n   LastScheduledTime: 2022-08-10 17:47:26\n    ExecuteStartTime: NULL\n             Timeout: 60\n                BeId: -1\nDataSourceProperties: {"2":0}\n             Message: there is no new data in kafka, wait for 20 seconds to schedule again\n*************************** 3. row ***************************\n              TaskId: 1a327a34-99f4-4f8d-8014-3cd38db99ec6\n               TxnId: -1\n           TxnStatus: UNKNOWN\n               JobId: 63013\n          CreateTime: 2022-08-10 17:09:26\n   LastScheduledTime: 2022-08-10 17:47:27\n    ExecuteStartTime: NULL\n             Timeout: 60\n                BeId: -1\nDataSourceProperties: {"0":2,"3":0}\n             Message: there is no new data in kafka, wait for 20 seconds to schedule again\n'})}),"\n",(0,n.jsx)(t.h2,{id:"pause-a-load-job",children:"Pause a load job"}),"\n",(0,n.jsxs)(t.p,{children:["You can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/PAUSE%20ROUTINE%20LOAD",children:"PAUSE ROUTINE LOAD"})," statement to pause a load job. The state of the load job will be ",(0,n.jsx)(t.strong,{children:"PAUSED"})," after the statement is executed. However, it has not stopped. You can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/RESUME%20ROUTINE%20LOAD",children:"RESUME ROUTINE LOAD"})," statement to resume it. You can also check its status with the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement."]}),"\n",(0,n.jsxs)(t.p,{children:["The following example pauses the load job ",(0,n.jsx)(t.code,{children:"example_tbl2_ordertest2"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:"PAUSE ROUTINE LOAD FOR example_tbl2_ordertest2;\n"})}),"\n",(0,n.jsx)(t.h2,{id:"resume-a-load-job",children:"Resume a load job"}),"\n",(0,n.jsxs)(t.p,{children:["You can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/RESUME%20ROUTINE%20LOAD",children:"RESUME ROUTINE LOAD"})," statement to resume a paused load job. The state of the load job will be ",(0,n.jsx)(t.strong,{children:"NEED_SCHEDULE"})," temporarily (because the load job is being re-scheduled), and then become ",(0,n.jsx)(t.strong,{children:"RUNNING"}),". You can check its status with the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement."]}),"\n",(0,n.jsxs)(t.p,{children:["The following example resumes the paused load job ",(0,n.jsx)(t.code,{children:"example_tbl2_ordertest2"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:"RESUME ROUTINE LOAD FOR example_tbl2_ordertest2;\n"})}),"\n",(0,n.jsx)(t.h2,{id:"alter-a-load-job",children:"Alter a load job"}),"\n",(0,n.jsxs)(t.p,{children:["Before altering a load job, you must pause it with the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/PAUSE%20ROUTINE%20LOAD",children:"PAUSE ROUTINE LOAD"})," statement. Then you can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/alter-routine-load",children:"ALTER ROUTINE LOAD"}),". After altering it, you can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/RESUME%20ROUTINE%20LOAD",children:"RESUME ROUTINE LOAD"})," statement to resume it, and check its status with the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement."]}),"\n",(0,n.jsxs)(t.p,{children:["Suppose the number of the BE nodes that are alive increases to ",(0,n.jsx)(t.code,{children:"6"})," and the Kafka topic partitions to be consumed is ",(0,n.jsx)(t.code,{children:'"0,1,2,3,4,5,6,7"'}),". If you want to increase the actual load task concurrency, you can execute the following statement to increase the number of desired task concurrency ",(0,n.jsx)(t.code,{children:"desired_concurrent_number"})," to ",(0,n.jsx)(t.code,{children:"6"})," (greater than or equal to the number of BE nodes that are alive), and specify the Kafka topic partitions and initial offsets."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"NOTE"})}),"\n",(0,n.jsxs)(t.p,{children:["Because the actual task concurrency is determined by the minimum value of multiple parameters, you must make sure that the value of the FE dynamic parameter ",(0,n.jsx)(t.code,{children:"max_routine_load_task_concurrent_num"})," is greater than or equal to ",(0,n.jsx)(t.code,{children:"6"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:'ALTER ROUTINE LOAD FOR example_tbl2_ordertest2\nPROPERTIES\n(\n    "desired_concurrent_number" = "6"\n)\nFROM kafka\n(\n    "kafka_partitions" = "0,1,2,3,4,5,6,7",\n    "kafka_offsets" = "OFFSET_BEGINNING,OFFSET_BEGINNING,OFFSET_BEGINNING,OFFSET_BEGINNING,OFFSET_END,OFFSET_END,OFFSET_END,OFFSET_END"\n);\n'})}),"\n",(0,n.jsx)(t.h2,{id:"stop-a-load-job",children:"Stop a load job"}),"\n",(0,n.jsxs)(t.p,{children:["You can execute the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/STOP%20ROUTINE%20LOAD",children:"STOP ROUTINE LOAD"})," statement to stop a load job. The state of the load job will be ",(0,n.jsx)(t.strong,{children:"STOPPED"})," after the statement is executed, and you cannot resume a stopped load job. You cannot check the status of a stopped load job with the ",(0,n.jsx)(t.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/SHOW%20ROUTINE%20LOAD",children:"SHOW ROUTINE LOAD"})," statement."]}),"\n",(0,n.jsxs)(t.p,{children:["The following example stops the load job ",(0,n.jsx)(t.code,{children:"example_tbl2_ordertest2"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-SQL",children:"STOP ROUTINE LOAD FOR example_tbl2_ordertest2;\n"})}),"\n",(0,n.jsx)(t.h2,{id:"faq",children:"FAQ"}),"\n",(0,n.jsxs)(t.p,{children:["Please see ",(0,n.jsx)(t.a,{href:"../faq/loading/Routine_load_faq",children:"Routine Load FAQ"}),"."]})]})}const m=function(e={}){const{wrapper:t}=Object.assign({},(0,s.ah)(),e.components);return t?(0,n.jsx)(t,Object.assign({},e,{children:(0,n.jsx)(h,e)})):h(e)}},39264:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/4.5.2-1-f146fc07da59c8d82569e5f4257aa297.png"},11151:(e,t,a)=>{a.d(t,{Zo:()=>i,ah:()=>o});var n=a(67294);const s=n.createContext({});function o(e){const t=n.useContext(s);return n.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const r={};function i({components:e,children:t,disableParentContext:a}){let i;return i=a?"function"==typeof e?e({}):e||r:o(e),n.createElement(s.Provider,{value:i},t)}}}]);