"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[14086],{67075:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>i});var s=t(85893),a=t(11151);const r={},l="CREATE TABLE AS SELECT",d={id:"sql-reference/sql-statements/data-definition/CREATE TABLE AS SELECT",title:"CREATE TABLE AS SELECT",description:"Description",source:"@site/versioned_docs/version-3.0/sql-reference/sql-statements/data-definition/CREATE TABLE AS SELECT.md",sourceDirName:"sql-reference/sql-statements/data-definition",slug:"/sql-reference/sql-statements/data-definition/CREATE TABLE AS SELECT",permalink:"/docs/3.0/sql-reference/sql-statements/data-definition/CREATE TABLE AS SELECT",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.0/sql-reference/sql-statements/data-definition/CREATE TABLE AS SELECT.md",tags:[],version:"3.0",frontMatter:{},sidebar:"documentation",previous:{title:"CREATE RESOURCE",permalink:"/docs/3.0/sql-reference/sql-statements/data-definition/CREATE RESOURCE"},next:{title:"CREATE TABLE LIKE",permalink:"/docs/3.0/sql-reference/sql-statements/data-definition/CREATE TABLE LIKE"}},c={},i=[{value:"Description",id:"description",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Usage notes",id:"usage-notes",level:2},{value:"Examples",id:"examples",level:2}];function o(e){const n=Object.assign({h1:"h1",h2:"h2",p:"p",a:"a",ul:"ul",li:"li",pre:"pre",code:"code",table:"table",thead:"thead",tr:"tr",th:"th",strong:"strong",tbody:"tbody",td:"td"},(0,a.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"create-table-as-select",children:"CREATE TABLE AS SELECT"}),"\n",(0,s.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,s.jsx)(n.p,{children:"You can use the CREATE TABLE AS SELECT (CTAS) statement to synchronously or asynchronously query a table and create a new table based on the query result, and then insert the query result into the new table."}),"\n",(0,s.jsxs)(n.p,{children:["You can submit an asynchronous CTAS task using ",(0,s.jsx)(n.a,{href:"/docs/3.0/sql-reference/sql-statements/data-manipulation/SUBMIT%20TASK",children:"SUBMIT TASK"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Synchronously query a table and create a new table based on the query result, and then insert the query result into the new table."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'CREATE TABLE [IF NOT EXISTS] [database.]table_name\n[(column_name [, column_name2, ...]]\n[key_desc]\n[COMMENT "table comment"]\n[partition_desc]\n[distribution_desc]\n[PROPERTIES ("key"="value", ...)]\nAS SELECT query\n[ ... ]\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Asynchronously query a table and create a new table based on the query result, and then insert the query result into the new table."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'SUBMIT [/*+ SET_VAR(key=value) */] TASK [[database.]<task_name>]AS\nCREATE TABLE [IF NOT EXISTS] [database.]table_name\n[(column_name [, column_name2, ...]]\n[key_desc]\n[COMMENT "table comment"]\n[partition_desc]\n[distribution_desc]\n[PROPERTIES ("key"="value", ...)]AS SELECT query\n[ ... ]\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Parameter"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Required"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Description"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"column_name"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"The name of a column in the new table. You do not need to specify the data type for the column. StarRocks automatically specifies an appropriate data type for the column . StarRocks converts FLOAT and DOUBLE data into DECIMAL(38,9) data. StarRocks also converts CHAR, VARCHAR, and STRING data into VARCHAR(65533) data."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"key_desc"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsxs)(n.td,{children:["The syntax is ",(0,s.jsx)(n.code,{children:"key_type ( <col_name1> [, <col_name2> , ...])"}),".",(0,s.jsx)("br",{}),(0,s.jsx)(n.strong,{children:"Parameters"}),":",(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)(n.code,{children:"key_type"}),": ",(0,s.jsx)(n.a,{href:"/docs/3.0/table_design/table_types/",children:"the key type of the new table"}),". Valid values: ",(0,s.jsx)(n.code,{children:"DUPLICATE KEY"})," and ",(0,s.jsx)(n.code,{children:"PRIMARY KEY"}),". Default value: ",(0,s.jsx)(n.code,{children:"DUPLICATE KEY"}),"."]}),(0,s.jsxs)("li",{children:[" ",(0,s.jsx)(n.code,{children:"col_name"}),": the column to form the key."]})]})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"COMMENT"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"The comment of the new table."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"partition_desc"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"The partitioning method of the new table. If you do not specify this parameter, by default, the new table has no partition. For more information about partitioning, see CREATE TABLE."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"distribution_desc"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"The bucketing method of the new table. If you do not specify this parameter, the bucket column defaults to the column with the highest cardinality collected by the cost-based optimizer (CBO). The number of buckets defaults to 10. If the CBO does not collect information about the cardinality, the bucket column defaults to the first column in the new table. For more information about bucketing, see CREATE TABLE."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Properties"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"The properties of the new table."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"AS SELECT query"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsxs)(n.td,{children:["The query result.  You can specify columns in ",(0,s.jsx)(n.code,{children:"... AS SELECT query"}),", for example, ",(0,s.jsx)(n.code,{children:"... AS SELECT a, b, c FROM table_a;"}),". In this example, ",(0,s.jsx)(n.code,{children:"a"}),", ",(0,s.jsx)(n.code,{children:"b"}),", and ",(0,s.jsx)(n.code,{children:"c"})," indicates the column names of the table that is queried. If you do not specify the column names of the new table, the column names of the new table are also ",(0,s.jsx)(n.code,{children:"a"}),", ",(0,s.jsx)(n.code,{children:"b"}),", and ",(0,s.jsx)(n.code,{children:"c"}),". You can specify expressions in ",(0,s.jsx)(n.code,{children:"... AS SELECT query"}),", for example, ",(0,s.jsx)(n.code,{children:"... AS SELECT a+1 AS x, b+2 AS y, c*c AS z FROM table_a;"}),". In this example, ",(0,s.jsx)(n.code,{children:"a+1"}),", ",(0,s.jsx)(n.code,{children:"b+2"}),", and ",(0,s.jsx)(n.code,{children:"c*c"})," indicates the column names of the table that is queried, and ",(0,s.jsx)(n.code,{children:"x"}),", ",(0,s.jsx)(n.code,{children:"y"}),", and ",(0,s.jsx)(n.code,{children:"z"})," indicates the column names of the new table. Note:  The number of columns in the new table need to be the same as the number of the columns specified in the SELECT statement . We recommend that you use column names that are easy to identify."]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"usage-notes",children:"Usage notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The CTAS statement can only create a new table that meets the following requirements:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ENGINE"})," is ",(0,s.jsx)(n.code,{children:"OLAP"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The table is a Duplicate Key table by default. You can also specify it as a Primary Key table in ",(0,s.jsx)(n.code,{children:"key_desc"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The sort keys are the first three columns, and the storage space of the data types of these three columns does not exceed 36 bytes."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The CTAS statement does not support setting indexes for a newly created table."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If the CTAS statement fails to execute due to reasons, such as an FE restart, one of the following issues may occur:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"A new table is created successfully but does not contain data."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"A new table fails to be created."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After a new table is created, if multiple methods (such as INSERT INTO) are used to insert data into the new table, the method that completes the INSERT operation first will insert its data into the new table."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After a new table is created, you need to manually grant permissions on this table to users."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If you do not specify a name for a Task when you asynchronously query a table and create a new table based on the query result, StarRocks automatically generates a name for the Task."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsxs)(n.p,{children:["Example 1: Synchronously query a table ",(0,s.jsx)(n.code,{children:"order"})," and create a new table ",(0,s.jsx)(n.code,{children:"order_new"})," based on the query result, and then insert the query result into the new table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"CREATE TABLE order_new\nAS SELECT * FROM order;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Example 2: Synchronously query the ",(0,s.jsx)(n.code,{children:"k1"}),", ",(0,s.jsx)(n.code,{children:"k2"}),", and ",(0,s.jsx)(n.code,{children:"k3"})," columns in the table ",(0,s.jsx)(n.code,{children:"order"})," and create a new table ",(0,s.jsx)(n.code,{children:"order_new"})," based on the query result, and then insert the query result into the new table. Additionally, set the column names of the new table to ",(0,s.jsx)(n.code,{children:"a"}),", ",(0,s.jsx)(n.code,{children:"b"}),", and ",(0,s.jsx)(n.code,{children:"c"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"CREATE TABLE order_new (a, b, c)\nAS SELECT k1, k2, k3 FROM order;\n"})}),"\n",(0,s.jsx)(n.p,{children:"or"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"CREATE TABLE order_new\nAS SELECT k1 AS a, k2 AS b, k3 AS c FROM order;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Example 3: Synchronously query the largest value of the ",(0,s.jsx)(n.code,{children:"salary"})," column in the table ",(0,s.jsx)(n.code,{children:"employee"})," and create a new table ",(0,s.jsx)(n.code,{children:"employee_new"})," based on the query result, and then insert the query result into the new table. Additionally, set the column name of the new table to ",(0,s.jsx)(n.code,{children:"salary_max"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"CREATE TABLE employee_new\nAS SELECT MAX(salary) AS salary_max FROM employee;\n"})}),"\n",(0,s.jsx)(n.p,{children:"After data is inserted, query the new table."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM employee_new;\n\n+------------+\n| salary_max |\n+------------+\n|   10000    |\n+------------+\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Example 4: Use CTAS to create a Primary Key table. Note that the number of data rows in the Primary Key table may be less than that in the query result. It is because the ",(0,s.jsx)(n.a,{href:"/docs/3.0/table_design/table_types/primary_key_table",children:"Primary Key"})," table only stores the most recent data row among a group of rows that have the same primary key."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"CREATE TABLE employee_new\nPRIMARY KEY(order_id)\nAS SELECT\n    order_list.order_id,\n    sum(goods.price) as total\nFROM order_list INNER JOIN goods ON goods.item_id1 = order_list.item_id2\nGROUP BY order_id;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Example 5: Synchronously query four tables, including ",(0,s.jsx)(n.code,{children:"lineorder"}),", ",(0,s.jsx)(n.code,{children:"customer"}),", ",(0,s.jsx)(n.code,{children:"supplier"}),", and ",(0,s.jsx)(n.code,{children:"part"})," and create a new table ",(0,s.jsx)(n.code,{children:"lineorder_flat"})," based on the query result, and then insert the query result to the new table. Additionally, specify the partitioning method and bucketing method for the new table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'CREATE TABLE lineorder_flat\nPARTITION BY RANGE(`LO_ORDERDATE`)\n(\n    START ("1993-01-01") END ("1999-01-01") EVERY (INTERVAL 1 YEAR)\n)\nDISTRIBUTED BY HASH(`LO_ORDERKEY`) AS SELECT\n    l.LO_ORDERKEY AS LO_ORDERKEY,\n    l.LO_LINENUMBER AS LO_LINENUMBER,\n    l.LO_CUSTKEY AS LO_CUSTKEY,\n    l.LO_PARTKEY AS LO_PARTKEY,\n    l.LO_SUPPKEY AS LO_SUPPKEY,\n    l.LO_ORDERDATE AS LO_ORDERDATE,\n    l.LO_ORDERPRIORITY AS LO_ORDERPRIORITY,\n    l.LO_SHIPPRIORITY AS LO_SHIPPRIORITY,\n    l.LO_QUANTITY AS LO_QUANTITY,\n    l.LO_EXTENDEDPRICE AS LO_EXTENDEDPRICE,\n    l.LO_ORDTOTALPRICE AS LO_ORDTOTALPRICE,\n    l.LO_DISCOUNT AS LO_DISCOUNT,\n    l.LO_REVENUE AS LO_REVENUE,\n    l.LO_SUPPLYCOST AS LO_SUPPLYCOST,\n    l.LO_TAX AS LO_TAX,\n    l.LO_COMMITDATE AS LO_COMMITDATE,\n    l.LO_SHIPMODE AS LO_SHIPMODE,\n    c.C_NAME AS C_NAME,\n    c.C_ADDRESS AS C_ADDRESS,\n    c.C_CITY AS C_CITY,\n    c.C_NATION AS C_NATION,\n    c.C_REGION AS C_REGION,\n    c.C_PHONE AS C_PHONE,\n    c.C_MKTSEGMENT AS C_MKTSEGMENT,\n    s.S_NAME AS S_NAME,\n    s.S_ADDRESS AS S_ADDRESS,\n    s.S_CITY AS S_CITY,\n    s.S_NATION AS S_NATION,\n    s.S_REGION AS S_REGION,\n    s.S_PHONE AS S_PHONE,\n    p.P_NAME AS P_NAME,\n    p.P_MFGR AS P_MFGR,\n    p.P_CATEGORY AS P_CATEGORY,\n    p.P_BRAND AS P_BRAND,\n    p.P_COLOR AS P_COLOR,\n    p.P_TYPE AS P_TYPE,\n    p.P_SIZE AS P_SIZE,\n    p.P_CONTAINER AS P_CONTAINER FROM lineorder AS l\nINNER JOIN customer AS c ON c.C_CUSTKEY = l.LO_CUSTKEY\nINNER JOIN supplier AS s ON s.S_SUPPKEY = l.LO_SUPPKEY\nINNER JOIN part AS p ON p.P_PARTKEY = l.LO_PARTKEY;\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Example 6: Asynchronously query the table ",(0,s.jsx)(n.code,{children:"order_detail"})," and create a new table ",(0,s.jsx)(n.code,{children:"order_statistics"})," based on the query result, and then insert the query result into the new table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"SUBMIT TASK AS CREATE TABLE order_statistics AS SELECT COUNT(*) as count FROM order_detail;\n\n+-------------------------------------------+-----------+\n| TaskName                                  | Status    |\n+-------------------------------------------+-----------+\n| ctas-df6f7930-e7c9-11ec-abac-bab8ee315bf2 | SUBMITTED |\n+-------------------------------------------+-----------+\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check information of the Task."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM INFORMATION_SCHEMA.tasks;\n\n-- Information of the Task\n\nTASK_NAME: ctas-df6f7930-e7c9-11ec-abac-bab8ee315bf2\nCREATE_TIME: 2022-06-14 14:07:06\nSCHEDULE: MANUAL\nDATABASE: default_cluster:test\nDEFINITION: CREATE TABLE order_statistics AS SELECT COUNT(*) as cnt FROM order_detail\nEXPIRE_TIME: 2022-06-17 14:07:06\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check the state of the TaskRun."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM INFORMATION_SCHEMA.task_runs;\n\n-- State of the TaskRun\n\nQUERY_ID: 37bd2b63-eba8-11ec-8d41-bab8ee315bf2\nTASK_NAME: ctas-df6f7930-e7c9-11ec-abac-bab8ee315bf2\nCREATE_TIME: 2022-06-14 14:07:06\nFINISH_TIME: 2022-06-14 14:07:07\nSTATE: SUCCESS\nDATABASE: \nDEFINITION: CREATE TABLE order_statistics AS SELECT COUNT(*) as cnt FROM order_detail\nEXPIRE_TIME: 2022-06-17 14:07:06\nERROR_CODE: 0\nERROR_MESSAGE: NULL\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Query the new table when the state of the TaskRun is ",(0,s.jsx)(n.code,{children:"SUCCESS"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM order_statistics;\n"})})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(o,e)})):o(e)}},11151:(e,n,t)=>{t.d(n,{Zo:()=>d,ah:()=>r});var s=t(67294);const a=s.createContext({});function r(e){const n=s.useContext(a);return s.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const l={};function d({components:e,children:n,disableParentContext:t}){let d;return d=t?"function"==typeof e?e({}):e||l:r(e),s.createElement(a.Provider,{value:d},n)}}}]);