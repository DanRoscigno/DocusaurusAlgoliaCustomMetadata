"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[13971],{85986:(e,n,a)=>{a.d(n,{ZP:()=>i});var s=a(85893),t=a(11151);function r(e){const n=Object.assign({blockquote:"blockquote",p:"p",strong:"strong",a:"a"},(0,t.ah)(),e.components);return(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTICE"})}),"\n",(0,s.jsxs)(n.p,{children:["You can load data into StarRocks tables only as a user who has the INSERT privilege on those StarRocks tables. If you do not have the INSERT privilege, follow the instructions provided in ",(0,s.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/account-management/GRANT",children:"GRANT"})," to grant the INSERT privilege to the user that you use to connect to your StarRocks cluster."]}),"\n"]})}const i=function(e={}){const{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(r,e)})):r(e)}},68301:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var s=a(85893),t=a(11151),r=a(85986);const i={displayed_sidebar:"English"},o="Load data from S3",l={id:"loading/s3",title:"Load data from S3",description:"StarRocks provides two options for loading data from S3:",source:"@site/versioned_docs/version-3.1/loading/s3.md",sourceDirName:"loading",slug:"/loading/s3",permalink:"/docs/loading/s3",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/edit/main/docs/loading/s3.md",tags:[],version:"3.1",frontMatter:{displayed_sidebar:"English"},sidebar:"English"},d={},c=[{value:"Using Broker Load",id:"using-broker-load",level:2},{value:"Advantages of Broker Load",id:"advantages-of-broker-load",level:3},{value:"Data flow",id:"data-flow",level:3},{value:"Typical example",id:"typical-example",level:3},{value:"Create a table",id:"create-a-table",level:4},{value:"Gather connection details",id:"gather-connection-details",level:4},{value:"Start a Broker Load",id:"start-a-broker-load",level:4},{value:"Check progress",id:"check-progress",level:4},{value:"Using the <code>FILES()</code> table function",id:"using-the-files-table-function",level:2},{value:"<code>FILES()</code> advantages",id:"files-advantages",level:3},{value:"Typical examples",id:"typical-examples",level:3},{value:"Querying directly from S3",id:"querying-directly-from-s3",level:4},{value:"Creating a table with schema inference",id:"creating-a-table-with-schema-inference",level:4},{value:"Loading into an existing table",id:"loading-into-an-existing-table",level:4},{value:"More information",id:"more-information",level:2}];function h(e){const n=Object.assign({h1:"h1",p:"p",ol:"ol",li:"li",code:"code",h2:"h2",h3:"h3",ul:"ul",img:"img",blockquote:"blockquote",strong:"strong",h4:"h4",pre:"pre",a:"a"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"load-data-from-s3",children:"Load data from S3"}),"\n","\n","\n",(0,s.jsx)(n.p,{children:"StarRocks provides two options for loading data from S3:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Asynchronous loading using Broker Load"}),"\n",(0,s.jsxs)(n.li,{children:["Synchronous loading using the ",(0,s.jsx)(n.code,{children:"FILES()"})," table function"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Small datasets are often loaded synchronously using the ",(0,s.jsx)(n.code,{children:"FILES()"})," table function, and large datasets are often loaded asynchronously using Broker Load. The two methods have different advantages and are described below."]}),"\n",(0,s.jsx)(r.ZP,{}),"\n",(0,s.jsx)(n.h2,{id:"using-broker-load",children:"Using Broker Load"}),"\n",(0,s.jsx)(n.p,{children:"An asynchronous Broker Load process handles making the connection to S3, pulling the data, and storing the data in StarRocks."}),"\n",(0,s.jsx)(n.h3,{id:"advantages-of-broker-load",children:"Advantages of Broker Load"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Broker Load supports data transformation, UPSERT, and DELETE operations during loading."}),"\n",(0,s.jsx)(n.li,{children:"Broker Load runs in the background and clients don't need to stay connected for the job to continue."}),"\n",(0,s.jsx)(n.li,{children:"Broker Load is preferred for long running jobs, the default timeout is 4 hours."}),"\n",(0,s.jsx)(n.li,{children:"In addition to Parquet and ORC file format, Broker Load supports CSV files."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"data-flow",children:"Data flow"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Workflow of Broker Load",src:a(26103).Z+"",width:"1478",height:"1064"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The user creates a load job."}),"\n",(0,s.jsx)(n.li,{children:"The frontend (FE) creates a query plan and distributes the plan to the backend nodes (BE)."}),"\n",(0,s.jsx)(n.li,{children:"The backend (BE) nodes pull the data from the source and load the data into StarRocks."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-example",children:"Typical example"}),"\n",(0,s.jsx)(n.p,{children:"Create a table, start a load process that pulls a Parquet file from S3, and verify the progress and success of the data loading."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsx)(n.p,{children:"The examples use a sample dataset in Parquet format, if you want to load a CSV or ORC file, that information is linked at the bottom of this page."}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"create-a-table",children:"Create a table"}),"\n",(0,s.jsx)(n.p,{children:"Create a database for your table:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"CREATE DATABASE IF NOT EXISTS project;\nUSE project;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create a table. This schema matches a sample dataset in an S3 bucket hosted in a StarRocks account."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'DROP TABLE IF EXISTS user_behavior;\n\nCREATE TABLE `user_behavior` (\n    `UserID` int(11),\n    `ItemID` int(11),\n    `CategoryID` int(11),\n    `BehaviorType` varchar(65533),\n    `Timestamp` datetime\n) ENGINE=OLAP \nDUPLICATE KEY(`UserID`)\nDISTRIBUTED BY HASH(`UserID`)\nPROPERTIES (\n    "replication_num" = "1"\n);\n'})}),"\n",(0,s.jsx)(n.h4,{id:"gather-connection-details",children:"Gather connection details"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsx)(n.p,{children:"The examples use IAM user-based authentication. Other authentication methods are available and linked at the bottom of this page."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Loading data from S3 requires having the:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"S3 bucket"}),"\n",(0,s.jsxs)(n.li,{children:["S3 object keys (object names) if accessing a specific object in the bucket. Note that the object key can include a prefix if your S3 objects are stored in sub-folders. The full syntax is linked in ",(0,s.jsx)(n.strong,{children:"more information"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"S3 region"}),"\n",(0,s.jsx)(n.li,{children:"Access key and secret"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"start-a-broker-load",children:"Start a Broker Load"}),"\n",(0,s.jsx)(n.p,{children:"This job has four main sections:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"LABEL"}),": A string used when querying the state of a ",(0,s.jsx)(n.code,{children:"LOAD"})," job."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"LOAD"})," declaration: The source URI, destination table, and the source data format."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"BROKER"}),": The connection details for the source."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PROPERTIES"}),": Timeout value and any other properties to apply to this job."]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsxs)(n.p,{children:["The dataset used in these examples is hosted in an S3 bucket in a StarRocks account. Any valid ",(0,s.jsx)(n.code,{children:"aws.s3.access_key"})," and ",(0,s.jsx)(n.code,{children:"aws.s3.secret_key"})," can be used, as the object is readable by any AWS authenticated user. Substitute your credentials for ",(0,s.jsx)(n.code,{children:"AAA"})," and ",(0,s.jsx)(n.code,{children:"BBB"})," in the commands below."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'LOAD LABEL user_behavior\n(\n    DATA INFILE("s3://starrocks-datasets/user_behavior_sample_data.parquet")\n    INTO TABLE user_behavior\n    FORMAT AS "parquet"\n )\n WITH BROKER\n (\n    "aws.s3.enable_ssl" = "true",\n    "aws.s3.use_instance_profile" = "false",\n    "aws.s3.region" = "us-west-1",\n    "aws.s3.access_key" = "AAAAAAAAAAAAAAAAAAAA",\n    "aws.s3.secret_key" = "BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB"\n )\nPROPERTIES\n(\n    "timeout" = "72000"\n);\n'})}),"\n",(0,s.jsx)(n.h4,{id:"check-progress",children:"Check progress"}),"\n",(0,s.jsxs)(n.p,{children:["Query the ",(0,s.jsx)(n.code,{children:"information_schema.loads"})," table to track progress. If you have multiple ",(0,s.jsx)(n.code,{children:"LOAD"})," jobs running you can filter on the ",(0,s.jsx)(n.code,{children:"LABEL"})," associated with the job. In the output below there are two entries for the load job ",(0,s.jsx)(n.code,{children:"user_behavior"}),". The first record shows a state of ",(0,s.jsx)(n.code,{children:"CANCELLED"}),"; scroll to the end of the output, and you see that ",(0,s.jsx)(n.code,{children:"listPath failed"}),". The second record shows success with a valid AWS IAM access key and secret."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM information_schema.loads;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM information_schema.loads WHERE LABEL = 'user_behavior';\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:'JOB_ID|LABEL                                      |DATABASE_NAME|STATE    |PROGRESS           |TYPE  |PRIORITY|SCAN_ROWS|FILTERED_ROWS|UNSELECTED_ROWS|SINK_ROWS|ETL_INFO|TASK_INFO                                           |CREATE_TIME        |ETL_START_TIME     |ETL_FINISH_TIME    |LOAD_START_TIME    |LOAD_FINISH_TIME   |JOB_DETAILS                                                                                                                                                                                                                                                    |ERROR_MSG                             |TRACKING_URL|TRACKING_SQL|REJECTED_RECORD_PATH|\n------+-------------------------------------------+-------------+---------+-------------------+------+--------+---------+-------------+---------------+---------+--------+----------------------------------------------------+-------------------+-------------------+-------------------+-------------------+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+------------+--------------------+\n 10121|user_behavior                              |project      |CANCELLED|ETL:N/A; LOAD:N/A  |BROKER|NORMAL  |        0|            0|              0|        0|        |resource:N/A; timeout(s):72000; max_filter_ratio:0.0|2023-08-10 14:59:30|                   |                   |                   |2023-08-10 14:59:34|{"All backends":{},"FileNumber":0,"FileSize":0,"InternalTableLoadBytes":0,"InternalTableLoadRows":0,"ScanBytes":0,"ScanRows":0,"TaskNumber":0,"Unfinished backends":{}}                                                                                        |type:ETL_RUN_FAIL; msg:listPath failed|            |            |                    |\n 10106|user_behavior                              |project      |FINISHED |ETL:100%; LOAD:100%|BROKER|NORMAL  | 86953525|            0|              0| 86953525|        |resource:N/A; timeout(s):72000; max_filter_ratio:0.0|2023-08-10 14:50:15|2023-08-10 14:50:19|2023-08-10 14:50:19|2023-08-10 14:50:19|2023-08-10 14:55:10|{"All backends":{"a5fe5e1d-d7d0-4826-ba99-c7348f9a5f2f":[10004]},"FileNumber":1,"FileSize":1225637388,"InternalTableLoadBytes":2710603082,"InternalTableLoadRows":86953525,"ScanBytes":1225637388,"ScanRows":86953525,"TaskNumber":1,"Unfinished backends":{"a5|                                      |            |            |                    |\n'})}),"\n",(0,s.jsx)(n.p,{children:"You can also check a subset of the data at this point."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * from user_behavior LIMIT 10;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"UserID|ItemID|CategoryID|BehaviorType|Timestamp          |\n------+------+----------+------------+-------------------+\n171146| 68873|   3002561|pv          |2017-11-30 07:11:14|\n171146|146539|   4672807|pv          |2017-11-27 09:51:41|\n171146|146539|   4672807|pv          |2017-11-27 14:08:33|\n171146|214198|   1320293|pv          |2017-11-25 22:38:27|\n171146|260659|   4756105|pv          |2017-11-30 05:11:25|\n171146|267617|   4565874|pv          |2017-11-27 14:01:25|\n171146|329115|   2858794|pv          |2017-12-01 02:10:51|\n171146|458604|   1349561|pv          |2017-11-25 22:49:39|\n171146|458604|   1349561|pv          |2017-11-27 14:03:44|\n171146|478802|    541347|pv          |2017-12-02 04:52:39|\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"using-the-files-table-function",children:["Using the ",(0,s.jsx)(n.code,{children:"FILES()"})," table function"]}),"\n",(0,s.jsxs)(n.h3,{id:"files-advantages",children:[(0,s.jsx)(n.code,{children:"FILES()"})," advantages"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"FILES()"})," can infer the data types of the columns of the Parquet data and generate the schema for a StarRocks table. This provides the ability to query the file directly from S3 with a ",(0,s.jsx)(n.code,{children:"SELECT"})," or to have StarRocks automatically create a table for you based on the Parquet file schema."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsx)(n.p,{children:"Schema inference is a new feature in version 3.1 and is provided for Parquet format only and nested types are not yet supported."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-examples",children:"Typical examples"}),"\n",(0,s.jsxs)(n.p,{children:["There are three examples using the ",(0,s.jsx)(n.code,{children:"FILES()"})," table function:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Querying the data directly from S3"}),"\n",(0,s.jsx)(n.li,{children:"Creating and loading the table using schema inference"}),"\n",(0,s.jsx)(n.li,{children:"Creating a table by hand and then loading the data"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsxs)(n.p,{children:["The dataset used in these examples is hosted in an S3 bucket in a StarRocks account. Any valid ",(0,s.jsx)(n.code,{children:"aws.s3.access_key"})," and ",(0,s.jsx)(n.code,{children:"aws.s3.secret_key"})," can be used, as the object is readable by any AWS authenticated user. Substitute your credentials for ",(0,s.jsx)(n.code,{children:"AAA"})," and ",(0,s.jsx)(n.code,{children:"BBB"})," in the commands below."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"querying-directly-from-s3",children:"Querying directly from S3"}),"\n",(0,s.jsxs)(n.p,{children:["Querying directly from S3 using ",(0,s.jsx)(n.code,{children:"FILES()"})," can gives a good preview of the content of a dataset before you create a table. For example:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Get a preview of the dataset without storing the data."}),"\n",(0,s.jsx)(n.li,{children:"Query for the min and max values and decide what data types to use."}),"\n",(0,s.jsx)(n.li,{children:"Check for nulls."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'SELECT * FROM FILES(\n    "path" = "s3://starrocks-datasets/user_behavior_sample_data.parquet",\n    "format" = "parquet",\n    "aws.s3.region" = "us-west-1",\n    "aws.s3.access_key" = "AAAAAAAAAAAAAAAAAAAA",\n    "aws.s3.secret_key" = "BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB"\n) LIMIT 10;\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsx)(n.p,{children:"Notice that the column names are provided by the Parquet file."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"UserID|ItemID |CategoryID|BehaviorType|Timestamp          |\n------+-------+----------+------------+-------------------+\n     1|2576651|    149192|pv          |2017-11-25 01:21:25|\n     1|3830808|   4181361|pv          |2017-11-25 07:04:53|\n     1|4365585|   2520377|pv          |2017-11-25 07:49:06|\n     1|4606018|   2735466|pv          |2017-11-25 13:28:01|\n     1| 230380|    411153|pv          |2017-11-25 21:22:22|\n     1|3827899|   2920476|pv          |2017-11-26 16:24:33|\n     1|3745169|   2891509|pv          |2017-11-26 19:44:31|\n     1|1531036|   2920476|pv          |2017-11-26 22:02:12|\n     1|2266567|   4145813|pv          |2017-11-27 00:11:11|\n     1|2951368|   1080785|pv          |2017-11-27 02:47:08|\n"})}),"\n",(0,s.jsx)(n.h4,{id:"creating-a-table-with-schema-inference",children:"Creating a table with schema inference"}),"\n",(0,s.jsxs)(n.p,{children:["This is a continuation of the previous example; the previous query is wrapped in ",(0,s.jsx)(n.code,{children:"CREATE TABLE"})," to automate the table creation using schema inference. The column names and types are not required to create a table when using the ",(0,s.jsx)(n.code,{children:"FILES()"})," table function with Parquet files as the Parquet format includes the column names and types and StarRocks will infer the schema."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsxs)(n.p,{children:["The syntax of ",(0,s.jsx)(n.code,{children:"CREATE TABLE"})," when using schema inference does not allow setting the number of replicas, so set it before creating the table. The example below is for a system with a single replica:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"ADMIN SET FRONTEND CONFIG ('default_replication_num' =\"1\");"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE DATABASE IF NOT EXISTS project;\nUSE project;\n\nCREATE TABLE `user_behavior_inferred` AS\nSELECT * FROM FILES(\n    "path" = "s3://starrocks-datasets/user_behavior_sample_data.parquet",\n    "format" = "parquet",\n    "aws.s3.region" = "us-west-1",\n    "aws.s3.access_key" = "AAAAAAAAAAAAAAAAAAAA",\n    "aws.s3.secret_key" = "BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB"\n);\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"DESCRIBE user_behavior_inferred;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"Field       |Type            |Null|Key  |Default|Extra|\n------------+----------------+----+-----+-------+-----+\nUserID      |bigint          |YES |true |       |     |\nItemID      |bigint          |YES |true |       |     |\nCategoryID  |bigint          |YES |true |       |     |\nBehaviorType|varchar(1048576)|YES |false|       |     |\nTimestamp   |varchar(1048576)|YES |false|       |     |\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsx)(n.p,{children:"Compare the inferred schema with the schema created by hand:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"data types"}),"\n",(0,s.jsx)(n.li,{children:"nullable"}),"\n",(0,s.jsx)(n.li,{children:"key fields"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"SELECT * from user_behavior_inferred LIMIT 10;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"UserID|ItemID|CategoryID|BehaviorType|Timestamp          |\n------+------+----------+------------+-------------------+\n171146| 68873|   3002561|pv          |2017-11-30 07:11:14|\n171146|146539|   4672807|pv          |2017-11-27 09:51:41|\n171146|146539|   4672807|pv          |2017-11-27 14:08:33|\n171146|214198|   1320293|pv          |2017-11-25 22:38:27|\n171146|260659|   4756105|pv          |2017-11-30 05:11:25|\n171146|267617|   4565874|pv          |2017-11-27 14:01:25|\n171146|329115|   2858794|pv          |2017-12-01 02:10:51|\n171146|458604|   1349561|pv          |2017-11-25 22:49:39|\n171146|458604|   1349561|pv          |2017-11-27 14:03:44|\n171146|478802|    541347|pv          |2017-12-02 04:52:39|\n"})}),"\n",(0,s.jsx)(n.h4,{id:"loading-into-an-existing-table",children:"Loading into an existing table"}),"\n",(0,s.jsx)(n.p,{children:"You may want to customize the table that you are inserting into, for example the:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"column data type, nullable setting, or default values"}),"\n",(0,s.jsx)(n.li,{children:"key types and columns"}),"\n",(0,s.jsx)(n.li,{children:"distribution"}),"\n",(0,s.jsx)(n.li,{children:"etc."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,s.jsxs)(n.p,{children:["Creating the most efficient table structure requires knowledge of how the data will be used and the content of the columns. This document does not cover table design, there is a link in ",(0,s.jsx)(n.strong,{children:"more information"})," at the end of the page."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In this example we are creating a table based on knowledge of how the table will be queried and the data in the Parquet file. The knowledge of the data in the Parquet file can be gained by querying the file directly in S3."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Since a query of the file in S3 indicates that the ",(0,s.jsx)(n.code,{children:"Timestamp"})," column contains data that matches a ",(0,s.jsx)(n.code,{children:"datetime"})," data type the column type is specified in the following DDL."]}),"\n",(0,s.jsx)(n.li,{children:"By querying the data in S3 you can find that there are no null values in the dataset, so the DDL does not set any columns as nullable."}),"\n",(0,s.jsxs)(n.li,{children:["Based on knowledge of the expected query types, the sort key and bucketing column are set to the column ",(0,s.jsx)(n.code,{children:"UserID"})," (your use case might be different for this data, you might decide to use ",(0,s.jsx)(n.code,{children:"ItemID"})," in addition to or instead of ",(0,s.jsx)(n.code,{children:"UserID"})," for the sort key:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'CREATE TABLE `user_behavior_declared` (\n    `UserID` int(11),\n    `ItemID` int(11),\n    `CategoryID` int(11),\n    `BehaviorType` varchar(65533),\n    `Timestamp` datetime\n) ENGINE=OLAP \nDUPLICATE KEY(`UserID`)\nDISTRIBUTED BY HASH(`UserID`)\nPROPERTIES (\n    "replication_num" = "1"\n);\n'})}),"\n",(0,s.jsxs)(n.p,{children:["After creating the table, you can load it with ",(0,s.jsx)(n.code,{children:"INSERT INTO"})," \u2026 ",(0,s.jsx)(n.code,{children:"SELECT FROM FILES()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:'INSERT INTO user_behavior_declared\n  SELECT * FROM FILES(\n    "path" = "s3://starrocks-datasets/user_behavior_sample_data.parquet",\n    "format" = "parquet",\n    "aws.s3.region" = "us-west-1",\n    "aws.s3.access_key" = "AAAAAAAAAAAAAAAAAAAA",\n    "aws.s3.secret_key" = "BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB"\n);\n'})}),"\n",(0,s.jsx)(n.h2,{id:"more-information",children:"More information"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For more details on synchronous and asynchronous data loading please see the ",(0,s.jsx)(n.a,{href:"/docs/loading/Loading_intro",children:"overview of data loading"})," documentation."]}),"\n",(0,s.jsxs)(n.li,{children:["Learn about how Broker Load supports data transformation during loading at ",(0,s.jsx)(n.a,{href:"/docs/loading/Etl_in_loading",children:"Transform data at loading"})," and ",(0,s.jsx)(n.a,{href:"/docs/loading/Load_to_Primary_Key_tables",children:"Change data through loading"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["This document only covered IAM user-based authentication. For other options please see ",(0,s.jsx)(n.a,{href:"/docs/integrations/authenticate_to_aws_resources",children:"authenticate to AWS resources"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.a,{href:"https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3/index.html",children:"AWS CLI Command Reference"})," covers the S3 URI in detail."]}),"\n",(0,s.jsxs)(n.li,{children:["Learn more about ",(0,s.jsx)(n.a,{href:"/docs/table_design/StarRocks_table_design",children:"table design"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Broker Load provides many more configuration and use options than those in the above examples, the details are in ",(0,s.jsx)(n.a,{href:"/docs/sql-reference/sql-statements/data-manipulation/BROKER_LOAD",children:"Broker Load"})]}),"\n"]})]})}const u=function(e={}){const{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(h,e)})):h(e)}},26103:(e,n,a)=>{a.d(n,{Z:()=>s});const s=a.p+"assets/images/broker_load_how-to-work_en-6132d562d6e87eac4b5c0e494ffdb34d.png"},11151:(e,n,a)=>{a.d(n,{Zo:()=>o,ah:()=>r});var s=a(67294);const t=s.createContext({});function r(e){const n=s.useContext(t);return s.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const i={};function o({components:e,children:n,disableParentContext:a}){let o;return o=a?"function"==typeof e?e({}):e||i:r(e),s.createElement(t.Provider,{value:o},n)}}}]);