"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[60708],{81720:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var i=r(85893),t=r(11151);const s={displayed_sidebar:"English"},a="Query rewrite with materialized views",o={id:"using_starrocks/query_rewrite_with_materialized_views",title:"Query rewrite with materialized views",description:"This topic describes how to leverage StarRocks' asynchronous materialized views to rewrite and accelerate queries.",source:"@site/versioned_docs/version-3.0/using_starrocks/query_rewrite_with_materialized_views.md",sourceDirName:"using_starrocks",slug:"/using_starrocks/query_rewrite_with_materialized_views",permalink:"/doc/docs/3.0/using_starrocks/query_rewrite_with_materialized_views",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/edit/main/docs/using_starrocks/query_rewrite_with_materialized_views.md",tags:[],version:"3.0",frontMatter:{displayed_sidebar:"English"},sidebar:"English",previous:{title:"Query Cache",permalink:"/doc/docs/3.0/using_starrocks/query_cache"},next:{title:"Sorted streaming aggregate",permalink:"/doc/docs/3.0/using_starrocks/sorted_aggregate"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"Features",id:"features",level:3},{value:"Join rewrite",id:"join-rewrite",level:2},{value:"Query Delta Join rewrite",id:"query-delta-join-rewrite",level:3},{value:"View Delta Join rewrite",id:"view-delta-join-rewrite",level:3},{value:"Join Derivability rewrite",id:"join-derivability-rewrite",level:3},{value:"Aggregation rewrite",id:"aggregation-rewrite",level:2},{value:"Aggregation Rollup rewrite",id:"aggregation-rollup-rewrite",level:3},{value:"COUNT DISTINCT rewrite",id:"count-distinct-rewrite",level:3},{value:"Nested materialized view rewrite",id:"nested-materialized-view-rewrite",level:2},{value:"Union rewrite",id:"union-rewrite",level:2},{value:"Predicate Union rewrite",id:"predicate-union-rewrite",level:3},{value:"Partition Union rewrite",id:"partition-union-rewrite",level:3},{value:"View-based materialized view rewrite",id:"view-based-materialized-view-rewrite",level:2},{value:"External catalog-based materialized view rewrite",id:"external-catalog-based-materialized-view-rewrite",level:2},{value:"Configure query rewrite",id:"configure-query-rewrite",level:2},{value:"Check if a query is rewritten",id:"check-if-a-query-is-rewritten",level:2},{value:"Disable query rewrite",id:"disable-query-rewrite",level:2},{value:"Limitations",id:"limitations",level:2}];function c(e){const n=Object.assign({h1:"h1",p:"p",h2:"h2",ul:"ul",li:"li",strong:"strong",blockquote:"blockquote",h3:"h3",pre:"pre",code:"code",img:"img",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",a:"a"},(0,t.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"query-rewrite-with-materialized-views",children:"Query rewrite with materialized views"}),"\n",(0,i.jsx)(n.p,{children:"This topic describes how to leverage StarRocks' asynchronous materialized views to rewrite and accelerate queries."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks' asynchronous materialized view uses a widely adopted transparent query rewrite algorithm based on the SPJG (select-project-join-group-by) form. Without the need to modify the query statement, StarRocks can automatically rewrite queries against the base tables into queries against the corresponding materialized view that contains the pre-computed results. As a result, materialized views can help you significantly reduce computational costs, and substantially accelerate query execution."}),"\n",(0,i.jsx)(n.p,{children:"The query rewrite feature based on asynchronous materialized views is particularly useful in the following scenarios:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pre-aggregation of metrics"})}),"\n",(0,i.jsx)(n.p,{children:"You can use materialized views to create a pre-aggregated metric layer if you are dealing with a high dimensionality of data."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Joins of wide tables"})}),"\n",(0,i.jsx)(n.p,{children:"Materialized views allow you to transparently accelerate queries with joins of multiple large wide tables in complex scenarios."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Query acceleration in the data lake"})}),"\n",(0,i.jsx)(n.p,{children:"Building an external catalog-based materialized view can easily accelerate queries against data in your data lake."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,i.jsx)(n.p,{children:"Asynchronous materialized views created on base tables in a JDBC catalog do not support query rewrite."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"features",children:"Features"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks' asynchronous materialized view-based automatic query rewrite features the following attributes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Strong data consistency"}),": If the base tables are native tables, StarRocks ensures that the results obtained through the materialized view-based query rewrite are consistent with the results returned from the direct query against the base tables."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Staleness rewrite"}),": StarRocks supports staleness rewrite, allowing you to tolerate a certain level of data expiration to cope with scenarios with frequent data changes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multi-table joins"}),": StarRocks' asynchronous materialized view supports various types of joins, including some complex join scenarios like View Delta Joins and Derivable Joins, allowing you to accelerate queries in scenarios involving large wide tables."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Aggregation rewrite"}),": StarRocks can rewrite queries with aggregations to improve report performance."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nested materialized view"}),": StarRocks supports rewriting complex queries based on nested materialized views, expanding the scope of queries that can be rewritten."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Union rewrite"}),": You can combine the Union rewrite feature with the TTL (Time-to-Live) of the materialized view's partitions to achieve the separation of the hot and cold data, which allows you to query hot data from materialized views and historical data from the base table."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Materialized views on views"}),": You can accelerate the queries in scenarios with data modeling based on views."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Materialized views on external catalogs"}),": You can accelerate queries in data lakes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Complex expression rewrite"}),": It can handle complex expressions, including function calls and arithmetic operations, catering to advanced analytical and calculation requirements."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These features will be elaborated in the following sections."}),"\n",(0,i.jsx)(n.h2,{id:"join-rewrite",children:"Join rewrite"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks supports rewriting queries with various types of joins, including Inner Join, Cross Join, Left Outer Join, Full Outer Join, Right Outer Join, Semi Join, and Anti Join."}),"\n",(0,i.jsx)(n.p,{children:"The following is an example of rewriting queries with joins. Create two base tables as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE TABLE customer (\n  c_custkey     INT(11)     NOT NULL,\n  c_name        VARCHAR(26) NOT NULL,\n  c_address     VARCHAR(41) NOT NULL,\n  c_city        VARCHAR(11) NOT NULL,\n  c_nation      VARCHAR(16) NOT NULL,\n  c_region      VARCHAR(13) NOT NULL,\n  c_phone       VARCHAR(16) NOT NULL,\n  c_mktsegment  VARCHAR(11) NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(c_custkey)\nDISTRIBUTED BY HASH(c_custkey) BUCKETS 12;\n\nCREATE TABLE lineorder (\n  lo_orderkey         INT(11) NOT NULL,\n  lo_linenumber       INT(11) NOT NULL,\n  lo_custkey          INT(11) NOT NULL,\n  lo_partkey          INT(11) NOT NULL,\n  lo_suppkey          INT(11) NOT NULL,\n  lo_orderdate        INT(11) NOT NULL,\n  lo_orderpriority    VARCHAR(16) NOT NULL,\n  lo_shippriority     INT(11) NOT NULL,\n  lo_quantity         INT(11) NOT NULL,\n  lo_extendedprice    INT(11) NOT NULL,\n  lo_ordtotalprice    INT(11) NOT NULL,\n  lo_discount         INT(11) NOT NULL,\n  lo_revenue          INT(11) NOT NULL,\n  lo_supplycost       INT(11) NOT NULL,\n  lo_tax              INT(11) NOT NULL,\n  lo_commitdate       INT(11) NOT NULL,\n  lo_shipmode         VARCHAR(11) NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(lo_orderkey)\nDISTRIBUTED BY HASH(lo_orderkey) BUCKETS 48;\n"})}),"\n",(0,i.jsx)(n.p,{children:"With the above base tables, you can create a materialized view as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW join_mv1\nDISTRIBUTED BY HASH(lo_orderkey)\nAS\nSELECT lo_orderkey, lo_linenumber, lo_revenue, lo_partkey, c_name, c_address\nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Such a materialized view can rewrite the following query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT lo_orderkey, lo_linenumber, lo_revenue, c_name, c_address\nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-1",src:r(14073).Z+"",width:"1584",height:"476"})}),"\n",(0,i.jsx)(n.p,{children:"StarRocks supports rewriting join queries with complex expressions, such as arithmetic operations, string functions, date functions, CASE WHEN expressions, and OR predicates. For example, the above materialized view can rewrite the following query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT \n    lo_orderkey, \n    lo_linenumber, \n    (2 * lo_revenue + 1) * lo_linenumber, \n    upper(c_name), \n    substr(c_address, 3)\nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"In addition to the conventional scenario, StarRocks further supports rewriting join queries in more complicated scenarios."}),"\n",(0,i.jsx)(n.h3,{id:"query-delta-join-rewrite",children:"Query Delta Join rewrite"}),"\n",(0,i.jsxs)(n.p,{children:["Query Delta Join refers to a scenario in which the tables joined in a query are a superset of the tables joined in a materialized view. For instance, consider the following query that involves joins of three tables: ",(0,i.jsx)(n.code,{children:"lineorder"}),", ",(0,i.jsx)(n.code,{children:"customer"}),", and ",(0,i.jsx)(n.code,{children:"part"}),". If the materialized view ",(0,i.jsx)(n.code,{children:"join_mv1"})," contains only the join of ",(0,i.jsx)(n.code,{children:"lineorder"})," and ",(0,i.jsx)(n.code,{children:"customer"}),", StarRocks can rewrite the query using ",(0,i.jsx)(n.code,{children:"join_mv1"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT lo_orderkey, lo_linenumber, lo_revenue, c_name, c_address, p_name\nFROM\n    lineorder INNER JOIN customer ON lo_custkey = c_custkey\n    INNER JOIN part ON lo_partkey = p_partkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-2",src:r(67438).Z+"",width:"1280",height:"436"})}),"\n",(0,i.jsx)(n.h3,{id:"view-delta-join-rewrite",children:"View Delta Join rewrite"}),"\n",(0,i.jsx)(n.p,{children:"View Delta Join refers to a scenario in which the tables joined in a query are a subset of the tables joined in a materialized view. This feature is typically used in scenarios involving large wide tables. For example, in the context of the Star Schema Benchmark (SSB), you can create a materialized view that joins all tables to improve query performance. Through testing, it has been found that query performance for multi-table joins can achieve the same level of performance as querying the corresponding large wide table after transparently rewriting the queries through the materialized view."}),"\n",(0,i.jsx)(n.p,{children:"To perform a View Delta Join rewrite, the materialized view must contain the 1:1 cardinality preservation join that does not exist in the query. Here are the nine types of joins that are considered cardinality preservation joins, and satisfying any one of them enables View Delta Join rewriting:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-3",src:r(66169).Z+"",width:"2044",height:"2982"})}),"\n",(0,i.jsx)(n.p,{children:"Take SSB tests as an example, create the following base tables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:'CREATE TABLE customer (\n  c_custkey         INT(11)       NOT NULL,\n  c_name            VARCHAR(26)   NOT NULL,\n  c_address         VARCHAR(41)   NOT NULL,\n  c_city            VARCHAR(11)   NOT NULL,\n  c_nation          VARCHAR(16)   NOT NULL,\n  c_region          VARCHAR(13)   NOT NULL,\n  c_phone           VARCHAR(16)   NOT NULL,\n  c_mktsegment      VARCHAR(11)   NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(c_custkey)\nDISTRIBUTED BY HASH(c_custkey) BUCKETS 12\nPROPERTIES (\n"unique_constraints" = "c_custkey"   -- Specify the unique constraints.\n);\n\nCREATE TABLE dates (\n  d_datekey          DATE          NOT NULL,\n  d_date             VARCHAR(20)   NOT NULL,\n  d_dayofweek        VARCHAR(10)   NOT NULL,\n  d_month            VARCHAR(11)   NOT NULL,\n  d_year             INT(11)       NOT NULL,\n  d_yearmonthnum     INT(11)       NOT NULL,\n  d_yearmonth        VARCHAR(9)    NOT NULL,\n  d_daynuminweek     INT(11)       NOT NULL,\n  d_daynuminmonth    INT(11)       NOT NULL,\n  d_daynuminyear     INT(11)       NOT NULL,\n  d_monthnuminyear   INT(11)       NOT NULL,\n  d_weeknuminyear    INT(11)       NOT NULL,\n  d_sellingseason    VARCHAR(14)   NOT NULL,\n  d_lastdayinweekfl  INT(11)       NOT NULL,\n  d_lastdayinmonthfl INT(11)       NOT NULL,\n  d_holidayfl        INT(11)       NOT NULL,\n  d_weekdayfl        INT(11)       NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(d_datekey)\nDISTRIBUTED BY HASH(d_datekey) BUCKETS 1\nPROPERTIES (\n"unique_constraints" = "d_datekey"   -- Specify the unique constraints.\n);\n\nCREATE TABLE supplier (\n  s_suppkey          INT(11)       NOT NULL,\n  s_name             VARCHAR(26)   NOT NULL,\n  s_address          VARCHAR(26)   NOT NULL,\n  s_city             VARCHAR(11)   NOT NULL,\n  s_nation           VARCHAR(16)   NOT NULL,\n  s_region           VARCHAR(13)   NOT NULL,\n  s_phone            VARCHAR(16)   NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(s_suppkey)\nDISTRIBUTED BY HASH(s_suppkey) BUCKETS 12\nPROPERTIES (\n"unique_constraints" = "s_suppkey"   -- Specify the unique constraints.\n);\n\nCREATE TABLE part (\n  p_partkey          INT(11)       NOT NULL,\n  p_name             VARCHAR(23)   NOT NULL,\n  p_mfgr             VARCHAR(7)    NOT NULL,\n  p_category         VARCHAR(8)    NOT NULL,\n  p_brand            VARCHAR(10)   NOT NULL,\n  p_color            VARCHAR(12)   NOT NULL,\n  p_type             VARCHAR(26)   NOT NULL,\n  p_size             TINYINT(11)   NOT NULL,\n  p_container        VARCHAR(11)   NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(p_partkey)\nDISTRIBUTED BY HASH(p_partkey) BUCKETS 12\nPROPERTIES (\n"unique_constraints" = "p_partkey"   -- Specify the unique constraints.\n);\n\nCREATE TABLE lineorder (\n  lo_orderdate       DATE          NOT NULL, -- Specify it as NOT NULL.\n  lo_orderkey        INT(11)       NOT NULL,\n  lo_linenumber      TINYINT       NOT NULL,\n  lo_custkey         INT(11)       NOT NULL, -- Specify it as NOT NULL.\n  lo_partkey         INT(11)       NOT NULL, -- Specify it as NOT NULL.\n  lo_suppkey         INT(11)       NOT NULL, -- Specify it as NOT NULL.\n  lo_orderpriority   VARCHAR(100)  NOT NULL,\n  lo_shippriority    TINYINT       NOT NULL,\n  lo_quantity        TINYINT       NOT NULL,\n  lo_extendedprice   INT(11)       NOT NULL,\n  lo_ordtotalprice   INT(11)       NOT NULL,\n  lo_discount        TINYINT       NOT NULL,\n  lo_revenue         INT(11)       NOT NULL,\n  lo_supplycost      INT(11)       NOT NULL,\n  lo_tax             TINYINT       NOT NULL,\n  lo_commitdate      DATE          NOT NULL,\n  lo_shipmode        VARCHAR(100)  NOT NULL\n) ENGINE=OLAP\nDUPLICATE KEY(lo_orderdate,lo_orderkey)\nPARTITION BY RANGE(lo_orderdate)\n(PARTITION p1 VALUES [("0000-01-01"), ("1993-01-01")),\nPARTITION p2 VALUES [("1993-01-01"), ("1994-01-01")),\nPARTITION p3 VALUES [("1994-01-01"), ("1995-01-01")),\nPARTITION p4 VALUES [("1995-01-01"), ("1996-01-01")),\nPARTITION p5 VALUES [("1996-01-01"), ("1997-01-01")),\nPARTITION p6 VALUES [("1997-01-01"), ("1998-01-01")),\nPARTITION p7 VALUES [("1998-01-01"), ("1999-01-01")))\nDISTRIBUTED BY HASH(lo_orderkey) BUCKETS 48\nPROPERTIES (\n"foreign_key_constraints" = "\n    (lo_custkey) REFERENCES customer(c_custkey);\n    (lo_partkey) REFERENCES part(p_partkey);\n    (lo_suppkey) REFERENCES supplier(s_suppkey)" -- Specify the Foreign Keys.\n);\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Create the materialized view ",(0,i.jsx)(n.code,{children:"lineorder_flat_mv"})," that joins ",(0,i.jsx)(n.code,{children:"lineorder"}),", ",(0,i.jsx)(n.code,{children:"customer"}),", ",(0,i.jsx)(n.code,{children:"supplier"}),", ",(0,i.jsx)(n.code,{children:"part"}),", and ",(0,i.jsx)(n.code,{children:"dates"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:'CREATE MATERIALIZED VIEW lineorder_flat_mv\nDISTRIBUTED BY HASH(LO_ORDERDATE, LO_ORDERKEY) BUCKETS 48\nPARTITION BY LO_ORDERDATE\nREFRESH MANUAL\nPROPERTIES (\n    "session.partition_refresh_nubmer"="1"\n)\nAS SELECT /*+ SET_VAR(query_timeout = 7200) */     -- Set timeout for the refresh operation.\n       l.LO_ORDERDATE        AS LO_ORDERDATE,\n       l.LO_ORDERKEY         AS LO_ORDERKEY,\n       l.LO_LINENUMBER       AS LO_LINENUMBER,\n       l.LO_CUSTKEY          AS LO_CUSTKEY,\n       l.LO_PARTKEY          AS LO_PARTKEY,\n       l.LO_SUPPKEY          AS LO_SUPPKEY,\n       l.LO_ORDERPRIORITY    AS LO_ORDERPRIORITY,\n       l.LO_SHIPPRIORITY     AS LO_SHIPPRIORITY,\n       l.LO_QUANTITY         AS LO_QUANTITY,\n       l.LO_EXTENDEDPRICE    AS LO_EXTENDEDPRICE,\n       l.LO_ORDTOTALPRICE    AS LO_ORDTOTALPRICE,\n       l.LO_DISCOUNT         AS LO_DISCOUNT,\n       l.LO_REVENUE          AS LO_REVENUE,\n       l.LO_SUPPLYCOST       AS LO_SUPPLYCOST,\n       l.LO_TAX              AS LO_TAX,\n       l.LO_COMMITDATE       AS LO_COMMITDATE,\n       l.LO_SHIPMODE         AS LO_SHIPMODE,\n       c.C_NAME              AS C_NAME,\n       c.C_ADDRESS           AS C_ADDRESS,\n       c.C_CITY              AS C_CITY,\n       c.C_NATION            AS C_NATION,\n       c.C_REGION            AS C_REGION,\n       c.C_PHONE             AS C_PHONE,\n       c.C_MKTSEGMENT        AS C_MKTSEGMENT,\n       s.S_NAME              AS S_NAME,\n       s.S_ADDRESS           AS S_ADDRESS,\n       s.S_CITY              AS S_CITY,\n       s.S_NATION            AS S_NATION,\n       s.S_REGION            AS S_REGION,\n       s.S_PHONE             AS S_PHONE,\n       p.P_NAME              AS P_NAME,\n       p.P_MFGR              AS P_MFGR,\n       p.P_CATEGORY          AS P_CATEGORY,\n       p.P_BRAND             AS P_BRAND,\n       p.P_COLOR             AS P_COLOR,\n       p.P_TYPE              AS P_TYPE,\n       p.P_SIZE              AS P_SIZE,\n       p.P_CONTAINER         AS P_CONTAINER,\n       d.D_DATE              AS D_DATE,\n       d.D_DAYOFWEEK         AS D_DAYOFWEEK,\n       d.D_MONTH             AS D_MONTH,\n       d.D_YEAR              AS D_YEAR,\n       d.D_YEARMONTHNUM      AS D_YEARMONTHNUM,\n       d.D_YEARMONTH         AS D_YEARMONTH,\n       d.D_DAYNUMINWEEK      AS D_DAYNUMINWEEK,\n       d.D_DAYNUMINMONTH     AS D_DAYNUMINMONTH,\n       d.D_DAYNUMINYEAR      AS D_DAYNUMINYEAR,\n       d.D_MONTHNUMINYEAR    AS D_MONTHNUMINYEAR,\n       d.D_WEEKNUMINYEAR     AS D_WEEKNUMINYEAR,\n       d.D_SELLINGSEASON     AS D_SELLINGSEASON,\n       d.D_LASTDAYINWEEKFL   AS D_LASTDAYINWEEKFL,\n       d.D_LASTDAYINMONTHFL  AS D_LASTDAYINMONTHFL,\n       d.D_HOLIDAYFL         AS D_HOLIDAYFL,\n       d.D_WEEKDAYFL         AS D_WEEKDAYFL\n   FROM lineorder            AS l\n       INNER JOIN customer   AS c ON c.C_CUSTKEY = l.LO_CUSTKEY\n       INNER JOIN supplier   AS s ON s.S_SUPPKEY = l.LO_SUPPKEY\n       INNER JOIN part       AS p ON p.P_PARTKEY = l.LO_PARTKEY\n       INNER JOIN dates      AS d ON l.LO_ORDERDATE = d.D_DATEKEY;    \n'})}),"\n",(0,i.jsxs)(n.p,{children:["SSB Q2.1 involves joining four tables, but it lacks the ",(0,i.jsx)(n.code,{children:"customer"})," table compared to the materialized view ",(0,i.jsx)(n.code,{children:"lineorder_flat_mv"}),". In ",(0,i.jsx)(n.code,{children:"lineorder_flat_mv"}),", ",(0,i.jsx)(n.code,{children:"lineorder INNER JOIN customer"})," is essentially a cardinality preservation join. Therefore, logically, this join can be eliminated without affecting the query results. As a result, Q2.1 can be rewritten using ",(0,i.jsx)(n.code,{children:"lineorder_flat_mv"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"SSB Q2.1:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT sum(lo_revenue) AS lo_revenue, d_year, p_brand\nFROM lineorder\nJOIN dates ON lo_orderdate = d_datekey\nJOIN part ON lo_partkey = p_partkey\nJOIN supplier ON lo_suppkey = s_suppkey\nWHERE p_category = 'MFGR#12' AND s_region = 'AMERICA'\nGROUP BY d_year, p_brand\nORDER BY d_year, p_brand;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-4",src:r(1570).Z+"",width:"2062",height:"1442"})}),"\n",(0,i.jsxs)(n.p,{children:["Similarly, other queries in the SSB can also be transparently rewritten using ",(0,i.jsx)(n.code,{children:"lineorder_flat_mv"}),", thus optimizing query performance."]}),"\n",(0,i.jsx)(n.h3,{id:"join-derivability-rewrite",children:"Join Derivability rewrite"}),"\n",(0,i.jsx)(n.p,{children:"Join Derivability refers to a scenario in which the join types in the materialized view and the query are not consistent, but the materialized view's join results contain the results of the query's join. Currently, it supports two scenarios - joining three or more tables, and  joining two tables."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Scenario one: Joining three or more tables"})}),"\n",(0,i.jsxs)(n.p,{children:["Suppose the materialized view contains a Left Outer Join between tables ",(0,i.jsx)(n.code,{children:"t1"})," and ",(0,i.jsx)(n.code,{children:"t2"})," and an Inner Join between tables ",(0,i.jsx)(n.code,{children:"t2"})," and ",(0,i.jsx)(n.code,{children:"t3"}),". In both joins, the join condition includes columns from ",(0,i.jsx)(n.code,{children:"t2"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The query, on the other hand, contains an Inner Join between t1 and t2, and an Inner Join between t2 and t3. In both joins, the join condition includes columns from t2."}),"\n",(0,i.jsx)(n.p,{children:"In this case, the query can be rewritten using the materialized view. This is because in the materialized view, the Left Outer Join is executed first, followed by the Inner Join. The right table generated by the Left Outer Join has no results for the matching (that is, columns in the right table are NULL). These results are subsequently filtered out during the Inner Join. Therefore, the logic of the materialized view and the query is equivalent, and the query can be rewritten."}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsxs)(n.p,{children:["Create the materialized view ",(0,i.jsx)(n.code,{children:"join_mv5"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:'CREATE MATERIALIZED VIEW join_mv5\nPARTITION BY lo_orderdate\nDISTRIBUTED BY hash(lo_orderkey)\nPROPERTIES (\n  "partition_refresh_number" = "1"\n)\nAS\nSELECT lo_orderkey, lo_orderdate, lo_linenumber, lo_revenue, c_custkey, c_address, p_name\nFROM customer LEFT OUTER JOIN lineorder\nON c_custkey = lo_custkey\nINNER JOIN part\nON p_partkey = lo_partkey;\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"join_mv5"})," can rewrite the following query:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT lo_orderkey, lo_orderdate, lo_linenumber, lo_revenue, c_custkey, c_address, p_name\nFROM customer INNER JOIN lineorder\nON c_custkey = lo_custkey\nINNER JOIN part\nON p_partkey = lo_partkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-5",src:r(67279).Z+"",width:"1280",height:"588"})}),"\n",(0,i.jsxs)(n.p,{children:["Similarly, if the materialized view is defined as ",(0,i.jsx)(n.code,{children:"t1 INNER JOIN t2 INNER JOIN t3"}),", and the query is ",(0,i.jsx)(n.code,{children:"LEFT OUTER JOIN t2 INNER JOIN t3"}),", the query can also be rewritten. Furthermore, this rewriting capability extends to scenarios involving more than three tables."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Scenario two: Joining two tables"})}),"\n",(0,i.jsx)(n.p,{children:"The Join Derivability Rewrite feature involving two tables supports the following specific cases:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-6",src:r(38165).Z+"",width:"1924",height:"5436"})}),"\n",(0,i.jsx)(n.p,{children:"In cases 1 to 9, filtering predicates must be added to the rewritten result to ensure semantic equivalence. For example, create a materialized view as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW join_mv3\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT lo_orderkey, lo_linenumber, lo_revenue, c_custkey, c_address\nFROM lineorder LEFT OUTER JOIN customer\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The following query can be rewritten using ",(0,i.jsx)(n.code,{children:"join_mv3"}),", and the predicate ",(0,i.jsx)(n.code,{children:"c_custkey IS NOT NULL"})," is added to the rewritten result:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT lo_orderkey, lo_linenumber, lo_revenue, c_custkey, c_address\nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-7",src:r(11105).Z+"",width:"1280",height:"363"})}),"\n",(0,i.jsxs)(n.p,{children:["In case 10, the Left Outer Join query must include the filtering predicate ",(0,i.jsx)(n.code,{children:"IS NOT NULL"})," in the right table, for example, ",(0,i.jsx)(n.code,{children:"="}),", ",(0,i.jsx)(n.code,{children:"<>"}),", ",(0,i.jsx)(n.code,{children:">"}),", ",(0,i.jsx)(n.code,{children:"<"}),", ",(0,i.jsx)(n.code,{children:"<="}),", ",(0,i.jsx)(n.code,{children:">="}),", ",(0,i.jsx)(n.code,{children:"LIKE"}),", ",(0,i.jsx)(n.code,{children:"IN"}),", ",(0,i.jsx)(n.code,{children:"NOT LIKE"}),", or ",(0,i.jsx)(n.code,{children:"NOT IN"}),". For example, create a materialized view as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW join_mv4\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT lo_orderkey, lo_linenumber, lo_revenue, c_custkey, c_address\nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"join_mv4"})," can rewrite the following query, where ",(0,i.jsx)(n.code,{children:'customer.c_address = "Sb4gxKs7"'})," is the filtering predicate ",(0,i.jsx)(n.code,{children:"IS NOT NULL"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:'SELECT lo_orderkey, lo_linenumber, lo_revenue, c_custkey, c_address\nFROM lineorder LEFT OUTER JOIN customer\nON lo_custkey = c_custkey\nWHERE customer.c_address = "Sb4gxKs7";\n'})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-8",src:r(85536).Z+"",width:"1656",height:"756"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"aggregation-rewrite",children:"Aggregation rewrite"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks' asynchronous materialized view supports rewriting multi-table aggregate queries with all available aggregate functions, including bitmap_union, hll_union, and percentile_union. For example, create a materialized view as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW agg_mv1\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT \n  lo_orderkey, \n  lo_linenumber, \n  c_name, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey\nGROUP BY lo_orderkey, lo_linenumber, c_name;\n"})}),"\n",(0,i.jsx)(n.p,{children:"It can rewrite the following query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT \n  lo_orderkey, \n  lo_linenumber, \n  c_name, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey\nGROUP BY lo_orderkey, lo_linenumber, c_name;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-9",src:r(41634).Z+"",width:"1280",height:"740"})}),"\n",(0,i.jsx)(n.p,{children:"The following sections expound on the scenarios where the Aggregation Rewrite feature can be useful."}),"\n",(0,i.jsx)(n.h3,{id:"aggregation-rollup-rewrite",children:"Aggregation Rollup rewrite"}),"\n",(0,i.jsxs)(n.p,{children:["StarRocks supports rewriting queries with Aggregation Rollup, that is, StarRocks can rewrite aggregate queries with a ",(0,i.jsx)(n.code,{children:"GROUP BY a"})," clause using an asynchronous materialized view created with a ",(0,i.jsx)(n.code,{children:"GROUP BY a,b"})," clause. For example, the following query can be rewritten using ",(0,i.jsx)(n.code,{children:"agg_mv1"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT \n  lo_orderkey, \n  c_name, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey\nGROUP BY lo_orderkey, c_name;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-10",src:r(24483).Z+"",width:"1280",height:"643"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"NOTE"})}),"\n",(0,i.jsx)(n.p,{children:"Currently, rewriting the grouping set, grouping set with rollup, or grouping set with cube is not supported."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Only certain aggregate functions support query rewrite with Aggregate Rollup. In the preceding example, if the materialized view ",(0,i.jsx)(n.code,{children:"order_agg_mv"})," uses ",(0,i.jsx)(n.code,{children:"count(distinct client_id)"})," instead of ",(0,i.jsx)(n.code,{children:"bitmap_union(to_bitmap(client_id))"}),", StarRocks cannot rewrite the queries with Aggregate Rollup."]}),"\n",(0,i.jsx)(n.p,{children:"The following table shows the correspondence between the aggregate functions in the original query and the aggregate function used to build the materialized view. You can select the corresponding aggregate functions to build a materialized view according to your business scenario."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Aggregate function suppprted in original queries"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Function supported Aggregate Rollup in materialized view"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"sum"}),(0,i.jsx)(n.td,{children:"sum"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"count"}),(0,i.jsx)(n.td,{children:"count"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"min"}),(0,i.jsx)(n.td,{children:"min"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"max"}),(0,i.jsx)(n.td,{children:"max"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"avg"}),(0,i.jsx)(n.td,{children:"sum / count"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"bitmap_union, bitmap_union_count, count(distinct)"}),(0,i.jsx)(n.td,{children:"bitmap_union"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"hll_raw_agg, hll_union_agg, ndv, approx_count_distinct"}),(0,i.jsx)(n.td,{children:"hll_union"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"percentile_approx, percentile_union"}),(0,i.jsx)(n.td,{children:"percentile_union"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"DISTINCT aggregates without the corresponding GROUP BY column cannot be rewritten with Aggregate Rollup. However, from StarRocks v3.1 onwards, if a query with an Aggregate Rollup DISTINCT aggregate function does not have a GROUP BY column but an equal predicate, it can also be rewritten by the relevant materialized view because StarRocks can convert the equal predicates into a GROUP BY constant expression."}),"\n",(0,i.jsxs)(n.p,{children:["In the following example, StarRocks can rewrite the query with the materialized view ",(0,i.jsx)(n.code,{children:"order_agg_mv1"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW order_agg_mv1\nDISTRIBUTED BY HASH(`order_id`) BUCKETS 12\nREFRESH ASYNC START('2022-09-01 10:00:00') EVERY (interval 1 day)\nAS\nSELECT\n    order_date,\n    count(distinct client_id) \nFROM order_list \nGROUP BY order_date;\n\n\n-- Query\nSELECT\n    order_date,\n    count(distinct client_id) \nFROM order_list WHERE order_date='2023-07-03';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"count-distinct-rewrite",children:"COUNT DISTINCT rewrite"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks supports rewriting COUNT DISTINCT calculations into bitmap-based calculations, enabling high-performance, precise deduplication using materialized views. For example, create a materialized view as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW distinct_mv\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT lo_orderkey, bitmap_union(to_bitmap(lo_custkey)) AS distinct_customer\nFROM lineorder\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"It can rewrite the following query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT lo_orderkey, count(distinct lo_custkey) \nFROM lineorder \nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"nested-materialized-view-rewrite",children:"Nested materialized view rewrite"}),"\n",(0,i.jsxs)(n.p,{children:["StarRocks supports rewriting queries using nested materialized view. For example, create the materialized views ",(0,i.jsx)(n.code,{children:"join_mv2"}),", ",(0,i.jsx)(n.code,{children:"agg_mv2"}),", and ",(0,i.jsx)(n.code,{children:"agg_mv3"})," as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW join_mv2\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT lo_orderkey, lo_linenumber, lo_revenue, c_name, c_address\nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey;\n\n\nCREATE MATERIALIZED VIEW agg_mv2\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT \n  lo_orderkey, \n  lo_linenumber, \n  c_name, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM join_mv2\nGROUP BY lo_orderkey, lo_linenumber, c_name;\n\nCREATE MATERIALIZED VIEW agg_mv3\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT \n  lo_orderkey, \n  sum(total_revenue) AS total_revenue, \n  max(max_discount) AS max_discount \nFROM agg_mv2\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Their relationship is as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-11",src:r(48479).Z+"",width:"308",height:"676"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agg_mv3"})," can rewrite the following query:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT \n  lo_orderkey, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder INNER JOIN customer\nON lo_custkey = c_custkey\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-12",src:r(46816).Z+"",width:"1280",height:"666"})}),"\n",(0,i.jsx)(n.h2,{id:"union-rewrite",children:"Union rewrite"}),"\n",(0,i.jsx)(n.h3,{id:"predicate-union-rewrite",children:"Predicate Union rewrite"}),"\n",(0,i.jsx)(n.p,{children:"When the predicate scope of a materialized view is a subset of the predicate scope of a query, the query can be rewritten using a UNION operation."}),"\n",(0,i.jsx)(n.p,{children:"For example, create a materialized view as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW agg_mv4\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT \n  lo_orderkey, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder\nWHERE lo_orderkey < 300000000\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"It can rewrite the following query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"select \n  lo_orderkey, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-13",src:r(20225).Z+"",width:"1280",height:"632"})}),"\n",(0,i.jsxs)(n.p,{children:["In this context, ",(0,i.jsx)(n.code,{children:"agg_mv5"})," contains data where ",(0,i.jsx)(n.code,{children:"lo_orderkey < 300000000"}),". Data where ",(0,i.jsx)(n.code,{children:"lo_orderkey >= 300000000"})," is directly obtained from the base table ",(0,i.jsx)(n.code,{children:"lineorder"}),". Finally, these two sets of data are combined using a UNION operation and then aggregated to obtain the final result."]}),"\n",(0,i.jsx)(n.h3,{id:"partition-union-rewrite",children:"Partition Union rewrite"}),"\n",(0,i.jsx)(n.p,{children:"Suppose you created a partitioned materialized view based on a partitioned table. When the partition range that a rewritable query scanned is a superset of the most recent partition range of the materialized view, the query will be rewritten using a UNION operation."}),"\n",(0,i.jsxs)(n.p,{children:["For example, consider the following materialized view ",(0,i.jsx)(n.code,{children:"agg_mv4"}),". Its base table ",(0,i.jsx)(n.code,{children:"lineorder"})," currently contains partitions from ",(0,i.jsx)(n.code,{children:"p1"})," to ",(0,i.jsx)(n.code,{children:"p7"}),", and the materialized view also contains partitions from ",(0,i.jsx)(n.code,{children:"p1"})," to ",(0,i.jsx)(n.code,{children:"p7"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW agg_mv5\nDISTRIBUTED BY hash(lo_orderkey)\nPARTITION BY RANGE(lo_orderdate)\nREFRESH MANUAL\nAS\nSELECT \n  lo_orderdate, \n  lo_orderkey, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If a new partition ",(0,i.jsx)(n.code,{children:"p8"}),", with a partition range of ",(0,i.jsx)(n.code,{children:'[("19990101"), ("20000101"))'}),",  is added to ",(0,i.jsx)(n.code,{children:"lineorder"}),", the following query can be rewritten using a UNION operation:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"SELECT \n  lo_orderdate, \n  lo_orderkey, \n  sum(lo_revenue) AS total_revenue, \n  max(lo_discount) AS max_discount \nFROM lineorder\nGROUP BY lo_orderkey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Its original query plan and the one after the rewrite are as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Rewrite-14",src:r(89682).Z+"",width:"1280",height:"547"})}),"\n",(0,i.jsxs)(n.p,{children:["As shown above, ",(0,i.jsx)(n.code,{children:"agg_mv5"})," contains the data from partitions ",(0,i.jsx)(n.code,{children:"p1"})," to ",(0,i.jsx)(n.code,{children:"p7"}),", and the data from partition ",(0,i.jsx)(n.code,{children:"p8"})," is directly queried from ",(0,i.jsx)(n.code,{children:"lineorder"}),". Finally, these two sets of data are combined using a UNION operation."]}),"\n",(0,i.jsx)(n.h2,{id:"view-based-materialized-view-rewrite",children:"View-based materialized view rewrite"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks supports creating materialized views based on views. Subsequent queries against the views can be transparently rewritten."}),"\n",(0,i.jsx)(n.p,{children:"For example, create the following views:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE VIEW customer_view1 \nAS\nSELECT c_custkey, c_name, c_address\nFROM customer;\n\nCREATE VIEW lineorder_view1\nAS\nSELECT lo_orderkey, lo_linenumber, lo_custkey, lo_revenue\nFROM lineorder;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then, create the following materialized view based on the views:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"CREATE MATERIALIZED VIEW join_mv1\nDISTRIBUTED BY hash(lo_orderkey)\nAS\nSELECT lo_orderkey, lo_linenumber, lo_revenue, c_name\nFROM lineorder_view1 INNER JOIN customer_view1\nON lo_custkey = c_custkey;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["During query rewrite, queries against ",(0,i.jsx)(n.code,{children:"customer_view1"})," and ",(0,i.jsx)(n.code,{children:"lineorder_view1"})," are automatically expanded to the base tables and then transparently matched and rewritten."]}),"\n",(0,i.jsx)(n.h2,{id:"external-catalog-based-materialized-view-rewrite",children:"External catalog-based materialized view rewrite"}),"\n",(0,i.jsx)(n.p,{children:"StarRocks supports building asynchronous materialized views on Hive catalogs, Hudi catalogs, and Iceberg catalogs, and transparently rewriting queries with them. External catalog-based materialized views support most of the query rewrite capabilities, but there are some limitations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Hudi, Iceberg, or JDBC catalog-based materialized views do not support Union rewrite."}),"\n",(0,i.jsx)(n.li,{children:"Hudi, Iceberg, or JDBC catalog-based materialized views do not support View Delta Join rewrite."}),"\n",(0,i.jsx)(n.li,{children:"Hudi, Iceberg, or JDBC catalog-based materialized views do not support the incremental refresh of partitions."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configure-query-rewrite",children:"Configure query rewrite"}),"\n",(0,i.jsx)(n.p,{children:"You can configure the asynchronous materialized view query rewrite through the following session variables:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Variable"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Default"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Description"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_materialized_view_union_rewrite"}),(0,i.jsx)(n.td,{children:"true"}),(0,i.jsx)(n.td,{children:"Boolean value to control if to enable materialized view Union query rewrite."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"enable_rule_based_materialized_view_rewrite"}),(0,i.jsx)(n.td,{children:"true"}),(0,i.jsx)(n.td,{children:"Boolean value to control if to enable rule-based materialized view query rewrite. This variable is mainly used in single-table query rewrite."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"nested_mv_rewrite_max_level"}),(0,i.jsx)(n.td,{children:"3"}),(0,i.jsxs)(n.td,{children:["The maximum levels of nested materialized views that can be used for query rewrite. Type: INT. Range: [1, +\u221e). The value of ",(0,i.jsx)(n.code,{children:"1"})," indicates that materialized views created on other materialized views will not be used for query rewrite."]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"check-if-a-query-is-rewritten",children:"Check if a query is rewritten"}),"\n",(0,i.jsxs)(n.p,{children:["You can check if your query is rewritten by viewing its query plan using the EXPLAIN statement. If the field ",(0,i.jsx)(n.code,{children:"TABLE"})," under the section ",(0,i.jsx)(n.code,{children:"OlapScanNode"})," shows the name of the corresponding materialized view, it means that the query has been rewritten based on the materialized view."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-Plain",children:"mysql> EXPLAIN SELECT \n    order_id, sum(goods.price) AS total \n    FROM order_list INNER JOIN goods \n    ON goods.item_id1 = order_list.item_id2 \n    GROUP BY order_id;\n+------------------------------------+\n| Explain String                     |\n+------------------------------------+\n| PLAN FRAGMENT 0                    |\n|  OUTPUT EXPRS:1: order_id | 8: sum |\n|   PARTITION: RANDOM                |\n|                                    |\n|   RESULT SINK                      |\n|                                    |\n|   1:Project                        |\n|   |  <slot 1> : 9: order_id        |\n|   |  <slot 8> : 10: total          |\n|   |                                |\n|   0:OlapScanNode                   |\n|      TABLE: order_mv               |\n|      PREAGGREGATION: ON            |\n|      partitions=1/1                |\n|      rollup: order_mv              |\n|      tabletRatio=0/12              |\n|      tabletList=                   |\n|      cardinality=3                 |\n|      avgRowSize=4.0                |\n|      numNodes=0                    |\n+------------------------------------+\n20 rows in set (0.01 sec)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"disable-query-rewrite",children:"Disable query rewrite"}),"\n",(0,i.jsxs)(n.p,{children:["By default, StarRocks enables query rewrite for asynchronous materialized views created based on the default catalog. You can disable this feature by setting the session variable ",(0,i.jsx)(n.code,{children:"enable_materialized_view_rewrite"})," to ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["For asynchronous materialized views created based on an external catalog, you can disable this feature by setting the materialized view property ",(0,i.jsx)(n.code,{children:"force_external_table_query_rewrite"})," to ",(0,i.jsx)(n.code,{children:"false"})," using ",(0,i.jsx)(n.a,{href:"/doc/docs/3.0/sql-reference/sql-statements/data-definition/ALTER_MATERIALIZED_VIEW",children:"ALTER MATERIALIZED VIEW"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsx)(n.p,{children:"In terms of materialized view-based query rewrite, StarRocks currently has the following limitations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"StarRocks does not support rewriting queries with non-deterministic functions, including rand, random, uuid, and sleep."}),"\n",(0,i.jsx)(n.li,{children:"StarRocks does not support rewriting queries with window functions."}),"\n",(0,i.jsx)(n.li,{children:"Materialized views defined with statements containing LIMIT, ORDER BY, UNION, EXCEPT, INTERSECT, MINUS, GROUPING SETS, WITH CUBE, or WITH ROLLUP cannot be used for query rewrite."}),"\n",(0,i.jsx)(n.li,{children:"Strong consistency of query results is not guaranteed between base tables and materialized views built on external catalogs."}),"\n",(0,i.jsx)(n.li,{children:"Asynchronous materialized views created on base tables in a JDBC catalog do not support query rewrite."}),"\n"]})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,i.jsx)(n,Object.assign({},e,{children:(0,i.jsx)(c,e)})):c(e)}},14073:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-1-eb9013df4b16703af03d8f8e3f16c54f.png"},24483:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-10-d8c1554f5b3d82dccadf2a0ff71168f7.png"},48479:(e,n,r)=>{r.d(n,{Z:()=>i});const i="data:image/png;base64,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"},46816:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-12-a51ca18e5a4c6d8e1d17dc7891c4e3ec.png"},20225:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-13-850c7bbda3cfe9646efba5b58fc313f1.png"},89682:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-14-8d68fa6e97a7c95ccd0260844c7289e8.png"},67438:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-2-bac991234e3290868fb679e96bac1ca1.png"},66169:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-3-4f39e3c2a4ef90666b07eeff874b2a4b.png"},1570:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-4-4c64e8655e7f1d038fb6a087e1834dd9.png"},67279:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-5-49ead3f3059211bcbc32c3cc930cf724.png"},38165:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-6-94db95ed8c016091ad59b399e9721999.png"},11105:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-7-44a515fb763130b95d99b67c4327deb3.png"},85536:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-8-c38cff46841e1c2f373e1ba840d843c8.png"},41634:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Rewrite-9-2d12a69c91722ead46a3944c900cae59.png"},11151:(e,n,r)=>{r.d(n,{Zo:()=>o,ah:()=>s});var i=r(67294);const t=i.createContext({});function s(e){const n=i.useContext(t);return i.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const a={};function o({components:e,children:n,disableParentContext:r}){let o;return o=r?"function"==typeof e?e({}):e||a:s(e),i.createElement(t.Provider,{value:o},n)}}}]);