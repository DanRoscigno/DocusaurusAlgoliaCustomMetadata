"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[75979],{43985:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var a=n(85893),s=n(11151);const o={displayed_sidebar:"documentation"},l="UPDATE",r={id:"sql-reference/sql-statements/data-manipulation/UPDATE",title:"UPDATE",description:"Updates rows in a Primary Key table.",source:"@site/versioned_docs/version-3.1/sql-reference/sql-statements/data-manipulation/UPDATE.md",sourceDirName:"sql-reference/sql-statements/data-manipulation",slug:"/sql-reference/sql-statements/data-manipulation/UPDATE",permalink:"/doc/docs/sql-reference/sql-statements/data-manipulation/UPDATE",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/sql-reference/sql-statements/data-manipulation/UPDATE.md",tags:[],version:"3.1",frontMatter:{displayed_sidebar:"documentation"},sidebar:"documentation",previous:{title:"SUBMIT TASK",permalink:"/doc/docs/sql-reference/sql-statements/data-manipulation/SUBMIT_TASK"},next:{title:"ALTER ROUTINE LOAD",permalink:"/doc/docs/sql-reference/sql-statements/data-manipulation/alter-routine-load"}},i={},c=[{value:"Usage notes",id:"usage-notes",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Partial updates in column mode (since v3.1)",id:"partial-updates-in-column-mode-since-v31",level:2},{value:"Examples",id:"examples",level:2},{value:"Single-table UPDATE",id:"single-table-update",level:3},{value:"Multi-table UPDATE",id:"multi-table-update",level:3}];function d(e){const t=Object.assign({h1:"h1",p:"p",h2:"h2",strong:"strong",pre:"pre",code:"code",a:"a",ul:"ul",li:"li",h3:"h3"},(0,s.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"update",children:"UPDATE"}),"\n",(0,a.jsx)(t.p,{children:"Updates rows in a Primary Key table."}),"\n",(0,a.jsx)(t.p,{children:"In versions earlier than version 3.0, the UPDATE statement only supports single-table UPDATE and does not support common table expressions (CTEs). Starting from version 3.0, StarRocks enriches the syntax to support multi-table joins and CTEs. If you need to join the table to be updated with other tables in the database, you can reference these other tables in the FROM clause or CTE. Since version 3.1, the UPDATE statement supports the partial updates in column mode, which is suitable for scenarios involving a small number of columns but a large number of rows, resulting in faster update speeds."}),"\n",(0,a.jsx)(t.p,{children:"This command requires the UPDATE privilege on the table you want to update."}),"\n",(0,a.jsx)(t.h2,{id:"usage-notes",children:"Usage notes"}),"\n",(0,a.jsx)(t.p,{children:"When executing the UPDATE statement involving multiple tables, StarRocks converts the table expression in the FROM clause of the UPDATE statement into an equivalent JOIN query statement. Therefore, make sure that the table expression that you specify in the FROM clause of the UPDATE statement supports this conversion. For example, the UPDATE statement is 'UPDATE t0 SET v1=t1.v1 FROM t1 WHERE t0.pk = t1.pk;'. The table expression in the FROM clause can be converted to 't0 JOIN t1 ON t0.pk=t1.pk;'. StarRocks matches the data rows to be updated based on the result set of the JOIN query. It is possible that multiple rows in the result set match a certain row in the table to be updated. In this scenario, that row is updated based on the value of a random row among these multiple rows."}),"\n",(0,a.jsx)(t.h2,{id:"syntax",children:"Syntax"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"Single-table UPDATE"})}),"\n",(0,a.jsx)(t.p,{children:"If the data rows of the table to be updated meet the WHERE condition, the specified columns of these data rows are assigned new values."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"[ WITH <with_query> [, ...] ]\nUPDATE <table_name>\n    SET <column_name> = <expression> [, ...]\n    WHERE <where_condition>\n"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"Multi-table UPDATE"})}),"\n",(0,a.jsx)(t.p,{children:"The result set from the multi-table join is matched against the table to be updated. If the data rows of the table to be updated match the result set and meet the WHERE condition, the specified columns of these data rows are assigned new values."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"[ WITH <with_query> [, ...] ]\nUPDATE <table_name>\n    SET <column_name> = <expression> [, ...]\n    [ FROM <from_item> [, ...] ]\n    WHERE <where_condition>\n"})}),"\n",(0,a.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"with_query"})}),"\n",(0,a.jsx)(t.p,{children:"One or more CTEs that can be referenced by name in an UPDATE statement. CTEs are temporary result sets that can improve the readability of complex statements."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"table_name"})}),"\n",(0,a.jsx)(t.p,{children:"The name of the table to be updated."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"column_name"})}),"\n",(0,a.jsx)(t.p,{children:"The name of the column to be updated. It cannot include the table name. For example, 'UPDATE t1 SET col = 1' is not valid."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"expression"})}),"\n",(0,a.jsx)(t.p,{children:"The expression that assigns new values to the column."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"from_item"})}),"\n",(0,a.jsxs)(t.p,{children:["One or more other tables in the database. These tables can be joined with the table to be updated based on the condition specified in the WHERE clause. The values of the rows in the result set are used to update the values for the specified columns in the matched rows in the table to be updated. For example, if the FROM clause is ",(0,a.jsx)(t.code,{children:"FROM t1 WHERE t0.pk = t1.pk"}),", StarRocks converts the table expression in the FROM clause to ",(0,a.jsx)(t.code,{children:"t0 JOIN t1 ON t0.pk=t1.pk"})," when executing the UPDATE statement."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"where_condition"})}),"\n",(0,a.jsxs)(t.p,{children:["The condition based on which you want to update rows. Only rows that meet the WHERE condition can be updated. This parameter is required, because it helps prevent you from accidentally updating the entire table. If you want to update the entire table, you can use 'WHERE true'. However, this parameter is not required for ",(0,a.jsx)(t.a,{href:"#partial-updates-in-column-mode-since-v31",children:"partial updates in column mode"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"partial-updates-in-column-mode-since-v31",children:"Partial updates in column mode (since v3.1)"}),"\n",(0,a.jsx)(t.p,{children:"Partial updates in column mode are suitable for scenarios where only a small number of columns, but a large number of rows need to be updated. In such scenarios, enabling the column mode offers faster update speeds. For example, in a table with 100 columns, if only 10 columns (10% of the total) are updated for all rows, the update speed of the column mode is 10 times faster."}),"\n",(0,a.jsxs)(t.p,{children:["The system variable ",(0,a.jsx)(t.code,{children:"partial_update_mode"})," controls the mode of partial updates and supports the following values:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"auto"})," (default): The system automatically determines the mode of partial updates by analyzing the UPDATE statement and the columns involved. If the following criteria are met, the system automatically uses the column mode:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"The percentage of updated columns compared to the total number of columns is less than 30%, and the number of updated columns is fewer than 4."}),"\n",(0,a.jsx)(t.li,{children:"The update statement does not use a WHERE condition.\nOtherwise, the system does not use the column mode."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"column"}),": The column mode is used for the partial updates, which is particularly suitable for the partial updates which involve a small number of columns and a large number of rows."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["You can use ",(0,a.jsx)(t.code,{children:"EXPLAIN UPDATE xxx"})," to view the mode of partial updates."]}),"\n",(0,a.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(t.h3,{id:"single-table-update",children:"Single-table UPDATE"}),"\n",(0,a.jsxs)(t.p,{children:["Create a table ",(0,a.jsx)(t.code,{children:"Employees"})," to record employee information and insert five data rows into the table."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"CREATE TABLE Employees (\n    EmployeeID INT,\n    Name VARCHAR(50),\n    Salary DECIMAL(10, 2)\n)\nPRIMARY KEY (EmployeeID) \nDISTRIBUTED BY HASH (EmployeeID)\nPROPERTIES (\"replication_num\" = \"3\");\n\nINSERT INTO Employees VALUES\n    (1, 'John Doe', 5000),\n    (2, 'Jane Smith', 6000),\n    (3, 'Robert Johnson', 5500),\n    (4, 'Emily Williams', 4500),\n    (5, 'Michael Brown', 7000);\n"})}),"\n",(0,a.jsx)(t.p,{children:"If you need to give a 10% raise to all employees, you can execute the following statement:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"UPDATE Employees\nSET Salary = Salary * 1.1  -- Increase the salary by 10%.\nWHERE true;\n"})}),"\n",(0,a.jsx)(t.p,{children:"If you need to give a 10% raise to employees with salaries lower than the average salary, you can execute the following statement:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"UPDATE Employees\nSET Salary = Salary * 1.1   -- Increase the salary by 10%.\nWHERE Salary < (SELECT AVG(Salary) FROM Employees);\n"})}),"\n",(0,a.jsx)(t.p,{children:"You can also use a CTE to rewrite the above statement to improve readability."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"WITH AvgSalary AS (\n    SELECT AVG(Salary) AS AverageSalary\n    FROM Employees\n)\nUPDATE Employees\nSET Salary = Salary * 1.1   -- Increase the salary by 10%.\nFROM AvgSalary\nWHERE Employees.Salary < AvgSalary.AverageSalary;\n"})}),"\n",(0,a.jsx)(t.h3,{id:"multi-table-update",children:"Multi-table UPDATE"}),"\n",(0,a.jsxs)(t.p,{children:["Create a table ",(0,a.jsx)(t.code,{children:"Accounts"})," to record account information and insert three data rows into the table."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"CREATE TABLE Accounts (\n    Accounts_id BIGINT NOT NULL,\n    Name VARCHAR(26) NOT NULL,\n    Sales_person VARCHAR(50) NOT NULL\n) \nPRIMARY KEY (Accounts_id)\nDISTRIBUTED BY HASH (Accounts_id)\nPROPERTIES (\"replication_num\" = \"3\");\n\nINSERT INTO Accounts VALUES\n    (1,'Acme Corporation','John Doe'),\n    (2,'Acme Corporation','Robert Johnson'),\n    (3,'Acme Corporation','Lily Swift');\n"})}),"\n",(0,a.jsxs)(t.p,{children:["If you need to give a 10% raise to employees in the table ",(0,a.jsx)(t.code,{children:"Employees"})," who manage accounts for Acme Corporation, you can execute the following statement:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"UPDATE Employees\nSET Salary = Salary * 1.1  -- Increase the salary by 10%.\nFROM Accounts\nWHERE Accounts.name = 'Acme Corporation'\n    AND Employees.Name = Accounts.Sales_person;\n"})}),"\n",(0,a.jsx)(t.p,{children:"You can also use a CTE to rewrite the above statement to improve readability."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-SQL",children:"WITH Acme_Accounts as (\n    SELECT * from Accounts\n    WHERE Accounts.name = 'Acme Corporation'\n)\nUPDATE Employees SET Salary = Salary * 1.1 -- Increase the salary by 10%.\nFROM Acme_Accounts\nWHERE Employees.Name = Acme_Accounts.Sales_person;\n"})})]})}const h=function(e={}){const{wrapper:t}=Object.assign({},(0,s.ah)(),e.components);return t?(0,a.jsx)(t,Object.assign({},e,{children:(0,a.jsx)(d,e)})):d(e)}},11151:(e,t,n)=>{n.d(t,{Zo:()=>r,ah:()=>o});var a=n(67294);const s=a.createContext({});function o(e){const t=a.useContext(s);return a.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const l={};function r({components:e,children:t,disableParentContext:n}){let r;return r=n?"function"==typeof e?e({}):e||l:o(e),a.createElement(s.Provider,{value:r},t)}}}]);