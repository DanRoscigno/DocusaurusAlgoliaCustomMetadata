"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[41249],{74041:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var t=r(85893),s=r(11151);const o={},c="\u4f7f\u7528 Docker \u90e8\u7f72",a={id:"administration/deploy_with_docker",title:"\u4f7f\u7528 Docker \u90e8\u7f72",description:"\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u4ee5 Docker \u955c\u50cf\u7684\u65b9\u5f0f\u624b\u52a8\u90e8\u7f72 StarRocks\u3002",source:"@site/chinese_versioned_docs/version-2.5/administration/deploy_with_docker.md",sourceDirName:"administration",slug:"/administration/deploy_with_docker",permalink:"/doc/zh/2.5/administration/deploy_with_docker",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/docs.zh-cn/edit/main/administration/deploy_with_docker.md",tags:[],version:"2.5",frontMatter:{},sidebar:"documentation",previous:{title:"\u90e8\u7f72 Broker \u8282\u70b9",permalink:"/doc/zh/2.5/administration/deploy_broker"},next:{title:"\u901a\u8fc7 StarRocks Manager \u81ea\u52a8\u90e8\u7f72 StarRocks \u96c6\u7fa4",permalink:"/doc/zh/2.5/administration/deploy_with_manager"}},i={},l=[{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6",level:2},{value:"\u521b\u5efa Dockerfile",id:"\u521b\u5efa-dockerfile",level:2},{value:"\u521b\u5efa\u811a\u672c\u6587\u4ef6",id:"\u521b\u5efa\u811a\u672c\u6587\u4ef6",level:2},{value:"\u642d\u5efa Docker \u955c\u50cf",id:"\u642d\u5efa-docker-\u955c\u50cf",level:2},{value:"\u542f\u52a8 Docker \u5bb9\u5668",id:"\u542f\u52a8-docker-\u5bb9\u5668",level:2},{value:"\u8fde\u63a5 StarRocks",id:"\u8fde\u63a5-starrocks",level:2},{value:"\u786e\u8ba4\u90e8\u7f72\u6210\u529f",id:"\u786e\u8ba4\u90e8\u7f72\u6210\u529f",level:2}];function d(e){const n=Object.assign({h1:"h1",p:"p",h2:"h2",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",pre:"pre",code:"code",blockquote:"blockquote",a:"a"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"\u4f7f\u7528-docker-\u90e8\u7f72",children:"\u4f7f\u7528 Docker \u90e8\u7f72"}),"\n",(0,t.jsx)(n.p,{children:"\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u4ee5 Docker \u955c\u50cf\u7684\u65b9\u5f0f\u624b\u52a8\u90e8\u7f72 StarRocks\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u524d\u63d0\u6761\u4ef6",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5206\u7c7b"}),(0,t.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u786c\u4ef6\u8981\u6c42"}),(0,t.jsx)(n.td,{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"CPU \u9700\u652f\u6301 AVX2 \u6307\u4ee4\u96c6"}),(0,t.jsx)("li",{children:"\u5efa\u8bae\u914d\u7f6e 8 \u6838 \u6216\u4ee5\u4e0a CPU\uff0c16GB \u6216\u4ee5\u4e0a\u5185\u5b58\u3002"})]})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u64cd\u4f5c\u7cfb\u7edf"}),(0,t.jsx)(n.td,{children:"Linux kernel  3.10 \u4ee5\u4e0a\u3002"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u8f6f\u4ef6\u8981\u6c42"}),(0,t.jsx)(n.td,{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Docker"}),(0,t.jsx)("li",{children:"MySQL \u5ba2\u6237\u7aef\uff085.5 \u6216\u4ee5\u4e0a\uff09"})]})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u521b\u5efa-dockerfile",children:"\u521b\u5efa Dockerfile"}),"\n",(0,t.jsx)(n.p,{children:"\u521b\u5efa\u4ee5\u4e0b Dockerfile\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'FROM centos:centos7\n\n# Prepare StarRocks Installer. Replace the "2.4.0" below with the StarRocks version that you want to deploy.\nENV StarRocks_version=2.4.0\n\n# Create directory for deployment.\nENV StarRocks_home=/data/deploy\n\n# Replace the "<url_to_download_specific_ver_of_starrocks>" below with the download path of the StarRocks that you want to deploy.\nENV StarRocks_url=<url_to_download_specific_ver_of_starrocks>\n\n# Install StarRocks.\nRUN yum -y install wget\nRUN mkdir -p $StarRocks_home\nRUN wget -SO $StarRocks_home/StarRocks-${StarRocks_version}.tar.gz  $StarRocks_url\nRUN cd $StarRocks_home && tar zxf StarRocks-${StarRocks_version}.tar.gz\n\n# Install Java JDK.\nRUN yum -y install java-1.8.0-openjdk-devel.x86_64\nRUN rpm -ql java-1.8.0-openjdk-devel.x86_64 | grep bin$\n\n# Create directory for FE meta and BE storage in StarRocks.\nRUN mkdir -p $StarRocks_home/StarRocks-${StarRocks_version}/fe/meta\nRUN mkdir -p $StarRocks_home/StarRocks-${StarRocks_version}/be/storage\n\n# Install relevant tools.\nRUN yum -y install mysql net-tools telnet\n\n# Run Setup script.\nCOPY run_script.sh $StarRocks_home/run_script.sh\nRUN chmod +x $StarRocks_home/run_script.sh\nCMD $StarRocks_home/run_script.sh\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u5c06\u4ee5\u4e0a ",(0,t.jsx)(n.code,{children:"<url_to_download_specific_ver_of_starrocks>"})," \u66ff\u6362\u4e3a\u5b9e\u9645",(0,t.jsx)(n.a,{href:"https://www.mirrorship.cn/zh-CN/download/community",children:"\u4e0b\u8f7d\u5730\u5740"}),"\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u521b\u5efa\u811a\u672c\u6587\u4ef6",children:"\u521b\u5efa\u811a\u672c\u6587\u4ef6"}),"\n",(0,t.jsxs)(n.p,{children:["\u6784\u5efa\u811a\u672c\u6587\u4ef6 ",(0,t.jsx)(n.code,{children:"run_script.sh"})," \u4ee5\u914d\u7f6e\u5e76\u542f\u52a8 StarRocks\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"#!/bin/bash\n\n\n# Set JAVA_HOME.\n\nJAVA_INSTALL_DIR=/usr/lib/jvm/$(rpm -aq | grep java-1.8.0-openjdk-1.8.0)\nexport JAVA_HOME=$JAVA_INSTALL_DIR\n\n# Start FE.\ncd $StarRocks_home/StarRocks-$StarRocks_version/fe/bin/\n./start_fe.sh --daemon\n\n# Start BE.\ncd $StarRocks_home/StarRocks-$StarRocks_version/be/bin/\n./start_be.sh --daemon\n\n# Sleep until the cluster starts.\nsleep 30;\n\n# Set BE server IP.\nIP=$(ifconfig eth0 | grep 'inet' | cut -d: -f2 | awk '{print $2}')\nmysql -uroot -h${IP} -P 9030 -e \"alter system add backend '${IP}:9050';\"\n\n# Loop to detect the process.\nwhile sleep 60; do\n  ps aux | grep starrocks | grep -q -v grep\n  PROCESS_STATUS=$?\n\n  if [ ${PROCESS_STATUS} -ne 0 ]; then\n    echo \"one of the starrocks process already exit.\"\n    exit 1;\n  fi\ndone\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u642d\u5efa-docker-\u955c\u50cf",children:"\u642d\u5efa Docker \u955c\u50cf"}),"\n",(0,t.jsx)(n.p,{children:"\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u642d\u5efa Docker \u955c\u50cf\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker build --no-cache --progress=plain -t starrocks:1.0 .\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u542f\u52a8-docker-\u5bb9\u5668",children:"\u542f\u52a8 Docker \u5bb9\u5668"}),"\n",(0,t.jsx)(n.p,{children:"\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 Docker \u5bb9\u5668\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# 1\u3001\u7aef\u53e3\u6620\u5c04\u542f\u52a8\u65b9\u5f0f\ndocker run -p 9030:9030 -p 8030:8030 -p 8040:8040 --privileged=true -itd --name starrocks-test starrocks:1.0\n\n# 2\u3001\u540c\u5bbf\u4e3b\u673a\u7f51\u7edc\u73af\u5883\u542f\u52a8\u65b9\u5f0f\uff08\u907f\u514d\u4f7f\u7528stream load\u5bfc\u5165\u6570\u636e\u7b49\u627e\u4e0d\u5230be\u8282\u70b9ip\u5730\u5740\uff09\ndocker run  --network host  --privileged=true -itd --name starrocks-test starrocks:1.0\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u8fde\u63a5-starrocks",children:"\u8fde\u63a5 StarRocks"}),"\n",(0,t.jsx)(n.p,{children:"\u5f53 Docker \u5bb9\u5668\u6210\u529f\u542f\u52a8\u540e\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u8fde\u63a5 StarRocks\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"mysql -uroot -h127.0.0.1 -P 9030\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u786e\u8ba4\u90e8\u7f72\u6210\u529f",children:"\u786e\u8ba4\u90e8\u7f72\u6210\u529f"}),"\n",(0,t.jsx)(n.p,{children:"\u60a8\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b SQL \u786e\u8ba4 StarRocks \u662f\u5426\u90e8\u7f72\u6210\u529f\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE TEST;\n\nUSE TEST;\n\nCREATE TABLE `sr_on_mac` (\n `c0` int(11) NULL COMMENT \"\",\n `c1` date NULL COMMENT \"\",\n `c2` datetime NULL COMMENT \"\",\n `c3` varchar(65533) NULL COMMENT \"\"\n) ENGINE=OLAP \nDUPLICATE KEY(`c0`)\nPARTITION BY RANGE (c1) (\n  START (\"2022-02-01\") END (\"2022-02-10\") EVERY (INTERVAL 1 DAY)\n)\nDISTRIBUTED BY HASH(`c0`) BUCKETS 1 \nPROPERTIES (\n\"replication_num\" = \"3\",\n\"storage_format\" = \"DEFAULT\"\n);\n\n\ninsert into sr_on_mac values (1, '2022-02-01', '2022-02-01 10:47:57', '111');\ninsert into sr_on_mac values (2, '2022-02-02', '2022-02-02 10:47:57', '222');\ninsert into sr_on_mac values (3, '2022-02-03', '2022-02-03 10:47:57', '333');\n\n\nselect * from sr_on_mac where c1 >= '2022-02-02';\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u679c\u65e0\u9519\u8bef\u8fd4\u56de\uff0c\u5219\u8868\u660e\u60a8\u5df2\u6210\u529f\u5728 Docker \u73af\u5883\u4e2d\u90e8\u7f72 StarRocks\u3002"})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(d,e)})):d(e)}},11151:(e,n,r)=>{r.d(n,{Zo:()=>a,ah:()=>o});var t=r(67294);const s=t.createContext({});function o(e){const n=t.useContext(s);return t.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const c={};function a({components:e,children:n,disableParentContext:r}){let a;return a=r?"function"==typeof e?e({}):e||c:o(e),t.createElement(s.Provider,{value:a},n)}}}]);