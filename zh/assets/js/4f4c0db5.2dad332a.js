"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[16646],{32688:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>o,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var i=s(85893),l=s(11151);const r={displayed_sidebar:"Chinese"},d="\u7269\u5316\u89c6\u56fe",c={id:"table_design/Materialized_view",title:"\u7269\u5316\u89c6\u56fe",description:"\u540d\u8bcd\u89e3\u91ca",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-2.2/table_design/Materialized_view.md",sourceDirName:"table_design",slug:"/table_design/Materialized_view",permalink:"/zh/docs/2.2/table_design/Materialized_view",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/docs.zh-cn/edit/main/table_design/Materialized_view.md",tags:[],version:"2.2",frontMatter:{displayed_sidebar:"Chinese"},sidebar:"Chinese",previous:{title:"\u6570\u636e\u6a21\u578b",permalink:"/zh/docs/2.2/table_design/Data_model"},next:{title:"\u6392\u5e8f\u952e\u548c\u524d\u7f00\u7d22\u5f15",permalink:"/zh/docs/2.2/table_design/Sort_key"}},t={},a=[{value:"\u540d\u8bcd\u89e3\u91ca",id:"\u540d\u8bcd\u89e3\u91ca",level:2},{value:"\u4f7f\u7528\u573a\u666f",id:"\u4f7f\u7528\u573a\u666f",level:2},{value:"\u5982\u4f55\u4f7f\u7528",id:"\u5982\u4f55\u4f7f\u7528",level:2},{value:"<strong>\u521b\u5efa\u7269\u5316\u89c6\u56fe\uff1a</strong>",id:"\u521b\u5efa\u7269\u5316\u89c6\u56fe",level:3},{value:"<strong>\u5220\u9664\u7269\u5316\u89c6\u56fe</strong>",id:"\u5220\u9664\u7269\u5316\u89c6\u56fe",level:3},{value:"<strong>\u67e5\u770b\u7269\u5316\u89c6\u56fe\uff1a</strong>",id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe",level:3},{value:"<strong>\u5bfc\u5165\u6570\u636e</strong>",id:"\u5bfc\u5165\u6570\u636e",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"<strong>\u7269\u5316\u89c6\u56fe\u51fd\u6570\u652f\u6301</strong>",id:"\u7269\u5316\u89c6\u56fe\u51fd\u6570\u652f\u6301",level:3},{value:"<strong>\u7269\u5316\u89c6\u56fe\u7684\u667a\u80fd\u8def\u7531</strong>",id:"\u7269\u5316\u89c6\u56fe\u7684\u667a\u80fd\u8def\u7531",level:3},{value:"<strong>\u5176\u4ed6\u9650\u5236</strong>",id:"\u5176\u4ed6\u9650\u5236",level:3}];function h(e){const n=Object.assign({h1:"h1",h2:"h2",ol:"ol",li:"li",p:"p",h3:"h3",strong:"strong",pre:"pre",code:"code",ul:"ul",blockquote:"blockquote"},(0,l.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"\u7269\u5316\u89c6\u56fe",children:"\u7269\u5316\u89c6\u56fe"}),"\n",(0,i.jsx)(n.h2,{id:"\u540d\u8bcd\u89e3\u91ca",children:"\u540d\u8bcd\u89e3\u91ca"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Duplicate \u6570\u636e\u6a21\u578b\uff1aStarRocks\u4e2d\u7684\u7528\u4e8e\u5b58\u653e\u660e\u7ec6\u6570\u636e\u7684\u6570\u636e\u6a21\u578b\uff0c\u5efa\u8868\u53ef\u6307\u5b9a\uff0c\u6570\u636e\u4e0d\u4f1a\u88ab\u805a\u5408\u3002"}),"\n",(0,i.jsx)(n.li,{children:"Base \u8868\uff1aStarRocks \u4e2d\u901a\u8fc7 CREATE TABLE \u547d\u4ee4\u521b\u5efa\u51fa\u6765\u7684\u8868\u3002"}),"\n",(0,i.jsx)(n.li,{children:"Materialized Views \u8868\uff1a\u7b80\u79f0 MVs\uff0c\u7269\u5316\u89c6\u56fe\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4f7f\u7528\u573a\u666f",children:"\u4f7f\u7528\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5b9e\u9645\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u901a\u5e38\u5b58\u5728\u4e24\u79cd\u573a\u666f\u5e76\u5b58\u7684\u5206\u6790\u9700\u6c42\uff1a\u5bf9\u56fa\u5b9a\u7ef4\u5ea6\u7684\u805a\u5408\u5206\u6790 \u548c \u5bf9\u539f\u59cb\u660e\u7ec6\u6570\u636e\u4efb\u610f\u7ef4\u5ea6\u7684\u5206\u6790\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u5728\u9500\u552e\u573a\u666f\u4e2d\uff0c\u6bcf\u6761\u8ba2\u5355\u6570\u636e\u5305\u542b\u8fd9\u51e0\u4e2a\u7ef4\u5ea6\u4fe1\u606f\uff08item_id, sold_time, customer_id, price\uff09\u3002\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u6709\u4e24\u79cd\u5206\u6790\u9700\u6c42\u5e76\u5b58\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u4e1a\u52a1\u65b9\u9700\u8981\u83b7\u53d6\u67d0\u4e2a\u5546\u54c1\u5728\u67d0\u5929\u7684\u9500\u552e\u989d\u662f\u591a\u5c11\uff0c\u90a3\u4e48\u4ec5\u9700\u8981\u5728\u7ef4\u5ea6\uff08item_id, sold_time\uff09\u7ef4\u5ea6\u4e0a\u5bf9 price \u8fdb\u884c\u805a\u5408\u5373\u53ef\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5206\u6790\u67d0\u4e2a\u4eba\u5728\u67d0\u5929\u5bf9\u67d0\u4e2a\u5546\u54c1\u7684\u8d2d\u4e70\u660e\u7ec6\u6570\u636e\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u73b0\u6709\u7684 StarRocks \u6570\u636e\u6a21\u578b\u4e2d\uff0c\u5982\u679c\u4ec5\u5efa\u7acb\u4e00\u4e2a\u805a\u5408\u6a21\u578b\u7684\u8868\uff0c\u6bd4\u5982\uff08item_id, sold_time, customer_id, sum(price)\uff09\u3002\u7531\u4e8e\u805a\u5408\u635f\u5931\u4e86\u6570\u636e\u7684\u90e8\u5206\u4fe1\u606f\uff0c\u65e0\u6cd5\u6ee1\u8db3\u7528\u6237\u5bf9\u660e\u7ec6\u6570\u636e\u7684\u5206\u6790\u9700\u6c42\u3002\u5982\u679c\u4ec5\u5efa\u7acb\u4e00\u4e2a Duplicate \u6a21\u578b\uff0c\u867d\u53ef\u4ee5\u6ee1\u8db3\u4efb\u610f\u7ef4\u5ea6\u7684\u5206\u6790\u9700\u6c42\uff0c\u4f46\u7531\u4e8e\u4e0d\u652f\u6301 Rollup\uff0c\u5206\u6790\u6027\u80fd\u4e0d\u4f73\uff0c\u65e0\u6cd5\u5feb\u901f\u5b8c\u6210\u5206\u6790\u3002\u5982\u679c\u540c\u65f6\u5efa\u7acb\u4e00\u4e2a\u805a\u5408\u6a21\u578b\u548c\u4e00\u4e2a Duplicate \u6a21\u578b\uff0c\u867d\u53ef\u4ee5\u6ee1\u8db3\u6027\u80fd\u548c\u4efb\u610f\u7ef4\u5ea6\u5206\u6790\uff0c\u4f46\u4e24\u8868\u4e4b\u95f4\u672c\u8eab\u65e0\u5173\u8054\uff0c\u9700\u8981\u4e1a\u52a1\u65b9\u81ea\u884c\u9009\u62e9\u5206\u6790\u8868\u3002\u4e0d\u7075\u6d3b\u4e5f\u4e0d\u6613\u7528\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5982\u4f55\u4f7f\u7528",children:"\u5982\u4f55\u4f7f\u7528"}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528\u805a\u5408\u51fd\u6570\uff08\u5982sum\u548ccount\uff09\u7684\u67e5\u8be2\uff0c\u5728\u5df2\u7ecf\u5305\u542b\u805a\u5408\u6570\u636e\u7684\u8868\u4e2d\u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u6267\u884c\u3002\u8fd9\u79cd\u6539\u8fdb\u7684\u6548\u7387\u5bf9\u4e8e\u67e5\u8be2\u5927\u91cf\u6570\u636e\u5c24\u5176\u9002\u7528\u3002\u8868\u4e2d\u7684\u6570\u636e\u88ab\u7269\u5316\u5728\u5b58\u50a8\u8282\u70b9\u4e2d\uff0c\u5e76\u4e14\u5728\u589e\u91cf\u66f4\u65b0\u4e2d\u80fd\u548c Base \u8868\u4fdd\u6301\u4e00\u81f4\u3002\u7528\u6237\u521b\u5efa MVs \u8868\u540e\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u652f\u6301\u9009\u62e9\u4e00\u4e2a\u6700\u9ad8\u6548\u7684 MVs \u6620\u5c04\uff0c\u5e76\u76f4\u63a5\u5bf9 MVs \u8868\u8fdb\u884c\u67e5\u8be2\u800c\u4e0d\u662f Base \u8868\u3002\u7531\u4e8e MVs \u8868\u6570\u636e\u901a\u5e38\u6bd4 Base \u8868\u6570\u636e\u5c0f\u5f88\u591a\uff0c\u56e0\u6b64\u547d\u4e2d MVs \u8868\u7684\u67e5\u8be2\u901f\u5ea6\u4f1a\u5feb\u5f88\u591a\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u521b\u5efa\u7269\u5316\u89c6\u56fe",children:(0,i.jsx)(n.strong,{children:"\u521b\u5efa\u7269\u5316\u89c6\u56fe\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW materialized_view_name\nAS SELECT id, SUM(clicks) AS sum_clicks\nFROM  database_name.base_table\nGROUP BY id\n"})}),"\n",(0,i.jsx)(n.p,{children:'\u7269\u5316\u89c6\u56fe\u7684\u521b\u5efa\u5f53\u524d\u4e3a\u5f02\u6b65\u64cd\u4f5c\u3002\u521b\u5efa\u7269\u5316\u89c6\u56fe\u7684\u8bed\u6cd5\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed3\u679c\uff0c\u4f46\u7269\u5316\u89c6\u56fe\u7684\u751f\u6210\u64cd\u4f5c\u53ef\u80fd\u4ecd\u5728\u8fd0\u884c\u3002\u7528\u6237\u53ef\u4ee5\u4f7f\u7528DESC "base_table_name" ALL\u547d\u4ee4\u67e5\u770b\u5f53\u524dBASE\u8868\u7684\u7269\u5316\u89c6\u56fe\u3002\u53ef\u4ee5\u4f7f\u7528 SHOW ALTER TABLE MATERIALIZED VIEW FROM "database_name"\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u4ee5\u53ca\u5386\u53f2\u7269\u5316\u89c6\u56fe\u7684\u5904\u7406\u72b6\u6001\u3002'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u9650\u5236\uff1a"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["base\u8868\u4e2d\u7684\u5206\u533a\u5217\uff0c\u5fc5\u987b\u5b58\u5728\u4e8e\u521b\u5efa\u7269\u5316\u89c6\u56fe\u7684group by\u805a\u5408\u5217\u4e2d","\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u5217\u5982\uff1abase\u8868\u6309\u5929\u5206\u533a\uff0c\u7269\u5316\u89c6\u56fe\u5219\u53ea\u80fd\u6309\u5929\u5206\u533a\u5217\u505agroup by\u805a\u5408\u3002\u4e0d\u80fd\u591f\u5efa\u7acb\u6309\u6708\u7c92\u5ea6group by\u7684\u7269\u5316\u89c6\u56fe\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u76ee\u524d\u53ea\u652f\u6301\u5bf9\u5355\u8868\u8fdb\u884c\u6784\u5efa\u7269\u5316\u89c6\u56fe\uff0c\u4e0d\u652f\u6301\u591a\u8868JOIN"}),"\n",(0,i.jsx)(n.li,{children:"\u805a\u5408\u7c7b\u578b\u8868\uff08Aggregation)\uff0c\u4e0d\u652f\u6301\u5bf9key\u5217\u6267\u884c\u805a\u5408\u7b97\u5b50\u64cd\u4f5c\uff0c\u4ec5\u652f\u6301\u5bf9value\u5217\u8fdb\u884c\u805a\u5408\uff0c\u4e14\u805a\u5408\u7b97\u5b50\u7c7b\u578b\u4e0d\u80fd\u6539\u53d8\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u7269\u5316\u89c6\u56fe\u4e2d\u81f3\u5c11\u5305\u542b\u4e00\u4e2aKEY\u5217"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u652f\u6301\u8868\u8fbe\u5f0f\u8ba1\u7b97"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u652f\u6301\u6307\u5b9a\u7269\u5316\u89c6\u56fe\u67e5\u8be2"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u652f\u6301 Order By"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5220\u9664\u7269\u5316\u89c6\u56fe",children:(0,i.jsx)(n.strong,{children:"\u5220\u9664\u7269\u5316\u89c6\u56fe"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"DROP  MATERIALIZED VIEW [IF  EXISTS] [db_name].<mv_name>"})}),"\n",(0,i.jsx)(n.h3,{id:"\u67e5\u770b\u7269\u5316\u89c6\u56fe",children:(0,i.jsx)(n.strong,{children:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\uff1a"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u67e5\u770b\u8be5database\u4e0b\u7684\u6240\u6709\u7269\u5316\u89c6\u56fe"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"SHOW MATERIALIZED  VIEW [IN|FROM db_name]"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u67e5\u770b\u6307\u5b9a\u7269\u5316\u89c6\u56fe\u7684\u8868\u7ed3\u6784"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"DESC table_name all"}),"\n( ",(0,i.jsx)(n.code,{children:"DESC/DESCRIBUE mv_name"})," \u4e0d\u518d\u652f\u6301\uff09"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u67e5\u770b\u7269\u5316\u89c6\u56fe\u5904\u7406\u8fdb\u5ea6"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"SHOW ALTER MATERIALIZED VIEW FROM db_name"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53d6\u6d88\u6b63\u5728\u521b\u5efa\u7684\u7269\u5316\u89c6\u56fe"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"CANCEL ALTER MATERIALIZED VIEW FROM db_name.view_name"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5982\u4f55\u786e\u5b9a\u67e5\u8be2\u547d\u4e2d\u4e86\u54ea\u4e2a\u7269\u5316\u89c6\u56fe"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u7528\u6237\u67e5\u8be2\u65f6\uff0c\u5e76\u4e0d\u611f\u77e5\u7269\u5316\u89c6\u56fe\u7684\u5b58\u5728\uff0c\u4e0d\u5fc5\u663e\u5f0f\u7684\u6307\u5b9a\u7269\u5316\u89c6\u56fe\u7684\u540d\u79f0\u3002\u67e5\u8be2\u4f18\u5316\u5668\u53ef\u4ee5\u6839\u636e\u67e5\u8be2\u6761\u4ef6\u81ea\u52a8\u5224\u65ad\u662f\u5426\u53ef\u4ee5\u8def\u7531\u5230\u76f8\u5e94\u7684\u7269\u5316\u89c6\u56fe\u4e0a\u3002\u67e5\u8be2\u8ba1\u5212\u662f\u5426\u88ab\u91cd\u5199\uff0c\u53ef\u5728explain sql \u4e2d\u67e5\u770b\u3002\u53ef\u4ee5\u5728Mysql \u5ba2\u6237\u7aef\u6267\u884c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"Explain SQL:\n\n0:OlapScanNode\nTABLE: lineorder4\nPREAGGREGATION: ON\npartitions=1/1\nRollUp\u8868: lineorder4\ntabletRatio=1/1\ntabletList=15184\ncardinality=119994608\navgRowSize=26.375498\nnumNodes=1\ntuple ids: 0\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u4e2d\u7684RollUp\u8868\u5b57\u6bb5\u8868\u793a\u5230\u5e95\u547d\u4e2d\u4e86\u54ea\u4e2a\u7269\u5316\u89c6\u56fe\u3002\u5176\u4e2d\u7684PREAGGREGATION \u5b57\u6bb5\u5982\u679c\u662fOn\uff0c\u5c31\u8868\u660e\u67e5\u8be2\u65f6\u4e0d\u9700\u8981\u5728StarRocks\u5b58\u50a8\u5f15\u64ce\u4e2d\u73b0\u573a\u805a\u5408\uff0c\u67e5\u8be2\u4f1a\u66f4\u5feb\uff0c\u5982\u679cPREAGGREGATION \u5b57\u6bb5\u662fOff\uff0c\u540e\u9762\u4f1a\u663e\u793a\u539f\u56e0\uff0c\u6bd4\u5982 PREAGGREGATION: OFF. Reason: \xa0The aggregate operator does not match\uff0c\u8868\u793a\u56e0\u4e3a\u67e5\u8be2\u7684\u805a\u5408\u51fd\u6570\u548c\u7269\u5316\u89c6\u56fe\u4e2d\u5b9a\u4e49\u7684\u805a\u5408\u51fd\u6570\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u5728StarRocks\u5b58\u50a8\u5f15\u64ce\u4e2d\u65e0\u6cd5\u4f7f\u7528\u7269\u5316\u89c6\u56fe\uff0c\u9700\u8981\u73b0\u573a\u805a\u5408\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u5bfc\u5165\u6570\u636e",children:(0,i.jsx)(n.strong,{children:"\u5bfc\u5165\u6570\u636e"})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9 Base \u8868\u7684\u589e\u91cf\u5bfc\u5165\u90fd\u4f1a\u4f5c\u7528\u5230\u6240\u6709\u5173\u8054\u7684 MVs \u8868\u4e2d\u3002\u5728 Base \u8868\u53ca\u6240\u6709\u7684 MVs \u8868\u5747\u5b8c\u6210\u540e\uff0c\u5bfc\u5165\u624d\u7b97\u5b8c\u6210\uff0c\u6570\u636e\u624d\u80fd\u88ab\u770b\u5230\u3002StarRocks\u4fdd\u8bc1Base \u8868\u548c MVs \u8868\u4e4b\u95f4\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\u3002\u67e5\u8be2 Base \u8868\u548c\u67e5\u8be2 MVs \u8868\u4e0d\u4f1a\u5b58\u5728\u6570\u636e\u5dee\u5f02\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsx)(n.h3,{id:"\u7269\u5316\u89c6\u56fe\u51fd\u6570\u652f\u6301",children:(0,i.jsx)(n.strong,{children:"\u7269\u5316\u89c6\u56fe\u51fd\u6570\u652f\u6301"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u524d\u7684\u7269\u5316\u89c6\u56fe\u53ea\u652f\u6301\u5bf9\u5355\u4e2a\u8868\u7684\u805a\u5408\u3002\u76ee\u524d\u652f\u6301\u4ee5\u4e0b\u805a\u5408\u51fd\u6570\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"COUNT"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"MAX"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"MIN"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"SUM"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"PERCENTILE_APPROX"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"HLL_UNION"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u660e\u7ec6\u6570\u636e\u8fdb\u884c HLL \u805a\u5408\u5e76\u4e14\u5728\u67e5\u8be2\u65f6\uff0c\u4f7f\u7528 HLL \u51fd\u6570\u5206\u6790\u6570\u636e\u3002\u4e3b\u8981\u9002\u7528\u4e8e\u5feb\u901f\u8fdb\u884c\u975e\u7cbe\u786e\u53bb\u91cd\u8ba1\u7b97\u3002\u5bf9\u660e\u7ec6\u6570\u636e\u4f7f\u7528HLL_UNION\u805a\u5408\uff0c\u9700\u8981\u5148\u8c03\u7528hll_hash\u51fd\u6570\uff0c\u5bf9\u539f\u6570\u636e\u8fdb\u884c\u8f6c\u6362\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"create materialized view dt_uv as \n    select dt, page_id, HLL_UNION(hll_hash(user_id)) \n    from user_view\n    group by dt, page_id;\nselect ndv(user_id) from user_view; \u67e5\u8be2\u53ef\u547d\u4e2d\u8be5\u7269\u5316\u89c6\u56fe\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u76ee\u524d\u4e0d\u652f\u6301\u5bf9 DECIMAL/BITMAP/HLL/PERCENTILE \u7c7b\u578b\u7684\u5217\u4f7f\u7528HLL_UNION\u805a\u5408\u7b97\u5b50\u3002"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"BITMAP_UNION"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u660e\u7ec6\u6570\u636e\u8fdb\u884cBITMAP\u805a\u5408\u5e76\u4e14\u5728\u67e5\u8be2\u65f6\uff0c\u4f7f\u7528BITMAP\u51fd\u6570\u5206\u6790\u6570\u636e\uff0c\u4e3b\u8981\u9002\u7528\u4e8e\u5feb\u901f\u8ba1\u7b97count(distinct)\u7684\u7cbe\u786e\u53bb\u91cd\u3002\u5bf9\u660e\u7ec6\u6570\u636e\u4f7f\u7528BITMAP_UNION\u805a\u5408\uff0c\u9700\u8981\u5148\u8c03\u7528to_bitmap\u51fd\u6570\uff0c\u5bf9\u539f\u6570\u636e\u8fdb\u884c\u8f6c\u6362\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-SQL",children:"create materialized view dt_uv  as\n    select dt, page_id, bitmap_union(to_bitmap(user_id))\n    from user_view\n    group by dt, page_id;\nselect count(distinct user_id) from user_view; \u67e5\u8be2\u53ef\u547d\u4e2d\u8be5\u7269\u5316\u89c6\u56fe\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u76ee\u524d\u4ec5\u652f\u6301TINYINT/SMALLINT/INT/BITINT\u7c7b\u578b\uff0c\u4e14\u5b58\u50a8\u5185\u5bb9\u9700\u4e3a\u6b63\u6574\u6570\uff08\u5305\u62ec0\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u7269\u5316\u89c6\u56fe\u7684\u667a\u80fd\u8def\u7531",children:(0,i.jsx)(n.strong,{children:"\u7269\u5316\u89c6\u56fe\u7684\u667a\u80fd\u8def\u7531"})}),"\n",(0,i.jsx)(n.p,{children:"StarRocks\u4e2d\uff0c\u67e5\u8be2\u65f6\u4e0d\u9700\u8981\u663e\u5f0f\u6307\u5b9aMV\u8868\u540d\u79f0\uff0cStarRocks\u4f1a\u6839\u636e\u67e5\u8be2SQL\u667a\u80fd\u8def\u7531\u5230\u6700\u4f73\u7684MV\u8868\u3002\u5728\u67e5\u8be2\u65f6\uff0cMV\u8868\u7684\u9009\u62e9\u89c4\u5219\u5982\u4e0b\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u9009\u62e9\u5305\u542b\u6240\u6709\u67e5\u8be2\u5217\u7684MV\u8868"}),"\n",(0,i.jsx)(n.li,{children:"\u6309\u7167\u8fc7\u6ee4\u548c\u6392\u5e8f\u7684Column\u7b5b\u9009\u6700\u7b26\u5408\u7684MV\u8868"}),"\n",(0,i.jsx)(n.li,{children:"\u6309\u7167Join\u7684Column\u7b5b\u9009\u6700\u7b26\u5408\u7684MV\u8868"}),"\n",(0,i.jsx)(n.li,{children:"\u884c\u6570\u6700\u5c0f\u7684MV\u8868"}),"\n",(0,i.jsx)(n.li,{children:"\u5217\u6570\u6700\u5c0f\u7684MV\u8868"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5176\u4ed6\u9650\u5236",children:(0,i.jsx)(n.strong,{children:"\u5176\u4ed6\u9650\u5236"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"RollUp\u8868\u7684\u6a21\u578b\u5fc5\u987b\u548cBase\u8868\u4fdd\u6301\u4e00\u81f4\uff08\u805a\u5408\u8868\u7684RollUp\u8868\u662f\u805a\u5408\u6a21\u578b\uff0c\u660e\u7ec6\u8868\u7684RollUp\u8868\u662f\u660e\u7ec6\u6a21\u578b\uff09\u3002"}),"\n",(0,i.jsx)(n.li,{children:"Delete \u64cd\u4f5c\u65f6\uff0c\u5982\u679c Where \u6761\u4ef6\u4e2d\u7684\u67d0\u4e2a Key \u5217\u5728\u67d0\u4e2a RollUp\u8868\u4e2d\u4e0d\u5b58\u5728\uff0c\u5219\u4e0d\u5141\u8bb8\u8fdb\u884c Delete\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5148\u5220\u9664\u7269\u5316\u89c6\u56fe\uff0c\u518d\u8fdb\u884cDelete\u64cd\u4f5c\uff0c\u6700\u540e\u518d\u91cd\u65b0\u589e\u52a0\u7269\u5316\u89c6\u56fe\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5982\u679c \u7269\u5316\u89c6\u56fe\u4e2d\u5305\u542b REPLACE \u805a\u5408\u7c7b\u578b\u7684\u5217\uff0c\u5219\u8be5\u7269\u5316\u89c6\u56fe\u5fc5\u987b\u5305\u542b\u6240\u6709 Key \u5217\u3002"}),"\n"]})]})}const o=function(e={}){const{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?(0,i.jsx)(n,Object.assign({},e,{children:(0,i.jsx)(h,e)})):h(e)}},11151:(e,n,s)=>{s.d(n,{Zo:()=>c,ah:()=>r});var i=s(67294);const l=i.createContext({});function r(e){const n=i.useContext(l);return i.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const d={};function c({components:e,children:n,disableParentContext:s}){let c;return c=s?"function"==typeof e?e({}):e||d:r(e),i.createElement(l.Provider,{value:c},n)}}}]);