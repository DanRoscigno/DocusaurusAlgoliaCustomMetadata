"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[191],{55512:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var s=a(85893),t=a(11151);const l={displayed_sidebar:"English"},i="Data import and query",r={id:"quick_start/Import_and_query",title:"Data import and query",description:"Local File Import",source:"@site/versioned_docs/version-2.1/quick_start/Import_and_query.md",sourceDirName:"quick_start",slug:"/quick_start/Import_and_query",permalink:"/zh/docs/2.1/quick_start/Import_and_query",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/docs.zh-cn/edit/main/quick_start/Import_and_query.md",tags:[],version:"2.1",frontMatter:{displayed_sidebar:"English"},sidebar:"English",previous:{title:"\u624b\u52a8\u90e8\u7f72",permalink:"/zh/docs/2.1/quick_start/Deploy"},next:{title:"\u6d4b\u8bd5\u5e38\u89c1\u95ee\u9898",permalink:"/zh/docs/2.1/quick_start/Test_faq"}},o={},c=[{value:"Local File Import",id:"local-file-import",level:2},{value:"Broker Load",id:"broker-load",level:3},{value:"Spark Load",id:"spark-load",level:3},{value:"Stream Load",id:"stream-load",level:3},{value:"Routine Load",id:"routine-load",level:3},{value:"Insert Into",id:"insert-into",level:3},{value:"Query",id:"query",level:2},{value:"Simple query",id:"simple-query",level:3},{value:"Query with order by",id:"query-with-order-by",level:3},{value:"Query with join",id:"query-with-join",level:3},{value:"Query with subqueries",id:"query-with-subqueries",level:3},{value:"Schema change",id:"schema-change",level:2},{value:"Change the schema",id:"change-the-schema",level:3},{value:"Create Roll up",id:"create-roll-up",level:3}];function d(e){const n=Object.assign({h1:"h1",h2:"h2",p:"p",h3:"h3",code:"code",img:"img",a:"a",ul:"ul",li:"li",strong:"strong",pre:"pre",blockquote:"blockquote"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"data-import-and-query",children:"Data import and query"}),"\n",(0,s.jsx)(n.h2,{id:"local-file-import",children:"Local File Import"}),"\n",(0,s.jsx)(n.p,{children:"StarRocks provides five ways  to import data sources (e.g. HDFS, Kafka, local files, etc.), either asynchronously or synchronously."}),"\n",(0,s.jsx)(n.h3,{id:"broker-load",children:"Broker Load"}),"\n",(0,s.jsx)(n.p,{children:"Broker Load is to access and read external data sources through the Broker and then create an import job using the MySQL protocol."}),"\n",(0,s.jsx)(n.p,{children:"Broker Load is used when the source data is in a broker-accessible storage system (e.g. HDFS) and the data volume is tens to hundreds of GB. Data sources include Hive, etc."}),"\n",(0,s.jsx)(n.h3,{id:"spark-load",children:"Spark Load"}),"\n",(0,s.jsx)(n.p,{children:"Spark Load leverages the external Spark resources to pre-process imported data, which improves StarRocks\u2019 performance of importing large data volumes and saves computing resources."}),"\n",(0,s.jsx)(n.p,{children:"Spark Load is suitable for initial migration of large data volumes (up to TB level) to StarRocks, and the source data is in a Spark-accessible storage system (e.g. HDFS)."}),"\n",(0,s.jsx)(n.h3,{id:"stream-load",children:"Stream Load"}),"\n",(0,s.jsx)(n.p,{children:"Stream Load is a synchronous import method. The user sends a request via the HTTP protocol to import a local file or data stream into StarRocks, and waits for the system to return a status indicating the import result."}),"\n",(0,s.jsx)(n.p,{children:"Stream Load is suitable for importing local files, or importing data from a data stream through a program. Data sources include Flink, CSV, etc."}),"\n",(0,s.jsx)(n.h3,{id:"routine-load",children:"Routine Load"}),"\n",(0,s.jsx)(n.p,{children:"Routine Load allows to automatically import data from a specified data source. The user submits a routine import job via the MySQL protocol, generating a runloop that reads data from a data source (such as Kafka) and imports it into StarRocks without interruption."}),"\n",(0,s.jsx)(n.h3,{id:"insert-into",children:"Insert Into"}),"\n",(0,s.jsxs)(n.p,{children:["Similar to the  ",(0,s.jsx)(n.code,{children:"Insert"})," statement of MySQL, StarRocks supports ",(0,s.jsx)(n.code,{children:"INSERT INTO tbl SELECT ... ;"})," to read data and import it to a table and ",(0,s.jsx)(n.code,{children:"INSERT INTO tbl VALUES(...) ;"})," to insert a single row of data. Data sources includes DataX/DTS, Kettle/Informatic, and StarRocks itself."]}),"\n",(0,s.jsx)(n.p,{children:"The overall ecological diagram of StarRocks data import is as follows."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"starrocks_ecology",src:a(321).Z+"",width:"2471",height:"1219"})}),"\n",(0,s.jsxs)(n.p,{children:["Please refer to ",(0,s.jsx)(n.a,{href:"../loading/Loading_intro.md",children:"Data Loading"})," for details on the specific import method. Here is an example of stream load using the HTTP protocol."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Example 1"}),": Import local file ",(0,s.jsx)(n.code,{children:"tabel 1\\_data"})," as ",(0,s.jsx)(n.code,{children:"table 1"}),", label with ",(0,s.jsx)(n.code,{children:"table1\\_20170707"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Create the data file ",(0,s.jsx)(n.code,{children:"table1\\_data"})," locally, use comma to separate data, as follows:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"1,1,jim,2\n2,1,grace,2\n3,2,tom,2\n4,3,bush,3\n5,3,helen,3\n"})}),"\n",(0,s.jsx)(n.p,{children:"Use the following curl command to send the HTTP request for data import."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl --location-trusted -u test:123456 -T table1_data -H "label: table1_20170707" -H "column_separator:," http://127.0.0.1:8030/api/example_ db/table1/_stream_load\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Note that FE\u2019s username is test. The HTTP port in ",(0,s.jsx)(n.code,{children:"fe.conf"})," is ",(0,s.jsx)(n.code,{children:"8030"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Example 2"}),": Import local file ",(0,s.jsx)(n.code,{children:"tabel2\\_data"})," as ",(0,s.jsx)(n.code,{children:"table 2"}),", label with ",(0,s.jsx)(n.code,{children:"table2\\_20170707"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Create the data file ",(0,s.jsx)(n.code,{children:"table2\\_data"})," locally, use comma to separate data, as follows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"2017-07-03,1,1,jim,2\n2017-07-05,2,1,grace,2\n2017-07-12,3,2,tom,2\n2017-07-15,4,3,bush,3\n"})}),"\n",(0,s.jsx)(n.p,{children:"Use the following curl command to send the HTTP request for data import."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl --location-trusted -u test:123456 -T table2_data -H "label:table2_20170707" -H "column_separator:," http://127.0.0.1:8030/api/example_ db/table2/_stream_load\n'})}),"\n",(0,s.jsx)(n.h2,{id:"query",children:"Query"}),"\n",(0,s.jsx)(n.h3,{id:"simple-query",children:"Simple query"}),"\n",(0,s.jsx)(n.p,{children:"Example 3:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> select * from table1;\n\n+--------+----------+----------+----+\n| siteid | citycode | username | pv |\n+--------+----------+----------+----+\n| \xa0 \xa0 \xa05 | \xa0 \xa0 \xa0 \xa03 | helen \xa0  | \xa03 |\n| \xa0 \xa0 \xa02 | \xa0 \xa0 \xa0 \xa01 | grace \xa0  | \xa02 |\n| \xa0 \xa0 \xa01 | \xa0 \xa0 \xa0 \xa01 | jim \xa0 \xa0  | \xa02 |\n| \xa0 \xa0 \xa04 | \xa0 \xa0 \xa0 \xa03 | bush \xa0   | \xa03 |\n| \xa0 \xa0 \xa03 | \xa0 \xa0 \xa0 \xa02 | tom \xa0 \xa0  | \xa02 |\n+--------+----------+----------+----+\n"})}),"\n",(0,s.jsx)(n.h3,{id:"query-with-order-by",children:"Query with order by"}),"\n",(0,s.jsx)(n.p,{children:"Example 4:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> select * from table1 order by citycode;\n\n+--------+----------+----------+----+\n| siteid | citycode | username | pv |\n+--------+----------+----------+----+\n| \xa0 \xa0 \xa02 | \xa0 \xa0 \xa0 \xa01 | grace \xa0  | \xa02 |\n| \xa0 \xa0 \xa01 | \xa0 \xa0 \xa0 \xa01 | jim \xa0 \xa0  | \xa02 |\n| \xa0 \xa0 \xa03 | \xa0 \xa0 \xa0 \xa02 | tom \xa0 \xa0  | \xa02 |\n| \xa0 \xa0 \xa04 | \xa0 \xa0 \xa0 \xa03 | bush \xa0   | \xa03 |\n| \xa0 \xa0 \xa05 | \xa0 \xa0 \xa0 \xa03 | helen \xa0  | \xa03 |\n+--------+----------+----------+----+\n5 rows in set (0.07 sec)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"query-with-join",children:"Query with join"}),"\n",(0,s.jsx)(n.p,{children:"Example 5:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> select sum(table1.pv) from table1 join table2 where table1.siteid = table2.siteid;\n\n+--------------------+\n| sum(`table1`.`pv`) |\n+--------------------+\n| 12                 |\n+--------------------+\n1 row in set (0.20 sec)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"query-with-subqueries",children:"Query with subqueries"}),"\n",(0,s.jsx)(n.p,{children:"Example 6:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> select sum(pv) from table2 where siteid in (select siteid from table1 where siteid > 2);\n\n+-----------+\n| sum(`pv`) |\n+-----------+\n| 8         |\n+-----------+\n1 row in set (0.13 sec)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"schema-change",children:"Schema change"}),"\n",(0,s.jsx)(n.h3,{id:"change-the-schema",children:"Change the schema"}),"\n",(0,s.jsx)(n.p,{children:"The Schema of a table can be modified using the ALTER TABLE command. Specifically, you can"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Add columns"}),"\n",(0,s.jsx)(n.li,{children:"Delete columns"}),"\n",(0,s.jsx)(n.li,{children:"Modify column type"}),"\n",(0,s.jsx)(n.li,{children:"Change column order"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"See the following examples."}),"\n",(0,s.jsx)(n.p,{children:"The Schema of the original table1 is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"+----------+-------------+------+-------+---------+-------+\n| Field \xa0 \xa0| Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid \xa0 | int(11)     | Yes \xa0| true \xa0| 10 \xa0 \xa0 \xa0| \xa0 \xa0 \xa0 |\n| citycode | smallint(6) | Yes \xa0| true \xa0| N/A \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| username | varchar(32) | Yes \xa0| true \xa0| \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| pv \xa0 \xa0 \xa0 | bigint(20) \xa0| Yes \xa0| false | 0 \xa0 \xa0 \xa0 | SUM   |\n+----------+-------------+------+-------+---------+-------+\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Add a new column ",(0,s.jsx)(n.code,{children:"uv"})," whose type is ",(0,s.jsx)(n.code,{children:"BIGINT"})," and aggregation type is ",(0,s.jsx)(n.code,{children:"SUM"})," with a default value of ",(0,s.jsx)(n.code,{children:"0"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE table1 ADD COLUMN uv BIGINT SUM DEFAULT '0' after pv;\n"})}),"\n",(0,s.jsx)(n.p,{children:"After submission, you can view the status with the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SHOW ALTER TABLE COLUMN\\G\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Job status is ",(0,s.jsx)(n.code,{children:"FINISHED"}),", meaning the job is complete. The new schema has taken effect."]}),"\n",(0,s.jsxs)(n.p,{children:["Once ",(0,s.jsx)(n.code,{children:"ALTER TABLE"})," is completed, you can check the latest schema using ",(0,s.jsx)(n.code,{children:"desc table"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> desc table1;\n\n+----------+-------------+------+-------+---------+-------+\n| Field \xa0 \xa0| Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid \xa0 | int(11)     | Yes \xa0| true \xa0| 10 \xa0 \xa0 \xa0| \xa0 \xa0 \xa0 |\n| citycode | smallint(6) | Yes \xa0| true \xa0| N/A \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| username | varchar(32) | Yes \xa0| true \xa0| \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| pv \xa0 \xa0 \xa0 | bigint(20) \xa0| Yes \xa0| false | 0 \xa0 \xa0 \xa0 | SUM   |\n| uv \xa0 \xa0 \xa0 | bigint(20) \xa0| Yes \xa0| false | 0 \xa0 \xa0 \xa0 | SUM   |\n+----------+-------------+------+-------+---------+-------+\n5 rows in set (0.00 sec)\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can cancel the running job with the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CANCEL ALTER TABLE COLUMN FROM table1\\G\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-roll-up",children:"Create Roll up"}),"\n",(0,s.jsx)(n.p,{children:"Rollup is a new pre-aggregate acceleration technique used by StarRocks, which can be regarded as a materialized indexing structure built on the base table. By materialized, it means data is stored independently. By indexing, it means rollup can adjust the column order to increase the hit rate of prefix indexes, and also reduce key columns to make data aggregation efficient."}),"\n",(0,s.jsx)(n.p,{children:"The schema of the original table1 is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"+----------+-------------+------+-------+---------+-------+\n| Field \xa0 \xa0| Type        | Null | Key   | Default | Extra |\n+----------+-------------+------+-------+---------+-------+\n| siteid \xa0 | int(11)     | Yes \xa0| true \xa0| 10 \xa0 \xa0 \xa0| \xa0 \xa0 \xa0 |\n| citycode | smallint(6) | Yes \xa0| true \xa0| N/A \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| username | varchar(32) | Yes \xa0| true \xa0| \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| pv \xa0 \xa0 \xa0 | bigint(20) \xa0| Yes \xa0| false | 0 \xa0 \xa0 \xa0 | SUM   |\n| uv \xa0 \xa0 \xa0 | bigint(20) \xa0| Yes \xa0| false | 0 \xa0 \xa0 \xa0 | SUM   |\n+----------+-------------+------+-------+---------+-------+\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.code,{children:"table1"}),", its detailed data ",(0,s.jsx)(n.code,{children:"siteid"}),", ",(0,s.jsx)(n.code,{children:"citycode"}),", ",(0,s.jsx)(n.code,{children:"username"})," form a key that is used to aggregate ",(0,s.jsx)(n.code,{children:"pv"}),". If users need to track cities\u2019 pv numbers, you can create a rollup of ",(0,s.jsx)(n.code,{children:"citycode"})," and ",(0,s.jsx)(n.code,{children:"pv"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE table1 ADD ROLLUP rollup_city(citycode, pv);\n"})}),"\n",(0,s.jsx)(n.p,{children:"After submission, you can view the status using the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SHOW ALTER TABLE ROLLUP\\G\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Job status is ",(0,s.jsx)(n.code,{children:"FINISHED"}),", meaning the job is completed."]}),"\n",(0,s.jsxs)(n.p,{children:["After the rollup is created, you can use ",(0,s.jsx)(n.code,{children:"desc table1"})," all to view the rollup information of the table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-Plain",metastring:"Text",children:"mysql> desc table1 all;\n\n+-------------+----------+-------------+------+-------+---------+-------+\n| IndexName \xa0 | Field    | Type \xa0 \xa0 \xa0 \xa0| Null | Key \xa0 | Default | Extra |\n+-------------+----------+-------------+------+-------+---------+-------+\n| table1 \xa0 \xa0 \xa0| siteid   | int(11) \xa0 \xa0 | Yes  | true  | 10 \xa0 \xa0 \xa0| \xa0 \xa0 \xa0 |\n| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | citycode | smallint(6) | Yes  | true  | N/A     | \xa0 \xa0 \xa0 |\n| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | username | varchar(32) | Yes  | true  | \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | pv       | bigint(20) \xa0| Yes  | false | 0 \xa0 \xa0 \xa0 | SUM \xa0 |\n| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | uv       | bigint(20) \xa0| Yes  | false | 0 \xa0 \xa0 \xa0 | SUM \xa0 |\n| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 \xa0 \xa0| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0| \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 \xa0 | \xa0 \xa0 \xa0 |\n| rollup_city | citycode | smallint(6) | Yes  | true  | N/A     | \xa0 \xa0 \xa0 |\n| \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 | pv       | bigint(20) \xa0| Yes  | false | 0 \xa0 \xa0 \xa0 | SUM \xa0 |\n+-------------+----------+-------------+------+-------+---------+-------+\n8 rows in set (0.01 sec)\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can cancel the running job with the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CANCEL ALTER TABLE ROLLUP FROM table1;\n"})})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(d,e)})):d(e)}},321:(e,n,a)=>{a.d(n,{Z:()=>s});const s=a.p+"assets/images/2.5-1-aa681789287a731f1df67b61eff9c313.png"},11151:(e,n,a)=>{a.d(n,{Zo:()=>r,ah:()=>l});var s=a(67294);const t=s.createContext({});function l(e){const n=s.useContext(t);return s.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const i={};function r({components:e,children:n,disableParentContext:a}){let r;return r=a?"function"==typeof e?e({}):e||i:l(e),s.createElement(t.Provider,{value:r},n)}}}]);