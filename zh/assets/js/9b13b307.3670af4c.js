"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[21838],{98120:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>x,frontMatter:()=>i,metadata:()=>a,toc:()=>o});var s=r(85893),l=r(11151);const i={displayed_sidebar:"Chinese"},c="\u7a97\u53e3\u51fd\u6570",a={id:"sql-reference/sql-functions/Window_function",title:"\u7a97\u53e3\u51fd\u6570",description:"\u80cc\u666f\u4ecb\u7ecd",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-2.2/sql-reference/sql-functions/Window_function.md",sourceDirName:"sql-reference/sql-functions",slug:"/sql-reference/sql-functions/Window_function",permalink:"/zh/docs/2.2/sql-reference/sql-functions/Window_function",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/docs.zh-cn/edit/main/sql-reference/sql-functions/Window_function.md",tags:[],version:"2.2",frontMatter:{displayed_sidebar:"Chinese"},sidebar:"Chinese",previous:{title:"[Preview] Java UDFs",permalink:"/zh/docs/2.2/sql-reference/sql-functions/Java-UDFs"},next:{title:"ANY_VALUE",permalink:"/zh/docs/2.2/sql-reference/sql-functions/aggregate-functions/any_value"}},d={},o=[{value:"\u80cc\u666f\u4ecb\u7ecd",id:"\u80cc\u666f\u4ecb\u7ecd",level:2},{value:"\u4f7f\u7528\u65b9\u5f0f",id:"\u4f7f\u7528\u65b9\u5f0f",level:2},{value:"Function",id:"function",level:3},{value:"PARTITION BY\u4ece\u53e5",id:"partition-by\u4ece\u53e5",level:3},{value:"ORDER BY\u4ece\u53e5",id:"order-by\u4ece\u53e5",level:3},{value:"Window Clause",id:"window-clause",level:3},{value:"\u51fd\u6570\u4e3e\u4f8b",id:"\u51fd\u6570\u4e3e\u4f8b",level:2},{value:"AVG()",id:"avg",level:3},{value:"COUNT()",id:"count",level:3},{value:"DENSE_RANK()",id:"dense_rank",level:3},{value:"FIRST_VALUE()",id:"first_value",level:3},{value:"LAG()",id:"lag",level:3},{value:"LAST_VALUE()",id:"last_value",level:3},{value:"LEAD()",id:"lead",level:3},{value:"MAX()",id:"max",level:3},{value:"MIN()",id:"min",level:3},{value:"RANK()",id:"rank",level:3},{value:"ROW_NUMBER()",id:"row_number",level:3},{value:"SUM()",id:"sum",level:3}];function t(n){const e=Object.assign({h1:"h1",h2:"h2",p:"p",strong:"strong",pre:"pre",code:"code",h3:"h3",ul:"ul",li:"li"},(0,l.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"\u7a97\u53e3\u51fd\u6570",children:"\u7a97\u53e3\u51fd\u6570"}),"\n",(0,s.jsx)(e.h2,{id:"\u80cc\u666f\u4ecb\u7ecd",children:"\u80cc\u666f\u4ecb\u7ecd"}),"\n",(0,s.jsxs)(e.p,{children:["\u7a97\u53e3\u51fd\u6570\u662f\u4e00\u7c7b\u7279\u6b8a\u7684\u5185\u7f6e\u51fd\u6570\u3002\u548c\u805a\u5408\u51fd\u6570\u7c7b\u4f3c\uff0c\u7a97\u53e3\u51fd\u6570\u4e5f\u662f\u5bf9\u4e8e\u591a\u4e2a\u8f93\u5165\u884c\u505a\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6570\u636e\u503c\u3002\u4e0d\u540c\u7684\u662f\uff0c\u7a97\u53e3\u51fd\u6570\u662f\u5728\u4e00\u4e2a\u7279\u5b9a\u7684\u7a97\u53e3\u5185\u5bf9\u8f93\u5165\u6570\u636e\u505a\u5904\u7406\uff0c\u800c\u4e0d\u662f\u6309\u7167group by\u6765\u5206\u7ec4\u8ba1\u7b97\u3002\u6bcf\u4e2a\u7a97\u53e3\u5185\u7684\u6570\u636e\u53ef\u4ee5\u7528over()\u4ece\u53e5\u8fdb\u884c\u6392\u5e8f\u548c\u5206\u7ec4\u3002\u7a97\u53e3\u51fd\u6570\u4f1a",(0,s.jsx)(e.strong,{children:"\u5bf9\u7ed3\u679c\u96c6\u7684\u6bcf\u4e00\u884c"}),"\u8ba1\u7b97\u51fa\u4e00\u4e2a\u5355\u72ec\u7684\u503c\uff0c\u800c\u4e0d\u662f\u6bcf\u4e2agroup by\u5206\u7ec4\u8ba1\u7b97\u4e00\u4e2a\u503c\u3002\u8fd9\u79cd\u7075\u6d3b\u7684\u65b9\u5f0f\u5141\u8bb8\u7528\u6237\u5728select\u4ece\u53e5\u4e2d\u589e\u52a0\u989d\u5916\u7684\u5217\uff0c\u7ed9\u7528\u6237\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u673a\u4f1a\u6765\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u91cd\u65b0\u7ec4\u7ec7\u548c\u8fc7\u6ee4\u3002\u7a97\u53e3\u51fd\u6570\u53ea\u80fd\u51fa\u73b0\u5728select\u5217\u8868\u548c\u6700\u5916\u5c42\u7684order by\u4ece\u53e5\u4e2d\u3002\u5728\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u7a97\u53e3\u51fd\u6570\u4f1a\u5728\u6700\u540e\u751f\u6548\uff0c\u5c31\u662f\u8bf4\uff0c\u5728\u6267\u884c\u5b8cjoin\uff0cwhere\u548cgroup by\u7b49\u64cd\u4f5c\u4e4b\u540e\u518d\u6267\u884c\u3002\u7a97\u53e3\u51fd\u6570\u5728\u91d1\u878d\u548c\u79d1\u5b66\u8ba1\u7b97\u9886\u57df\u7ecf\u5e38\u88ab\u4f7f\u7528\u5230\uff0c\u7528\u6765\u5206\u6790\u8d8b\u52bf\u3001\u8ba1\u7b97\u79bb\u7fa4\u503c\u4ee5\u53ca\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u5206\u6876\u5206\u6790\u7b49\u3002"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h2,{id:"\u4f7f\u7528\u65b9\u5f0f",children:"\u4f7f\u7528\u65b9\u5f0f"}),"\n",(0,s.jsx)(e.p,{children:"\u7a97\u53e3\u51fd\u6570\u7684\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"function(args) OVER(partition_by_clause order_by_clause [window_clause])\npartition_by_clause ::= PARTITION BY expr [, expr ...]\norder_by_clause ::= ORDER BY expr [ASC | DESC] [, expr [ASC | DESC] ...]\n"})}),"\n",(0,s.jsx)(e.h3,{id:"function",children:"Function"}),"\n",(0,s.jsx)(e.p,{children:"\u76ee\u524d\u652f\u6301\u7684Function\u5305\u62ec\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"MIN(), MAX(), COUNT(), SUM(), AVG()"}),"\n",(0,s.jsx)(e.li,{children:"FIRST_VALUE(), LAST_VALUE(), LEAD(), LAG()"}),"\n",(0,s.jsx)(e.li,{children:"ROW_NUMBER(), RANK(), DENSE_RANK()"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"partition-by\u4ece\u53e5",children:"PARTITION BY\u4ece\u53e5"}),"\n",(0,s.jsx)(e.p,{children:"Partition By\u4ece\u53e5\u548cGroup By\u7c7b\u4f3c\u3002\u5b83\u628a\u8f93\u5165\u884c\u6309\u7167\u6307\u5b9a\u7684\u4e00\u5217\u6216\u591a\u5217\u5206\u7ec4\uff0c\u76f8\u540c\u503c\u7684\u884c\u4f1a\u88ab\u5206\u5230\u4e00\u7ec4\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"order-by\u4ece\u53e5",children:"ORDER BY\u4ece\u53e5"}),"\n",(0,s.jsxs)(e.p,{children:["Order By\u4ece\u53e5\u548c\u5916\u5c42\u7684Order By\u57fa\u672c\u4e00\u81f4\u3002\u5b83\u5b9a\u4e49\u4e86\u8f93\u5165\u884c\u7684\u6392\u5217\u987a\u5e8f\uff0c\u5982\u679c\u6307\u5b9a\u4e86Partition By\uff0c\u5219Order By\u5b9a\u4e49\u4e86\u6bcf\u4e2aPartition\u5206\u7ec4\u5185\u7684\u987a\u5e8f\u3002\u4e0e\u5916\u5c42Order By\u7684\u552f\u4e00\u4e0d\u540c\u70b9\u662f\uff1aOVER\u4ece\u53e5\u4e2d\u7684",(0,s.jsx)(e.code,{children:"Order By n"}),"\uff08n\u662f\u6b63\u6574\u6570\uff09\u76f8\u5f53\u4e8e\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u800c\u5916\u5c42\u7684Order By n\u8868\u793a\u6309\u7167\u7b2cn\u5217\u6392\u5e8f\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b:"}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u4e2a\u4f8b\u5b50\u5c55\u793a\u4e86\u5728select\u5217\u8868\u4e2d\u589e\u52a0\u4e00\u4e2aid\u5217\uff0c\u5b83\u7684\u503c\u662f1\uff0c2\uff0c3\u7b49\u7b49\uff0c\u987a\u5e8f\u6309\u7167events\u8868\u4e2d\u7684date_and_time\u5217\u6392\u5e8f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"SELECT row_number() OVER (ORDER BY date_and_time) AS id,\n    c1, c2, c3, c4\nFROM events;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"window-clause",children:"Window Clause"}),"\n",(0,s.jsx)(e.p,{children:"Window\u4ece\u53e5\u7528\u6765\u4e3a\u7a97\u53e3\u51fd\u6570\u6307\u5b9a\u4e00\u4e2a\u8fd0\u7b97\u8303\u56f4\uff0c\u4ee5\u5f53\u524d\u884c\u4e3a\u51c6\uff0c\u524d\u540e\u82e5\u5e72\u884c\u4f5c\u4e3a\u7a97\u53e3\u51fd\u6570\u8fd0\u7b97\u7684\u5bf9\u8c61\u3002Window\u4ece\u53e5\u652f\u6301\u7684\u65b9\u6cd5\u6709\uff1aAVG(), COUNT(), FIRST_VALUE(), LAST_VALUE()\u548cSUM()\u3002\u5bf9\u4e8e MAX()\u548cMIN(), window\u4ece\u53e5\u53ef\u4ee5\u6307\u5b9a\u5f00\u59cb\u8303\u56f4UNBOUNDED PRECEDING"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"ROWS BETWEEN [ { m | UNBOUNDED } PRECEDING | CURRENT ROW] [ AND [CURRENT ROW | { UNBOUNDED | n } FOLLOWING] ]\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.p,{children:"\u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b\u7684\u80a1\u7968\u6570\u636e\uff0c\u80a1\u7968\u4ee3\u7801\u662fJDR\uff0cclosing price\u662f\u6bcf\u5929\u7684\u6536\u76d8\u4ef7\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"create table stock_ticker (\n    stock_symbol string,\n    closing_price decimal(8,2),\n    closing_date timestamp);\n\n-- ...load some data...\n\nselect *\nfrom stock_ticker\norder by stock_symbol, closing_date\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5f97\u5230\u539f\u59cb\u6570\u636e\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+--------------+---------------+---------------------+\n| stock_symbol | closing_price | closing_date        |\n+--------------+---------------+---------------------+\n| JDR          | 12.86         | 2014-10-02 00:00:00 |\n| JDR          | 12.89         | 2014-10-03 00:00:00 |\n| JDR          | 12.94         | 2014-10-04 00:00:00 |\n| JDR          | 12.55         | 2014-10-05 00:00:00 |\n| JDR          | 14.03         | 2014-10-06 00:00:00 |\n| JDR          | 14.75         | 2014-10-07 00:00:00 |\n| JDR          | 13.98         | 2014-10-08 00:00:00 |\n+--------------+---------------+---------------------+\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u4e2a\u67e5\u8be2\u4f7f\u7528\u7a97\u53e3\u51fd\u6570\u4ea7\u751fmoving_average\u8fd9\u4e00\u5217\uff0c\u5b83\u7684\u503c\u662f3\u5929\u7684\u80a1\u7968\u5747\u4ef7\uff0c\u5373\u524d\u4e00\u5929\u3001\u5f53\u524d\u4ee5\u53ca\u540e\u4e00\u5929\u4e09\u5929\u7684\u5747\u4ef7\u3002\u7b2c\u4e00\u5929\u6ca1\u6709\u524d\u4e00\u5929\u7684\u503c\uff0c\u6700\u540e\u4e00\u5929\u6ca1\u6709\u540e\u4e00\u5929\u7684\u503c\uff0c\u6240\u4ee5\u8fd9\u4e24\u884c\u53ea\u8ba1\u7b97\u4e86\u4e24\u5929\u7684\u5747\u503c\u3002\u8fd9\u91ccPartition By\u6ca1\u6709\u8d77\u5230\u4f5c\u7528\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u6570\u636e\u90fd\u662fJDR\u7684\u6570\u636e\uff0c\u4f46\u5982\u679c\u8fd8\u6709\u5176\u4ed6\u80a1\u7968\u4fe1\u606f\uff0cPartition By\u4f1a\u4fdd\u8bc1\u7a97\u53e3\u51fd\u6570\u503c\u4f5c\u7528\u5728\u672cPartition\u4e4b\u5185\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select stock_symbol, closing_date, closing_price,\n    avg(closing_price)\n        over (partition by stock_symbol\n              order by closing_date\n              rows between 1 preceding and 1 following\n        ) as moving_average\nfrom stock_ticker;\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5f97\u5230\u5982\u4e0b\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+--------------+---------------------+---------------+----------------+\n| stock_symbol | closing_date        | closing_price | moving_average |\n+--------------+---------------------+---------------+----------------+\n| JDR          | 2014-10-02 00:00:00 | 12.86         | 12.87          |\n| JDR          | 2014-10-03 00:00:00 | 12.89         | 12.89          |\n| JDR          | 2014-10-04 00:00:00 | 12.94         | 12.79          |\n| JDR          | 2014-10-05 00:00:00 | 12.55         | 13.17          |\n| JDR          | 2014-10-06 00:00:00 | 14.03         | 13.77          |\n| JDR          | 2014-10-07 00:00:00 | 14.75         | 14.25          |\n| JDR          | 2014-10-08 00:00:00 | 13.98         | 14.36          |\n+--------------+---------------------+---------------+----------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h2,{id:"\u51fd\u6570\u4e3e\u4f8b",children:"\u51fd\u6570\u4e3e\u4f8b"}),"\n",(0,s.jsx)(e.p,{children:"\u672c\u8282\u4ecb\u7ecdStarRocks\u4e2d\u53ef\u4ee5\u7528\u4f5c\u7a97\u53e3\u51fd\u6570\u7684\u65b9\u6cd5\u3002"}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"avg",children:"AVG()"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"AVG([DISTINCT | ALL] *expression*) [OVER (*analytic_clause*)]\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.p,{children:["\u8ba1\u7b97\u5f53\u524d\u884c\u548c\u5b83",(0,s.jsx)(e.strong,{children:"\u524d\u540e\u5404\u4e00\u884c"}),"\u6570\u636e\u7684x\u5e73\u5747\u503c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, property,\n    avg(x)\n        over (\n            partition by property\n            order by x\n            rows between 1 preceding and 1 following\n        ) as 'moving average'\nfrom int_t\nwhere property in ('odd','even');\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+----+----------+----------------+\n| x  | property | moving average |\n+----+----------+----------------+\n| 2  | even     | 3              |\n| 4  | even     | 4              |\n| 6  | even     | 6              |\n| 8  | even     | 8              |\n| 10 | even     | 9              |\n| 1  | odd      | 2              |\n| 3  | odd      | 3              |\n| 5  | odd      | 5              |\n| 7  | odd      | 7              |\n| 9  | odd      | 8              |\n+----+----------+----------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"count",children:"COUNT()"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"COUNT([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.p,{children:["\u8ba1\u7b97\u4ece",(0,s.jsx)(e.strong,{children:"\u5f53\u524d\u884c\u5230\u7b2c\u4e00\u884c"}),"x\u51fa\u73b0\u7684\u6b21\u6570\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, property,\n    count(x)\n        over (\n            partition by property\n            order by x\n            rows between unbounded preceding and current row\n        ) as 'cumulative total'\nfrom int_t where property in ('odd','even');\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+----+----------+------------------+\n| x  | property | cumulative count |\n+----+----------+------------------+\n| 2  | even     | 1                |\n| 4  | even     | 2                |\n| 6  | even     | 3                |\n| 8  | even     | 4                |\n| 10 | even     | 5                |\n| 1  | odd      | 1                |\n| 3  | odd      | 2                |\n| 5  | odd      | 3                |\n| 7  | odd      | 4                |\n| 9  | odd      | 5                |\n+----+----------+------------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"dense_rank",children:"DENSE_RANK()"}),"\n",(0,s.jsxs)(e.p,{children:["DENSE_RANK()\u51fd\u6570\u7528\u6765\u8868\u793a\u6392\u540d\uff0c\u4e0eRANK()\u4e0d\u540c\u7684\u662f\uff0cDENSE_RANK()",(0,s.jsx)(e.strong,{children:"\u4e0d\u4f1a\u51fa\u73b0\u7a7a\u7f3a"}),"\u6570\u5b57\u3002\u6bd4\u5982\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u4e24\u4e2a\u5e76\u5217\u76841\uff0cDENSE_RANK()\u7684\u7b2c\u4e09\u4e2a\u6570\u4ecd\u7136\u662f2\uff0c\u800cRANK()\u7684\u7b2c\u4e09\u4e2a\u6570\u662f3\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"DENSE_RANK() OVER(partition_by_clause order_by_clause)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a\n\u4e0b\u4f8b\u5c55\u793a\u4e86\u6309\u7167property\u5217\u5206\u7ec4\u5bf9x\u5217\u6392\u540d\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, y,\n    dense_rank()\n        over (\n            partition by x\n            order by y\n        ) as `rank`\nfrom int_t;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---+---+------+\n| x | y | rank |\n+---+---+------+\n| 1 | 1 | 1    |\n| 1 | 2 | 2    |\n| 1 | 2 | 2    |\n| 2 | 1 | 1    |\n| 2 | 2 | 2    |\n| 2 | 3 | 3    |\n| 3 | 1 | 1    |\n| 3 | 1 | 1    |\n| 3 | 2 | 2    |\n+---+---+------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"first_value",children:"FIRST_VALUE()"}),"\n",(0,s.jsxs)(e.p,{children:["FIRST_VALUE()\u8fd4\u56de\u7a97\u53e3\u8303\u56f4\u5185\u7684",(0,s.jsx)(e.strong,{children:"\u7b2c\u4e00\u4e2a"}),"\u503c\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"FIRST_VALUE(expr) OVER(partition_by_clause order_by_clause [window_clause])\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.p,{children:"\u6211\u4eec\u6709\u5982\u4e0b\u6570\u636e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select name, country, greeting\nfrom mail_merge;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---------+---------+--------------+\n| name    | country | greeting     |\n+---------+---------+--------------+\n| Pete    | USA     | Hello        |\n| John    | USA     | Hi           |\n| Boris   | Germany | Guten tag    |\n| Michael | Germany | Guten morgen |\n| Bjorn   | Sweden  | Hej          |\n| Mats    | Sweden  | Tja          |\n+---------+---------+--------------+\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528FIRST_VALUE()\uff0c\u6839\u636ecountry\u5206\u7ec4\uff0c\u8fd4\u56de\u6bcf\u4e2a\u5206\u7ec4\u4e2d\u7b2c\u4e00\u4e2agreeting\u7684\u503c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select country, name,\n    first_value(greeting)\n        over (\n            partition by country\n            order by name, greeting\n        ) as greeting\nfrom mail_merge;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---------+---------+-----------+\n| country | name    | greeting  |\n+---------+---------+-----------+\n| Germany | Boris   | Guten tag |\n| Germany | Michael | Guten tag |\n| Sweden  | Bjorn   | Hej       |\n| Sweden  | Mats    | Hej       |\n| USA     | John    | Hi        |\n| USA     | Pete    | Hi        |\n+---------+---------+-----------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"lag",children:"LAG()"}),"\n",(0,s.jsxs)(e.p,{children:["LAG()\u65b9\u6cd5\u7528\u6765\u8ba1\u7b97\u5f53\u524d\u884c",(0,s.jsx)(e.strong,{children:"\u5411\u524d"}),"\u6570\u82e5\u5e72\u884c\u7684\u503c\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"LAG (expr, offset, default) OVER (partition_by_clause order_by_clause)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"expr"}),": \u9700\u8981\u8ba1\u7b97\u7684\u76ee\u6807\u5b57\u6bb5\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"offset"}),": \u504f\u79fb\u91cf\uff0c\u8868\u793a\u5411\u524d\u67e5\u627e\u7684\u884c\u6570\uff0c\u5fc5\u987b\u4e3a",(0,s.jsx)(e.strong,{children:"\u6b63\u6574\u6570"}),"\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u9ed8\u8ba4\u6309\u7167 1 \u5904\u7406\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"default"}),": \u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u884c\u65f6\uff0c\u8fd4\u56de\u7684\u9ed8\u8ba4\u503c\u3002\u5982\u679c\u672a\u6307\u5b9a ",(0,s.jsx)(e.code,{children:"default"}),"\uff0c\u9ed8\u8ba4\u8fd4\u56de NULL\u3002",(0,s.jsx)(e.code,{children:"default"})," \u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u548c ",(0,s.jsx)(e.code,{children:"expr"})," \u517c\u5bb9\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u8ba1\u7b97 ",(0,s.jsx)(e.code,{children:"stock_ticker"})," \u8868\u4e2d\u80a1\u7968 JDR ",(0,s.jsx)(e.strong,{children:"\u524d\u4e00\u5929"}),"\u7684\u6536\u76d8\u4ef7 ",(0,s.jsx)(e.code,{children:"closing_price"}),"\u3002",(0,s.jsx)(e.code,{children:"default"})," \u8bbe\u7f6e\u4e3a 0\uff0c\u8868\u793a\u5982\u679c\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u884c\uff0c\u5219\u8fd4\u56de 0\uff0c\u6bd4\u5982\u4e0b\u9762\u793a\u4f8b\u4e2d\u8fd4\u56de\u7ed3\u679c\u7684\u7b2c\u4e00\u884c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:'select stock_symbol, closing_date, closing_price,\n    lag(closing_price,1, 0) over\n    (\n        partition by stock_symbol\n        order by closing_date\n    ) as "yesterday closing"\nfrom stock_ticker\norder by closing_date;\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+--------------+---------------------+---------------+-------------------+\n| stock_symbol | closing_date        | closing_price | yesterday closing |\n+--------------+---------------------+---------------+-------------------+\n| JDR          | 2014-09-13 00:00:00 | 12.86         | 0                 |\n| JDR          | 2014-09-14 00:00:00 | 12.89         | 12.86             |\n| JDR          | 2014-09-15 00:00:00 | 12.94         | 12.89             |\n| JDR          | 2014-09-16 00:00:00 | 12.55         | 12.94             |\n| JDR          | 2014-09-17 00:00:00 | 14.03         | 12.55             |\n| JDR          | 2014-09-18 00:00:00 | 14.75         | 14.03             |\n| JDR          | 2014-09-19 00:00:00 | 13.98         | 14.75             |\n+--------------+---------------------+---------------+-------------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"last_value",children:"LAST_VALUE()"}),"\n",(0,s.jsxs)(e.p,{children:["LAST_VALUE()\u8fd4\u56de\u7a97\u53e3\u8303\u56f4\u5185\u7684",(0,s.jsx)(e.strong,{children:"\u6700\u540e\u4e00\u4e2a"}),"\u503c\u3002\u4e0eFIRST_VALUE()\u76f8\u53cd\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"LAST_VALUE(expr) OVER(partition_by_clause order_by_clause [window_clause])\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528FIRST_VALUE()\u4e3e\u4f8b\u4e2d\u7684\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select country, name,\n    last_value(greeting)\n        over (\n            partition by country\n            order by name, greeting\n        ) as greeting\nfrom mail_merge;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---------+---------+--------------+\n| country | name    | greeting     |\n+---------+---------+--------------+\n| Germany | Boris   | Guten morgen |\n| Germany | Michael | Guten morgen |\n| Sweden  | Bjorn   | Tja          |\n| Sweden  | Mats    | Tja          |\n| USA     | John    | Hello        |\n| USA     | Pete    | Hello        |\n+---------+---------+--------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"lead",children:"LEAD()"}),"\n",(0,s.jsxs)(e.p,{children:["LEAD()\u65b9\u6cd5\u7528\u6765\u8ba1\u7b97\u5f53\u524d\u884c",(0,s.jsx)(e.strong,{children:"\u5411\u540e"}),"\u6570\u82e5\u5e72\u884c\u7684\u503c\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"LEAD (expr, offset, default]) OVER (partition_by_clause order_by_clause)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"expr"}),": \u9700\u8981\u8ba1\u7b97\u7684\u76ee\u6807\u5b57\u6bb5\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"offset"}),": \u504f\u79fb\u91cf\uff0c\u8868\u793a\u5411\u540e\u67e5\u627e\u7684\u884c\u6570\uff0c\u5fc5\u987b\u4e3a",(0,s.jsx)(e.strong,{children:"\u6b63\u6574\u6570"}),"\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u9ed8\u8ba4\u6309\u7167 1 \u5904\u7406\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"default"}),": \u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u884c\u65f6\uff0c\u8fd4\u56de\u7684\u9ed8\u8ba4\u503c\u3002\u5982\u679c\u672a\u6307\u5b9a ",(0,s.jsx)(e.code,{children:"default"}),"\uff0c\u9ed8\u8ba4\u8fd4\u56de NULL\u3002",(0,s.jsx)(e.code,{children:"default"})," \u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u548c ",(0,s.jsx)(e.code,{children:"expr"})," \u517c\u5bb9\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u4e0b\u793a\u4f8b\u8ba1\u7b97\u7b2c\u4e8c\u5929\u7684\u6536\u76d8\u4ef7\u5bf9\u6bd4\u5f53\u5929\u6536\u76d8\u4ef7\u7684\u8d70\u52bf\uff0c\u5373\u7b2c\u4e8c\u5929\u6536\u76d8\u4ef7\u6bd4\u5f53\u5929\u9ad8\u8fd8\u662f\u4f4e\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"default"})," \u8bbe\u7f6e\u4e3a 0\uff0c\u8868\u793a\u5982\u679c\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u884c\uff0c\u5219\u8fd4\u56de 0\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:'select stock_symbol, closing_date, closing_price,\n    case\n        (lead(closing_price,1, 0)\n            over (partition by stock_symbol\n                  order by closing_date)\n         - closing_price) > 0\n    when true then "higher"\n    when false then "flat or lower"\n    end as "trending"\nfrom stock_ticker\norder by closing_date;\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+--------------+---------------------+---------------+---------------+\n| stock_symbol | closing_date        | closing_price | trending      |\n+--------------+---------------------+---------------+---------------+\n| JDR          | 2014-09-13 00:00:00 | 12.86         | higher        |\n| JDR          | 2014-09-14 00:00:00 | 12.89         | higher        |\n| JDR          | 2014-09-15 00:00:00 | 12.94         | flat or lower |\n| JDR          | 2014-09-16 00:00:00 | 12.55         | higher        |\n| JDR          | 2014-09-17 00:00:00 | 14.03         | higher        |\n| JDR          | 2014-09-18 00:00:00 | 14.75         | flat or lower |\n| JDR          | 2014-09-19 00:00:00 | 13.98         | flat or lower |\n+--------------+---------------------+---------------+---------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"max",children:"MAX()"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"MAX([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.p,{children:["\u8ba1\u7b97",(0,s.jsx)(e.strong,{children:"\u4ece\u7b2c\u4e00\u884c\u5230\u5f53\u524d\u884c\u4e4b\u540e\u4e00\u884c"}),"\u7684\u6700\u5927\u503c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, property,\n    max(x)\n        over (\n            order by property, x\n            rows between unbounded preceding and 1 following\n        ) as 'local maximum'\nfrom int_t\nwhere property in ('prime','square');\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---+----------+---------------+\n| x | property | local maximum |\n+---+----------+---------------+\n| 2 | prime    | 3             |\n| 3 | prime    | 5             |\n| 5 | prime    | 7             |\n| 7 | prime    | 7             |\n| 1 | square   | 7             |\n| 4 | square   | 9             |\n| 9 | square   | 9             |\n+---+----------+---------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"min",children:"MIN()"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"MIN([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.p,{children:["\u8ba1\u7b97",(0,s.jsx)(e.strong,{children:"\u4ece\u7b2c\u4e00\u884c\u5230\u5f53\u524d\u884c\u4e4b\u540e\u4e00\u884c"}),"\u7684\u6700\u5c0f\u503c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, property,\n    min(x)\n        over (\n            order by property, x desc\n            rows between unbounded preceding and 1 following\n        ) as 'local minimum'\nfrom int_t\nwhere property in ('prime','square');\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---+----------+---------------+\n| x | property | local minimum |\n+---+----------+---------------+\n| 7 | prime    | 5             |\n| 5 | prime    | 3             |\n| 3 | prime    | 2             |\n| 2 | prime    | 2             |\n| 9 | square   | 2             |\n| 4 | square   | 1             |\n| 1 | square   | 1             |\n+---+----------+---------------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"rank",children:"RANK()"}),"\n",(0,s.jsxs)(e.p,{children:["RANK()\u51fd\u6570\u7528\u6765\u8868\u793a\u6392\u540d\uff0c\u4e0eDENSE_RANK()\u4e0d\u540c\u7684\u662f\uff0cRANK()\u4f1a",(0,s.jsx)(e.strong,{children:"\u51fa\u73b0\u7a7a\u7f3a"}),"\u6570\u5b57\u3002\u6bd4\u5982\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u4e24\u4e2a\u5e76\u5217\u76841\uff0cRANK()\u7684\u7b2c\u4e09\u4e2a\u6570\u5c31\u662f3\uff0c\u800c\u4e0d\u662f2\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"RANK() OVER(partition_by_clause order_by_clause)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.p,{children:"\u6839\u636ex\u5217\u8fdb\u884c\u6392\u540d"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, y, \n    rank() over(\n        partition by x \n        order by y\n    ) as `rank`\nfrom int_t;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---+---+------+\n| x | y | rank |\n+---+---+------+\n| 1 | 1 | 1    |\n| 1 | 2 | 2    |\n| 1 | 2 | 2    |\n| 2 | 1 | 1    |\n| 2 | 2 | 2    |\n| 2 | 3 | 3    |\n| 3 | 1 | 1    |\n| 3 | 1 | 1    |\n| 3 | 2 | 3    |\n+---+---+------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"row_number",children:"ROW_NUMBER()"}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u6bcf\u4e2aPartition\u7684\u6bcf\u4e00\u884c\u8fd4\u56de\u4e00\u4e2a\u4ece1\u5f00\u59cb\u8fde\u7eed\u9012\u589e\u7684\u6574\u6570\u3002\u4e0eRANK()\u548cDENSE_RANK()\u4e0d\u540c\u7684\u662f\uff0cROW_NUMBER()\u8fd4\u56de\u7684\u503c",(0,s.jsx)(e.strong,{children:"\u4e0d\u4f1a\u91cd\u590d\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u7a7a\u7f3a"}),"\uff0c\u662f",(0,s.jsx)(e.strong,{children:"\u8fde\u7eed\u9012\u589e"}),"\u7684\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"ROW_NUMBER() OVER(partition_by_clause order_by_clause)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, y, \n    row_number() over(\n        partition by x \n        order by y\n    ) as `rank`\nfrom int_t;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+---+---+------+\n| x | y | rank |\n+---+---+------+\n| 1 | 1 | 1    |\n| 1 | 2 | 2    |\n| 1 | 2 | 3    |\n| 2 | 1 | 1    |\n| 2 | 2 | 2    |\n| 2 | 3 | 3    |\n| 3 | 1 | 1    |\n| 3 | 1 | 2    |\n| 3 | 2 | 3    |\n+---+---+------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.h3,{id:"sum",children:"SUM()"}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"SUM([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,s.jsxs)(e.p,{children:["\u6309\u7167property\u8fdb\u884c\u5206\u7ec4\uff0c\u5728\u7ec4\u5185\u8ba1\u7b97",(0,s.jsx)(e.strong,{children:"\u5f53\u524d\u884c\u4ee5\u53ca\u524d\u540e\u5404\u4e00\u884c"}),"\u7684x\u5217\u7684\u548c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-SQL",children:"select x, property,\n    sum(x)\n        over (\n            partition by property\n            order by x\n            rows between 1 preceding and 1 following\n        ) as 'moving total'\nfrom int_t where property in ('odd','even');\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-Plain",metastring:"Text",children:"+----+----------+--------------+\n| x  | property | moving total |\n+----+----------+--------------+\n| 2  | even     | 6            |\n| 4  | even     | 12           |\n| 6  | even     | 18           |\n| 8  | even     | 24           |\n| 10 | even     | 18           |\n| 1  | odd      | 4            |\n| 3  | odd      | 9            |\n| 5  | odd      | 15           |\n| 7  | odd      | 21           |\n+----+----------+--------------+\n"})})]})}const x=function(n={}){const{wrapper:e}=Object.assign({},(0,l.ah)(),n.components);return e?(0,s.jsx)(e,Object.assign({},n,{children:(0,s.jsx)(t,n)})):t(n)}},11151:(n,e,r)=>{r.d(e,{Zo:()=>a,ah:()=>i});var s=r(67294);const l=s.createContext({});function i(n){const e=s.useContext(l);return s.useMemo((()=>"function"==typeof n?n(e):{...e,...n}),[e,n])}const c={};function a({components:n,children:e,disableParentContext:r}){let a;return a=r?"function"==typeof n?n({}):n||c:i(n),s.createElement(l.Provider,{value:a},e)}}}]);