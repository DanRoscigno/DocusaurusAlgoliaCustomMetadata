"use strict";(self.webpackChunkstarrocks=self.webpackChunkstarrocks||[]).push([[50708],{9011:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>o});var s=a(85893),l=a(11151);const r={displayed_sidebar:"Chinese"},t="\u4ecb\u7ecd",i={id:"loading/Json_loading",title:"\u4ecb\u7ecd",description:"\u5bf9\u4e8e\u4e00\u4e9b\u534a\u7ed3\u6784\u5316\u7684\u6bd4\u5982Json\u7c7b\u578b\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528stream load \u6216\u8005 routine load\u7684\u65b9\u5f0f\u8fdb\u884c\u5bfc\u5165\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-2.0/loading/Json_loading.md",sourceDirName:"loading",slug:"/loading/Json_loading",permalink:"/zh/docs/2.0/loading/Json_loading",draft:!1,unlisted:!1,editUrl:"https://github.com/StarRocks/docs.zh-cn/edit/main/loading/Json_loading.md",tags:[],version:"2.0",frontMatter:{displayed_sidebar:"Chinese"},sidebar:"Chinese",previous:{title:"Insert Into \u5bfc\u5165",permalink:"/zh/docs/2.0/loading/InsertInto"},next:{title:"\u5bfc\u5165",permalink:"/zh/docs/2.0/loading/Loading_intro"}},c={},o=[{value:"\u4f7f\u7528\u573a\u666f",id:"\u4f7f\u7528\u573a\u666f",level:2},{value:"Stream Load\u5bfc\u5165",id:"stream-load\u5bfc\u5165",level:3},{value:"Routine Load\u5bfc\u5165",id:"routine-load\u5bfc\u5165",level:3},{value:"\u4f7f\u7528Canal\u4ecemysql\u4e2d\u589e\u91cf\u540c\u6b65binlog\u5bfc\u5165StarRocks",id:"\u4f7f\u7528canal\u4ecemysql\u4e2d\u589e\u91cf\u540c\u6b65binlog\u5bfc\u5165starrocks",level:3}];function d(n){const e=Object.assign({h1:"h1",p:"p",h2:"h2",ul:"ul",li:"li",h3:"h3",pre:"pre",code:"code",img:"img",blockquote:"blockquote",ol:"ol",a:"a"},(0,l.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"\u4ecb\u7ecd",children:"\u4ecb\u7ecd"}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8e\u4e00\u4e9b\u534a\u7ed3\u6784\u5316\u7684\u6bd4\u5982Json\u7c7b\u578b\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528stream load \u6216\u8005 routine load\u7684\u65b9\u5f0f\u8fdb\u884c\u5bfc\u5165\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u4f7f\u7528\u573a\u666f",children:"\u4f7f\u7528\u573a\u666f"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Stream Load\uff1a \u5bf9\u4e8e\u6587\u672c\u6587\u4ef6\u5b58\u50a8\u7684Json\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 stream load\u8fdb\u884c\u5bfc\u5165\u3002"}),"\n",(0,s.jsx)(e.li,{children:"Routine Load\uff1a\u5bf9\u4e8eKafka\u4e2d\u7684json\u683c\u5f0f\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528Routine load\u7684\u65b9\u5f0f\u5bfc\u5165\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"stream-load\u5bfc\u5165",children:"Stream Load\u5bfc\u5165"}),"\n",(0,s.jsx)(e.p,{children:"\u6837\u4f8b\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{ "id": 123, "city" : "beijing"},\n{ "id": 456, "city" : "shanghai"},\n    ...\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'curl -v --location-trusted -u root: \\\n    -H "format: json" -H "jsonpaths: [\\"$.id\\", \\"$.city\\"]" \\\n    -T example.json \\\n    http://FE_HOST:HTTP_PORT/api/DATABASE/TABLE/_stream_load\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u901a\u8fc7 format: json \u53c2\u6570\u53ef\u4ee5\u6267\u884c\u5bfc\u5165\u7684\u6570\u636e\u683c\u5f0f jsonpaths \u7528\u6765\u6267\u884c\u5bf9\u5e94\u7684\u6570\u636e\u5bfc\u5165\u8def\u5f84"}),"\n",(0,s.jsx)(e.p,{children:"\u76f8\u5173\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"jsonpaths : \u9009\u62e9\u6bcf\u4e00\u5217\u7684json\u8def\u5f84"}),"\n",(0,s.jsx)(e.li,{children:"json_root : \u9009\u62e9json\u5f00\u59cb\u89e3\u6790\u7684\u5217"}),"\n",(0,s.jsx)(e.li,{children:"strip_outer_array \uff1a \u88c1\u526a\u6700\u5916\u9762\u7684 array \u5b57\u6bb5\uff08\u53ef\u4ee5\u89c1\u4e0b\u4e00\u4e2a\u6837\u4f8b\uff09"}),"\n",(0,s.jsx)(e.li,{children:"strict_mode\uff1a\u5bfc\u5165\u8fc7\u7a0b\u4e2d\u7684\u5217\u7c7b\u578b\u8f6c\u6362\u8fdb\u884c\u4e25\u683c\u8fc7\u6ee4"}),"\n",(0,s.jsx)(e.li,{children:"columns:\u5bf9\u5e94StarRocks\u8868\u4e2d\u7684\u5b57\u6bb5\u7684\u540d\u79f0"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"jsonpaths\u53c2\u6570\u548ccolumns\u53c2\u6570\u8fd8\u6709StarRocks\u8868\u4e2d\u5b57\u6bb5\u4e09\u8005\u5173\u7cfb\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"jsonpaths\u7684\u503c\u540d\u79f0\u4e0ejson\u6587\u4ef6\u4e2d\u7684key\u7684\u540d\u79f0\u4e00\u81f4"}),"\n",(0,s.jsx)(e.li,{children:"columns\u7684\u503c\u7684\u540d\u79f0\u548cStarRocks\u8868\u4e2d\u5b57\u6bb5\u540d\u79f0\u4fdd\u6301\u4e00\u81f4"}),"\n",(0,s.jsx)(e.li,{children:"columns\u548cjsonpaths\u5c5e\u6027\u7684\u503c\uff0c\u540d\u79f0\u4e0d\u9700\u8981\u4fdd\u6301\u4e00\u81f4(\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u4e00\u81f4\u65b9\u4fbf\u533a\u5206)\uff0c\u503c\u7684\u987a\u5e8f\u4fdd\u6301\u4e00\u81f4\u5c31\u53ef\u4ee5\u5c06json\u6587\u4ef6\u4e2d\u7684value\u548cStarRocks\u8868\u4e2d\u5b57\u6bb5\u5bf9\u5e94\u8d77\u6765\uff0c\u5982\u4e0b\u56fe\uff1a"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"streamload",src:a(35291).Z+"",width:"1001",height:"663"})}),"\n",(0,s.jsx)(e.p,{children:"\u6837\u4f8b\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{"name": "\u5317\u4eac", "code": 2}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u793a\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'curl -v --location-trusted -u root: \\\n    -H "format: json" -H "jsonpaths: [\\"$.name\\", \\"$.code\\"]" \\\n    -H "columns: city,tmp_id, id = tmp_id * 100" \\\n    -T jsontest.json \\\n    http://127.0.0.1:8030/api/test/testJson/_stream_load\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u540e\u7ed3\u679c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plain",metastring:"text",children:"+------+------+\n|  id  | city |\n+------+------+\n| \xa0200 | \u5317\u4eac |\n+------+------+\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60f3\u5148\u5bf9Json\u4e2d\u6570\u636e\u8fdb\u884c\u52a0\u5de5\uff0c\u7136\u540e\u518d\u843d\u5165StarRocks\u8868\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539columns\u7684\u503c\u6765\u5b9e\u73b0\uff0c\u5c5e\u6027\u7684\u5bf9\u5e94\u5173\u7cfb\u53ef\u4ee5\u53c2\u8003\u4e0a\u56fe\u4e2d\u63cf\u8ff0\uff0c\u793a\u4f8b\u5982\u4e0b:"}),"\n",(0,s.jsx)(e.p,{children:"\u6837\u4f8b\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{"k1": 1, "k2": 2}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u793a\u4f8b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'curl -v --location-trusted -u root: \\\n    -H "format: json" -H "jsonpaths: [\\"$.k2\\", \\"$.k1\\"]" \\\n    -H "columns: k2, tmp_k1, k1 = tmp_k1 * 100" \\\n    -T example.json \\\n    http://127.0.0.1:8030/api/db1/tbl1/_stream_load\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u91cc\u5bfc\u5165\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u4e86\u5c06k1\u4e58\u4ee5100\u7684ETL\u64cd\u4f5c\uff0c\u5e76\u4e14\u901a\u8fc7Jsonpath\u6765\u8fdb\u884ccolumn\u548c\u539f\u59cb\u6570\u636e\u7684\u5bf9\u5e94"}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u540e\u7ed3\u679c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plain",metastring:"text",children:"+------+------+\n|  k1 \xa0|  k2  |\n+------+------+\n| \xa0100 | \xa02   |\n+------+------+\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8e\u7f3a\u5931\u7684\u5217 \u5982\u679c\u5217\u7684\u5b9a\u4e49\u662fnullable\uff0c\u90a3\u4e48\u4f1a\u8865\u4e0aNULL\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7ifnull\u8865\u5145\u9ed8\u8ba4\u503c\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u6837\u4f8b\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'[\n    {"k1": 1, "k2": "a"},\n    {"k1": 2},\n    {"k1": 3, "k2": "c"},\n]\n'})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u91cc\u6700\u5916\u5c42\u6709\u4e00\u5bf9\u8868\u793a json array \u7684\u4e2d\u62ec\u53f7 ",(0,s.jsx)(e.code,{children:"[ ]"}),"\uff0c\u5bfc\u5165\u65f6\u5c31\u9700\u8981\u6307\u5b9a ",(0,s.jsx)(e.code,{children:"strip_outer_array = true"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u793a\u4f8b-1\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'curl -v --location-trusted -u root: \\\n    -H "format: json" -H "strip_outer_array: true" \\\n    -T example.json \\\n    http://127.0.0.1:8030/api/db1/tbl1/_stream_load\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u540e\u7ed3\u679c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plain",metastring:"text",children:"+------+------+\n|  k1 \xa0| k2   |\n+------+------+\n| \xa0\xa01  | a    |\n+------+------+\n|  \xa02  | NULL |\n+------+------+\n|  \xa03  | c    |\n+------+------+\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u793a\u4f8b-2\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'curl -v --location-trusted -u root: \\\n    -H "format: json" -H "strip_outer_array: true" \\\n    -H "jsonpaths: [\\"$.k1\\", \\"$.k2\\"]" \\\n    -H "columns: k1, tmp_k2, k2 = ifnull(tmp_k2, \'x\')" \\\n    -T example.json \\\n    http://127.0.0.1:8030/api/db1/tbl1/_stream_load\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5bfc\u5165\u540e\u7ed3\u679c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-plain",metastring:"text",children:"+------+------+\n|  k1  |  k2  |\n+------+------+\n| \xa01   |  a   |\n+------+------+\n|\xa0\xa02   |  x   |\n+------+------+\n| \xa03   |  c   |\n+------+------+\n"})}),"\n",(0,s.jsx)(e.h3,{id:"routine-load\u5bfc\u5165",children:"Routine Load\u5bfc\u5165"}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8e Kafka \u6570\u636e\u6e90\uff0c\u548cStream Load\u7684\u539f\u7406\u7c7b\u4f3c\uff0c\u6bcf\u4e2a Massage \u4e2d\u7684\u5185\u5bb9\u88ab\u89c6\u4f5c\u4e00\u4e2a\u5b8c\u6574\u7684 Json \u6570\u636e\u3002"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u5982\u679c\u4e00\u4e2a Massage \u4e2d\u662f\u4ee5 Array \u683c\u5f0f\u7684\u8868\u793a\u7684\u591a\u884c\u6570\u636e\uff0c\u5219\u4f1a\u5bfc\u5165\u591a\u884c\uff0c\u800c Kafka \u7684 offset \u53ea\u4f1a\u589e\u52a0 1\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u5982\u679c\u4e00\u4e2a Array \u683c\u5f0f\u7684 Json \u8868\u793a\u591a\u884c\u6570\u636e\uff0c\u4f46\u662f\u56e0\u4e3a Json \u683c\u5f0f\u9519\u8bef\u5bfc\u81f4\u89e3\u6790 Json \u5931\u8d25\uff0c\u5219\u9519\u8bef\u884c\u53ea\u4f1a\u589e\u52a0 1\uff08\u56e0\u4e3a\u89e3\u6790\u5931\u8d25\uff0c\u5b9e\u9645\u4e0a StarRocks \u65e0\u6cd5\u5224\u65ad\u5176\u4e2d\u5305\u542b\u591a\u5c11\u884c\u6570\u636e\uff0c\u53ea\u80fd\u6309\u4e00\u884c\u9519\u8bef\u6570\u636e\u8bb0\u5f55\uff09\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528canal\u4ecemysql\u4e2d\u589e\u91cf\u540c\u6b65binlog\u5bfc\u5165starrocks",children:"\u4f7f\u7528Canal\u4ecemysql\u4e2d\u589e\u91cf\u540c\u6b65binlog\u5bfc\u5165StarRocks"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://github.com/alibaba/canal",children:"Canal"})," \u662f\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u4e00\u4e2aMysql binlog\u540c\u6b65\u5de5\u5177\uff0c\u901a\u8fc7\u4ed6\u6211\u4eec\u53ef\u4ee5\u628aMysql\u7684\u6570\u636e\u540c\u6b65\u5230Kafka\uff0c\u5728Kafka\u4e2d\u6570\u636e\u662f\u7528Json\u7684\u683c\u5f0f\u751f\u6210\u7684\uff0c\u6211\u4eec\u8fd9\u91cc\u6f14\u793a\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528Routine load\u540c\u6b65kafka\u4e2d\u7684\u6570\u636e\u6765\u5b9e\u73b0\u548cMysql\u8fdb\u884c\u589e\u91cf\u6570\u636e\u540c\u6b65\u7684\u5de5\u4f5c\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728MySQL\u4e2d\u6211\u4eec\u6709\u4e00\u5f20\u6570\u636e\u8868 \u5176\u5efa\u8868\u8bed\u53e5\u5982\u4e0b\uff1a"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `query_record` (\n  `query_id` varchar(64) NOT NULL,\n  `conn_id` int(11) DEFAULT NULL,\n  `fe_host` varchar(32) DEFAULT NULL,\n  `user` varchar(32) DEFAULT NULL,\n  `start_time` datetime NOT NULL,\n  `end_time` datetime DEFAULT NULL,\n  `time_used` double DEFAULT NULL,\n  `state` varchar(16) NOT NULL,\n  `error_message` text,\n  `sql` text NOT NULL,\n  `database` varchar(128) NOT NULL,\n  `profile` longtext,\n  `plan` longtext,\n  PRIMARY KEY (`query_id`),\n  KEY `idx_start_time` (`start_time`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u51c6\u5907\uff1a\u9996\u5148\u786e\u8ba4mysql\u5f00\u542f\u4e86binlog \u5e76\u4e14\u683c\u5f0f\u4e3aROW\u6a21\u5f0f"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"[mysqld]\nlog-bin=mysql-bin # \u5f00\u542f binlog\nbinlog-format=ROW # \u9009\u62e9 ROW \u6a21\u5f0f\nserver_id=1       # \u914d\u7f6e MySQL replaction \u9700\u8981\u5b9a\u4e49\uff0c\u4e0d\u8981\u548c canal \u7684 slaveId \u91cd\u590d\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u521b\u5efa\u4e00\u4e2a\u8d26\u53f7\u5e76\u6388\u4e88Mysql slave\u7684\u6743\u9650"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE USER canal IDENTIFIED BY 'canal';\nGRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'canal'@'%';\n-- GRANT ALL PRIVILEGES ON *.* TO 'canal'@'%';\nFLUSH PRIVILEGES;\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7136\u540e\u6211\u4eec\u4e0b\u8f7d\u5b89\u88c5canal"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"wget https://github.com/alibaba/canal/releases/download/canal-1.0.17/canal.deployer-1.0.17.tar.gz\n\nmkdir /tmp/canal\ntar zxvf canal.deployer-$version.tar.gz\xa0-C /tmp/canal\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4fee\u6539\u914d\u7f6e\uff08mysql \u76f8\u5173\uff09"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"$ vi conf/example/instance.properties"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"## mysql serverId\ncanal.instance.mysql.slaveId = 1234\n#position info\uff0c\u9700\u8981\u6539\u6210\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4fe1\u606f\ncanal.instance.master.address = 127.0.0.1:3306\ncanal.instance.master.journal.name =\ncanal.instance.master.position =\ncanal.instance.master.timestamp =\n#canal.instance.standby.address =\n#canal.instance.standby.journal.name =\n#canal.instance.standby.position =\n#canal.instance.standby.timestamp =\n#username/password\uff0c\u9700\u8981\u6539\u6210\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4fe1\u606f\ncanal.instance.dbUsername = canal \xa0\ncanal.instance.dbPassword = canal\ncanal.instance.defaultDatabaseName =\ncanal.instance.connectionCharset = UTF-8\n#table regex\ncanal.instance.filter.regex = .\\*\\\\\\\\..\\*\n# \u9009\u62e9\u9700\u8981\u540c\u6b65\u7684\u8868\u540d\u548ckafka\u76ee\u6807\u7684\u5206\u533a\u540d\u79f0\ncanal.mq.dynamicTopic=databasename.query_record\ncanal.mq.partitionHash= databasename.query_record:query_id\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4fee\u6539\u914d\u7f6e\uff08kafka \u76f8\u5173\uff09"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"$ vi /usr/local/canal/conf/canal.properties"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# \u53ef\u9009\u9879: tcp(\u9ed8\u8ba4), kafka, RocketMQ\ncanal.serverMode = kafka\n# ...\n# kafka/rocketmq \u96c6\u7fa4\u914d\u7f6e: 192.168.1.117:9092,192.168.1.118:9092,192.168.1.119:9092\ncanal.mq.servers = 127.0.0.1:6667\ncanal.mq.retries = 0\n# flagMessage\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u8c03\u5927\u8be5\u503c, \u4f46\u4e0d\u8981\u8d85\u8fc7MQ\u6d88\u606f\u4f53\u5927\u5c0f\u4e0a\u9650\ncanal.mq.batchSize = 16384\ncanal.mq.maxRequestSize = 1048576\n# flatMessage\u6a21\u5f0f\u4e0b\u8bf7\u5c06\u8be5\u503c\u6539\u5927, \u5efa\u8bae50-200\ncanal.mq.lingerMs = 1\ncanal.mq.bufferMemory = 33554432\n# Canal\u7684batch size, \u9ed8\u8ba450K, \u7531\u4e8ekafka\u6700\u5927\u6d88\u606f\u4f53\u9650\u5236\u8bf7\u52ff\u8d85\u8fc71M(900K\u4ee5\u4e0b)\ncanal.mq.canalBatchSize = 50\n# Canal get\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4, \u5355\u4f4d: \u6beb\u79d2, \u7a7a\u4e3a\u4e0d\u9650\u8d85\u65f6\ncanal.mq.canalGetTimeout = 100\n# \u662f\u5426\u4e3aflat json\u683c\u5f0f\u5bf9\u8c61\ncanal.mq.flatMessage = false\ncanal.mq.compressionType = none\ncanal.mq.acks = all\n# kafka\u6d88\u606f\u6295\u9012\u662f\u5426\u4f7f\u7528\u4e8b\u52a1\ncanal.mq.transaction = false\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u542f\u52a8"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"bin/startup.sh"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728 ",(0,s.jsx)(e.code,{children:"logs/example/example.log"})," \u53ef\u4ee5\u770b\u5230\u76f8\u5e94\u7684\u540c\u6b65\u65e5\u5fd7\u4fe1\u606f\uff0c\u5728kafka\u4e2d\u4e5f\u80fd\u770b\u5230\u6d88\u606f\uff0c\u5176\u6d88\u606f\u683c\u5f0f\u5982\u4e0b"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\n    "data": [{\n        "query_id": "3c7ebee321e94773-b4d79cc3f08ca2ac",\n        "conn_id": "34434",\n        "fe_host": "172.26.34.139",\n        "user": "zhaoheng",\n        "start_time": "2020-10-19 20:40:10.578",\n        "end_time": "2020-10-19 20:40:10",\n        "time_used": "1.0",\n        "state": "FINISHED",\n        "error_message": "",\n        "sql": "COMMIT",\n        "database": "",\n        "profile": "",\n        "plan": ""\n    }, {\n        "query_id": "7ff2df7551d64f8e-804004341bfa63ad",\n        "conn_id": "34432",\n        "fe_host": "172.26.34.139",\n        "user": "zhaoheng",\n        "start_time": "2020-10-19 20:40:10.566",\n        "end_time": "2020-10-19 20:40:10",\n        "time_used": "0.0",\n        "state": "FINISHED",\n        "error_message": "",\n        "sql": "COMMIT",\n        "database": "",\n        "profile": "",\n        "plan": ""\n    }, {\n        "query_id": "3a4b35d1c1914748-be385f5067759134",\n        "conn_id": "34440",\n        "fe_host": "172.26.34.139",\n        "user": "zhaoheng",\n        "start_time": "2020-10-19 20:40:10.601",\n        "end_time": "1970-01-01 08:00:00",\n        "time_used": "-1.0",\n        "state": "RUNNING",\n        "error_message": "",\n        "sql": " SELECT SUM(length(lo_custkey)), SUM(length(c_custkey)) FROM lineorder_str INNER JOIN customer_str ON lo_custkey=c_custkey;",\n        "database": "ssb",\n        "profile": "",\n        "plan": ""\n    }],\n    "database": "center_service_lihailei",\n    "es": 1603111211000,\n    "id": 122,\n    "isDdl": false,\n    "mysqlType": {\n        "query_id": "varchar(64)",\n        "conn_id": "int(11)",\n        "fe_host": "varchar(32)",\n        "user": "varchar(32)",\n        "start_time": "datetime(3)",\n        "end_time": "datetime",\n        "time_used": "double",\n        "state": "varchar(16)",\n        "error_message": "text",\n        "sql": "text",\n        "database": "varchar(128)",\n        "profile": "longtext",\n        "plan": "longtext"\n    },\n    "old": null,\n    "pkNames": ["query_id"],\n    "sql": "",\n    "sqlType": {\n        "query_id": 12,\n        "conn_id": 4,\n        "fe_host": 12,\n        "user": 12,\n        "start_time": 93,\n        "end_time": 93,\n        "time_used": 8,\n        "state": 12,\n        "error_message": 2005,\n        "sql": 2005,\n        "database": 12,\n        "profile": 2005,\n        "plan": 2005\n    },\n    "table": "query_record",\n    "ts": 1603111212015,\n    "type": "INSERT"\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u5bfc\u5165data\u4e2d\u7684\u6570\u636e\uff0c\u6240\u4ee5\u9700\u8981\u52a0\u4e0a json_root \u548c strip_outer_array = true"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:'create routine load manual.query_job on query_record   \ncolumns (query_id,conn_id,fe_host,user,start_time,end_time,time_used,state,error_message,`sql`,`database`,profile,plan)  \nPROPERTIES (  \n    "format"="json",  \n    "json_root"="$.data",\n    "desired_concurrent_number"="1",  \n    "strip_outer_array" ="true",    \n    "max_error_number"="1000" \n) \nFROM KAFKA (     \n    "kafka_broker_list"= "172.26.92.141:9092",     \n    "kafka_topic" = "databasename.query_record" \n);\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u4ecemysql\u5230StarRocks\u7684\u8fd1\u5b9e\u65f6\u540c\u6b65\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u901a\u8fc7",(0,s.jsx)(e.code,{children:"show routine load"})," \u53ef\u4ee5\u770b\u5230\u5bfc\u5165\u4efb\u52a1\u7684\u8fdb\u5ea6\u548c\u9519\u8bef\u4fe1\u606f\u3002"]})]})}const h=function(n={}){const{wrapper:e}=Object.assign({},(0,l.ah)(),n.components);return e?(0,s.jsx)(e,Object.assign({},n,{children:(0,s.jsx)(d,n)})):d(n)}},35291:(n,e,a)=>{a.d(e,{Z:()=>s});const s=a.p+"assets/images/4.8.1-18c0e100b0b6415138140a99b5937362.png"},11151:(n,e,a)=>{a.d(e,{Zo:()=>i,ah:()=>r});var s=a(67294);const l=s.createContext({});function r(n){const e=s.useContext(l);return s.useMemo((()=>"function"==typeof n?n(e):{...e,...n}),[e,n])}const t={};function i({components:n,children:e,disableParentContext:a}){let i;return i=a?"function"==typeof n?n({}):n||t:r(n),s.createElement(l.Provider,{value:i},e)}}}]);