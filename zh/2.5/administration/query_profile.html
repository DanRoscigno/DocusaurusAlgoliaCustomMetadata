<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-chinese docs-version-2.5 docs-doc-page docs-doc-id-administration/query_profile" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-beta.0">
<title data-rh="true">查看分析 Query Profile | StarRocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/doc/zh/2.5/administration/query_profile"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="2.5"><meta data-rh="true" name="docusaurus_tag" content="docs-chinese-2.5"><meta data-rh="true" name="docsearch:version" content="2.5"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-chinese-2.5"><meta data-rh="true" property="og:title" content="查看分析 Query Profile | StarRocks"><meta data-rh="true" name="description" content="本文介绍如何查看并分析 Query Profile。Query Profile 记录了查询中涉及的所有工作节点的执行信息。您可以通过 Query Profile 快速识别影响 StarRocks 集群查询性能的瓶颈。"><meta data-rh="true" property="og:description" content="本文介绍如何查看并分析 Query Profile。Query Profile 记录了查询中涉及的所有工作节点的执行信息。您可以通过 Query Profile 快速识别影响 StarRocks 集群查询性能的瓶颈。"><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/doc/zh/2.5/administration/query_profile"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/zh/2.5/administration/query_profile" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/zh/2.5/administration/query_profile" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ER08SJMRY1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="StarRocks" href="/doc/opensearch.xml"><link rel="stylesheet" href="/doc/assets/css/styles.55e61827.css">
<script src="/doc/assets/js/runtime~main.3f38b808.js" defer="defer"></script>
<script src="/doc/assets/js/main.f42b5291.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.starrocks.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/doc/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StarRocks</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/doc/en/administration/Authentication">English latest</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/en/administration/Authentication">English latest</a></li><li><a class="dropdown__link" href="/doc/en/3.0/administration/Authentication">English 3.0</a></li><li><a class="dropdown__link" href="/doc/en/2.5/administration/Authentication">English 2.5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/doc/zh/2.5/administration/Administration_guide">Chinese 2.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/zh/administration/query_profile">Chinese latest</a></li><li><a class="dropdown__link" href="/doc/zh/3.0/administration/query_profile">Chinese 3.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/doc/zh/2.5/administration/query_profile">Chinese 2.5</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/StarRocks/starrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/doc/zh/2.5/administration/Administration_guide">administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Administration_guide">管理手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Authentication">设置用户认证</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Backup_and_restore">备份与恢复</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Blacklist">管理黑名单</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Build_in_docker">通过源码编译 StarRocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Configuration">配置参数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Data_recovery">恢复数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Deployment">部署 FE 高可用集群</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Load_balance">负载均衡</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Memory_management">管理内存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Monitor_and_Alert">监控报警</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Profiling">优化性能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Query_management">管理查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Query_planning">分析查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Replica">管理副本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/Scale_up_down">扩容缩容 StarRocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/User_privilege">管理用户权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/audit_loader">通过 Audit Loader 管理 StarRocks 中的审计日志</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/deploy_broker">部署 Broker 节点</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/deploy_with_docker">使用 Docker 部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/deploy_with_manager">通过 StarRocks Manager 自动部署 StarRocks 集群</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/enable_fqdn">启用 FQDN 访问</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/filemanager">文件管理器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/information_schema">Information Schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/zh/2.5/administration/query_profile">查看分析 Query Profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/query_queues">查询队列</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/resource_group">资源隔离</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/stargo">使用 StarGo 部署管理 StarRocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/timezone">设置时区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/administration/update_from_doris">升级 Apache Doris 至 StarRocks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/benchmarking/SSB_Benchmarking">benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/data_source/External_table">data_source</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/deployment/deploy_broker">deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/developers/build-starrocks/Build_in_docker">developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/ecosystem_release/flink_connector">ecosystem_release</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/faq/Deploy_faq">faq</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/zh/2.5/feedback-and-contribute">How to feedback and contribute</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/integrations/authenticate_to_aws_resources">integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/introduction/Architecture">introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/loading/BrokerLoad">loading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/zh/2.5/quick_start">quick_start</a><button aria-label="Expand sidebar category &#x27;quick_start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/reference/Error_code">reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/release_notes/release-1.19">release_notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/sql-reference/How_to_write_SQL_command_doc">sql-reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/zh/2.5/table_design">介绍</a><button aria-label="Expand sidebar category &#x27;介绍&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/unloading/Export">unloading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/using_starrocks/Bitmap_index">using_starrocks</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">administration</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">查看分析 Query Profile</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Chinese 2.5</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>查看分析 Query Profile</h1>
<p>本文介绍如何查看并分析 Query Profile。Query Profile 记录了查询中涉及的所有工作节点的执行信息。您可以通过 Query Profile 快速识别影响 StarRocks 集群查询性能的瓶颈。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="启用-query-profile">启用 Query Profile<a href="#启用-query-profile" class="hash-link" aria-label="Direct link to 启用 Query Profile" title="Direct link to 启用 Query Profile">​</a></h2>
<p>针对 StarRocks v2.5 之前的版本，您可以通过将变量 <code>is_report_success</code> 设置为 <code>true</code> 以启用 Query Profile：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> is_report_success </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>针对 StarRocks v2.5 或更高版本，您可以通过将变量 <code>enable_profile</code> 设置为 <code>true</code> 以启用 Query Profile：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> enable_profile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="获取-query-profile">获取 Query Profile<a href="#获取-query-profile" class="hash-link" aria-label="Direct link to 获取 Query Profile" title="Direct link to 获取 Query Profile">​</a></h2>
<blockquote>
<p><strong>说明</strong></p>
<p>如果您使用 StarRocks 企业版，则可以使用 StarRocks Manager 获取并可视化 Query Profile。</p>
</blockquote>
<p>如果您不是 StarRocks 企业版用户，请按照以下步骤获取 Query Profile：</p>
<ol>
<li>在浏览器中访问 <code>http://&lt;fe_ip&gt;:&lt;fe_http_port&gt;</code>。</li>
<li>在显示的页面上，单击顶部导航中的 <strong>queries</strong>。</li>
<li>在 <strong>Finished Queries</strong> 列表中，选择您要分析的查询并单击 <strong>Profile</strong> 列中的链接。</li>
</ol>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-1-e14d11ad744041b7af92ed2ee2b98758.png" width="1280" height="558" class="img_ev3q"></p>
<p>页面将跳转至相应 Query Profile。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-2-2801dbb3484feef652b8a1287838b0e0.png" width="1280" height="587" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="分析-query-profile">分析 Query Profile<a href="#分析-query-profile" class="hash-link" aria-label="Direct link to 分析 Query Profile" title="Direct link to 分析 Query Profile">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-profile-结构">Query Profile 结构<a href="#query-profile-结构" class="hash-link" aria-label="Direct link to Query Profile 结构" title="Direct link to Query Profile 结构">​</a></h3>
<p>以下是示例 Query Profile：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Query:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Summary:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Planner:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Execution Profile </span><span class="token number" style="color:#36acaa">7</span><span class="token plain">de16a85</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">761</span><span class="token plain">c</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token plain">ed</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">917</span><span class="token plain">d</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">00163</span><span class="token plain">e14d435:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Fragment </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Pipeline </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EXCHANGE_SINK </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plan_node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LOCAL_MERGE_SOURCE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plan_node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Pipeline </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LOCAL_SORT_SINK </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plan_node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AGGREGATE_BLOCKING_SOURCE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plan_node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Pipeline </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AGGREGATE_BLOCKING_SINK </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plan_node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EXCHANGE_SOURCE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plan_node_id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Fragment </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Fragment </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Query Profile 由以下三部分组成：</p>
<ul>
<li>Fragment：执行树。一个查询由一个或多个 Fragment 组成。</li>
<li>Pipeline：执行链。执行链没有分支。一个 Fragment 可分为多个 Pipeline。</li>
<li>Operator：算子。一个 Pipeline 由多个 Operator 组成。</li>
</ul>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-3-cdd21397147bec3db5a785705a235493.png" width="1280" height="484" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重要指标">重要指标<a href="#重要指标" class="hash-link" aria-label="Direct link to 重要指标" title="Direct link to 重要指标">​</a></h3>
<p>Query Profile 包含大量查询执行详细信息的指标。在大多数情况下，您只需关注运算符的执行时间以及处理的数据量大小即可。找到瓶颈后，您就可以有针对性地解决它们。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary-指标">Summary 指标<a href="#summary-指标" class="hash-link" aria-label="Direct link to Summary 指标" title="Direct link to Summary 指标">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>Total</td><td>查询消耗的总时间，包括 Planning、Executing 以及 Profiling 阶段耗时。</td></tr><tr><td>QueryCpuCost</td><td>查询累积 CPU 使用时间。所有并发进程累加，因此该指标会大于实际的执行时间。</td></tr><tr><td>QueryMemCost</td><td>查询的总内存消耗。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="operator-通用指标">Operator 通用指标<a href="#operator-通用指标" class="hash-link" aria-label="Direct link to Operator 通用指标" title="Direct link to Operator 通用指标">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>OperatorTotalTime</td><td>Operator 消耗的总时间。</td></tr><tr><td>PushRowNum</td><td>Operator 累积输入行数。</td></tr><tr><td>PullRowNum</td><td>Operator 累积输出行数。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="unique-指标">Unique 指标<a href="#unique-指标" class="hash-link" aria-label="Direct link to Unique 指标" title="Direct link to Unique 指标">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>IOTaskExecTime</td><td>所有 I/O Task 的累计执行时间。</td></tr><tr><td>IOTaskWaitTime</td><td>所有 I/O Task 的累计等待时间。</td></tr><tr><td>MorselsCount</td><td>I/O Task 的总数。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scan-operator">Scan operator<a href="#scan-operator" class="hash-link" aria-label="Direct link to Scan operator" title="Direct link to Scan operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>Table</td><td>表名称。</td></tr><tr><td>ScanTime</td><td>Scan 累计时间。Scan 操作在异步 I/O 线程池中完成。</td></tr><tr><td>TabletCount</td><td>Tablet 数量。</td></tr><tr><td>PushdownPredicates</td><td>下推的谓词数量。</td></tr><tr><td>BytesRead</td><td>读取数据的大小。</td></tr><tr><td>CompressedBytesRead</td><td>读取压缩数据的大小。</td></tr><tr><td>IOTime</td><td>累计 I/O 时间。</td></tr><tr><td>BitmapIndexFilterRows</td><td>Bitmap 索引过滤的数据行数。</td></tr><tr><td>BloomFilterFilterRows</td><td>Bloomfilter 过滤的数据行数。</td></tr><tr><td>SegmentRuntimeZoneMapFilterRows</td><td>Runtime Zone Map 过滤的数据行数。</td></tr><tr><td>SegmentZoneMapFilterRows</td><td>Zone Map 过滤的数据行数。</td></tr><tr><td>ShortKeyFilterRows</td><td>Short Key 过滤的数据行数。</td></tr><tr><td>ZoneMapIndexFilterRows</td><td>Zone Map 索引过滤的数据行数。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="exchange-operator">Exchange operator<a href="#exchange-operator" class="hash-link" aria-label="Direct link to Exchange operator" title="Direct link to Exchange operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>PartType</td><td>数据分布模式，包括：<code>UNPARTITIONED</code>、<code>RANDOM</code>、<code>HASH_PARTITIONED</code> 以及 <code>BUCKET_SHUFFLE_HASH_PARTITIONED</code>。</td></tr><tr><td>BytesSent</td><td>发送的数据大小。</td></tr><tr><td>OverallThroughput</td><td>吞吐速率。</td></tr><tr><td>NetworkTime</td><td>数据包传输时间（不包括接收后处理时间）。请参阅下方 FAQ，了解有关指标计算以及潜在异常的更多信息。</td></tr><tr><td>WaitTime</td><td>由于发送端队列满而导致的等待时间。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="aggregate-operator">Aggregate operator<a href="#aggregate-operator" class="hash-link" aria-label="Direct link to Aggregate operator" title="Direct link to Aggregate operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>GroupingKeys</td><td>GROUP BY 列。</td></tr><tr><td>AggregateFunctions</td><td>聚合函数。</td></tr><tr><td>AggComputeTime</td><td>聚合函数计算耗时。</td></tr><tr><td>ExprComputeTime</td><td>表达式计算耗时。</td></tr><tr><td>HashTableSize</td><td>Hash Table 大小。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="join-operator">Join operator<a href="#join-operator" class="hash-link" aria-label="Direct link to Join operator" title="Direct link to Join operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>JoinPredicates</td><td>Join 谓词。</td></tr><tr><td>JoinType</td><td>Join 类型。</td></tr><tr><td>BuildBuckets</td><td>Hash Table 的 Bucket 数量。</td></tr><tr><td>BuildHashTableTime</td><td>构建 Hash Table 耗时。</td></tr><tr><td>ProbeConjunctEvaluateTime</td><td>Probe Conjunct 耗时。</td></tr><tr><td>SearchHashTableTimer</td><td>查询 Hash Table 耗时。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="window-function-operator">Window Function operator<a href="#window-function-operator" class="hash-link" aria-label="Direct link to Window Function operator" title="Direct link to Window Function operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>ComputeTime</td><td>窗口函数计算耗时。</td></tr><tr><td>PartitionKeys</td><td>分区列。</td></tr><tr><td>AggregateFunctions</td><td>聚合函数。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sort-operator">Sort operator<a href="#sort-operator" class="hash-link" aria-label="Direct link to Sort operator" title="Direct link to Sort operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>SortKeys</td><td>排序键。</td></tr><tr><td>SortType</td><td>查询结果排序方式：全排序或者排序 Top N 个结果。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tablefunction-operator">TableFunction operator<a href="#tablefunction-operator" class="hash-link" aria-label="Direct link to TableFunction operator" title="Direct link to TableFunction operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>TableFunctionExecTime</td><td>Table Function 计算耗时。</td></tr><tr><td>TableFunctionExecCount</td><td>Table Function 执行次数。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="project-operator">Project operator<a href="#project-operator" class="hash-link" aria-label="Direct link to Project operator" title="Direct link to Project operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>ExprComputeTime</td><td>表达式计算耗时。</td></tr><tr><td>CommonSubExprComputeTime</td><td>公共子表达式计算耗时。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="localexchange-operator">LocalExchange operator<a href="#localexchange-operator" class="hash-link" aria-label="Direct link to LocalExchange operator" title="Direct link to LocalExchange operator">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>Type</td><td>Local Exchange 类型，包括：<code>Passthrough</code>、Partition<code>以及</code>Broadcast`。</td></tr><tr><td>ShuffleNum</td><td>Shuffle 数量。该指标仅当 <code>Type</code> 为 <code>Partition</code> 时有效。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hive-connector">Hive Connector<a href="#hive-connector" class="hash-link" aria-label="Direct link to Hive Connector" title="Direct link to Hive Connector">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>ScanRanges</td><td>扫描的数据分片总数。</td></tr><tr><td>ReaderInit</td><td>Reader 初始化时间。</td></tr><tr><td>ColumnReadTime</td><td>Reader 读取和解析数据时间。</td></tr><tr><td>ExprFilterTime</td><td>表达式过滤时间。</td></tr><tr><td>RowsRead</td><td>读取的数据行数。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-stream">Input Stream<a href="#input-stream" class="hash-link" aria-label="Direct link to Input Stream" title="Direct link to Input Stream">​</a></h4>
<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>AppIOBytesRead</td><td>应用层读取的数据量。</td></tr><tr><td>AppIOCounter</td><td>应用层读取的 I/O 次数。</td></tr><tr><td>AppIOTime</td><td>应用层累计读取时间。</td></tr><tr><td>FSBytesRead</td><td>存储系统读取的数据量。</td></tr><tr><td>FSIOCounter</td><td>存储层读取的 I/O 次数。</td></tr><tr><td>FSIOTime</td><td>存储层累计读取时间。</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="operator-耗时">Operator 耗时<a href="#operator-耗时" class="hash-link" aria-label="Direct link to Operator 耗时" title="Direct link to Operator 耗时">​</a></h3>
<ul>
<li>对于 OlapScan 和 ConnectorScan Operator，其耗时相当于 <code>OperatorTotalTime + ScanTime</code>。因为 Scan Operator 在异步 I/O 线程池中进行 I/O 操作，所以 ScanTime 为异步 I/O 时间。</li>
<li>Exchange Operator 的耗时相当于 <code>OperatorTotalTime + NetworkTime</code>。因为 Exchange Operator 在 BRPC 线程池中收发数据包，NetworkTime 即为网络传输消耗的时间。</li>
<li>对于其他 Operator，其耗时为 <code>OperatorTotalTime</code>。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metric-合并以及-minmax-值">Metric 合并以及 MIN/MAX 值<a href="#metric-合并以及-minmax-值" class="hash-link" aria-label="Direct link to Metric 合并以及 MIN/MAX 值" title="Direct link to Metric 合并以及 MIN/MAX 值">​</a></h3>
<p>Pipeline Engine 是并行计算引擎。每个 Fragment 被分发到多台机器上并行处理，每台机器上的 Pipeline 作为多个并发实例同时执行。因此，在统计 Profile 时，StarRocks 会合并相同的指标，并记录所有并发实例中每个指标的最小值和最大值。</p>
<p>不同种类的指标采用了不同的合并策略：</p>
<ul>
<li>时间类指标求平均值。例如：<!-- -->
<ul>
<li><code>OperatorTotalTime</code> 是所有并发实例的平均耗时。</li>
<li><code>__MAX_OF_OperatorTotalTime</code> 是所有并发实例中的最 大耗时。</li>
<li><code>__MIN_OF_OperatorTotalTime</code> 是所有并发实例中的最小耗时。</li>
</ul>
</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> OperatorTotalTime: </span><span class="token number" style="color:#36acaa">2.192</span><span class="token plain">us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __MAX_OF_OperatorTotalTime: </span><span class="token number" style="color:#36acaa">2.502</span><span class="token plain">us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __MIN_OF_OperatorTotalTime: </span><span class="token number" style="color:#36acaa">1.882</span><span class="token plain">us</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>非时间类指标求和。例如：<!-- -->
<ul>
<li><code>PullChunkNum</code> 是该指标在所有并发实例的和。</li>
<li><code>__MAX_OF_PullChunkNum</code> 是该指标在所有并发实例中的最大值。</li>
<li><code>__MIN_OF_PullChunkNum</code> 是该指标在所有并发实例中的最小值。</li>
</ul>
</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> PullChunkNum: </span><span class="token number" style="color:#36acaa">146.66</span><span class="token plain">K </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">146660</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __MAX_OF_PullChunkNum: </span><span class="token number" style="color:#36acaa">24.45</span><span class="token plain">K </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">24450</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __MIN_OF_PullChunkNum: </span><span class="token number" style="color:#36acaa">24.435</span><span class="token plain">K </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">24435</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>个别没有最值的指标在所有并发实例中的值相同，例如：<code>DegreeOfParallelism</code>。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="min-和-max-值差异过大">MIN 和 MAX 值差异过大<a href="#min-和-max-值差异过大" class="hash-link" aria-label="Direct link to MIN 和 MAX 值差异过大" title="Direct link to MIN 和 MAX 值差异过大">​</a></h4>
<p>通常，MIN 和 MAX 值之间如果有明显差异，则表明数据有很大几率存在倾斜。可能的场景包括聚合和 Join 等。</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> OperatorTotalTime: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">m48s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __MAX_OF_OperatorTotalTime: </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">m30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> __MIN_OF_OperatorTotalTime: </span><span class="token number" style="color:#36acaa">279.170</span><span class="token plain">us</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="可视化-query-profile">可视化 Query Profile<a href="#可视化-query-profile" class="hash-link" aria-label="Direct link to 可视化 Query Profile" title="Direct link to 可视化 Query Profile">​</a></h2>
<p>如果您是 StarRocks 企业版用户，则可以通过 StarRocks Manager 可视化您的 Query Profile。</p>
<p><strong>执行概览</strong>页面显示了一些 Summary 指标，包括总执行时间<code>ExecutionWallTime</code>、I/O 指标、网络传输大小以及 CPU 和 I/O 耗时比例。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-4-d5a54980b29524277c4c7e60b9d134f7.png" width="1280" height="678" class="img_ev3q"></p>
<p>单击 Operator（节点）的卡片，可以在页面右侧的选项卡中查看其详细信息。共有三个选项卡：</p>
<ul>
<li><strong>节点</strong>：该 Operator 的核心指标。</li>
<li><strong>节点详情</strong>: 该 Operator 的所有 指标。</li>
<li><strong>Pipeline</strong>: 该 Operator 所属 Pipeline 指标。该选项卡中的指标仅与调度相关，您无需过多关注。</li>
</ul>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-5-3f98c4900b7e51396d90af6aef974432.png" width="1280" height="683" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认查询瓶颈">确认查询瓶颈<a href="#确认查询瓶颈" class="hash-link" aria-label="Direct link to 确认查询瓶颈" title="Direct link to 确认查询瓶颈">​</a></h3>
<p>Operator 花费的时间比例越大，其对应卡片的颜色就越深。您可借此轻松确认查询的瓶颈。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-6-1cd933a5ba490b335a3b0283cc185ab9.png" width="1280" height="834" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认数据是否倾斜">确认数据是否倾斜<a href="#确认数据是否倾斜" class="hash-link" aria-label="Direct link to 确认数据是否倾斜" title="Direct link to 确认数据是否倾斜">​</a></h3>
<p>点击占用时间占比较大的 Operator 卡片，查看其 <code>MaxTime</code> 和 <code>MinTime</code> 指标。通常，<code>MaxTime</code> 和 <code>MinTime</code> 之间如果存在明显差异，则表示数据存在倾斜。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-7-620c7fe97a29162a1be9087642104dee.png" width="1280" height="822" class="img_ev3q"></p>
<p>然后，单击<strong>节点详情</strong>选项卡，并查看是否有任何异常指标。在以下示例中，聚合运算符的指标 <code>PushRowNum</code> 显示数据倾斜。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-8-c19a4c8f5a3c60ada5b4a43d4a689f6d.png" width="1280" height="630" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认分桶或分区裁剪是否生效">确认分桶或分区裁剪是否生效<a href="#确认分桶或分区裁剪是否生效" class="hash-link" aria-label="Direct link to 确认分桶或分区裁剪是否生效" title="Direct link to 确认分桶或分区裁剪是否生效">​</a></h3>
<p>您可以通过 <code>EXPLAIN &lt;sql_statement&gt;</code> 语句查看查询对应的 Query Plan 以查看分区或分桶裁剪是否生效。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-9-ae47456988da592eb07e35c41a3a9e0b.png" width="1280" height="529" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认物化视图选择是否正确">确认物化视图选择是否正确<a href="#确认物化视图选择是否正确" class="hash-link" aria-label="Direct link to 确认物化视图选择是否正确" title="Direct link to 确认物化视图选择是否正确">​</a></h3>
<p>单击相应的 Scan Operator 的卡片并查看<strong>节点详情</strong>选项卡上的 <code>Rollup</code> 字段。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-10-6827eee4e3bf80e72df8db93d67190af.png" width="1280" height="771" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认-join-左右表-plan-是否合理">确认 Join 左右表 Plan 是否合理<a href="#确认-join-左右表-plan-是否合理" class="hash-link" aria-label="Direct link to 确认 Join 左右表 Plan 是否合理" title="Direct link to 确认 Join 左右表 Plan 是否合理">​</a></h3>
<p>通常，StarRocks 会选择较小的表作为 Join 的右表。如果 Query Profile 显示右表的数据量明显大于左表，则该 Join Plan 异常。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-11-cdcaaa6efd8f2836b6c842256edc0f75.png" width="1280" height="566" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认-join-分布方式是否正确">确认 Join 分布方式是否正确<a href="#确认-join-分布方式是否正确" class="hash-link" aria-label="Direct link to 确认 Join 分布方式是否正确" title="Direct link to 确认 Join 分布方式是否正确">​</a></h3>
<p>按照数据分布类型，Exchange Operator 可分为三类：</p>
<ul>
<li><code>UNPARTITIONED</code>：Broadcast。数据被拷贝多份，然后发送至多台 BE。</li>
<li><code>RANDOM</code>：Round robin。</li>
<li><code>HASH_PARTITIONED</code> 和 <code>BUCKET_SHUFFLE_HASH_PARTITIONED</code>：Shuffle。<code>HASH_PARTITIONED</code> 和 <code>BUCKET_SHUFFLE_HASH_PARTITIONED</code> 区别在于计算 Hash Code 所使用的 Hash 函数不同。</li>
</ul>
<p>对于 Inner Join，右表可以是 <code>HASH_PARTITIONED</code> 和<code>BUCKET_SHUFFLE_HASH_PARTITIONED</code> 类型或者 <code>UNPARTITIONED</code> 类型。通常只有在右表行数小于 100K 时才采用 <code>UNPARTITIONED</code> 类型。</p>
<p>在以下示例中，Exchange Operator 的类型是 Broadcast，但是该 Operator 传输的数据量远远超过了阈值。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-12-7edaf71e48831f0884cd9c7ac19811a7.png" width="1280" height="444" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认-joinruntimefilter-是否生效">确认 JoinRuntimeFilter 是否生效<a href="#确认-joinruntimefilter-是否生效" class="hash-link" aria-label="Direct link to 确认 JoinRuntimeFilter 是否生效" title="Direct link to 确认 JoinRuntimeFilter 是否生效">​</a></h3>
<p>当 Join 的右孩子构建 Hash Table 时，会构建 Runtime Filter，该 Runtime Filter 会被投递到左子树，并尽可能地下推到 Scan Operator。您可以在 Scan Operator 的<strong>节点详情</strong>选项卡上查看与 JoinRuntimeFilter 相关的指标。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-13-c4f8d3e037eee78a3c8f3f1366dbb58c.png" width="1280" height="694" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么-exchange-operator-时间异常">为什么 Exchange Operator 时间异常？<a href="#为什么-exchange-operator-时间异常" class="hash-link" aria-label="Direct link to 为什么 Exchange Operator 时间异常？" title="Direct link to 为什么 Exchange Operator 时间异常？">​</a></h3>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-14-b0b09c4d85d8e79f04353f5e9dcc2910.png" width="996" height="681" class="img_ev3q"></p>
<p>Exchange Operator 的耗时由两部分组成：CPU 时间和网络时间。网络时间依赖于系统时钟。网络时间计算方式如下：</p>
<ol>
<li>发送端在调用BRPC接口发送包之前记录 <code>send_timestamp</code>。</li>
<li>接收端从 BRPC 接口收到包后记录 <code>receive_timestamp</code>（不包括接收后处理时间）。</li>
<li>处理完成后，接收端发送 Response 并计算网络延迟。数据包传输时延等于 <code>receive_timestamp</code> - <code>send_timestamp</code>。</li>
</ol>
<p>如果不同机器的系统时钟不一致，Exchange Operator 的耗时就会出现异常。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么各-operator-时间之和远小于查询实际的执行时间">为什么各 Operator 时间之和远小于查询实际的执行时间？<a href="#为什么各-operator-时间之和远小于查询实际的执行时间" class="hash-link" aria-label="Direct link to 为什么各 Operator 时间之和远小于查询实际的执行时间？" title="Direct link to 为什么各 Operator 时间之和远小于查询实际的执行时间？">​</a></h3>
<p>可能原因：在高并发场景下，有些 Pipeline Driver 虽然可以调度，但可能会因为排队而无法及时执行。等待时间不会记录在 Operator 的指标中，而是记录在 <code>PendingTime</code>、<code>ScheduleTime</code> 和 <code>IOTaskWaitTime</code> 中。</p>
<p>示例：</p>
<p>从 Pipeline Profile 中可以看到 <code>ExecutionWallTime</code> 大约为 463 毫秒。但是，所有 Operator 的总耗时却不足 20 毫秒，明显小于 <code>ExecutionWallTime</code>。</p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-16-f8f2f4afbd6ef7270cb22b2d4a5303ea.png" width="600" height="814" class="img_ev3q"></p>
<p><img loading="lazy" alt="img" src="/doc/assets/images/profile-15-29266555ae8353e087936d416380af51.png" width="1472" height="2836" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/StarRocks/docs.zh-cn/edit/main/administration/query_profile.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/zh/2.5/administration/information_schema"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Information Schema</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/zh/2.5/administration/query_queues"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">查询队列</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#启用-query-profile" class="table-of-contents__link toc-highlight">启用 Query Profile</a></li><li><a href="#获取-query-profile" class="table-of-contents__link toc-highlight">获取 Query Profile</a></li><li><a href="#分析-query-profile" class="table-of-contents__link toc-highlight">分析 Query Profile</a><ul><li><a href="#query-profile-结构" class="table-of-contents__link toc-highlight">Query Profile 结构</a></li><li><a href="#重要指标" class="table-of-contents__link toc-highlight">重要指标</a></li><li><a href="#operator-耗时" class="table-of-contents__link toc-highlight">Operator 耗时</a></li><li><a href="#metric-合并以及-minmax-值" class="table-of-contents__link toc-highlight">Metric 合并以及 MIN/MAX 值</a></li></ul></li><li><a href="#可视化-query-profile" class="table-of-contents__link toc-highlight">可视化 Query Profile</a><ul><li><a href="#确认查询瓶颈" class="table-of-contents__link toc-highlight">确认查询瓶颈</a></li><li><a href="#确认数据是否倾斜" class="table-of-contents__link toc-highlight">确认数据是否倾斜</a></li><li><a href="#确认分桶或分区裁剪是否生效" class="table-of-contents__link toc-highlight">确认分桶或分区裁剪是否生效</a></li><li><a href="#确认物化视图选择是否正确" class="table-of-contents__link toc-highlight">确认物化视图选择是否正确</a></li><li><a href="#确认-join-左右表-plan-是否合理" class="table-of-contents__link toc-highlight">确认 Join 左右表 Plan 是否合理</a></li><li><a href="#确认-join-分布方式是否正确" class="table-of-contents__link toc-highlight">确认 Join 分布方式是否正确</a></li><li><a href="#确认-joinruntimefilter-是否生效" class="table-of-contents__link toc-highlight">确认 JoinRuntimeFilter 是否生效</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a><ul><li><a href="#为什么-exchange-operator-时间异常" class="table-of-contents__link toc-highlight">为什么 Exchange Operator 时间异常？</a></li><li><a href="#为什么各-operator-时间之和远小于查询实际的执行时间" class="table-of-contents__link toc-highlight">为什么各 Operator 时间之和远小于查询实际的执行时间？</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/docs/introduction/StarRocks_intro">Documentation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 StarRocks, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>