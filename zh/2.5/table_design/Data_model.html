<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-chinese docs-version-2.5 docs-doc-page docs-doc-id-table_design/Data_model" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-beta.0">
<title data-rh="true">数据模型 | StarRocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/doc/zh/2.5/table_design/Data_model"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="2.5"><meta data-rh="true" name="docusaurus_tag" content="docs-chinese-2.5"><meta data-rh="true" name="docsearch:version" content="2.5"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-chinese-2.5"><meta data-rh="true" property="og:title" content="数据模型 | StarRocks"><meta data-rh="true" name="description" content="建表时，您需要指定数据模型 (Data Model)，这样数据导入至数据模型时，StarRocks 会按照排序键对数据进行排序、处理和存储。本文介绍 StarRocks 支持的各种数据模型，满足您在不同业务场景下的需求。"><meta data-rh="true" property="og:description" content="建表时，您需要指定数据模型 (Data Model)，这样数据导入至数据模型时，StarRocks 会按照排序键对数据进行排序、处理和存储。本文介绍 StarRocks 支持的各种数据模型，满足您在不同业务场景下的需求。"><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/doc/zh/2.5/table_design/Data_model"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/zh/2.5/table_design/Data_model" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/zh/2.5/table_design/Data_model" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ER08SJMRY1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="StarRocks" href="/doc/opensearch.xml"><link rel="stylesheet" href="/doc/assets/css/styles.55e61827.css">
<script src="/doc/assets/js/runtime~main.3f38b808.js" defer="defer"></script>
<script src="/doc/assets/js/main.f42b5291.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.starrocks.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/doc/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StarRocks</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/doc/en/administration/Authentication">English latest</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/en/administration/Authentication">English latest</a></li><li><a class="dropdown__link" href="/doc/en/3.0/administration/Authentication">English 3.0</a></li><li><a class="dropdown__link" href="/doc/en/2.5/administration/Authentication">English 2.5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/doc/zh/2.5/administration/Administration_guide">Chinese 2.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/zh/administration/AWS_cloudformation">Chinese latest</a></li><li><a class="dropdown__link" href="/doc/zh/3.0/administration/AWS_cloudformation">Chinese 3.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/doc/zh/2.5/table_design/Data_model">Chinese 2.5</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/StarRocks/starrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/administration/Administration_guide">administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/benchmarking/SSB_Benchmarking">benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/data_source/External_table">data_source</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/deployment/deploy_broker">deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/developers/build-starrocks/Build_in_docker">developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/ecosystem_release/flink_connector">ecosystem_release</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/faq/Deploy_faq">faq</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/zh/2.5/feedback-and-contribute">How to feedback and contribute</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/integrations/authenticate_to_aws_resources">integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/introduction/Architecture">introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/loading/BrokerLoad">loading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/zh/2.5/quick_start">quick_start</a><button aria-label="Expand sidebar category &#x27;quick_start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/reference/Error_code">reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/release_notes/release-1.19">release_notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/sql-reference/How_to_write_SQL_command_doc">sql-reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/doc/zh/2.5/table_design">介绍</a><button aria-label="Collapse sidebar category &#x27;介绍&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/table_design/Data_distribution">数据分布</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/zh/2.5/table_design/Data_model">数据模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/table_design/Sort_key">排序键和前缀索引</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/table_design/StarRocks_table_design">理解 StarRocks 表设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/table_design/Temporary_partition">临时分区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/table_design/data_compression">数据压缩</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/zh/2.5/table_design/dynamic_partitioning">动态分区</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/doc/zh/2.5/table_design/table_types">数据模型</a><button aria-label="Expand sidebar category &#x27;数据模型&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/unloading/Export">unloading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/doc/zh/2.5/using_starrocks/Bitmap_index">using_starrocks</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/doc/zh/2.5/table_design"><span itemprop="name">介绍</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">数据模型</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Chinese 2.5</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>数据模型</h1>
<p>建表时，您需要指定数据模型 (Data Model)，这样数据导入至数据模型时，StarRocks 会按照排序键对数据进行排序、处理和存储。本文介绍 StarRocks 支持的各种数据模型，满足您在不同业务场景下的需求。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="基本概念">基本概念<a href="#基本概念" class="hash-link" aria-label="Direct link to 基本概念" title="Direct link to 基本概念">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据模型-1">数据模型<a href="#数据模型-1" class="hash-link" aria-label="Direct link to 数据模型" title="Direct link to 数据模型">​</a></h3>
<p>StarRocks 支持四种数据模型，分别是明细模型 (Duplicate Key Model)、聚合模型 (Aggregate Key Model)、更新模型 (Unique Key Model) 和主键模型 (Primary Key Model)。这四种数据模型能够支持多种数据分析场景，例如日志分析、数据汇总分析、实时分析等。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="排序键">排序键<a href="#排序键" class="hash-link" aria-label="Direct link to 排序键" title="Direct link to 排序键">​</a></h3>
<p>数据导入至数据模型，按照建表时指定的一列或多列排序和存储，这部分用于排序的列就称为排序键。排序键通常为查询时过滤条件频繁使用的维度列，可以加速查询。明细模型中，排序键就是用于排序的列，即 <code>DUPLICATE KEY</code> 指定的列。 聚合模型中，排序键就是用于聚合的列，即 <code>AGGREGATE KEY</code> 指定的列。主键模型和更新模型中，排序键就是满足唯一性约束的列，分别由 <code>PRIMARY KEY</code> 和 <code>UNIQUE KEY</code> 指定。</p>
<p>StarRocks 中的排序键，相对于传统的主键，具有如下特点：</p>
<ul>
<li>
<p>排序键通常为查询时过滤条件中频繁使用的维度列。</p>
</li>
<li>
<p>在明细模型中，排序键可重复，不必满足唯一性约束。在聚合模型、主键模型和更新模型中，排序键必须满足唯一性约束。</p>
</li>
<li>
<p>数据表采用聚簇存储，即表中每列的值，按照排序键进行排序并存储。</p>
</li>
<li>
<p>根据排序键生成前缀索引 (Prefix Index) 。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="注意事项">注意事项<a href="#注意事项" class="hash-link" aria-label="Direct link to 注意事项" title="Direct link to 注意事项">​</a></h2>
<ul>
<li>
<p>在建表语句中，排序键必须定义在其他列之前。</p>
</li>
<li>
<p>在创建表时，您可以将一个或多个列定义为排序键。排序键在建表语句中的出现次序，为数据存储时多重排序的次序。</p>
</li>
<li>
<p>不支持排序键的数据类型为 BITMAP、HLL。</p>
</li>
<li>
<p>前缀索引的长度限制为 36 字节。如果排序键中全部列的值的长度加起来超过 36 字节，则前缀索引仅会保存限制范围内排序键的若干前缀列。</p>
</li>
<li>
<p>如果导入的数据存在重复的主键，则数据导入至数据模型，存储在 StarRocks 时，则会按照如下方式进行处理：</p>
<ul>
<li>明细模型：表中会存在主键重复的数据行，并且与导入的数据是完全对应的。您可以召回所导入的全部历史数据。</li>
<li>聚  合模型：表中不存在主键重复的数据行，主键满足唯一性约束。导入的数据中主键重复的数据行聚合为一行，即具有相同主键的指标列，会通过聚合函数进行聚合。您只能召回导入的全部历史数据的聚合结果，但是无法召回历史明细数据。</li>
<li>主键模型和更新模型：表中不存在主键重复的数据行，主键满足唯一性约束。最新导入的数据行，替换掉其他主键重复的数据行。这两种模型可以视为聚合模型的特殊情况，相当于在聚合模型中，为表的指标列指定聚合函数为 REPLACE，REPLACE 函数返回主键相同的一组数据中的最新数据。</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="明细模型">明细模型<a href="#明细模型" class="hash-link" aria-label="Direct link to 明细模型" title="Direct link to 明细模型">​</a></h2>
<p>明细模型是默认的建表模型。如果在建表时未指定任何模型，默认创建的是明细类型的表。</p>
<p>创建表时，支持定义排序键。如果查询的过滤条件包含排序键，则 StarRocks 能够快速地过滤数据，提高查询效率。明细模型适用于日志数据分析等场景，支持追加新数据，不支持修改历史数据。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景">适用场景<a href="#适用场景" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3>
<ul>
<li>
<p>分析原始数据，例如原始日志、原始操作记录等。</p>
</li>
<li>
<p>查询方式灵活，不需要局限于预聚合的分析方式。</p>
</li>
<li>
<p>导入日志数据或者时序数据，主要特点是旧数据不会更新，只会追加新的数据。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建表">创建表<a href="#创建表" class="hash-link" aria-label="Direct link to 创建表" title="Direct link to 创建表">​</a></h3>
<p>例如，需 要分析某时间范围的某一类事件的数据，则可以将事件时间（<code>event_time</code>）和事件类型（<code>event_type</code>）作为排序键。</p>
<p>在该业务场景下，建表语句如下：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> detail </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event_time </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;datetime of event&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event_type </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;type of event&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id of user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    device_code </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;device code&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    channel </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DUPLICATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>建表时必须使用 <code>DISTRIBUTED BY HASH</code> 子句指定分桶键，否则建表失败。分桶键的更多说明，请参见<a href="/doc/zh/2.5/table_design/Data_distribution.md#%E5%88%86%E6%A1%B6">分桶</a>。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明">使用说明<a href="#使用说明" class="hash-link" aria-label="Direct link to 使用说明" title="Direct link to 使用说明">​</a></h3>
<ul>
<li>
<p>排序键的相关说明：</p>
<ul>
<li>
<p>在建表语句中，排序键必须定义在其他列之前。</p>
</li>
<li>
<p>排序键可以通过 <code>DUPLICATE KEY</code> 显式定义。本示例中排序键为 <code>event_time</code> 和 <code>event_type</code>。</p>
<blockquote>
<p>如果未指定，则默认选择表的前三列作为排序键。</p>
</blockquote>
</li>
<li>
<p>明细模型中的排序键可以为部分或全部维度列。</p>
</li>
</ul>
</li>
<li>
<p>建表时，支持为指标列创建 BITMAP、Bloom Filter 等索引。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下一步">下一步<a href="#下一步" class="hash-link" aria-label="Direct link to 下一步" title="Direct link to 下一步">​</a></h3>
<p>建表完成后，您可以创建多种导入作业，导入数据至表中。具体导入方式，请参见<a href="/doc/zh/2.5/loading/Loading_intro">导入概览</a>。</p>
<blockquote>
<ul>
<li>导入时，支持追加新数据，不支持修改历史数据。</li>
<li>如果导入两行完全 相同的数据，则明细模型会将这两行数据视为两行，而不是一行。</li>
</ul>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="聚合模型">聚合模型<a href="#聚合模型" class="hash-link" aria-label="Direct link to 聚合模型" title="Direct link to 聚合模型">​</a></h2>
<p>建表时，支持定义排序键和指标列，并为指标列指定聚合函数。当多条数据具有相同的排序键时，指标列会进行聚合。在分析统计和汇总数据时，聚合模型能够减少查询时所需要处理的数据，提升查询效率。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景-1">适用场景<a href="#适用场景-1" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3>
<p>适用于分析统计和汇总数据。比如:</p>
<ul>
<li>
<p>通过分析网站或 APP 的访问流量，统计用户的访问总时长、访问总次数。</p>
</li>
<li>
<p>广告厂商为广告主提供的广告点击总量、展示总量、消费统计等。</p>
</li>
<li>
<p>通过分析电商的全年交易数据，获得指定季度或者月份中，各类消费人群的爆款商品。</p>
</li>
</ul>
<p>在这些场景中，数据查询和导入，具有以下特点：</p>
<ul>
<li>
<p>多为汇总类查询，比如 SUM、MAX、MIN等类型的查询。</p>
</li>
<li>
<p>不需要查询原始的明细数据。</p>
</li>
<li>
<p>旧数据更新不频繁，只会追加新的数据。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理">原理<a href="#原理" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>从数据导入至数据查询阶段，聚合模型内部同一排序键的数据会多次聚合，聚合的具体时机和机制如下：</p>
<ol>
<li>
<p>数据导入阶段：数据按批次导入至聚合模型时，每一个批次的数据形成一个版本。在一个版本中，同一排序键的数据会进行一次聚合。</p>
</li>
<li>
<p>后台文件合并阶段 (Compaction) ：数据分批次多次导入至聚合模型中，会生成多个版本的文件，多个版本的文件定期合并成一个大版本文件时，同一排序键的数据会进行一次聚合。</p>
</li>
<li>
<p>查询阶段：所有版本中同一排序键的数据进行聚合，然后返回查询结果。</p>
</li>
</ol>
<p>因此，聚合模型中数据多次聚合，能够减少查询时所需要的处理的数据量，进而提升查询的效率。</p>
<p>例如，导入如下数据至聚合模型中，排序键为 Date、Country：</p>
<table><thead><tr><th>Date</th><th>Country</th><th>PV</th></tr></thead><tbody><tr><td>2020.05.01</td><td>CHN</td><td>1</td></tr><tr><td>2020.05.01</td><td>CHN</td><td>2</td></tr><tr><td>2020.05.01</td><td>USA</td><td>3</td></tr><tr><td>2020.05.01</td><td>USA</td><td>4</td></tr></tbody></table>
<p>在聚合模型中，以上四条数据会聚合为两条数据。这样在后续查询处理的时候，处理的数据量就会显著降低。</p>
<table><thead><tr><th>Date</th><th>Country</th><th>PV</th></tr></thead><tbody><tr><td>2020.05.01</td><td>CHN</td><td>3</td></tr><tr><td>2020.05.01</td><td>USA</td><td>7</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建表-1">创建表<a href="#创建表-1" class="hash-link" aria-label="Direct link to 创建表" title="Direct link to 创建表">​</a></h3>
<p>例如需要分析某一段时间内，来自不同城市的用户，访问不同网页的总次数。则可以将网页地址 <code>site_id</code>、日期 <code>date</code> 和城市代码 <code>city_code</code> 作为排序键，将访问次数 <code>pv</code> 作为指标列，并为指标列 <code>pv</code> 指定聚合函数为 SUM。</p>
<p>在该业务场景下，建表语句如下：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> example_db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aggregate_tbl </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    site_id LARGEINT </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id of site&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">date</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;time of event&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    city_code </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;city_code of user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pv </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> SUM </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;total page views&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AGGREGATE </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">site_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> city_code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">site_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>建表时必须使用 <code>DISTRIBUTED BY HASH</code> 子句指定分桶键。分桶键的更多说明，请参见<a href="/doc/zh/2.5/table_design/Data_distribution.md#%E5%88%86%E6%A1%B6">分桶</a>。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-1">使用说明<a href="#使用说明-1" class="hash-link" aria-label="Direct link to 使用说明" title="Direct link to 使用说明">​</a></h3>
<ul>
<li>
<p>排序键的相关说明：</p>
<ul>
<li>
<p>在建表语句中，<strong>排序键必须定义在其他列之前</strong>。</p>
</li>
<li>
<p>排序键可以通过 <code>AGGREGATE KEY</code> 显式定义。</p>
<blockquote>
<ul>
<li>如果 <code>AGGREGATE KEY</code> 未包含全部维度列（除指标列之外的列），则建表会失败。</li>
<li>如果不通过 <code>AGGREGATE KEY</code> 显示定义排序键，则默认除指标列之外的列均为排序键。</li>
</ul>
</blockquote>
</li>
<li>
<p>排序键必须满足唯一性约束，必须包含全部维度列，并且列的值不会更新。</p>
</li>
</ul>
</li>
<li>
<p>指标列：通过在列名后指定聚合函数，定义该列为指标列。一般为需要汇总统计的数据。</p>
</li>
<li>
<p>聚合函数：指标列使用的聚合函数。聚合模型支持的聚合函数，请参见 <a href="/doc/zh/2.5/sql-reference/sql-statements/data-definition/CREATE_TABLE">CREATE TABLE</a>。</p>
</li>
<li>
<p>查询时，排序键在多版聚合之前就能进行过滤，而指标列的过滤在多版本聚合之后。因此建议将频繁使用的过滤字段作为排序键，在聚合前就能过滤数据，从而提升查询性能。</p>
</li>
<li>
<p>建表时，不支持为指标列创建 BITMAP、Bloom Filter 等索引。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下一步-1">下一步<a href="#下一步-1" class="hash-link" aria-label="Direct link to 下一步" title="Direct link to 下一步">​</a></h3>
<p>建表完成后，您可以创建多种导入作业，导入数据至表中。具体导入方式，请参见<a href="/doc/zh/2.5/loading/Loading_intro">导入概览</a>。</p>
<blockquote>
<p>导入时，仅支持全字段导入，即导入任务需要涵盖表的所有列，例如示例中的 <code>site_id</code>、<code>date</code>、<code>city_code</code> 和 <code>pv</code> 四个列。</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="更新模型">更新模型<a href="#更新模型" class="hash-link" aria-label="Direct link to 更新模型" title="Direct link to 更新模型">​</a></h2>
<p>建表时，支持定义主键和指标列，查询时返回主键相同的一组数据中的最新数据。相对于明细模型，更新模型简化了数据导入流程，能够更好地支撑实时和频繁更新的场景。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景-2">适用场景<a href="#适用场景-2" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3>
<p>实时和频繁更新的业务场景，例如分析电商订单。在电商场景中，订单的状态经常会发生变化，每天的订单更新量可突破上亿。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-1">原理<a href="#原理-1" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>更新模型可以视为聚合模型的特殊情况，指标列指定的聚合函数为 REPLACE，返回具有相同主键的一组数据中的最新数据。</p>
<p>数据分批次多次导入至更新模型，每一批次数据分配一个版本号，因此同一主键的数据可能有多个版本，查询时返回版本最新（即版本号最大）的数据。相对于明细模型，更新模型通过简化导入流程，能够更好地支持实时和频繁更新。</p>
<p>例  如下表中，<code>ID</code> 是主键，<code>value</code> 是指标列，<code>_version</code> 是 StarRocks 内部的版本号。其中，<code>ID</code> 为 1 的数据有两个导入批次，版本号分别为 <code>1</code> 和 <code>2</code>；<code>ID</code> 为 <code>2</code> 的数据有三个导入批次，版本号分别为 <code>3</code>、<code>4</code>、<code>5</code>。</p>
<table><thead><tr><th>ID</th><th>value</th><th>_version</th></tr></thead><tbody><tr><td>1</td><td>100</td><td>1</td></tr><tr><td>1</td><td>101</td><td>2</td></tr><tr><td>2</td><td>100</td><td>3</td></tr><tr><td>2</td><td>101</td><td>4</td></tr><tr><td>2</td><td>102</td><td>5</td></tr></tbody></table>
<p>查询 <code>ID</code> 为 <code>1</code> 的数据时，仅会返回最新版本 <code>2</code> 的数据，而查询 <code>ID</code> 为 <code>2</code> 的数据时，仅会返回最新版本 <code>5</code> 的数据，最终查询结果如下：</p>
<table><thead><tr><th>ID</th><th>value</th></tr></thead><tbody><tr><td>1</td><td>101</td></tr><tr><td>2</td><td>102</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建表-2">创建表<a href="#创建表-2" class="hash-link" aria-label="Direct link to 创建表" title="Direct link to 创建表">​</a></h3>
<p>在电商订单分析场景中，经常按照日期对订单状态进行统计分析，则可以将经常使用的过滤字段订单创建时间 <code>create_time</code>、订单编号 <code>order_id</code> 作为主键，其余列订单状态 <code>order_state</code> 和订单总价 <code>total_price</code> 作为指标列。这样既能够满足实时更新订单状态的需求，又能够在查询中进行快速过滤。</p>
<p>在该业务场景下，建表语句如下：</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> orders </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_time </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;create time of an order&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id of an order&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_state </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;state of an order&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_price </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;price of an order&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">create_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>建表时必须使用 <code>DISTRIBUTED BY HASH</code> 子句指定分桶键。分桶键的更多说明，请参见<a href="/doc/zh/2.5/table_design/Data_distribution.md#%E5%88%86%E6%A1%B6">分桶</a>。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-2">使用说明<a href="#使用说明-2" class="hash-link" aria-label="Direct link to 使用说明" title="Direct link to 使用说明">​</a></h3>
<ul>
<li>
<p>主键的相关说明：</p>
<ul>
<li>在建表语句中，主键必须定义在其他列之前。</li>
<li>主键通过 <code>UNIQUE KEY</code> 定义。</li>
<li>主键必须满足唯一性约束，且列的值不会修改。</li>
<li>设置合理的主键。<!-- -->
<ul>
<li>查询时，主键在聚合之前就能进行过滤，而指标列的过滤通常在多版本聚合之后，因此建议将频繁使用的过滤字段作为主键，在聚合前就能过滤数据，从而提升查询性能。</li>
<li>聚合过程中会比较所有主键，因此需要避免设置过多的主键，以免降低查询性能。如果某个列只是偶尔会作为查询中的过滤条件，则不建议放在主键中。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>建表时，不支持为指标列创建 BITMAP、Bloom Filter 等索引。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下一步-2">下一步<a href="#下一步-2" class="hash-link" aria-label="Direct link to 下一步" title="Direct link to 下一步">​</a></h3>
<p>建表完成后，您可以创建多种导入作业，导入数据至表中。具体导入方式，请参见<a href="/doc/zh/2.5/loading/Loading_intro">导入概览</a>。</p>
<blockquote>
<ul>
<li>
<p>导入数据时，仅支持全部更新，即导入任务需要指明所有列，例如示例中的 <code>create_time</code>、<code>order_id</code>、<code>order_state</code> 和 <code>total_price</code> 四个列。</p>
</li>
<li>
<p>在设计导入频率时，建议以满足业务对实时性的要求为准。查询更新模型的数据时，需要聚合多版本的数据，当版本过多时会导致查询性能降低。所以导入数据至更新模型时，应该适当降低导入频率，从而提升查询性能。如果业务对实时性的要求是分钟级别，那么每分钟导入一次更新数据即可，不需要秒级导入。</p>
</li>
</ul>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="  主键模型">主键模型<a href="#主键模型" class="hash-link" aria-label="Direct link to 主键模型" title="Direct link to 主键模型">​</a></h2>
<p>StarRocks 1.19 版本推出了主键模型 (Primary Key Model) 。建表时，支持定义主键和指标列，查询时返回主键相同的一组数据中的最新数据。相对于更新模型，主键模型在查询时不需要执行聚合操作，并且支持谓词和索引下推，能够在支持<strong>实时和频繁更新</strong>等场景的同时，提供高效查询。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="适用场景-3">适用场景<a href="#适用场景-3" class="hash-link" aria-label="Direct link to 适用场景" title="Direct link to 适用场景">​</a></h3>
<p>主键模型适用于实时和频繁更新的场景，例如：</p>
<ul>
<li><strong>实时对接事务型数据至 StarRocks</strong>。事务型数据库中，除了插入数据外，一般还会涉及较多更新和删除数据的操作，因此事务型数据库的数据同步至 StarRocks 时，建议使用主键模型。<a href="/doc/zh/2.5/loading/Flink_cdc_load">通过 Flink-CDC 等工具直接对接 TP 的 Binlog</a>，实时同步增删改的数据至主键模型，可以简化数据同步流程，并且相对于 Merge-On-Read 策略的更新模型，查询性能能够提升 3~10 倍。</li>
<li><strong>利用部分列更新轻松实现多流 JOIN</strong>。在用户画像等分析场景中，一般会采用大宽表方式来提升多维分析的性能，同时简化数据分析师的使用模型。而这种场景中的上游数据，往往可能来自于多个不同业务（比如来自购物消费业务、快递业务、银行业务等）或系统（比如计算用户不同标签属性的机器学习系统），主键模型的部分列更新功能就很好地满足这种需求，不同业务直接各自按需更新与业务相关的列即可，并且继续享受主键模型的实时同步增删改数据及高效的查询性能。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注意事项-1">注意事项<a href="#注意事项-1" class="hash-link" aria-label="Direct link to 注意事项" title="Direct link to 注意事项">​</a></h3>
<ul>
<li>如果开启持久化索引，主键模型大大降低了主键索引对内存的占用。因为导入时少部分主键索引存在内存中，大部分主键索引存在磁盘中。<strong>单条主键编码后的最大长度为 128 字节</strong>。</li>
<li>如果不开启持久化索引，主键模型适用于主键占用空间相对可控的场景，因为导入时将主键索引加载至内存中。<strong>单条主键编码后的最大长度和内存占用上限为 128 字节</strong>。
如下两个场景中，主键占用空间相对可控：<!-- -->
<ul>
<li><strong>数据有冷热特征</strong>，即最近几天的热数据才经常被修改，老的冷数据很少被修改。例如，MySQL订单表实时同步到 StarRocks 中提供分析查询。其中，数据按天分区，对订单的修改集中在最近几天新创建的订单，老的订单完成后就不再更新，因此导入时其主键索引就不会加载，也就不会占用内存，内存中仅会加载最近几天的索引。<br>
<img loading="lazy" alt="主键1" src="/doc/assets/images/3.2-1-e82c04cee3654d64c7d24653f952d77a.png" width="304" height="483" class="img_ev3q"></li>
</ul>
<blockquote>
<p>如图所示，数据按天分区，最新两个分区的数据更新比较频繁。</p>
</blockquote>
<ul>
<li><strong>大宽表</strong>（数百到数千列）。主键只占整个数据的很小一部分，其内存开销比较低。比如用户状态和画像表，虽然列非常多，但总的用户数不大（千万至亿级别），主键索引内存占用相对可控。
<img loading="lazy" alt="主键2" src="data:image/png;base64,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" width="620" height="82" class="img_ev3q"></li>
</ul>
<blockquote>
<p>如图所示，大宽表中主键只占一小部分，且数据行数不多。</p>
</blockquote>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-2">原理<a href="#原理-2" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>主键模型是由 StarRocks 全新设计开发的存储引擎支撑。相比于更新模型，主键模型的元数据组织、读取、写入方式完全不同，不需要执行聚合操作，并且支持谓词和索引下推，极大地提高了查询性能。</p>
<p>更新模型整体上采用了 Merge-On-Read 的策略。虽然写入时处理简单高效，但是查询时需要在线聚合多版本。并且由于 Merge 算子的存在，谓词和索引无法下推，严重影响了查询性能。</p>
<p>而主键模型采用了 Delete+Insert 的策略，保证同一个主键下仅存在一条记录，这样就完全避免了 Merge 操作。具体实现方式如下：</p>
<ul>
<li>
<p>StarRocks 收到对某记录的更新操作时，会通过主键索引找到该条记录的位置，并对其标记为删除，再插入一条新的记录。相当于把 Update 改写为 Delete+Insert。</p>
</li>
<li>
<p>StarRocks 收到对某记录的删除操作时，会通过主键索引找到该条记录的位置，对其标记为删除。</p>
</li>
</ul>
<p>这样，查询时不需要执行聚合操作，不影响谓词和索引的下推，保证了查询的高效执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建表-3">创建表<a href="#创建表-3" class="hash-link" aria-label="Direct link to 创建表" title="Direct link to 创建表">​</a></h3>
<ul>
<li>例如，需要按天实时分析订单，则可以将时间 <code>dt</code>、订单编号 <code>order_id</code> 作为主键，其余列为指标列。建表语句如下：</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> orders </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dt </span><span class="token keyword" style="color:#00009f">date</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    order_id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    merchant_id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    good_id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    good_name string </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    price </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cnt </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    revenue </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> RANGE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">dt</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> p20210820 </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-08-20&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-08-21&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> p20210821 </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-08-21&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-08-22&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> p20210929 </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-09-29&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-09-30&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> p20210930 </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-09-30&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2021-10-01&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;enable_persistent_index&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>建表时必须使用 <code>DISTRIBUTED BY HASH</code> 子句指定分桶键。分桶键的更多说明，请参见<a href="/doc/zh/2.5/table_design/Data_distribution.md#%E5%88%86%E6%A1%B6">分桶</a>。</p>
</blockquote>
<ul>
<li>例如，需要实时分析用户情况，则可以将用户 ID <code>user_id</code> 作为主键，其余为指标列。建表语句如下：</li>
</ul>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> users </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name string </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email string </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address string </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sex </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    last_active </span><span class="token keyword" style="color:#00009f">datetime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    property0 </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    property1 </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    property2 </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    property3 </span><span class="token keyword" style="color:#00009f">tinyint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> BUCKETS </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;replication_num&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;enable_persistent_index&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>建表时必须使用 <code>DISTRIBUTED BY HASH</code> 子句指定分桶键。分桶键的更多说明，请参见<a href="/doc/zh/2.5/table_design/Data_distribution.md#%E5%88%86%E6%A1%B6">分桶</a>。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-3">使用说明<a href="#使用说明-3" class="hash-link" aria-label="Direct link to 使用说明" title="Direct link to 使用说明">​</a></h3>
<ul>
<li>
<p>主键相关的说明：</p>
<ul>
<li>在建表语句中，主键必须定义在其他列之前。</li>
<li>主键通过 <code>PRIMARY KEY</code> 定义。</li>
<li>主键必须满足唯一性约束，且列的值不会修改。本示例中主键为 <code>dt</code>、<code>order_id</code>。</li>
<li>主键支持以下数据类型：BOOLEAN、TINYINT、SMALLINT、INT、BIGINT、LARGEINT、DATE、DATETIME、VARCHAR/STRING。并且不允许为 NULL。</li>
<li>分区列和分桶列必须在主键中。</li>
</ul>
</li>
<li>
<p><code>enable_persistent_index</code>：是否持久化主键索引，同时使用磁盘和内存存储主键索引，避免主键索引占用过大内存空间。通常情况下，持久化主键索引后，主键索引所占内存为之前的 1/10。您可以在建表时，在<code>PROPERTIES</code>中配置该参数，取 值范围为 <code>true</code> 或者 <code>false</code>（默认值）。</p>
<blockquote>
<ul>
<li>自 2.3.0 版本起，StarRocks 支持配置该参数。</li>
<li>如果磁盘为固态硬盘 SSD，则建议设置为 <code>true</code>。如果磁盘为机械硬盘 HDD，并且导入频率不高，则也可以设置为 <code>true</code>。</li>
<li>建表后，如果您需要修改该参数，请参见 ALTER TABLE <a href="/doc/zh/2.5/sql-reference/sql-statements/data-definition/ALTER_TABLE#%E4%BF%AE%E6%94%B9-table-%E7%9A%84%E5%B1%9E%E6%80%A7">修改表的属性</a> 。</li>
</ul>
</blockquote>
</li>
<li>
<p>如果未开启持久化索引，导入时主键索引存在内存中，可能会导致占用内存较多。因此建议您遵循如下建议：</p>
<ul>
<li>合理设置主键的列数和长度。建议主键为占用内存空间较少的数据类型，例如 INT、BIGINT 等，暂时不建议为 VARCHAR。</li>
<li>在建表前根据主键的数据类型和表的行数来预估主键索引占用内存空间，以避免出现内存溢出。以下示例说明主键索引占用内存空间的计算方式：<!-- -->
<ul>
<li>假设存在主键模型，主键为<code>dt</code>、<code>id</code>，数据类型为 DATE（4 个字节）、BIGINT（8 个字节）。则主键占 12 个字节。</li>
<li>假设该表的热数据有 1000 万行，存储为三个副本。</li>
<li>则内存占用的计算方式：<code>(12 + 9(每行固定开销) ) * 1000W * 3 * 1.5（哈希表平均额外开销) = 945 M</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>自2.3.0 版本起，指标列新增支持 BITMAP、HLL 数据类型。</p>
</li>
<li>
<p>创建表时，支持为指标列创建 BITMAP、Bloom Filter 等索引。</p>
</li>
<li>
<p>自 2.4 版本起，支持基于主键模型的表创建<a href="/doc/zh/2.5/using_starrocks/Materialized_view">异步物化视图</a>。</p>
</li>
<li>
<p>使用 <a href="/doc/zh/2.5/sql-reference/sql-statements/data-definition/ALTER_TABLE">ALTER TABLE</a> 时暂不支持修改主键的列类  型，不支持调整指标列的顺序。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下一步-3">下一步<a href="#下一步-3" class="hash-link" aria-label="Direct link to 下一步" title="Direct link to 下一步">​</a></h3>
<p>建表完成后，您可以创建多种导入作业，导入数据至表中。具体导入方式，请参见<a href="/doc/zh/2.5/loading/Loading_intro">导入总览</a>。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/StarRocks/docs.zh-cn/edit/main/table_design/Data_model.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/zh/2.5/table_design/Data_distribution"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">数据分布</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/zh/2.5/table_design/Sort_key"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">排序键和前缀索引</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基本概念" class="table-of-contents__link toc-highlight">基本概念</a><ul><li><a href="#数据模型-1" class="table-of-contents__link toc-highlight">数据模型</a></li><li><a href="#排序键" class="table-of-contents__link toc-highlight">排序键</a></li></ul></li><li><a href="#注意事项" class="table-of-contents__link toc-highlight">注意事项</a></li><li><a href="#明细模型" class="table-of-contents__link toc-highlight">明细模型</a><ul><li><a href="#适用场景" class="table-of-contents__link toc-highlight">适用场景</a></li><li><a href="#创建表" class="table-of-contents__link toc-highlight">创建表</a></li><li><a href="#使用说明" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#下一步" class="table-of-contents__link toc-highlight">下一步</a></li></ul></li><li><a href="#聚合模型" class="table-of-contents__link toc-highlight">聚合模型</a><ul><li><a href="#适用场景-1" class="table-of-contents__link toc-highlight">适用场景</a></li><li><a href="#原理" class="table-of-contents__link toc-highlight">原理</a></li><li><a href="#创建表-1" class="table-of-contents__link toc-highlight">创建表</a></li><li><a href="#使用说明-1" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#下一步-1" class="table-of-contents__link toc-highlight">下一步</a></li></ul></li><li><a href="#更新模型" class="table-of-contents__link toc-highlight">更新模型</a><ul><li><a href="#适用场景-2" class="table-of-contents__link toc-highlight">适用场景</a></li><li><a href="#原理-1" class="table-of-contents__link toc-highlight">原理</a></li><li><a href="#创建表-2" class="table-of-contents__link toc-highlight">创建表</a></li><li><a href="#使用说明-2" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#下一步-2" class="table-of-contents__link toc-highlight">下一步</a></li></ul></li><li><a href="#主键模型" class="table-of-contents__link toc-highlight">主键模型</a><ul><li><a href="#适用场景-3" class="table-of-contents__link toc-highlight">适用场景</a></li><li><a href="#注意事项-1" class="table-of-contents__link toc-highlight">注意事项</a></li><li><a href="#原理-2" class="table-of-contents__link toc-highlight">原理</a></li><li><a href="#创建表-3" class="table-of-contents__link toc-highlight">创建表</a></li><li><a href="#使用说明-3" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#下一步-3" class="table-of-contents__link toc-highlight">下一步</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/docs/introduction/StarRocks_intro">Documentation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 StarRocks, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>