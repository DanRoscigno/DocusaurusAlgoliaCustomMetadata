<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.1 docs-doc-page docs-doc-id-administration/Cluster_administration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-beta.0">
<title data-rh="true">管理集群 | StarRocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/doc/zh/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/doc/zh/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/doc/zh/docs/administration/Cluster_administration"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="3.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.1"><meta data-rh="true" name="docsearch:version" content="3.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.1"><meta data-rh="true" property="og:title" content="管理集群 | StarRocks"><meta data-rh="true" name="description" content="本文介绍如何管理维护 StarRocks 集群，包括启停集群，升级回滚等操作。"><meta data-rh="true" property="og:description" content="本文介绍如何管理维护 StarRocks 集群，包括启停集群，升级回滚等操作。"><link data-rh="true" rel="icon" href="/doc/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/doc/zh/docs/administration/Cluster_administration"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/docs/administration/Cluster_administration" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/zh/docs/administration/Cluster_administration" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/docs/administration/Cluster_administration" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ER08SJMRY1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="StarRocks" href="/doc/zh/opensearch.xml"><link rel="stylesheet" href="/doc/zh/assets/css/styles.62f01ed5.css">
<script src="/doc/zh/assets/js/runtime~main.8111edea.js" defer="defer"></script>
<script src="/doc/zh/assets/js/main.219fbd63.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.starrocks.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/doc/zh/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/zh/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StarRocks</b></a><a class="navbar__item navbar__link" href="/doc/zh/docs/introduction/StarRocks_intro">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/doc/zh/docs/introduction/StarRocks_intro">3.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/zh/docs/next/examples/introduction">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/doc/zh/docs/administration/Cluster_administration">3.1</a></li><li><a class="dropdown__link" href="/doc/zh/docs/3.0/administration/Cluster_administration">3.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/doc/docs/administration/Cluster_administration" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/doc/zh/docs/administration/Cluster_administration" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/StarRocks/starrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">版本：3.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>管理集群</h1>
<p>本文介绍如何管理维护 StarRocks 集群，包括启停集群，升级回滚等操作。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动集群">启动集群<a href="#启动集群" class="hash-link" aria-label="启动集群的直接链接" title="启动集群的直接链接">​</a></h2>
<p>在启动 StarRocks 集群之前，您需要确认相关节点的配置文件是否正确。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动-fe-集群">启动 FE 集群<a href="#启动-fe-集群" class="hash-link" aria-label="启动 FE 集群的直接链接" title="启动 FE 集群的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="确认-fe-配置">确认 FE 配置<a href="#确认-fe-配置" class="hash-link" aria-label="确认 FE 配置的直接链接" title="确认 FE 配置的直接链接">​</a></h4>
<p>启动 FE 节点前，您需要确认配置文件 <strong>fe/conf/fe.conf</strong> 中元数据路径 <code>meta_dir</code> 和相关通信端口的配置项是否正确。</p>
<table><thead><tr><th>配置项</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>meta_dir</td><td>FE 节点存储元数据的路径，您需要提前创建相应路径。</td><td><code>${STARROCKS_HOME}/meta</code></td></tr><tr><td>http_port</td><td>FE 节点的 HTTP Server 端口。</td><td>8030</td></tr><tr><td>rpc_port</td><td>FE 节点的 Thrift Server 端口。</td><td>9020</td></tr><tr><td>query_port</td><td>FE 节点的 MySQL Server 端口。</td><td>9030</td></tr><tr><td>edit_log_port</td><td>FE 集群（Leader，Follower，以及 Observer）间的通信端口。</td><td>9010</td></tr></tbody></table>
<blockquote>
<p>注意</p>
<p>由于 FE 节点的元数据涉及整个 StarRocks 系统，十分关键，建议您将 <code>meta_dir</code> 部署于单独路径下。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动-fe-进程">启动 FE 进程<a href="#启动-fe-进程" class="hash-link" aria-label="启动 FE 进程的直接链接" title="启动 FE 进 程的直接链接">​</a></h4>
<p>进入 FE 进程的部署路径并运行命令启动服务。启动多 FE 节点时，您需要逐台启动 Follower FE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_fe.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>为了保证 FE 高可用，您需要部署多个 FE 节点。我们建议您部署 3 个 FE 节点，其中包含 1 个 Leader FE 节点和 2 个 Follower FE 节点。</p>
<p>在初次部署时，第一个启动的 FE 会默认成为 Leader FE，后启动的 Follower FE 在<strong>首次启动</strong>时需要指定已存活在集群中的 Follower FE 作为 helper 节点（仅首次启动时需要指定，helper 节点通常选用 Leader FE 节点）。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_fe.sh --helper </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Leader_FE_IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">edit_log_port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>注意</p>
<p>当拥有多个 Follower FE 节点时，集群内需要有半数以上的 Follower FE 节点存活才能够选举出 Leader FE 节点，从而提供查询服务。</p>
</blockquote>
<p>每启动一台 FE 节点后，建议您验证该节点是否启动成功。您可以通过发送查询的方式进行验证。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动-be-集群">启动 BE 集群<a href="#启动-be-集群" class="hash-link" aria-label="启动 BE 集群的直接链接" title="  启动 BE 集群的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="确认-be-配置">确认 BE 配置<a href="#确认-be-配置" class="hash-link" aria-label="确认 BE 配置的直接链接" title="确认 BE 配置的直接链接">​</a></h4>
<p>启动 BE 节点前，您需要确认配置文件 <strong>be/conf/be.conf</strong> 中数据存路径 <code>storage_root_path</code> 和相关通信端口的配置项是否正确。</p>
<table><thead><tr><th>配置项</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>storage_root_path</td><td>BE 节点存储数据路径，您需要提前创建相应路径。建议您为每个磁盘创建一个路径。</td><td><code>${STARROCKS_HOME}/storage</code></td></tr><tr><td>be_port</td><td>BE 上 Thrift Server 的端口，用于接收来自 FE 的请求。</td><td>9060</td></tr><tr><td>be_http_port</td><td>BE 上的 HTTP Server 的端口。</td><td>8040</td></tr><tr><td>heartbeat_service_port</td><td>BE 上 Thrift server 端口，用于接收来自 FE 的心跳。</td><td>9050</td></tr><tr><td>brpc_port</td><td>BE 节点间的通讯端口。</td><td>8060</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动-be-进程">启动 BE 进程<a href="#启动-be-进程" class="hash-link" aria-label="启动 BE 进程的直接链接" title="启动 BE 进程的直接链接">​</a></h4>
<p>进入 BE 进程的部署路径并运行命令启动服务。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_be.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动-cn-集群-可选">启动 CN 集群 (可选)<a href="#启动-cn-集群-可选" class="hash-link" aria-label="启动 CN 集群 (可选)的直接链接" title="启动 CN 集群 (可选)的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="确认-cn-配置">确认 CN 配置<a href="#确认-cn-配置" class="hash-link" aria-label="确认 CN 配置的直接链接" title="确认 CN 配置的直接链接">​</a></h4>
<table><thead><tr><th>配置项</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>be_port</td><td>CN 上 Thrift Server 的端口，用于接收来自 FE 的请求。自 v3.1 起，该配置项由 <code>thrift_port</code> 更名为 <code>be_port</code>。</td><td>9060</td></tr><tr><td>be_http_port</td><td>CN 上的 HTTP Server 的端口。</td><td>8040</td></tr><tr><td>heartbeat_service_port</td><td>CN 上 Thrift server 端口，用于接收来自 FE 的心跳。</td><td>9050</td></tr><tr><td>brpc_port</td><td>CN 与 BE 节点间的通讯端口。</td><td>8060</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动-cn-进程">启动 CN 进程<a href="#启动-cn-进程" class="hash-link" aria-label="启动 CN 进程的直接链接" title="启动 CN 进程的直接链接">​</a></h4>
<p>进入 CN 进程的部署路径并运行命令启动服务。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_cn.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认集群健康状态">确认集群健康状态<a href="#确认集群健康状态" class="hash-link" aria-label="确认集群健康状态的直接链接" title="确认集群健康状态的直接链接">​</a></h3>
<p>在 FE、BE、CN 启动完成之后，您需要检查进程状态，以确定服务正常启动。</p>
<ul>
<li>确认 FE 集群启动状态。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">fe_host</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">fe_http_port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/api/bootstrap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>若返回 <code>{&quot;status&quot;: &quot;OK&quot;, &quot;msg&quot;: &quot;Success&quot;}</code>，则集群正常启动。</p>
<ul>
<li>确认 BE 集群启动状态。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">be_host</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">be_http_port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/api/health</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>若返回 <code>{&quot;status&quot;: &quot;OK&quot;, &quot;msg&quot;: &quot;To Be Added&quot;}</code>，则集群正常启动。</p>
<ul>
<li>确认 CN 集群启动状态。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cn_host</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cn_http_port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/api/health</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>若返回 <code>{&quot;status&quot;: &quot;OK&quot;, &quot;msg&quot;: &quot;To Be Added&quot;}</code>，则集群正常启动。</p>
<p>确认正常启动后，如果执行查询时需要使用 CN 节点，扩展算力，则需要设置系统变量 <a href="/doc/zh/docs/reference/System_variable.md"><code>prefer_compute_node</code>、<code>use_compute_nodes</code></a>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="停止集群">停止集群<a href="#停止集群" class="hash-link" aria-label="停止集群的直接链接" title="停止集群的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="停止-fe-集群">停止 FE 集群<a href="#停止-fe-集群" class="hash-link" aria-label="停止 FE 集群的直接链接" title="停止 FE 集群的直接链接">​</a></h3>
<p>进入 FE 路径，运行命令停止 FE 集群。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_fe.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="停止-be-集群">停止 BE 集群<a href="#停止-be-集群" class="hash-link" aria-label="停止 BE 集群的直接链接" title="停止 BE 集群的直接链接">​</a></h3>
<p>进入 BE 路径，运行命令停止 BE 集群。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_be.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="停止-cn-集群">停止 CN 集群<a href="#停止-cn-集群" class="hash-link" aria-label="停止 CN 集群的直接链接" title="停止 CN 集群的直接链接">​</a></h3>
<p>进入 CN 路径，运行命令停止 CN 集群。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_cn.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="升级集群">升级集群<a href="#升级集群" class="hash-link" aria-label="升级集群的直接链接" title="升级集群的直接链接">​</a></h2>
<p>您可以通过滚动升级的方式平滑升级 StarRocks。StarRocks 的版本号遵循 Major.Minor.Patch 的命名方式，分别代表重大版本，大版本以及小版本。</p>
<blockquote>
<p>注意</p>
<ul>
<li>由于 StarRocks 保证 BE 后向兼容 FE，因此您需要<strong>先升级 BE 节点，再升级 FE 节点</strong>。错误的升级顺序可能导致新旧 FE、BE 节点不兼容，进而导致 BE 节点停止服务。</li>
<li>StarRocks 2.0 之前的大版本升级时必须<strong>逐个大版本</strong>升级，2.0 之后的版本可以<strong>跨大版本</strong>升级。 更为推荐的稳妥方式是逐个版本升级，比如 1.19-&gt;2.0-&gt;2.1-&gt;2.2-&gt;2.3-&gt;2.4。StarRocks 2.2 和 2.5 是当前的长期支持版本（Long Term Support，LTS），维护期为半年以上。</li>
</ul>
<table><thead><tr><th>版本</th><th>可直接升级版本</th><th>注意事项</th><th>是否为 LTS 版本</th></tr></thead><tbody><tr><td>1.18.x</td><td></td><td></td><td>否</td></tr><tr><td>1.19.x</td><td>必须从1.18.x升级</td><td></td><td>否</td></tr><tr><td>2.0.x</td><td>必须从1.19.x升级</td><td>升级过程中需要暂时关闭 Clone。</td><td>否</td></tr><tr><td>2.1.x</td><td>必须从2.0.x 升级</td><td>灰度升级前需要修改 <code>vector_chunk_size</code> 和 <code>batch_size</code>。</td><td>否</td></tr><tr><td>2.2.x</td><td>可以从2.0.x 或 2.1.x 升级</td><td>回滚需要配置 <code>ignore_unknown_log_id</code> 为 <code>true</code>。</td><td>是</td></tr><tr><td>2.3.x</td><td>可以从2.0.x、2.1.x 或 2.2.x 升级</td><td>不建议跨版本回滚。回滚需要配置 <code>ignore_unknown_log_id</code> 为 <code>true</code>。</td><td>否</td></tr><tr><td>2.4.x</td><td>可以从2.0.x、2.1.x、2.2.x 或 2.3.x 升级</td><td>不建议跨版本回滚。如果您开启了 <a href="/doc/zh/docs/administration/enable_fqdn">FQDN 访问</a>，需先将集群修改为 IP 地址访问。</td><td>否</td></tr><tr><td>2.5.x</td><td>可以从2.0.x、2.1.x、2.2.x、2.3.x 或 2.4.x 升级</td><td>不建议跨版本回滚。</td><td>是</td></tr></tbody></table>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载安装文件">下载安装文件<a href="#下载安装文件" class="hash-link" aria-label="下载安装文件的直接链接" title="下载安装文件的直接链接">​</a></h3>
<p>在完成数据正确性验证后，将新版本的 BE 和 FE 节点的安装包下载并分发至各自路径下。您也可以 <a href="/doc/zh/docs/developers/build-starrocks/Build_in_docker">在 Docker 中编译</a> 对应 tag 的源码。建议您选择小版本号最高的版本。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级-be-前的准备">升级 BE 前的准备<a href="#升级-be-前的准备" class="hash-link" aria-label="升级 BE 前的准备的直接链接" title="升级 BE 前的准备的直接链接">​</a></h3>
<p>为了避免 BE 重启期间不必要的 Tablet 修复，进而影响升级后的集群性能，建议在升级前先在 Leader FE 上执行如下命令以禁用 Tablet 调度功能，</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_scheduling_tablets&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_colocate_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在<strong>所有</strong> BE 重启升级完成后，通过 <code>show backends</code> 命令确认所有 BE 的 <code>Alive</code> 状态为 <code>true</code> 后，启用 Tablet 调度功能，</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_scheduling_tablets&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_colocate_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试-be-升级的正确性">测试 BE 升级的正确性<a href="#测试-be-升级的正确性" class="hash-link" aria-label="测试 BE 升级的正确性的直接链接" title="测试 BE 升级的正确性的直接链接">​</a></h3>
<ol>
<li>选择任意一个 BE 节点，停止该节点。</li>
<li>替换改节点路径下的 <strong>bin</strong> 和 <strong>lib</strong> 文件夹。</li>
<li>启动该 BE 节点，通过 BE 日志 <strong>be.INFO</strong> 查看是否启动成功。</li>
<li>如果该 BE 节点启动失败，您可以先排查失败原因。如果错误不可恢复，您可以直接通过 <code>DROP BACKEND</code> 删除该 BE、清理数据后，使用上一个版本的 <strong>starrocks_be</strong> 重新启动该 BE 节点。然后通过 <code>ADD BACKEND</code> 重新添加 BE 节点。</li>
</ol>
<blockquote>
<p><strong>警告</strong></p>
<p><strong>该方法会导致系统丢失一个数据副本，请务必确保 3 个副本完整的情况下执行这个操作。</strong></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级-be-节点">升级 BE 节点<a href="#升级-be-节点" class="hash-link" aria-label="升级 BE 节点的直接链接" title="升级 BE 节点的直接链接">​</a></h3>
<ol>
<li>
<p>进入 BE 路径，停止 BE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_be.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 BE 节点相关文件。</p>
<blockquote>
<p>注意</p>
<p>BE 节点小版本升级中（例如从 2.0.x 升级到 2.0.y），您只需升级 <strong>/lib/starrocks_be</strong>。而大版本升级中（例如从 2.0.x 升级到 2.x.x），您需要替换 BE 节点路径下的 <strong>bin</strong> 和 <strong>lib</strong> 文件夹。</p>
</blockquote>
<p>以下示例以大版本升级为例。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/be/lib  </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/be/bin  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 BE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_be.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>确认当前节点启动成功。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> starrocks_be</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>重复以上步骤，升级其他 BE 节点。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试-fe-升级的正确性">测试 FE 升级的正确性<a href="#测试-fe-升级的正确性" class="hash-link" aria-label="测试 FE 升级的正确性的直接链接" title="测试 FE 升级的正确性的直接链接">​</a></h3>
<blockquote>
<p>注意</p>
<p>由于 FE 元数据极其重要，而升级出现异常可能导致所有数据丢失，请谨慎升级。</p>
</blockquote>
<ol>
<li>在测试开发环境中单独使用新版本部署一个测试用的 FE 进程。</li>
<li>修改测试用的 FE 的配置文件 <strong>fe.conf</strong>，将所有端口设置为与生产环境不同。</li>
<li>在 <strong>fe.conf</strong> 添加配置 <code>cluster_id = 123456</code> 。</li>
<li>在 <strong>fe.conf</strong> 添加配置 <code>metadata_failure_recovery = true</code>。</li>
<li>拷贝生产环境中 Leader FE 的元数据路径 <strong>meta</strong> 到测试环境。</li>
<li>修改测试环境中 <strong>meta/image/VERSION</strong> 文件中的 <code>cluster_id</code> 为 <code>123456</code>（即与第 3 步中相同）。</li>
<li>在测试环境中，运行 <code>sh bin/start_fe.sh</code> 启动 FE。</li>
<li>通过 FE 日志 <strong>fe.log</strong> 验证测试 FE 节点是否成功启动。</li>
<li>如果启动成功，运行 <code>sh bin/stop_fe.sh</code> 停止测试环境的 FE 节点进程。</li>
</ol>
<blockquote>
<p>说明</p>
<p>以上第 2 至 第 6 步的目的是防止测试环境的 FE 启动后，错误连接到线上环境中。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级-fe-节点">升级 FE 节点<a href="#升级-fe-节点" class="hash-link" aria-label="升级 FE 节点的直接链接" title="升级 FE 节点的直接链接">​</a></h3>
<p>升级 FE 集群时，您需要先升级各 Follower FE 节点，最后升级 Leader FE 节点，从而在 Follower FE 节点升级失败时可以提前发现问题，防止其影响集群查询功能。</p>
<ol>
<li>
<p>进入 FE 路径，停止 FE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_fe.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 FE 相关文件。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>FE 节点小版本升级中（例如从 2.0.x 升级到 2.0.y），您只需升级 <strong>/lib/starrocks-fe.jar</strong>。而大版本升级中（例如从 2.0.x 升级到 2.x.x），您需要替换 FE 节点路径下的 <strong>bin</strong>、<strong>lib</strong> 和 <strong>spark-dpp</strong> 文件夹。</p>
</blockquote>
<p>以下示例以大版本升级为例。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/fe/lib  </span><span class="token builtin class-name">.</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/fe/bin  </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/fe/spark-dpp  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 FE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_fe.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>确认当前节点启动成功。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> StarRocksFE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>重复以上步骤，升级其他 Follower FE 节点，并最后升级 Leader FE 节点。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级-cn-节点">升级 CN 节点<a href="#升级-cn-节点" class="hash-link" aria-label="升级 CN 节点的直接链接" title="升级 CN 节点的直接链接">​</a></h3>
<p>升级 CN 节点时，您需要根据升级的版本，选择对应的升级方式：</p>
<ul>
<li>如果为小版本升级（例如从 2.0.x 升级到 2.0.y），则只需要替换二进制文件 <strong>/lib/starrocks_be</strong>，然后重启服务。</li>
<li>如果为大版本升级 （例如从 2.0.x 升级到 2.x.x），您需要替换 BE 节点路径下的 bin 和 lib 文件夹。</li>
</ul>
<p>以下示例以大版本升级为例。</p>
<ol>
<li>
<p>进入 CN 路径，停止 CN 节点。推荐使用 graceful 的停止方式。使用该种方式停止，CN 会等待当前运行的任务运行结束后再退出进程。</p>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_cn.sh --graceful</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 CN 节点相关文件。</p>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/be/lib  </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/be/bin  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 CN 节点。</p>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_cn.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>确认当前节点启动成功。</p>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> starrocks_be</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>重复以上步骤，升级其他 CN 节点。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级-broker">升级 Broker<a href="#升级-broker" class="hash-link" aria-label="升级 Broker的  直接链接" title="升级 Broker的直接链接">​</a></h3>
<ol>
<li>
<p>进入 Broker 路径，停止 Broker 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/apache_hdfs_broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_broker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 Broker 相关文件。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/apache_hdfs_broker/lib  </span><span class="token builtin class-name">.</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/apache_hdfs_broker/bin  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 Broker 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_broker.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>在升级下一台实例之前，您需要确认当前实例启动成功。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="关于-starrocks-119-升级至-20x">关于 StarRocks 1.19 升级至 2.0.x<a href="#关于-starrocks-119-升级至-20x" class="hash-link" aria-label="关于 StarRocks 1.19 升级至 2.0.x的直接链接" title="关于 StarRocks 1.19 升级至 2.0.x的直接链接">​</a></h3>
<p>如果您需要将 StarRocks 1.19 升级至 2.0.x，您必须在升级过程中关闭 Clone 以避免触发旧版本中的 Bug。该操作同样适用于从 StarRocks 2.1.5 或之前版本升级至 2.1.6 或之后版本。</p>
<p>升级开始前，您需要关闭 Clone。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ADMIN </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> FRONTEND CONFIG </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_scheduling_tablets&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADMIN </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> FRONTEND CONFIG </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_balancing_tablets&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>升级结束后，开启 Clone。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ADMIN </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> FRONTEND CONFIG </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_scheduling_tablets&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADMIN </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> FRONTEND CONFIG </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_balancing_tablets&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="关于-starrocks-20x-灰度升级至-21x">关于 StarRocks 2.0.x 灰度升级至 2.1.x<a href="#关于-starrocks-20x-灰度升级至-21x" class="hash-link" aria-label="关于 StarRocks 2.0.x 灰度升级至 2.1.x的直接链接" title="关于 StarRocks 2.0.x 灰度升级至 2.1.x的直接链接">​</a></h3>
<p>如果您需要将 StarRocks 2.0 灰度升级至 2.1，则必须确保所有 BE 节点拥有一致的 <code>chunk size</code>，即 BE 节点在每个批次中处理数据 的行数。</p>
<ol>
<li>在配置文件 <strong>conf/be.conf</strong> 中，将所有 BE 节点的配置项 <code>vector_chunk_size</code> 设为 <code>4096</code>（默认值为 4096，单位为行）。配置项修改将在重启后生效。</li>
<li>为 FE 节点设定全局变量 <code>batch_size</code> 小于或等于 <code>4096</code>（默认值和建议值为 4096，单位为行）。</li>
</ol>
<p>示例：</p>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 查询 batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show variables like &#x27;%batch_size%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name | Value |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| batch_size    | 1024  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- 设置 batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; set global batch_size = 4096;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="故障排除">故障排除<a href="#故障排除" class="hash-link" aria-label="故障排除的直接链接" title="故障排除的直接链接">​</a></h4>
<p>Q：升级 StarRocks 2.0 至 2.1 及后期版本后，通过 Stream Load 将 JSON 格式的 BOOLEAN 类型数据导入至整形列中返回 NULL。我该如何处理？</p>
<p>A：StarRocks 2.0 版本将所有字段作为字符串解析，然后进行类型转换。将执行格式为 JSON 且类型为 BOOLEAN 的数据（<code>true</code> 和 <code>false</code>）导入至整形列中时，StarRocks 2.0 会将数据转化为 <code>0</code> 和 <code>1</code> 后导入。StarRocks 2.1 及后期版本重制了 JSON Parser，直接按照目标列类型提取 JSON 字段，从而导致最终得到的数据为 NULL。</p>
<p>您可以通过在 <a href="/doc/zh/docs/sql-reference/sql-statements/data-manipulation/STREAM LOAD">Stream Load</a> 导入命令 <code>columns</code> 项中添加表达式 <code>tmp, target=if(tmp,1,0)</code> 解决该问题。完整导入命令如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> --location-trusted -u </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">username</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-H </span><span class="token string" style="color:#e3116c">&quot;columns: &lt;col_name_1&gt;, &lt;col_name_2&gt;, &lt;tmp&gt;, &lt;col_name_3&gt;=if(&lt;tmp&gt;,1,0)&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-T demo.csv -XPUT </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">fe_ip</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">fe_http_port</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/api/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">db_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">table_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/_stream_load</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="回滚集群">回滚集群<a href="#回滚集群" class="hash-link" aria-label="回滚集群的直接链接" title="回滚集群的直接链接">​</a></h2>
<p>您可以通过命令回滚 StarRocks 版本，回滚范围包括所有安装包名为 <strong>StarRocks-xx</strong> 的版本。当升级后发现出现异常状况，不符合预期，想快速恢复服务的，可以按照下述操作回滚版本。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>回滚操作与升级操作的顺序相反，应当<strong>先回滚 FE 节点，再回滚 BE 节点</strong> 。错误的回滚顺序可能导致新旧 FE、BE 节点不兼容，进而导致 BE 节点停止服务。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="前置工作">前置工作<a href="#前置工作" class="hash-link" aria-label="前置工作的直接链接" title="前置工作的直接链接">​</a></h3>
<p>回滚 StarRocks 2.2 及以后版本前，您需要在所有 FE 节点的配置文件 <strong>fe.conf</strong> 中增加配置项 <code>ignore_unknown_log_id=true</code>，否则回滚后系统可能无法启动。重启 StarRocks，CheckPoint 完成后，您需要将该设置项恢复为 <code>ignore_unknown_log_id=false</code>，然后重启 FE 以恢复正常配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载安装文件-1">下载安装文件<a href="#下载安装文件-1" class="hash-link" aria-label="下载安装文件的直接链接" title="下载安装文件的直接链接">​</a></h3>
<p>在完成数据正确性验证后，将需要回滚的旧版本 BE 和 FE 节点安装包下载并分发至各自路径下。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="回滚-fe-节点">回滚 FE 节点<a href="#回滚-fe-节点" class="hash-link" aria-label="回滚 FE 节点的直接链接" title="回滚 FE 节点的直接链接">​</a></h3>
<p>您需要先回滚各 Follower FE 节点，最后回滚 Leader FE 节点。以下示例以大版本回滚为例。</p>
<blockquote>
<p>注意</p>
<ul>
<li>FE 节点小版本回滚中（例如从 2.0.y 回滚到 2.0.x），您只需回滚 <strong>/lib/starrocks-fe.jar</strong>。</li>
<li>FE 节点大版本回滚中（例如从 2.x.x 升级到 2.0.x），您需要替换 FE 节点路径下的 <strong>bin</strong>、<strong>lib</strong> 和 <strong>spark-dpp</strong> 文件夹。</li>
<li>从 2.1.x 回滚至 2.0.x及以前版本需要通过以下命令关闭 pipeline：<code>set global enable_pipeline_engine = false</code>。</li>
</ul>
</blockquote>
<ol>
<li>
<p>进入 FE 路径，停止 FE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/fe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_fe.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 FE 相关文件。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/fe/lib  </span><span class="token builtin class-name">.</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/fe/bin  </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/fe/spark-dpp  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 FE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_fe.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>确认当前节点启动成功。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> StarRocksFE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>重复以上步骤，回滚其他 Follower FE 节点，并最后回滚 Leader FE 节点。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="回滚-be-节点前的准备">回滚 BE 节点前的准备<a href="#回滚-be-节点前的准备" class="hash-link" aria-label="回滚 BE 节点前的准备的直接链接" title="回滚 BE 节点前的准备的直接链接">​</a></h3>
<p>为了避免 BE 重启期间不必要的 Tablet 修复，进而影响回滚后的集群性能，建议在回滚前先在 Leader FE 上执行如下命令以禁用 Tablet 调度功能，</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_scheduling_tablets&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_colocate_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在<strong>所有</strong> BE 重启回滚完成后，通过 <code>show backends</code> 命令确认所有 BE 的 <code>Alive</code> 状态为 <code>true</code> 后，启用 Tablet 调度功能，</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_scheduling_tablets&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> frontend config </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disable_colocate_balance&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="回滚-be-节点">回滚 BE 节点<a href="#回滚-be-节点" class="hash-link" aria-label="回滚 BE 节点的直接链接" title="回滚 BE 节点的直接链接">​</a></h3>
<p>以下示例以大版本回滚为例。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>BE 节点小版本回滚中（例如从 2.0.y 回滚到 2.0.x），您只需回滚 <strong>/lib/starrocks_be</strong>。而大版本回滚中（例如从 2.x.x 升级到 2.0.x），您需要替换 BE 节点路径下的 <strong>bin</strong> 和 <strong>lib</strong> 文件夹。</p>
</blockquote>
<ol>
<li>
<p>进入 BE 路径，停止 BE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_be.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 BE 节点相关文件。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/be/lib  </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/be/bin  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 BE 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_be.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>确认当前节点启动成功。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> starrocks_be</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>重复以上步骤，回滚其他 BE 节点。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="回滚-broker">回滚 Broker<a href="#回滚-broker" class="hash-link" aria-label="回滚 Broker的直接链接" title="回滚 Broker的直接链接">​</a></h3>
<ol>
<li>
<p>进入 Broker 路径，停止 Broker 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> StarRocks-x.x.x/apache_hdfs_broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/stop_broker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>替换 Broker 相关文件。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> lib lib.bak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> bin bin.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/apache_hdfs_broker/lib  </span><span class="token builtin class-name">.</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> -r /tmp/StarRocks-x.x.x/apache_hdfs_broker/bin  </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>启动 Broker 节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> bin/start_broker.sh --daemon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>在升级下一台实例之前，您需要确认当前实例启动成功。</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/administration/Cluster_administration.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#启动集群" class="table-of-contents__link toc-highlight">启动集群</a><ul><li><a href="#启动-fe-集群" class="table-of-contents__link toc-highlight">启动 FE 集群</a></li><li><a href="#启动-be-集群" class="table-of-contents__link toc-highlight">启动 BE 集群</a></li><li><a href="#启动-cn-集群-可选" class="table-of-contents__link toc-highlight">启动 CN 集群 (可选)</a></li><li><a href="#确认集群健康状态" class="table-of-contents__link toc-highlight">确认集群健康状态</a></li></ul></li><li><a href="#停止集群" class="table-of-contents__link toc-highlight">停止集群</a><ul><li><a href="#停止-fe-集群" class="table-of-contents__link toc-highlight">停止 FE 集群</a></li><li><a href="#停止-be-集群" class="table-of-contents__link toc-highlight">停止 BE 集群</a></li><li><a href="#停止-cn-集群" class="table-of-contents__link toc-highlight">停止 CN 集群</a></li></ul></li><li><a href="#升级集群" class="table-of-contents__link toc-highlight">升级集群</a><ul><li><a href="#下载安装文件" class="table-of-contents__link toc-highlight">下载安装文件</a></li><li><a href="#升级-be-前的准备" class="table-of-contents__link toc-highlight">升级 BE 前的准备</a></li><li><a href="#测试-be-升级的正确性" class="table-of-contents__link toc-highlight">测试 BE 升级的正确性</a></li><li><a href="#升级-be-节点" class="table-of-contents__link toc-highlight">升级 BE 节点</a></li><li><a href="#测试-fe-升级的正确性" class="table-of-contents__link toc-highlight">测试 FE 升级的正确性</a></li><li><a href="#升级-fe-节点" class="table-of-contents__link toc-highlight">升级 FE 节点</a></li><li><a href="#升级-cn-节点" class="table-of-contents__link toc-highlight">升级 CN 节点</a></li><li><a href="#升级-broker" class="table-of-contents__link toc-highlight">升级 Broker</a></li><li><a href="#关于-starrocks-119-升级至-20x" class="table-of-contents__link toc-highlight">关于 StarRocks 1.19 升级至 2.0.x</a></li><li><a href="#关于-starrocks-20x-灰度升级至-21x" class="table-of-contents__link toc-highlight">关于 StarRocks 2.0.x 灰度升级至 2.1.x</a></li></ul></li><li><a href="#回滚集群" class="table-of-contents__link toc-highlight">回滚集群</a><ul><li><a href="#前置工作" class="table-of-contents__link toc-highlight">前置工作</a></li><li><a href="#下载安装文件-1" class="table-of-contents__link toc-highlight">下载安装文件</a></li><li><a href="#回滚-fe-节点" class="table-of-contents__link toc-highlight">回滚 FE 节点</a></li><li><a href="#回滚-be-节点前的准备" class="table-of-contents__link toc-highlight">回滚 BE 节点前的准备</a></li><li><a href="#回滚-be-节点" class="table-of-contents__link toc-highlight">回滚 BE 节点</a></li><li><a href="#回滚-broker" class="table-of-contents__link toc-highlight">回滚 Broker</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/zh/docs/introduction/StarRocks_intro">Documentation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 StarRocks, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>