<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.1 docs-doc-page docs-doc-id-administration/Metadata_recovery" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-beta.0">
<title data-rh="true">元数据恢复（此方法并不能根本解决问题，只是为了尽快恢复集群才需要如此操作，请联系官方人员协助） | StarRocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/zh/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/zh/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/zh/docs/2.1/administration/Metadata_recovery"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="2.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.1"><meta data-rh="true" name="docsearch:version" content="2.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.1"><meta data-rh="true" property="og:title" content="元数据恢复（此方法并不能根本解决问题，只是为了尽快恢复集群才需要如此操作，请联系官方人员协助） | StarRocks"><meta data-rh="true" name="description" content="FE 有可能因为某些原因出现无法启动 bdbje、FE 之间无法同步等问题。故障表现包括无法进行元数据写操作、没有 MASTER 等等，需要手动恢复 FE。"><meta data-rh="true" property="og:description" content="FE 有可能因为某些原因出现无法启动 bdbje、FE 之间无法同步等问题。故障表现包括无法进行元数据写操作、没有 MASTER 等等，需要手动恢复 FE。"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/zh/docs/2.1/administration/Metadata_recovery"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/docs/2.1/administration/Metadata_recovery" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/zh/docs/2.1/administration/Metadata_recovery" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/docs/2.1/administration/Metadata_recovery" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ER08SJMRY1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="StarRocks" href="/zh/opensearch.xml"><link rel="stylesheet" href="/zh/assets/css/styles.83b858a3.css">
<script src="/zh/assets/js/runtime~main.c14eeca4.js" defer="defer"></script>
<script src="/zh/assets/js/main.71e2ed45.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.starrocks.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/zh/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StarRocks</b></a><a class="navbar__item navbar__link" href="/zh/docs/2.1/administration/Authentication">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/2.1/administration/Authentication">2.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/examples/introduction">Next</a></li><li><a class="dropdown__link" href="/zh/docs/introduction/StarRocks_intro">Latest-3.1</a></li><li><a class="dropdown__link" href="/zh/docs/3.0/administration/Authentication">3.0</a></li><li><a class="dropdown__link" href="/zh/docs/2.5/administration/Authentication">Stable-2.5</a></li><li><a class="dropdown__link" href="/zh/docs/2.3/administration/Metadata_recovery">2.3</a></li><li><a class="dropdown__link" href="/zh/docs/2.2/administration/Metadata_recovery">2.2</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/docs/2.1/administration/Metadata_recovery">2.1</a></li><li><a class="dropdown__link" href="/zh/docs/2.0/administration/Build_in_docker">2.0</a></li><li><a class="dropdown__link" href="/zh/docs/1.19/development/Build_in_docker">1.19</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/docs/2.1/administration/Metadata_recovery" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/zh/docs/2.1/administration/Metadata_recovery" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/StarRocks/starrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/docs/2.1/administration/Authentication">administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Authentication">认证方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Backup_and_restore">备份与恢复</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Blacklist">黑名单管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Build_in_docker">dev-env image 使用说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Cluster_administration">集群管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Configuration">参数配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Data_recovery">数据删除恢复</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Load_balance">负载均衡</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Memory_management">内存管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/2.1/administration/Metadata_recovery">元数据恢复（此方法并不能根本解决问题，只是为了尽快恢复集群才需要如此操作，请联系官方人员协助）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Monitor_and_Alert">监控报警</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Profiling">性能优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Query_management">查询管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Query_planning">查询分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Replica">副本管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/Scale_up_down">扩容缩容</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/2.1/administration/User_privilege">用户权限</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/benchmarking/SSB_Benchmarking">benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/faq/Deploy_faq">faq</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/introduction/StarRocks_intro">introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/loading/BrokerLoad">loading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/2.1/quick_start">quick_start</a><button aria-label="Expand sidebar category &#x27;quick_start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/reference/Error_code">reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/release_notes/release-1.19">release_notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/sql-reference/sql-functions/How_to_Write_Functions_Documentation">sql-reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/2.1/table_design">介绍</a><button aria-label="Expand sidebar category &#x27;介绍&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/unloading/Export">unloading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/2.1/using_starrocks/Array">using_starrocks</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">administration</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">元数据恢复（此方法并不能根本解决问题，只是为了尽快恢复集群才需要如此操作，请联系官方人员协助）</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：2.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>元数据恢复（此方法并不能根本解决问题，只是为了尽快恢复集群才需要如此操作，请联系官方人员协助）</h1>
<p>FE 有可能因为某些原因出现无法启动 bdbje、FE 之间无法同步等问题。故障表现包括无法进行元数据写操作、没有 MASTER 等等，需要手动恢复 FE。</p>
<p><code>注：元数据操作需要谨慎，错误的操作可能导致集群数据的不可逆丢失，因此普通的fe无法启动尽量去排查启动问题，非整个集群不可用，bdbje无法选主的情况，不要参考此文档操作。</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="恢复原理">恢复原理<a href="#恢复原理" class="hash-link" aria-label="恢复原理的直接链接" title="恢复原理的直接链接">​</a></h2>
<p>手动恢复 FE 的大致原理，是先通过当前 meta_dir 中的元数据，启动一个新的 MASTER，然后再逐台添加其他 FE。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="恢复示例">恢复示例<a href="#恢复示例" class="hash-link" aria-label="恢复示例的直接链接" title="恢复示例的直接链接">​</a></h2>
<p>请严格按照如下步骤操作：</p>
<ol>
<li>
<p>停止所有 FE 进程，同时停止一切业务访问。保证在元数据恢复期间，不会因为外部访问导致其他不可预期的问题。</p>
</li>
<li>
<p>寻找元数据最新的FE节点</p>
<ul>
<li>先备份所有FE的meta_dir目录</li>
<li>如果meta文件夹不在默认位置，路径可在<code>xxx/fe/conf/fe.conf</code>中找到,示  例如下</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    meta_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> /home/disk1/sr/StarRocks-1.19.0/fe-3365df09-14bc-44a5-aabc-ccfaa5824d52/meta</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>meta_dir文件夹结构如下：</li>
</ul>
<p><img loading="lazy" alt="8-2" src="/zh/assets/images/8-2-7ce0b091bae57da1efb9826ca3caf38f.png" width="557" height="375" class="img_ev3q"></p>
<ul>
<li>通常情况下，Master FE 的元数据是最新的</li>
<li>确保元数据最新，可以切换到fe安装目录下，执行以下操作，获取lastVLSN，数字越大则该节点元数据越新</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    java -jar lib/je-7.3.7.jar DbPrintLog -h meta/bdb/ -vd </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>lastVLSN获取如下所示：</p>
<p><img loading="lazy" alt="8-8" src="/zh/assets/images/8-8-8b122a47e83763c52ca4e7b43b9262c1.png" width="1392" height="226" class="img_ev3q"></p>
<ul>
<li>比较各个fe节点上述操作获取的lastVLSN值大小，该值最大的节点为元数据最新的节点</li>
</ul>
</li>
<li>
<p>确认恢复节点角色</p>
<ul>
<li>进入image目录查看role文件，路径示例为<code>/xxx/StarRocks-xxx/fe-xxx/meta/image</code></li>
</ul>
<p><img loading="lazy" alt="8-3" src="data:image/png;base64,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" width="542" height="68" class="img_ev3q"></p>
<ul>
<li>之后，我们要使用这个拥有最新元数据的 FE 节点，进行恢复，建议尽量选择 FOLLOWER 节点恢复。</li>
</ul>
<p><code>注:如果恢复的节点的role为 FOLLOWER 则参考第四部分内容，如果恢复的节点的role为 OBSERVER 则参考第五部分内容</code></p>
</li>
<li>
<p>以下操作在选出来的元数据最新的FE节点执行(恢复节点角色为 FOLLOWER )：</p>
<ul>
<li>在 fe.conf 中添加配置：<code>metadata_failure_recovery=true</code>。</li>
</ul>
<p><code>metadata_failure_recovery=true</code> 的含义是，清空 BDBJE 中其他 FE 的元数据，只保留待恢复的 FE 的元数据。这样该 FE 就不会再联系其他的 FE，而作为一个独立的 FE 启动。这个参数只有在恢复启动时才需要设置为 true。恢复完成后，一定要设置为 false(后面有步骤说明)，否则一旦重启，bdbje 的元数据又会被清空，导致其他 FE 无法正常工作。</p>
<ul>
<li>执行<code>sh bin/start_fe.sh --daemon</code> 启动该FE，如果正常，这个 FE 会以 MASTER 的角色启动，在 fe.log 中会看到 <code>transfer from XXXX to MASTER</code> 等字样。</li>
<li>启动完成后，先连接到这个 FE，执行一些查询导入，检查是否能够正常访问。如果不正常，有可能是操作有误，查看FE启动日志，排查问题后重新启动FE。</li>
<li>如果成功，通过 <code>show frontends;</code> 命令，应该可以看到之前集群所添加的所有 FE，并且当前 FE 是 master。</li>
<li>将 fe.conf 中的 <code>metadata_failure_recovery=true</code> 配置项删除，或者设置为 false，然后重启这个 FE(重要)。</li>
<li>跳转至第六步骤继续执行恢复操作。</li>
</ul>
</li>
<li>
<p>以下操作在选出来的元数据最新的FE节点执行(恢复节点角色为 OBSERVER )：</p>
<ul>
<li>如果该节点是一个 OBSERVER，先将 meta_dir/image/ROLE 文件中的 <code>role=OBSERVER</code> 改为 <code>role=FOLLOWER</code>。</li>
<li>在 fe.conf 中添加配置：<code>metadata_failure_recovery=true</code>。</li>
</ul>
<p><code>metadata_failure_recovery=true</code> 的含义是，清空 BDBJE 中其他 FE 的元数据，只保留待恢复的 FE 的元数据。这样该 FE 就不会再联系其他的 FE，而作为一个独立的 FE 启动。这个参数只有在恢复启动时才需要设置为 true。恢复完成后，一定要设置为 false(后面有步骤说明)，否则一旦重启，bdbje 的元数据又会被清空，导致其他 FE 无法正常工作。</p>
<ul>
<li>执行<code>sh bin/start_fe.sh --daemon</code> 启动该FE，如果正常，这个 FE 会以 MASTER 的角色启动，在 fe.log 中会看到 <code>transfer from XXXX to MASTER</code> 等字样。</li>
<li>启动完成后，先连接到这个 FE，执行一些查询导入，检查是否能够正常访问。如果不正常，有可能是操作有误，查看FE启动日志，排查问题后重新启动FE。</li>
<li>如果成功，通过 <code>show frontends;</code> 命令，应该可以看到之前集群所添加的所有 FE，并且当前 FE 是 master。</li>
<li>由于是用一个 OBSERVER 节点的元数据进行恢复的，导致完成上述步骤后，<code>show frontends;</code> 会发现，当前这个 FE 的角色为 OBSERVER，但是 IsMaster 显示为 true。这是因为，这里看到的 “OBSERVER” 是记录在 StarRocks 的元数据中的，而是否是 master，是记录在 bdbje 的元数据中的。我们是从一个 OBSERVER 节点恢复的，所以这里出现了不一致。这种内部不一致的状态，不能支持后续的导入等修改操作，所以，还需要继续按以下步骤修复：</li>
<li>先把这个 “OBSERVER” conf中的<code>metadata_failure_recovery=true</code>注释掉，但不要重启该节点，以防止这个节点再加入集群的时候报错。</li>
<li>把除了这个 “OBSERVER” 以外的所有 FE 节点 DROP 掉。</li>
<li>通过 <code>ADD FOLLOWER</code> 命令，添加一 个新的 FOLLOWER FE，假设在 hostA 上。</li>
<li>在 hostA 上启动一个全新的 FE，通过 --helper 的方式加入集群。</li>
<li>启动成功后，通过 <code>show frontends;</code> 语句，你应该能看到两个 FE，一个是之前的 OBSERVER，一个是新添加的 FOLLOWER，并且 OBSERVER 是 master。</li>
<li>确认新的 FOLLOWER 是否可以正常工作，(观察如图所示的ID是否同步完成即可了解新的 FOLLOWER 是否正常工作)。</li>
</ul>
<p><img loading="lazy" alt="8-4" src="/zh/assets/images/8-4-fb2b51f57061a14cc7e48da6f570aaa1.png" width="1004" height="248" class="img_ev3q"></p>
<ul>
<li>确认这个新的 FOLLOWER 可以正常工作之后，跳转至第四步骤，用这个新的 FOLLOWER 的元数据，再执行一遍故障恢复操作。 以上这些步骤的目的，其实就是人为地制造出一个 FOLLOWER 节点的元数据，然后用这个元数据，重新开始故障恢复。这样就避免了从 OBSERVER 恢复元数据所遇到的不一致的问题。</li>
</ul>
</li>
<li>
<p>上述步骤完成后，我们就得到了一个存活的 FOLLOWER 角色的 MASTER，此时我们再通过 <code>ALTER SYSTEM DROP FOLLOWER/OBSERVER</code> 命令，将之前的其他的 FE 从元数据删除后，按加入全新 FE 的方式，即通过--helper启动的方式重新把这些 FE 添加一遍。如果通过--helper添加FE时对应fe启动失败，可以检查当前master节点的/fe/meta/bdb文件夹大小，如果bdb过大(超过fe.conf中jvm设置的一半)，则需要增大fe.conf中的jvm大小后重新启动。</p>
</li>
<li>
<p>如果以上操作正常，则恢复完毕。</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/StarRocks/docs.zh-cn/edit/main/administration/Metadata_recovery.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/2.1/administration/Memory_management"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">内存管理</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/2.1/administration/Monitor_and_Alert"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">监控报警</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#恢复原理" class="table-of-contents__link toc-highlight">恢复原理</a></li><li><a href="#恢复示例" class="table-of-contents__link toc-highlight">恢复示例</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/introduction/StarRocks_intro">Documentation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 StarRocks, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>