<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.3 docs-doc-page docs-doc-id-using_starrocks/Materialized_view" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-beta.0">
<title data-rh="true">Materialized view | StarRocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/docs/2.3/using_starrocks/Materialized_view"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.3"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.3"><meta data-rh="true" name="docsearch:version" content="2.3"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.3"><meta data-rh="true" property="og:title" content="Materialized view | StarRocks"><meta data-rh="true" name="description" content="This topic describes how to create, use, and manage a materialized view."><meta data-rh="true" property="og:description" content="This topic describes how to create, use, and manage a materialized view."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/docs/2.3/using_starrocks/Materialized_view"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/docs/2.3/using_starrocks/Materialized_view" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/zh/docs/2.3/using_starrocks/Materialized_view" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/docs/2.3/using_starrocks/Materialized_view" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ER08SJMRY1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="StarRocks" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.62f01ed5.css">
<script src="/assets/js/runtime~main.3ec76a3f.js" defer="defer"></script>
<script src="/assets/js/main.bda7b85e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.starrocks.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StarRocks</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/2.3/administration/Authentication">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/2.3/administration/Authentication">2.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/examples/introduction">Next</a></li><li><a class="dropdown__link" href="/docs/using_starrocks/Materialized_view">Latest-3.1</a></li><li><a class="dropdown__link" href="/docs/3.0/using_starrocks/Materialized_view">3.0</a></li><li><a class="dropdown__link" href="/docs/2.5/using_starrocks/Materialized_view">Stable-2.5</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.3/using_starrocks/Materialized_view">2.3</a></li><li><a class="dropdown__link" href="/docs/2.2/using_starrocks/Materialized_view">2.2</a></li><li><a class="dropdown__link" href="/docs/2.1/using_starrocks/Materialized_view">2.1</a></li><li><a class="dropdown__link" href="/docs/2.0/using_starrocks/Materialized_view">2.0</a></li><li><a class="dropdown__link" href="/docs/1.19/development/Build_in_docker">1.19</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/2.3/using_starrocks/Materialized_view" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/zh/docs/2.3/using_starrocks/Materialized_view" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/StarRocks/starrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/administration/Authentication">administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/benchmarking/SSB_Benchmarking">benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/data_source/External_table">data_source</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/faq/Deploy_faq">faq</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/introduction/Architecture">introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/loading/BrokerLoad">loading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/2.3/quick_start">quick_start</a><button aria-label="Expand sidebar category &#x27;quick_start&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/reference/Error_code">reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/release_notes/release-1.19">release_notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/sql-reference/sql-functions/How_to_Write_Functions_Documentation">sql-reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/2.3/table_design">Introduction</a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/2.3/unloading/Export">unloading</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/2.3/using_starrocks/Array">using_starrocks</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Array">Arrays</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Bitmap_index">Bitmap indexing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Bloomfilter_index">Bloom filter indexing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Colocate_join">Colocate Join</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Cost_based_optimizer">Cost Based Optimizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Lateral_join">Use Lateral Join for column-to-row conversion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.3/using_starrocks/Materialized_view">Materialized view</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Using_HLL">Use HLL for approximate count distinct</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.3/using_starrocks/Using_bitmap">Use Bitmap for exact count distinct</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">using_starrocks</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Materialized view</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Materialized view</h1>
<p>This topic describes how to create, use, and manage a materialized view.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>A materialized view in StarRocks is a special physical table that holds pre-computed query results from a base table. When you perform complex queries on a base table, the relevant pre-computed results can be used directly in the query execution to avoid repeated calculations and improve query efficiency.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-concepts">Basic concepts<a href="#basic-concepts" class="hash-link" aria-label="Direct link to Basic concepts" title="Direct link to Basic concepts">​</a></h3>
<ul>
<li>
<p><strong>Materialized view</strong></p>
<p>You can understand materialized views from two perspectives: materialization and view. Materialization means storing and reusing the pre-computed results for query acceleration. A view is essentially a table built on the basis of other tables. It is usually used to build mathematical models.</p>
</li>
<li>
<p><strong>Base table</strong></p>
<p>Base table is the driving table of its materialized view.</p>
</li>
<li>
<p><strong>Query rewrite</strong></p>
<p>Query rewrite means that when executing a query on a base table with materialized views built on, the system automatically judges whether or not the pre-computed results can be reused in processing the query. If they can be reused, the system will load the data directly from the relevant materialized view to avoid the time- and resource-consuming computation or join operation.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scenario">Scenario<a href="#scenario" class="hash-link" aria-label="Direct link to Scenario" title="Direct link to Scenario">​</a></h3>
<p>Materialized views are useful in the following situation:</p>
<ul>
<li>
<p><strong>Query acceleration</strong></p>
<p>Materialized views well serve the needs for accelerating predictable queries and queries that use same sub-query repetitively. Through materialized views, the system can directly use the pre-computed intermediate query result set to process such queries. It significantly reduces the load pressure caused by a large number of complex queries, and also greatly shortens the query processing time. StarRocks implements transparent acceleration based on materialized views, and ensures that, when querying the source table directly, the result must be based on the latest data.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-case">Use case<a href="#use-case" class="hash-link" aria-label="Direct link to Use case" title="Direct link to Use case">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="accelerating-queries-with-repetitive-aggregate-functions">Accelerating queries with repetitive aggregate functions<a href="#accelerating-queries-with-repetitive-aggregate-functions" class="hash-link" aria-label="Direct link to Accelerating queries with repetitive aggregate functions" title="Direct link to Accelerating queries with repetitive aggregate functions">​</a></h4>
<p>Suppose that most queries in your data warehouse include the same sub-query with an aggregate function, and these queries have consumed a huge proportion of your computing resources. Based on this sub-query, you can create a materialized view, which will compute and store all results of the sub-query. After the materialized view is built, the system will rewrite all queries that contain the sub-query, load the intermediate result stored in the materialized view, and thus accelerate these queries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="accelerate-queries-with-a-materialized-view">Accelerate queries with a materialized view<a href="#accelerate-queries-with-a-materialized-view" class="hash-link" aria-label="Direct link to Accelerate queries with a materialized view" title="Direct link to Accelerate queries with a materialized view">​</a></h2>
<p>If there are a considerable number of predictable queries or queries that use a same set of sub-query results repetitively, you can build materialized views to accelerate these queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparation">Preparation<a href="#preparation" class="hash-link" aria-label="Direct link to Preparation" title="Direct link to Preparation">​</a></h3>
<p>Before creating the materialized view, check if your data warehouse is eligible for query acceleration through materialized views. For example, check if the queries reuse certain subquery statements.</p>
<p>The following example is based on the table <code>sales_records</code>, which contains the transaction ID <code>record_id</code>, salesperson ID <code>seller_id</code>, store ID <code>store_id</code>, date <code>sale_date</code>, and sales amount <code>sale_amt</code> for each transaction. Follow these steps to create the table and insert data into it:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> sales_records</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    record_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seller_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    store_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sale_date </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sale_amt </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTRIBUTED</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HASH</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;2022-03-13&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8573</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">002</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">02</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;2022-03-14&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6948</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">003</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;2022-03-14&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4319</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">004</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;2022-03-15&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8734</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">005</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;2022-03-16&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4212</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">006</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">02</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;2022-03-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">9515</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The business scenario of this example demands frequent analyses on the sales amounts of different stores. As a result, the sum function is used on each query, consuming a massive amount of computing resources. You can run the query to record its time, and view its query profile by using EXPLAIN command.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL &gt; SELECT store_id, SUM(sale_amt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY store_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| store_id | sum(`sale_amt`) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        2 |           16463 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        3 |           12946 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        1 |           12892 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set (0.02 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MySQL &gt; EXPLAIN SELECT store_id, SUM(sale_amt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY store_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Explain String                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PLAN FRAGMENT 0                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  OUTPUT EXPRS:3: store_id | 6: sum                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   PARTITION: UNPARTITIONED                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   RESULT SINK                                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   4:EXCHANGE                                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PLAN FRAGMENT 1                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  OUTPUT EXPRS:                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   PARTITION: HASH_PARTITIONED: 3: store_id                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   STREAM DATA SINK                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     EXCHANGE ID: 04                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     UNPARTITIONED                                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   3:AGGREGATE (merge finalize)                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  output: sum(6: sum)                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  group by: 3: store_id                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |                                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   2:EXCHANGE                                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PLAN FRAGMENT 2                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  OUTPUT EXPRS:                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   PARTITION: RANDOM                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   STREAM DATA SINK                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     EXCHANGE ID: 02                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     HASH_PARTITIONED: 3: store_id                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   1:AGGREGATE (update serialize)                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  STREAMING                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  output: sum(5: sale_amt)                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  group by: 3: store_id                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |                                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   0:OlapScanNode                                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      TABLE: sales_records                                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      PREAGGREGATION: ON                                                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      partitions=1/1                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      rollup: sales_records                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      tabletRatio=10/10                                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      tabletList=12049,12053,12057,12061,12065,12069,12073,12077,12081,12085 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      cardinality=1                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      avgRowSize=2.0                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      numNodes=0                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">45 rows in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It can be observed that the query takes about 0.02 seconds, and no materialized view is used to accelerate the query because the output of <code>rollup</code> section in the query profile is <code>sales_records</code>, which is the base table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-materialized-view">Create a materialized view<a href="#create-a-materialized-view" class="hash-link" aria-label="Direct link to Create a materialized view" title="Direct link to Create a materialized view">​</a></h3>
<p>You can create a materialized view based on a specific query statement by using the following SQL command.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">mv_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">PROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For detailed instructions and parameter references, see <a href="/docs/2.3/sql-reference/sql-statements/data-definition/CREATE_MATERIALIZED_VIEW">SQL Reference - CREATE MATERIALIZED VIEW</a>.</p>
<p>Based on the table <code>sales_records</code> and the query statement mentioned above, the following example creates the materialized view <code>store_amt</code> to analyze the sum of sales amount in each store.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> store_amt </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> store_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sale_amt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> store_id</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-with-the-materialized-view">Query with the materialized view<a href="#query-with-the-materialized-view" class="hash-link" aria-label="Direct link to Query with the materialized view" title="Direct link to Query with the materialized view">​</a></h3>
<p>The materialized view you created contains the complete set of pre-computed results in accordance with the query statement. Subsequent queries will use the data within it. You can run the same query to test the query time as you did in the preparation.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL &gt; SELECT store_id, SUM(sale_amt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY store_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| store_id | sum(`sale_amt`) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        2 |           16463 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        3 |           12946 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        1 |           12892 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------+-----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 rows in set (0.01 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It can be observed that the query time is reduced to 0.01 seconds.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-if-a-query-hits-the-materialized-view">Check if a query hits the materialized view<a href="#check-if-a-query-hits-the-materialized-view" class="hash-link" aria-label="Direct link to Check if a query hits the materialized view" title="Direct link to Check if a query hits the materialized view">​</a></h3>
<p>Run EXPLAIN command again to check if the query hits the materialized view.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL &gt; EXPLAIN SELECT store_id, SUM(sale_amt) FROM sales_records GROUP BY store_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Explain String                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PLAN FRAGMENT 0                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  OUTPUT EXPRS:3: store_id | 6: sum                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   PARTITION: UNPARTITIONED                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   RESULT SINK                                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   4:EXCHANGE                                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PLAN FRAGMENT 1                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  OUTPUT EXPRS:                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   PARTITION: HASH_PARTITIONED: 3: store_id                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   STREAM DATA SINK                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     EXCHANGE ID: 04                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     UNPARTITIONED                                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   3:AGGREGATE (merge finalize)                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  output: sum(6: sum)                                                    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  group by: 3: store_id                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |                                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   2:EXCHANGE                                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PLAN FRAGMENT 2                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  OUTPUT EXPRS:                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   PARTITION: RANDOM                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   STREAM DATA SINK                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     EXCHANGE ID: 02                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|     HASH_PARTITIONED: 3: store_id                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   1:AGGREGATE (update serialize)                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  STREAMING                                                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  output: sum(5: sale_amt)                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |  group by: 3: store_id                                                  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |                                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   0:OlapScanNode                                                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      TABLE: sales_records                                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      PREAGGREGATION: ON                                                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      partitions=1/1                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      rollup: store_amt                                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      tabletRatio=10/10                                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      tabletList=12092,12096,12100,12104,12108,12112,12116,12120,12124,12128 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      cardinality=6                                                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      avgRowSize=2.0                                                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      numNodes=0                                                             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">45 rows in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, now the output of <code>rollup</code> section in the query profile is <code>store_amt</code>, which is the materialized view you have built. That means this query has hit the materialized view.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-the-building-status-of-a-materialized-view">Check the building status of a materialized view<a href="#check-the-building-status-of-a-materialized-view" class="hash-link" aria-label="Direct link to Check the building status of a materialized view" title="Direct link to Check the building status of a materialized view">​</a></h3>
<p>Creating a materialized view is an asynchronous operation. Running CREATE MATERIALIZED VIEW command successfully indicates that the task of creating the materialized view is submitted successfully. You can view the building status of the materialized view in a database via <a href="/docs/2.3/sql-reference/sql-statements/data-manipulation/SHOW_ALTER">SHOW ALTER</a> command.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL &gt; SHOW ALTER MATERIALIZED VIEW\G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          JobId: 12090</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableName: sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CreateTime: 2022-08-25 19:41:10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FinishedTime: 2022-08-25 19:41:39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BaseIndexName: sales_records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RollupIndexName: store_amt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       RollupId: 12091</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransactionId: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          State: FINISHED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Msg: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Progress: NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Timeout: 86400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>RollupIndexName</code> section indicates the name of the materialized view, and <code>State</code> section indicates if the building is completed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-the-schema-of-a-materialized-view">Check the schema of a materialized view<a href="#check-the-schema-of-a-materialized-view" class="hash-link" aria-label="Direct link to Check the schema of a materialized view" title="Direct link to Check the schema of a materialized view">​</a></h3>
<p>You can use DESC tbl_name ALL command to check the schema of a table and its subordinate materialized views.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL &gt; DESC sales_records ALL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+---------------+-----------+--------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| IndexName     | IndexKeysType | Field     | Type   | Null | Key   | Default | Extra |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+---------------+-----------+--------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| sales_records | DUP_KEYS      | record_id | INT    | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|               |               | seller_id | INT    | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|               |               | store_id  | INT    | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|               |               | sale_date | DATE   | Yes  | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|               |               | sale_amt  | BIGINT | Yes  | false | NULL    | NONE  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|               |               |           |        |      |       |         |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| store_amt     | AGG_KEYS      | store_id  | INT    | Yes  | true  | NULL    |       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|               |               | sale_amt  | BIGINT | Yes  | false | NULL    | SUM   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------+---------------+-----------+--------+------+-------+---------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 rows in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="drop-a-materialized-view">Drop a materialized view<a href="#drop-a-materialized-view" class="hash-link" aria-label="Direct link to Drop a materialized view" title="Direct link to Drop a materialized view">​</a></h3>
<p>Under the following circumstances, you need to drop a materialized view:</p>
<ul>
<li>
<p>You have created a wrong materialized view and you need to drop it before the building completed.</p>
</li>
<li>
<p>You have created too many materialized views, which results in a huge drop in load performance, and some of the materialized views are duplicate.</p>
</li>
<li>
<p>The frequency of the involved queries is low, and you can tolerate a relatively high query latency.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="drop-an-unfinished-materialized-view">Drop an unfinished materialized view<a href="#drop-an-unfinished-materialized-view" class="hash-link" aria-label="Direct link to Drop an unfinished materialized view" title="Direct link to Drop an unfinished materialized view">​</a></h4>
<p>You can drop a materialized view that is being created by canceling the in-progress creation task. First, you need to get the job ID <code>JobID</code> of the materialized view creation task by <a href="#check-the-building-status-of-a-materialized-view">checking the building status of the materialized view</a>. After getting the job ID, you need to cancel the creation task with the CANCEL ALTER command.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CANCEL ALTER TABLE ROLLUP FROM sales_records (12090);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="drop-an-existing-materialized-view">Drop an existing materialized view<a href="#drop-an-existing-materialized-view" class="hash-link" aria-label="Direct link to Drop an existing materialized view" title="Direct link to Drop an existing materialized view">​</a></h4>
<p>You can drop an existing materialized view with the <a href="/docs/2.3/sql-reference/sql-statements/data-definition/DROP_MATERIALIZED_VIEW">DROP MATERIALIZED VIEW</a> command.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> store_amt</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="exact-count-distinct">Exact count distinct<a href="#exact-count-distinct" class="hash-link" aria-label="Direct link to Exact count distinct" title="Direct link to Exact count distinct">​</a></h4>
<p>The following example is based on an advertisement business analysis table <code>advertiser_view_record</code>, which records the date that the ad is viewed <code>click_time</code>, the name of the ad <code>advertiser</code>, the channel of the ad <code>channel</code>, and the ID of the user who viewed the ID <code>user_id</code>.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> advertiser_view_record</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    click_time </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advertiser </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    channel </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">distributed</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">hash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">click_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Analysis is mainly focused on the UV of the ads.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> advertiser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">distinct</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> advertiser_view_record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> advertiser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To accelerate exact count distinct, you can create a materialized view based on this table and use the bitmap_union function to pre-aggregate the data.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> advertiser_uv </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> advertiser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bitmap_union</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to_bitmap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> advertiser_view_record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> advertiser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After the materialized view is created, the sub-query <code>count(distinct user_id)</code> in the subsequent queries will be automatically rewritten as <code>bitmap_union_count (to_bitmap(user_id))</code> so that they can hit the materialized view.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="approximate-count-distinct">Approximate count distinct<a href="#approximate-count-distinct" class="hash-link" aria-label="Direct link to Approximate count distinct" title="Direct link to Approximate count distinct">​</a></h4>
<p>Use the table <code>advertiser_view_record</code> above as an example again. To accelerate approximate count distinct, you can create a materialized view based on this table and use the <a href="/docs/2.3/sql-reference/sql-functions/aggregate-functions/hll_union">hll_union()</a> function to pre-aggregate the data.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> advertiser_uv2 </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> advertiser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hll_union</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hll_hash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> advertiser_view_record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> advertiser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-extra-sort-keys">Set extra sort keys<a href="#set-extra-sort-keys" class="hash-link" aria-label="Direct link to Set extra sort keys" title="Direct link to Set extra sort keys">​</a></h4>
<p>Suppose that the base table <code>tableA</code> contains columns <code>k1</code>, <code>k2</code> and <code>k3</code>, where only <code>k1</code> and <code>k2</code> are sort keys. If the query including the sub-query <code>where k3=x</code> must be accelerated, you can create a materialized view with <code>k3</code> as the first column.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> k3_as_key </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> k3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> k2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> k1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> tableA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="correspondence-of-aggregate-functions">Correspondence of aggregate functions<a href="#correspondence-of-aggregate-functions" class="hash-link" aria-label="Direct link to Correspondence of aggregate functions" title="Direct link to Correspondence of aggregate functions">​</a></h3>
<p>When a query is executed with a materialized view, the original query statement will be automatically rewritten and used to query the intermediate results stored in the materialized view. The following table shows the correspondence between the aggregate function in the original query and the aggregate function used to construct the materialized view. You can select the corresponding aggregate function to build a materialized view according to your business scenario.</p>
<table><thead><tr><th><strong>aggregate function in the original query</strong></th><th><strong>aggregate function of the materialized view</strong></th></tr></thead><tbody><tr><td>sum</td><td>sum</td></tr><tr><td>min</td><td>min</td></tr><tr><td>max</td><td>max</td></tr><tr><td>count</td><td>count</td></tr><tr><td>bitmap_union, bitmap_union_count, count(distinct)</td><td>bitmap_union</td></tr><tr><td>hll_raw_agg, hll_union_agg, ndv, approx_count_distinct</td><td>hll_union</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="caution">Caution<a href="#caution" class="hash-link" aria-label="Direct link to Caution" title="Direct link to Caution">​</a></h3>
<ul>
<li>
<p>Prior to StarRocks 2.4, materialized views only support aggregate functions on a single column. Query statements in the form of <code>sum(a+b)</code> are not supported.</p>
</li>
<li>
<p>Prior to StarRocks 2.4, clauses such as JOIN, WHERE, and GROUP BY are not supported in the materialized view creation statements.</p>
</li>
<li>
<p>The current version of StarRocks does not support creating multiple materialized views at the same time. A new materialized view can only be created when the one before is completed.</p>
</li>
<li>
<p>A materialized view supports only one aggregate function for each column of the base table. Query statements such as <code>select sum(a), min(a) from table</code> are not supported.</p>
</li>
<li>
<p>When using ALTER TABLE DROP COLUMN to drop a specific column in a base table, you need to ensure that all materialized views of the base table contain the dropped column, otherwise the drop operation cannot be performed. If you have to drop the column, you need to first drop all materialized views that do not contain the column, and then drop the column.</p>
</li>
<li>
<p>Creating too many materialized views for a table will affect the data load efficiency. When data is being loaded to the base table, the data in materialized view and base table will be updated synchronously. If a base table contains <code>n</code> materialized views, the efficiency of loading data into the base table is about the same as the efficiency of loading data into <code>n</code> tables.</p>
</li>
<li>
<p>You must use the GROUP BY clause when using aggregate functions and specify the GROUP BY column in your SELECT list.</p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/StarRocks/starrocks/edit/main/docs/using_starrocks/Materialized_view.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/2.3/using_starrocks/Lateral_join"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Use Lateral Join for column-to-row conversion</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/2.3/using_starrocks/Using_HLL"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Use HLL for approximate count distinct</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#basic-concepts" class="table-of-contents__link toc-highlight">Basic concepts</a></li><li><a href="#scenario" class="table-of-contents__link toc-highlight">Scenario</a></li><li><a href="#use-case" class="table-of-contents__link toc-highlight">Use case</a></li></ul></li><li><a href="#accelerate-queries-with-a-materialized-view" class="table-of-contents__link toc-highlight">Accelerate queries with a materialized view</a><ul><li><a href="#preparation" class="table-of-contents__link toc-highlight">Preparation</a></li><li><a href="#create-a-materialized-view" class="table-of-contents__link toc-highlight">Create a materialized view</a></li><li><a href="#query-with-the-materialized-view" class="table-of-contents__link toc-highlight">Query with the materialized view</a></li><li><a href="#check-if-a-query-hits-the-materialized-view" class="table-of-contents__link toc-highlight">Check if a query hits the materialized view</a></li><li><a href="#check-the-building-status-of-a-materialized-view" class="table-of-contents__link toc-highlight">Check the building status of a materialized view</a></li><li><a href="#check-the-schema-of-a-materialized-view" class="table-of-contents__link toc-highlight">Check the schema of a materialized view</a></li><li><a href="#drop-a-materialized-view" class="table-of-contents__link toc-highlight">Drop a materialized view</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a></li><li><a href="#correspondence-of-aggregate-functions" class="table-of-contents__link toc-highlight">Correspondence of aggregate functions</a></li><li><a href="#caution" class="table-of-contents__link toc-highlight">Caution</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/StarRocks_intro">Documentation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 StarRocks, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>