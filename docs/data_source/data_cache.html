<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.1 docs-doc-page docs-doc-id-data_source/data_cache" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-beta.0">
<title data-rh="true">Data Cache | StarRocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://danroscigno.github.io/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://danroscigno.github.io/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://danroscigno.github.io/doc/docs/data_source/data_cache"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.1"><meta data-rh="true" name="docsearch:version" content="3.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.1"><meta data-rh="true" property="og:title" content="Data Cache | StarRocks"><meta data-rh="true" name="description" content="This topic describes the working principles of Data Cache and how to enable Data Cache to improve query performance on external data."><meta data-rh="true" property="og:description" content="This topic describes the working principles of Data Cache and how to enable Data Cache to improve query performance on external data."><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danroscigno.github.io/doc/docs/data_source/data_cache"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/docs/data_source/data_cache" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/zh/docs/data_source/data_cache" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://danroscigno.github.io/doc/docs/data_source/data_cache" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ER08SJMRY1-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="StarRocks" href="/doc/opensearch.xml"><link rel="stylesheet" href="/doc/assets/css/styles.62f01ed5.css">
<script src="/doc/assets/js/runtime~main.ec766b52.js" defer="defer"></script>
<script src="/doc/assets/js/main.47f208f4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.starrocks.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/doc/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/img/logo.svg" alt="StarRocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StarRocks</b></a><a class="navbar__item navbar__link" href="/doc/docs/introduction/StarRocks_intro">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/doc/docs/introduction/StarRocks_intro">3.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/docs/next/examples/introduction">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/doc/docs/data_source/data_cache">3.1</a></li><li><a class="dropdown__link" href="/doc/docs/3.0/data_source/data_cache">3.0</a></li><li><a class="dropdown__link" href="/doc/docs/2.5/data_source/data_cache">2.5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/doc/docs/data_source/data_cache" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/doc/zh/docs/data_source/data_cache" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/StarRocks/starrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/introduction/StarRocks_intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/产品简介">产品简介</a><button aria-label="Expand sidebar category &#x27;产品简介&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/release-notes-1">Release Notes</a><button aria-label="Expand sidebar category &#x27;Release Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/快速开始">快速开始</a><button aria-label="Expand sidebar category &#x27;快速开始&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/deployment/deployment_overview">部署 StarRocks</a><button aria-label="Expand sidebar category &#x27;部署 StarRocks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/table_design/StarRocks_table_design">表设计</a><button aria-label="Expand sidebar category &#x27;表设计&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/loading/Loading_intro">导入数据</a><button aria-label="Expand sidebar category &#x27;导入数据&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/导出数据">导出数据</a><button aria-label="Expand sidebar category &#x27;导出数据&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/doc/docs/category/查询数据湖">查询数据湖</a><button aria-label="Collapse sidebar category &#x27;查询数据湖&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/doc/docs/data_source/catalog/catalog_overview">Catalog</a><button aria-label="Expand sidebar category &#x27;Catalog&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/data_source/External_table">(To be deprecated) External table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/data_source/file_external_table">File external table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/docs/data_source/data_cache">Data Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/data_source/datalake_faq">Data lake-related FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/查询加速">查询加速</a><button aria-label="Expand sidebar category &#x27;查询加速&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/外部系统集成">外部系统集成</a><button aria-label="Expand sidebar category &#x27;外部系统集成&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/管理手册">管理手册</a><button aria-label="Expand sidebar category &#x27;管理手册&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/参考手册">参考手册</a><button aria-label="Expand sidebar category &#x27;参考手册&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/faq-1">FAQ</a><button aria-label="Expand sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/benchmarks-1">Benchmarks</a><button aria-label="Expand sidebar category &#x27;Benchmarks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/developers-1">Developers</a><button aria-label="Expand sidebar category &#x27;Developers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/docs/category/ecosystem-release-notes-1">Ecosystem Release Notes</a><button aria-label="Expand sidebar category &#x27;Ecosystem Release Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/doc/docs/category/查询数据湖"><span itemprop="name">查询数据湖</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Data Cache</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Data Cache</h1>
<p>This topic describes the working principles of Data Cache and how to enable Data Cache to improve query performance on external data.</p>
<p>In data lake analytics, StarRocks works as an OLAP engine to scan data files stored in external storage systems, such as HDFS and Amazon S3. The I/O overhead increases as the number of files to scan increases. In addition, in some ad hoc scenarios, frequent access to the same data doubles I/O overhead.</p>
<p>To optimize the query performance in these scenarios, StarRocks 2.5 provides the Data Cache feature. This feature splits data in an external storage system into multiple blocks based on predefined policies and caches the data on StarRocks backends (BEs). This eliminates the need to pull data from external systems for each access request and accelerates queries and analysis on hot data. Data Cache only works when you query data from external storage systems by using external catalogs or external tables (excluding external tables for JDBC-compatible databases). It does not work when you query StarRocks native tables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h2>
<p>StarRocks splits data in an external storage system into multiple blocks of the same size, and caches the data on BEs. Block is the smallest unit of data cache, which is configurable.</p>
<p>For example, if you set the block size to 1 MB and you want to query a Parquet file of 128 MB from Amazon S3, StarRocks splits the file into 128 blocks. The blocks are [0, 1 MB), [1 MB, 2 MB), [2 MB, 3 MB) ... [127 MB, 128 MB). StarRocks assigns a globally unique ID to each block, called a cache key. A cache key consists of the following three parts.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hash(filename) + fileModificationTime + blockId</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following table provides descriptions of each part.</p>
<table><thead><tr><th><strong>Component item</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>filename</td><td>The name of the data file.</td></tr><tr><td>fileModificationTime</td><td>The last modification time of the data file.</td></tr><tr><td>blockId</td><td>The ID that StarRocks assigns to a block when splitting the data file. The ID is unique under the same data file but is not unique within your StarRocks cluster.</td></tr></tbody></table>
<p>If the query hits the [1 MB, 2 MB) block, StarRocks performs the following operations:</p>
<ol>
<li>Check whether the block exists in the cache.</li>
<li>If the block exists, StarRocks reads the block from the cache. If the block does not exist, StarRocks reads the block from Amazon S3 and caches it on a BE.</li>
</ol>
<p>After Data Cache is enabled, StarRocks caches data blocks read from external storage systems. If you do not want to cache such data blocks, run the following command:</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> enable_populate_block_cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For more information about <code>enable_populate_block_cache</code>, see <a href="/doc/docs/reference/System_variable">System variables</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="storage-media-of-blocks">Storage media of blocks<a href="#storage-media-of-blocks" class="hash-link" aria-label="Direct link to Storage media of blocks" title="Direct link to Storage media of blocks">​</a></h2>
<p>StarRocks uses the memory and disks of BE machines to cache blocks. It supports cache solely on memory or on both the memory and disks.</p>
<p>If you use disks as the storage media, the cache speed is directly affected by the performance of disks. Therefore, we recommend that you use high-performance disks such as NVMe disks for data cache. If you do not have high-performance disks, you can add more disks to relieve disk I/O pressure.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cache-replacement-policies">Cache replacement policies<a href="#cache-replacement-policies" class="hash-link" aria-label="Direct link to Cache replacement policies" title="Direct link to Cache replacement policies">​</a></h2>
<p>StarRocks uses the <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)" target="_blank" rel="noopener noreferrer">least recently used</a> (LRU) policy to cache and discard data.</p>
<ul>
<li>StarRocks first reads data from memory. If the data is not found in memory, StarRocks will read the data from disks and try to load the data read from disks into memory.</li>
<li>Data discarded from memory will be written to disks. Data discarded from disks will be deleted.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-data-cache">Enable Data Cache<a href="#enable-data-cache" class="hash-link" aria-label="Direct link to Enable Data Cache" title="Direct link to Enable Data Cache">​</a></h2>
<p>Data Cache is disabled by default. To enable this feature, configure FEs and BEs in your StarRocks cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configurations-for-fes">Configurations for FEs<a href="#configurations-for-fes" class="hash-link" aria-label="Direct link to Configurations for FEs" title="Direct link to Configurations for FEs">​</a></h3>
<p>You can enable Data Cache for FEs by using one of the following methods:</p>
<ul>
<li>
<p>Enable Data Cache for a given session based on your requirements.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> enable_scan_block_cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Enable Data Cache for all active sessions.</p>
<div class="language-SQL language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">GLOBAL</span><span class="token plain"> enable_scan_block_cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configurations-for-bes">Configurations for BEs<a href="#configurations-for-bes" class="hash-link" aria-label="Direct link to Configurations for BEs" title="Direct link to Configurations for BEs">​</a></h3>
<p>Add the following parameters to the <strong>conf/be.conf</strong> file of each BE. Then restart each BE to make the settings take effect.</p>
<table><thead><tr><th><strong>Parameter</strong></th><th><strong>Description</strong></th><th><strong>Default value</strong></th></tr></thead><tbody><tr><td>block_cache_enable</td><td>Whether to enable Data Cache.<ul><li><code>true</code>: Data Cache is enabled.</li><li><code>false</code>: Data Cache is disabled.</li></ul></td><td>false</td></tr><tr><td>block_cache_disk_path</td><td>The paths of disks. You can configure more than one disk and separate the disk paths with semicolons (;). We recommend that the number of paths you configured be the same as the number of disks of your BE machine. When the BE starts, StarRocks automatically creates a disk cache directory (the creation fails if no parent directory exists).</td><td><code>${STARROCKS_HOME}/block_cache</code></td></tr><tr><td>block_cache_meta_path</td><td>The storage path of block metadata. You can leave this parameter unspecified.</td><td><code>${STARROCKS_HOME}/block_cache</code></td></tr><tr><td>block_cache_mem_size</td><td>The maximum amount of data that can be cached in the memory. Unit: bytes. We recommend that you set the value of this parameter to at least 20 GB. If StarRocks reads a large amount of data from disks after Data Cache is enabled, consider increasing the value.</td><td><code>2147483648</code>, which is 2 GB.</td></tr><tr><td>block_cache_disk_size</td><td>The maximum amount of data that can be cached in a single disk. Unit: bytes. For example, if you configure two disk paths for the <code>block_cache_disk_path</code> parameter and set the value of the <code>block_cache_disk_size</code> parameter to <code>21474836480</code> (20 GB), a maximum of 40 GB data can be cached in these two disks.</td><td><code>0</code>, which indicates that only the memory is used to cache data.</td></tr></tbody></table>
<p>Examples of setting these parameters.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable Data Cache.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">block_cache_enable = true  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure the disk path. Assume the BE machine is equipped with two disks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">block_cache_disk_path = /home/disk1/sr/dla_cache_data/;/home/disk2/sr/dla_cache_data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set block_cache_mem_size to 2 GB.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">block_cache_mem_size = 2147483648</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set block_cache_disk_size to 1.2 TB.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">block_cache_disk_size = 1288490188800</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="check-whether-a-query-hits-data-cache">Check whether a query hits data cache<a href="#check-whether-a-query-hits-data-cache" class="hash-link" aria-label="Direct link to Check whether a query hits data cache" title="Direct link to Check whether a query hits data cache">​</a></h2>
<p>You can check whether a query hits data cache by analyzing the following metrics in the query profile:</p>
<ul>
<li><code>BlockCacheReadBytes</code>: the amount of data that StarRocks reads directly from its memory and disks.</li>
<li><code>BlockCacheWriteBytes</code>: the amount of data loaded from an external storage system to StarRocks&#x27; memory and disks.</li>
<li><code>BytesRead</code>: the total amount of data that is read, including data that StarRocks reads from an external storage system, its memory, and disks.</li>
</ul>
<p>Example 1: In this example, StarRocks reads a large amount of data (7.65 GB) from the external storage system and only a few data (518.73 MB) from the memory and disks. This means that few data caches were hit.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> - Table: lineorder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BlockCacheReadBytes: 518.73 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BlockCacheReadBytes: 4.73 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BlockCacheReadBytes: 16.00 KB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BlockCacheReadCounter: 684</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BlockCacheReadCounter: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BlockCacheReadCounter: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BlockCacheReadTimer: 737.357us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BlockCacheWriteBytes: 7.65 GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BlockCacheWriteBytes: 64.39 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BlockCacheWriteBytes: 0.00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BlockCacheWriteCounter: 7.887K (7887)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BlockCacheWriteCounter: 65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BlockCacheWriteCounter: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BlockCacheWriteTimer: 23.467ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BlockCacheWriteTimer: 62.280ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BlockCacheWriteTimer: 0ns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BufferUnplugCount: 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BufferUnplugCount: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BufferUnplugCount: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - BytesRead: 7.65 GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MAX_OF_BytesRead: 64.39 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - __MIN_OF_BytesRead: 0.00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Example 2: In this example, StarRocks reads a large amount of data (46.08 GB) from data cache and no data from the external storage system, which means StarRocks reads data only from data cache.</p>
<div class="language-Plain language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Table: lineitem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BlockCacheReadBytes: 46.08 GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MAX_OF_BlockCacheReadBytes: 194.99 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MIN_OF_BlockCacheReadBytes: 81.25 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BlockCacheReadCounter: 72.237K (72237)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MAX_OF_BlockCacheReadCounter: 299</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MIN_OF_BlockCacheReadCounter: 118</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BlockCacheReadTimer: 856.481ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MAX_OF_BlockCacheReadTimer: 1s547ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MIN_OF_BlockCacheReadTimer: 261.824ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BlockCacheWriteBytes: 0.00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BlockCacheWriteCounter: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BlockCacheWriteTimer: 0ns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BufferUnplugCount: 1.231K (1231)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MAX_OF_BufferUnplugCount: 81</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MIN_OF_BufferUnplugCount: 35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- BytesRead: 46.08 GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MAX_OF_BytesRead: 194.99 MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> - __MIN_OF_BytesRead: 81.25 MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/StarRocks/starrocks/tree/main/versioned_docs/version-3.1/data_source/data_cache.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/docs/data_source/file_external_table"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">File external table</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/docs/data_source/datalake_faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data lake-related FAQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#storage-media-of-blocks" class="table-of-contents__link toc-highlight">Storage media of blocks</a></li><li><a href="#cache-replacement-policies" class="table-of-contents__link toc-highlight">Cache replacement policies</a></li><li><a href="#enable-data-cache" class="table-of-contents__link toc-highlight">Enable Data Cache</a><ul><li><a href="#configurations-for-fes" class="table-of-contents__link toc-highlight">Configurations for FEs</a></li><li><a href="#configurations-for-bes" class="table-of-contents__link toc-highlight">Configurations for BEs</a></li></ul></li><li><a href="#check-whether-a-query-hits-data-cache" class="table-of-contents__link toc-highlight">Check whether a query hits data cache</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/docs/introduction/StarRocks_intro">Documentation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 StarRocks, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>